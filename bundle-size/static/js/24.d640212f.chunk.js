(this["webpackJsonpambire-wallet"]=this["webpackJsonpambire-wallet"]||[]).push([[24],{1595:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return d}));var a=r(2),n=r.n(a),s=r(11),c=r(8),i=(r(975),r(3)),o=r(36),u=r(85),l=r(728),p=r(37),b=r(4);function d(e){var t=e.relayerURL,r=e.onAddAccount,a=Object(i.useState)(null),d=Object(c.a)(a,2),j=d[0],m=d[1],h=Object(i.useState)(""),O=Object(c.a)(h,2),f=O[0],g=O[1],x=Object(i.useState)(!1),y=Object(c.a)(x,2),v=y[0],k=y[1],w=Object(p.e)({key:"loginSessionKey",isStringStorage:!0}),S=Object(c.a)(w,3),A=S[0],C=S[1],N=S[2],q=function(){var e=Object(s.a)(n.a.mark((function e(a,s){var c,i,o,l,p,b,d,j,h,O,f,x,y,v,k,w,S;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=a.email,i=a.passphrase,e.next=3,Object(u.b)("".concat(t,"/identity/by-email/").concat(encodeURIComponent(c)),{headers:{authorization:A?"Bearer ".concat(A):null}});case 3:if(o=e.sent,l=o.resp,p=o.body,!(b=o.errMsg)){e.next=10;break}return g(b),e.abrupt("return");case 10:if(401!==l.status||"UNAUTHORIZED"!==p.errType){e.next=26;break}if(!s){e.next=14;break}return m({email:c,passphrase:i}),e.abrupt("return");case 14:return e.next=16,Object(u.a)("".concat(t,"/identity/by-email/").concat(encodeURIComponent(c),"/request-confirm-login"),{method:"POST"});case 16:if(200===(d=e.sent).status){e.next=20;break}return g("Email confirmation needed but unable to request: ".concat(d.status)),e.abrupt("return");case 20:return e.next=22,d.json();case 22:return j=e.sent.sessionKey,C(j),m({email:c,passphrase:i}),e.abrupt("return");case 26:if(404!==l.status||"DOES_NOT_EXIST"!==p.errType){e.next=30;break}return m(null),g("Account does not exist"),e.abrupt("return");case 30:200===l.status?(O=(h=p)._id,f=h.salt,x=h.identityFactoryAddr,y=h.baseIdentityAddr,v=h.bytecode,k=h.meta,w=k.quickAccSigner,S=k.primaryKeyBackup,r({id:O,email:h.meta.email,primaryKeyBackup:S,salt:f,identityFactoryAddr:x,baseIdentityAddr:y,bytecode:v,signer:w},{select:!0}),N()):g(p.message?"Relayer error: ".concat(p.message):"Unknown no-message error: ".concat(l.status)),m(null);case 32:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),I=function(){var e=Object(s.a)(n.a.mark((function e(t){var r,a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.email,a=t.passphrase,g(""),m(null),k(!0),e.prev=4,e.next=7,q({email:r,passphrase:a});case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(4),g("Unexpected error: ".concat(e.t0.message||e.t0));case 12:k(!1);case 13:case"end":return e.stop()}}),e,null,[[4,9]])})));return function(t){return e.apply(this,arguments)}}();Object(i.useEffect)((function(){if(j){var e=setTimeout(Object(s.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k(!0),e.next=3,q(j,!0);case 3:k(!1);case 4:case"end":return e.stop()}}),e)}))),3e3);return function(){return clearTimeout(e)}}}));if(!t)return Object(b.jsxs)("section",{className:"loginSignupWrapper",id:"emailLoginSection",children:[Object(b.jsx)("div",{id:"logo"}),Object(b.jsx)("h3",{className:"error",children:"Email login not supported without the relayer."}),Object(b.jsx)("a",{href:"/#/json-import",children:Object(b.jsx)("button",{children:"Import JSON"})})]});var T=j?Object(b.jsxs)("div",{id:"loginEmail",className:"emailConf",children:[Object(b.jsxs)("h3",{children:[Object(b.jsx)(o.p,{size:25,color:"white"}),"Email confirmation required"]}),Object(b.jsxs)("p",{children:["We sent an email to ",j.email,', please check your inbox and click "',Object(b.jsx)("b",{children:"Authorize New Device"}),'".']}),f?Object(b.jsx)("p",{className:"error",children:f}):Object(b.jsx)(b.Fragment,{})]}):Object(b.jsxs)("div",{id:"loginEmail",children:[Object(b.jsx)(l.a,{onAccRequest:I,inProgress:v}),Object(b.jsx)("div",{className:"magicLink",children:"A password will not be required, we will send a magic login link to your email."}),f?Object(b.jsx)("p",{className:"error",children:f}):Object(b.jsx)(b.Fragment,{})]});return Object(b.jsxs)("section",{className:"loginSignupWrapper",id:"emailLoginSection",children:[Object(b.jsx)("div",{id:"logo"}),T]})}},728:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var a=r(7),n=r(8),s=r(3),c=r(151),i=r(79),o=r(4);function u(e){var t=e.action,r=void 0===t?"LOGIN":t,u=e.onAccRequest,l=e.inProgress,p=Object(s.useRef)(null),b=Object(s.useState)({email:"",passphrase:"",passphraseConfirm:"",action:r}),d=Object(n.a)(b,2),j=d[0],m=d[1],h=function(e){var t=Object(a.a)(Object(a.a)({},j),e);m(t);var r="SIGNUP"===t.action&&t.passphrase!==t.passphraseConfirm;p.current&&p.current.setCustomValidity(r?"Passwords must match":"")},O="SIGNUP"===j.action,f=Math.ceil(c.a.quickAccTimelock/86400),g="In case you forget your password or lose your backup, you will have to wait ".concat(f," days and pay the recovery fee to restore access to your account."),x=j.backupOptout?Object(o.jsx)(i.g,{label:g,required:!0}):Object(o.jsx)(o.Fragment,{}),y=function(e){var t=e.href,r=e.children;return Object(o.jsx)("a",{href:t,target:"_blank",rel:"noreferrer",onClick:function(e){return e.stopPropagation()},children:r})},v=O?Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)("input",{type:"password",required:!0,minLength:8,placeholder:"Password",value:j.passphrase,onChange:function(e){return h({passphrase:e.target.value})}}),Object(o.jsx)("input",{ref:p,required:!0,minLength:8,type:"password",placeholder:"Confirm password",value:j.passphraseConfirm,onChange:function(e){return h({passphraseConfirm:e.target.value})}}),Object(o.jsx)(i.g,{label:Object(o.jsxs)(o.Fragment,{children:["I agree to the ",Object(o.jsx)(y,{href:"https://www.ambire.com/Ambire%20ToS%20and%20PP%20(26%20November%202021).pdf",children:"Terms of Service and Privacy policy"}),"."]}),required:!0}),Object(o.jsx)(i.g,{label:Object(o.jsxs)(o.Fragment,{children:["Backup on ",Object(o.jsx)(y,{href:"https://help.ambire.com/hc/en-us/articles/4410892186002-What-is-Ambire-Cloud-",children:"Ambire Cloud"}),"."]}),checked:!j.backupOptout,onChange:function(e){return h({backupOptout:!e.target.checked})}}),x]}):Object(o.jsx)(o.Fragment,{});return Object(o.jsxs)("form",{onSubmit:function(e){e.preventDefault(),u({action:j.action,accType:"QUICK",email:j.email,passphrase:j.passphrase,backupOptout:j.backupOptout})},children:[Object(o.jsx)("input",{type:"email",required:!0,placeholder:"Email",value:j.email,onChange:function(e){return h({email:e.target.value})}}),O?Object(o.jsx)(o.Fragment,{}):Object(o.jsx)("input",{type:"password",style:{display:"none"}}),v,Object(o.jsx)("input",{type:"submit",disabled:l,value:O?l?"Signing up...":"Sign up":l?"Logging in...":"Log in"})]})}},975:function(e,t,r){}}]);
//# sourceMappingURL=24.d640212f.chunk.js.map