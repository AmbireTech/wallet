(this["webpackJsonpambire-wallet"]=this["webpackJsonpambire-wallet"]||[]).push([[3],{614:function(e,r,t){"use strict";t.d(r,"a",(function(){return m}));var n=t(2),a=t.n(n),s=t(11),c=t(8),o=t(671),i=t(727),u=t.n(i),d=t(55),f=t(611),p=t.n(f),h=t(675),w=t(703),b=t(632),l=t(617),x=t(21),v=t(87),g=t(60),y={};function m(e){var r=e.signer,t=e.signerExtra,n=e.chainId,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s="".concat(r.address||r.one).concat(n);return y[s]?y[s]:y[s]=k({signer:r,signerExtra:t,chainId:n},a)}function k(e,r){var t=e.chainId,n=e.signer,i=e.signerExtra;if(i&&"trezor"===i.type){u.a.manifest({email:"contactus@ambire.com",appUrl:"https://wallet.ambire.com"});var f=new o.TrezorSubprovider({trezorConnectClientApi:u.a,networkId:t});return f._initialDerivedKeyInfo=function(e){return{hdKey:p.a.fromExtendedKey(e.info.hdKey.xpub),derivationPath:e.info.derivationPath,baseDerivationPath:e.info.baseDerivationPath}}(i),{signMessage:function(e){return f.signPersonalMessageAsync(d.ethers.utils.hexlify(e),n.address)},signTransaction:function(e){return f.signTransactionAsync(Object(c.a)(Object(c.a)({},e),{},{from:n.address}))},sendTransaction:function(){var e=Object(s.a)(a.a.mark((function e(r){var t,n,s,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=g.a.find((function(e){return e.chainId===r.chainId}))){e.next=3;break}throw Error("no network found for chainId : "+r.chainId);case 3:return e.next=5,Object(v.a)(t.id);case 5:if(n=e.sent){e.next=8;break}throw Error("no provider found for network : "+t.id);case 8:return e.t0=d.ethers.utils,e.next=11,n.getTransactionCount(r.from);case 11:return e.t1=e.sent,r.nonce=e.t0.hexlify.call(e.t0,e.t1),s=d.ethers.utils.hexlify(r.gas||r.gasLimit),r.gasPrice=d.ethers.utils.hexlify(r.gasPrice),r=Object(c.a)(Object(c.a)({},r),{},{gas:s}),e.next=18,f.signTransactionAsync(r);case 18:return o=e.sent,e.abrupt("return",n.sendTransaction(o));case 20:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),isConnected:function(){var e=Object(s.a)(a.a.mark((function e(r){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.getAccountsAsync(100);case 2:return t=e.sent,e.abrupt("return",t.map((function(e){return e.toLowerCase()})).includes(r.toLowerCase()));case 4:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),_signTypedData:function(){var e=Object(s.a)(a.a.mark((function e(r,t,s){var c,o,i,u,d,p,h;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=x._TypedDataEncoder.hashDomain(r),o=x._TypedDataEncoder.hashStruct(x._TypedDataEncoder.getPrimaryType(t),t,s),i=x._TypedDataEncoder.getPayload(r,t,s),e.next=5,f._initialDerivedKeyInfoAsync();case 5:return u=e.sent,d=f._findDerivedKeyInfoForAddress(u,n.address),p=d.derivationPath,e.next=10,f._trezorConnectClientApi.ethereumSignTypedData({path:p,data:i,metamask_v4_compat:!0,domain_separator_hash:c,message_hash:o});case 10:if(!(h=e.sent).success){e.next=15;break}return e.abrupt("return","".concat(h.payload.signature));case 15:throw new Error(h.payload.error);case 16:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}()}}if(i&&"ledger"===i.type){if("webHID"===i.transportProtocol)return{signMessage:function(e){return Object(b.c)(d.ethers.utils.hexlify(e),n.address)},signTransaction:function(e){return Object(b.e)(e,t)},sendTransaction:function(){var e=Object(s.a)(a.a.mark((function e(r){var t,n,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=g.a.find((function(e){return e.chainId===r.chainId}))){e.next=3;break}throw Error("no network found for chainId : "+r.chainId);case 3:return e.next=5,Object(v.a)(t.id);case 5:if(n=e.sent){e.next=8;break}throw Error("no provider found for network : "+t.id);case 8:return e.t0=d.ethers.utils,e.next=11,n.getTransactionCount(r.from);case 11:return e.t1=e.sent,r.nonce=e.t0.hexlify.call(e.t0,e.t1),e.next=15,Object(b.e)(r,r.chainId);case 15:return s=e.sent,e.abrupt("return",n.sendTransaction(s));case 17:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),isConnected:function(){var e=Object(s.a)(a.a.mark((function e(r){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.b)();case 2:if(!(t=e.sent)||!t[0]){e.next=7;break}if(!r){e.next=6;break}return e.abrupt("return",!!t.find((function(e){return e.toLowerCase()===r.toLowerCase()})));case 6:return e.abrupt("return",!0);case 7:return e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),_signTypedData:function(e,r,t){var a=x._TypedDataEncoder.hashDomain(e),s=x._TypedDataEncoder.hashStruct(x._TypedDataEncoder.getPrimaryType(r),r,t);return Object(b.d)(a,s,n.address)}};var y=new h.LedgerSubprovider({networkId:t,ledgerEthereumClientFactoryAsync:w.ledgerEthereumBrowserClientFactoryAsync,baseDerivationPath:i.info.baseDerivationPath});return{signMessage:function(e){return y.signPersonalMessageAsync(d.ethers.utils.hexlify(e),n.address)},signTransaction:function(e){return y.signTransactionAsync(Object(c.a)(Object(c.a)({},e),{},{from:n.address}))},sendTransaction:function(){var e=Object(s.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Please use a chrome based browser to use Ledger");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),isConnected:function(){var e=Object(s.a)(a.a.mark((function e(r){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.getAccountsAsync(1);case 2:return t=e.sent,e.abrupt("return",t.map((function(e){return e.toLowerCase()})).includes(r.toLowerCase()));case 4:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),_signTypedData:function(e,r,t){throw Error("Please, use a chrome based browser to use 721 Typed signatures")}}}if(i&&"Lattice"===i.type)return{signMessage:function(){var e=Object(s.a)(a.a.mark((function e(r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(function(){var e=Object(s.a)(a.a.mark((function e(r){var t,n,s,c,o,u,d,f,p;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.commKey,n=i.deviceId,s=Object(l.c)(t),e.next=4,Object(l.a)(s,n);case 4:if(c=e.sent,o=c.isPaired,!(u=c.errConnect)){e.next=9;break}throw new Error(u.message||u);case 9:if(o){e.next=12;break}throw s.pair(""),new Error("The Lattice device is not paired! Please re-add your account!");case 12:return e.next=14,Object(l.e)(s,r);case 14:if(d=e.sent,f=d.signedMsg,!(p=d.errSignMessage)){e.next=19;break}throw new Error(p);case 19:return e.abrupt("return",f);case 20:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),[r]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),signTransaction:function(){var e=Object(s.a)(a.a.mark((function e(r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(function(){var e=Object(s.a)(a.a.mark((function e(r){var n,s,c,o,u,d,f,p,h;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.commKey,s=i.deviceId,c=Object(l.c)(n),e.next=4,Object(l.a)(c,s);case 4:if(o=e.sent,u=o.isPaired,!(d=o.errConnect)){e.next=9;break}throw new Error(d.message||d);case 9:if(u){e.next=12;break}throw c.pair(""),new Error("The Lattice device is not paired! Please re-add your account!");case 12:return e.next=14,Object(l.g)(c,r,t);case 14:if(f=e.sent,p=f.serializedSigned,!(h=f.errSignTxn)){e.next=19;break}throw new Error(h);case 19:return e.abrupt("return",p);case 20:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),[r]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),sendTransaction:function(){var e=Object(s.a)(a.a.mark((function e(r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(function(){var e=Object(s.a)(a.a.mark((function e(r){var n,s,c,o,u,f,p,h,w,b,x;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=g.a.find((function(e){return e.chainId===r.chainId}))){e.next=3;break}throw Error("no network found for chainId : "+r.chainId);case 3:return e.next=5,Object(v.a)(n.id);case 5:if(s=e.sent){e.next=8;break}throw Error("no provider found for network : "+n.id);case 8:return e.t0=d.ethers.utils,e.next=11,s.getTransactionCount(r.from);case 11:return e.t1=e.sent,r.nonce=e.t0.hexlify.call(e.t0,e.t1),c=i.commKey,o=i.deviceId,u=Object(l.c)(c),e.next=17,Object(l.a)(u,o);case 17:if(f=e.sent,p=f.isPaired,!(h=f.errConnect)){e.next=22;break}throw new Error(h.message||h);case 22:if(p){e.next=25;break}throw u.pair(""),new Error("The Lattice device is not paired! Please re-add your account!");case 25:return e.next=27,Object(l.g)(u,r,t);case 27:if(w=e.sent,b=w.serializedSigned,!(x=w.errSignTxn)){e.next=32;break}throw new Error(x);case 32:return e.abrupt("return",s.sendTransaction(b));case 33:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),[r]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),isConnected:function(){var e=Object(s.a)(a.a.mark((function e(r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(function(){var e=Object(s.a)(a.a.mark((function e(r){var t,n,s,c,o,u,d,f,p,h;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=null,n=i.commKey,s=i.deviceId,c=Object(l.c)(n),e.next=5,Object(l.a)(c,s);case 5:if(o=e.sent,u=o.isPaired,!(d=o.errConnect)){e.next=10;break}throw new Error(d.message||d);case 10:if(u){e.next=13;break}throw c.pair(""),new Error("The Lattice device is not paired! Please re-add your account!");case 13:return e.next=15,Object(l.b)(c);case 15:if(f=e.sent,p=f.res,!(h=f.errGetAddresses)){e.next=20;break}throw new Error("Lattice: ".concat(h),{error:!0});case 20:return t=p,e.abrupt("return",t.map((function(e){return e.toLowerCase()})).includes(r.toLowerCase()));case 22:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),[r]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),_signTypedData:function(){var e=Object(s.a)(a.a.mark((function e(r,t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(function(){var e=Object(s.a)(a.a.mark((function e(r,t,n){var s,c,o,u,d,f,p,h,w,b;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=x._TypedDataEncoder.getPayload(r,t,n),c=i.commKey,o=i.deviceId,u=Object(l.c)(c),e.next=5,Object(l.a)(u,o);case 5:if(d=e.sent,f=d.isPaired,!(p=d.errConnect)){e.next=10;break}throw new Error(p.message||p);case 10:if(f){e.next=13;break}throw u.pair(""),new Error("The Lattice device is not paired! Please re-add your account!");case 13:return e.next=15,Object(l.f)(u,s);case 15:if(h=e.sent,w=h.signedMsg,!(b=h.errSignMessage)){e.next=20;break}throw new Error(b);case 20:return e.abrupt("return",w);case 21:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),[r,t,n]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}()};if(n.address){if(!window.ethereum)throw new Error("No web3 support detected in your browser: if you created this account through MetaMask, please install it.");var m=new d.ethers.providers.Web3Provider(window.ethereum,"any"),k=m.getSigner(n.address);return k.isConnected=function(){var e=Object(s.a)(a.a.mark((function e(r,t){var n,s,c,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.listAccounts();case 2:if(n=e.sent,s=!0,!n.length){e.next=14;break}if(r&&(s=!!n.find((function(e){return e.toLowerCase()===r.toLowerCase()}))),!t){e.next=12;break}return e.next=9,m.getNetwork();case 9:c=e.sent,o=c.chainId,s=s&&o===t;case 12:e.next=15;break;case 14:s=!1;case 15:return e.abrupt("return",s);case 16:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),k}throw n.one?new Error("getWallet not applicable for QuickAccounts: use primaryKeyBackup with the passphrase and /second-sig"):new Error("unknown signer type")}function j(e,r){return O.apply(this,arguments)}function O(){return(O=Object(s.a)(a.a.mark((function e(r,t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.apply(this,t).catch((function(e){throw new Error("Lattice: ".concat(e.message))}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},632:function(e,r,t){"use strict";(function(e){t.d(r,"a",(function(){return h})),t.d(r,"b",(function(){return l})),t.d(r,"e",(function(){return k})),t.d(r,"c",(function(){return O})),t.d(r,"d",(function(){return T}));var n=t(8),a=t(2),s=t.n(a),c=t(11),o=t(710),i=t(717),u=t(619),d=t(231),f=t(611),p=null,h="44'/60'/0'/0";function w(){return b.apply(this,arguments)}function b(){return(b=Object(c.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.list();case 2:if(!(p=e.sent).length){e.next=11;break}if(!p[0].opened){e.next=8;break}return e.abrupt("return",new o.a(p[0]));case 8:return e.abrupt("return",o.a.open(p[0]));case 9:e.next=22;break;case 11:return e.prev=11,e.next=14,o.a.request();case 14:return e.abrupt("return",e.sent);case 17:if(e.prev=17,e.t0=e.catch(11),!e.t0.message.includes("reading 'open'")){e.next=21;break}throw new Error("ledger WebHID request denied");case 21:throw new Error("Could not request WebHID ledger: "+e.t0.message);case 22:case"end":return e.stop()}}),e,null,[[11,17]])})))).apply(this,arguments)}function l(){return x.apply(this,arguments)}function x(){return(x=Object(c.a)(s.a.mark((function e(){var r,t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w();case 2:return r=e.sent,e.next=5,v(r);case 5:return t=e.sent,r.close(),e.abrupt("return",t.map((function(e){return e.address})));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return g.apply(this,arguments)}function g(){return(g=Object(c.a)(s.a.mark((function r(t){var n,a,c,o,i;return s.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n="m/".concat(h),r.next=3,y(t,n).then((function(e){return e})).catch((function(e){throw 25871===e.statusCode||27404===e.statusCode?Error("Please make sure your ledger is unlocked and running the Ethereum app. "+e.message):Error("Could not get address from ledger : "+e)}));case 3:return a=r.sent,(c=new f).publicKey=e.from(a.publicKey,"hex"),c.chainCode=e.from(a.chainCode,"hex"),o=I(c),i={hdKey:c,address:o,derivationPath:n,baseDerivationPath:h},r.abrupt("return",C(i,1));case 10:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function y(e,r){return m.apply(this,arguments)}function m(){return(m=Object(c.a)(s.a.mark((function e(r,t){var n,a,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new i.a(r),c=new Promise((function(e,r){n=setTimeout((function(){return r(new Error("Device took too long to respond..."))}),1e4)})),e.abrupt("return",Promise.race([a.getAddress(t,!1,!0),c]).then((function(e){return clearTimeout(n),e})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e,r){return j.apply(this,arguments)}function j(){return(j=Object(c.a)(s.a.mark((function e(r,t){var a,c,o,d,f,p,h,b;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w();case 2:return a=e.sent,c=r.from,delete(o=Object(n.a)(Object(n.a)({},r),{},{gasLimit:r.gasLimit||r.gas,chainId:t})).from,delete o.gas,d=Object(u.a)(o),e.next=10,v(a);case 10:if(f=e.sent,f[0].address.toLowerCase()!==c.toLowerCase()){e.next=30;break}return e.prev=13,e.next=16,new i.a(a).signTransaction(f[0].derivationPath,d.substr(2));case 16:h=e.sent,e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(13),new Error("Could not sign transaction "+e.t0);case 22:if(b=parseInt(h.v,16),Math.floor((b-35)/2)===t){e.next=26;break}throw new Error("Invalid returned V 0x"+h.v);case 26:delete o.v,p=Object(u.a)(o,{r:"0x"+h.r,s:"0x"+h.s,v:b}),e.next=31;break;case 30:throw new Error("Incorrect address. Are you using the correct account/ledger?");case 31:return a.close(),e.abrupt("return",p);case 33:case"end":return e.stop()}}),e,null,[[13,19]])})))).apply(this,arguments)}function O(e,r){return E.apply(this,arguments)}function E(){return(E=Object(c.a)(s.a.mark((function e(r,t){var n,a,c,o,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w();case 2:return n=e.sent,e.next=5,v(n);case 5:if(a=e.sent,(c=a[0]).address.toLowerCase()!==t.toLowerCase()){e.next=20;break}return e.prev=8,e.next=11,new i.a(n).signPersonalMessage(c.derivationPath,r.substr(2));case 11:u=e.sent,o="0x"+u.r+u.s+u.v.toString(16),e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(8),new Error("Signature denied "+e.t0.message);case 18:e.next=21;break;case 20:throw new Error("Incorrect address. Are you using the correct account/ledger?");case 21:return n.close(),e.abrupt("return",o);case 23:case"end":return e.stop()}}),e,null,[[8,15]])})))).apply(this,arguments)}function T(e,r,t){return P.apply(this,arguments)}function P(){return(P=Object(c.a)(s.a.mark((function e(r,t,n){var a,c,o,u,d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w();case 2:return a=e.sent,e.next=5,v(a);case 5:if(c=e.sent,(o=c[0]).address.toLowerCase()!==n.toLowerCase()){e.next=20;break}return e.prev=8,e.next=11,new i.a(a).signEIP712HashedMessage(o.derivationPath,r,t);case 11:d=e.sent,u="0x"+d.r+d.s+d.v.toString(16),e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(8),new Error("Signature denied "+e.t0.message);case 18:e.next=21;break;case 20:throw new Error("Incorrect address. Are you using the correct account/ledger?");case 21:return a.close(),e.abrupt("return",u);case 23:case"end":return e.stop()}}),e,null,[[8,15]])})))).apply(this,arguments)}function C(e,r){for(var t=[],n=0;n<r;n++){var a="m/".concat(e.baseDerivationPath,"/").concat(n),s="m/".concat(n),c=e.hdKey.derive(s),o={address:I(c),hdKey:c,baseDerivationPath:e.baseDerivationPath,derivationPath:a};t.push(o)}return t}function I(e){var r=e.publicKey,t=d.publicToAddress(r,!0).toString("hex");return d.addHexPrefix(t).toLowerCase()}}).call(this,t(25).Buffer)},699:function(e,r){},700:function(e,r){},704:function(e,r){},708:function(e,r){}}]);
//# sourceMappingURL=3.57f60d87.chunk.js.map