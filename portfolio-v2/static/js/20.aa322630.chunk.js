(this["webpackJsonpambire-wallet"]=this["webpackJsonpambire-wallet"]||[]).push([[20],{1557:function(e,r,t){var n=t(2),a=t(187),s=t(57).ethers,c=["function isValidSignature(bytes32 hash, bytes signature) view returns (bytes4)"],i=function(){var e=a(n.mark((function e(r){var t,a,c,i,p,l,f;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.provider,a=r.signer,c=r.message,i=r.typedData,p=r.finalDigest,l=r.signature,f=r.undeployedCallback,!c){e.next=5;break}p=s.utils.hashMessage(c),e.next=13;break;case 5:if(!i){e.next=11;break}if(i.domain&&i.types&&i.message){e.next=8;break}throw Error("Missing one or more properties for typedData (domain, types, message)");case 8:p=s.utils._TypedDataEncoder.hash(i.domain,i.types,i.message),e.next=13;break;case 11:if(p){e.next=13;break}throw Error("Missing one of the properties: message, unPrefixedMessage, typedData or finalDigest");case 13:if(!u(o(p,l),a)){e.next=15;break}return e.abrupt("return",!0);case 15:return e.next=17,d(t,a,p,l);case 17:if(e.t0=e.sent,"0x1626ba7e"!==e.t0){e.next=20;break}return e.abrupt("return",!0);case 20:if(!f){e.next=29;break}if(e.prev=21,!f(a,p,l)){e.next=24;break}return e.abrupt("return",!0);case 24:e.next=29;break;case 26:throw e.prev=26,e.t1=e.catch(21),new Error("undeployedCallback error: "+e.t1.message);case 29:return e.abrupt("return",!1);case 30:case"end":return e.stop()}}),e,null,[[21,26]])})));return function(r){return e.apply(this,arguments)}}(),o=function(e,r){try{return s.utils.recoverAddress(e,r)}catch(t){return!1}},u=function(e,r){if(!1===e)return!1;if(!s.utils.isAddress(e))throw new Error("Invalid recovered address: "+e);return e.toLowerCase()===r.toLowerCase()},d=function(){var e=a(n.mark((function e(r,t,a,i){var o,u,d;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=s.providers.Provider.isProvider(r)?r:new s.providers.Web3Provider(r),e.next=3,o.getCode(t);case 3:if(!(u=e.sent)||"0x"===u){e.next=7;break}return d=new s.Contract(t,c,o),e.abrupt("return",d.isValidSignature(a,i));case 7:return e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e)})));return function(r,t,n,a){return e.apply(this,arguments)}}();e.exports={verifyMessage:i}},1558:function(e,r,t){},1637:function(e,r,t){"use strict";t.r(r),t.d(r,"default",(function(){return I}));var n=t(5),a=t(2),s=t.n(a),c=t(12),i=t(8),o=t(16),u=t(575),d=t(108),p=t(17),l=t(3),f=t(1557),h=t(88),b=t(76),g=t(39),v=t(223);function x(e){return Object(p.isHexString)(e)?Object(p.arrayify)(e):Object(p.toUtf8Bytes)(e)}var w=function(e){var r,t,n=e.fetch,a=e.account,w=e.everythingToSign,m=e.relayerURL,j=e.addToast,y=e.resolve,O=e.onConfirmationCodeRequired,k=e.onLastMessageSign,E=e.getHardwareWallet,P=e.useStorage,T=Object(l.useState)(!1),S=Object(i.a)(T,2),I=S[0],C=S[1],A=Object(l.useState)(null),D=Object(i.a)(A,2),L=D[0],M=D[1],N=Object(l.useState)(null),_=Object(i.a)(N,2),q=_[0],K=_[1],R=Object(l.useState)(null),z=Object(i.a)(R,2),H=z[0],W=z[1],U=Object(l.useState)(null),V=Object(i.a)(U,2),B=V[0],F=V[1],G=Object(l.useMemo)((function(){return w[0]||{}}),[w]),J=P({key:"signedMessages",defaultValue:[]}),Y=Object(i.a)(J,2),Q=Y[0],X=Y[1],Z=G.dapp,$=G.chainId,ee=-1!==["eth_signTypedData_v4","eth_signTypedData"].indexOf(null===G||void 0===G?void 0:G.type);if(ee){t=G.txn;try{t.startsWith("{")&&(t=JSON.parse(G.txn))}catch(ge){t=G.txn}if("object"===typeof t&&null!==t)try{var re,te,ne,ae,se,ce,ie,oe;if(null===(re=t)||void 0===re||null===(te=re.types)||void 0===te?void 0:te.EIP712Domain)null===(ce=t)||void 0===ce||(null===(ie=ce.types)||void 0===ie||delete ie.EIP712Domain);if(p._TypedDataEncoder.hash(null===(ne=t)||void 0===ne?void 0:ne.domain,t.types,null===(ae=t)||void 0===ae?void 0:ae.message),null===(se=t.domain)||void 0===se?void 0:se.chainId)$=null===(oe=t.domain)||void 0===oe?void 0:oe.chainId}catch(ve){r=".txn has Invalid TypedData object. Should be {domain, types, message}"}else r=".txn should be a TypedData object"}var ue,de=(ue=$)?g.b.find((function(e){return e.chainId===parseInt(ue.toString(),10)})):null,pe=Object(l.useCallback)(Object(c.a)(s.a.mark((function e(){var r,t,c,i,o,d,l,f,g,x,w,m,j,y;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(de){e.next=2;break}return e.abrupt("return");case 2:return c=new u.Bundle({network:null===de||void 0===de?void 0:de.id,identity:null===a||void 0===a?void 0:a.id,signer:null===a||void 0===a?void 0:a.signer}),e.next=5,Object(v.a)(null===de||void 0===de?void 0:de.id);case 5:i=e.sent,(null===a||void 0===a||null===(r=a.signer)||void 0===r?void 0:r.quickAccManager)?(x=h.a.quickAccTimelock,w=[x,null===a||void 0===a||null===(l=a.signer)||void 0===l?void 0:l.one,null===a||void 0===a||null===(f=a.signer)||void 0===f?void 0:f.two],m=new p.AbiCoder,d=Object(p.keccak256)(m.encode(["tuple(uint, address, address)"],[w])),o=null===(g=a.signer)||void 0===g?void 0:g.quickAccManager):o=null===(j=a.signer)||void 0===j?void 0:j.address,y={method:"eth_call",params:[{to:c.identity,data:"0xc066a5b1000000000000000000000000".concat(o.toLowerCase().substring(2))},"latest"],id:1,jsonrpc:"2.0"},Object(b.b)(n,null===i||void 0===i||null===(t=i.connection)||void 0===t?void 0:t.url,y).then((function(e){var r;e.result&&"0x"!==e.result?(M(!0),(null===a||void 0===a||null===(r=a.signer)||void 0===r?void 0:r.quickAccManager)?K(e.result===d):"0x0000000000000000000000000000000000000000000000000000000000000001"===e.result?K(!0):K(!1)):M(!1)})).catch((function(e){W(e.message)}));case 9:case"end":return e.stop()}}),e)}))),[a,de,n]);Object(l.useEffect)((function(){pe()}),[pe]);var le=Object(l.useCallback)((function(e){var r;e&&e.message.includes("must provide an Ethereum address")?j("Signing error: not connected with the correct address. Make sure you're connected with ".concat(null===(r=a.signer)||void 0===r?void 0:r.address,"."),{error:!0}):j("Signing error: ".concat(e.message||e),{error:!0})}),[a,j]),fe=Object(l.useCallback)((function(e,r,n){var s=Object(v.a)(n);return Object(f.verifyMessage)({provider:s,signer:a.id,message:ee?null:x(e.txn),typedData:ee?t:null,signature:r}).then((function(r){r?j("".concat(e.type," SIGNATURE VALID")):j("".concat(e.type," SIGNATURE INVALID"),{error:!0})})).catch((function(r){j("".concat(e.type," SIGNATURE INVALID: ").concat(r.message),{error:!0})}))}),[a,j,t,ee]),he=Object(l.useCallback)(function(){var e=Object(c.a)(s.a.mark((function e(r){var c,i,p,l,f,h,g,v;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m){e.next=3;break}return j("Email/pass accounts not supported without a relayer connection",{error:!0}),e.abrupt("return");case 3:if(r.password){e.next=6;break}return j("Password required to unlock the account",{error:!0}),e.abrupt("return");case 6:return C(!0),e.prev=7,e.next=10,Object(b.b)(n,"".concat(m,"/second-key/").concat(a.id,"/ethereum/sign").concat(ee?"?typedData=true":""),{toSign:G.txn,code:(null===(c=r.code)||void 0===c?void 0:c.length)?r.code:void 0});case 10:if(i=e.sent,p=i.signature,l=i.success,f=i.message,h=i.confCodeRequired,l){e.next=24;break}if(C(!1),f){e.next=19;break}throw new Error("Secondary key: no success but no error message");case 19:return f.includes("invalid confirmation code")&&j("Unable to sign: wrong confirmation code",{error:!0}),j("Second signature error: ".concat(f),{error:!0}),F(null),C(!1),e.abrupt("return");case 24:if(!h){e.next=31;break}if(F(h),!O){e.next=29;break}return e.next=29,O(h,he);case 29:return C(!1),e.abrupt("return");case 31:if(a.primaryKeyBackup){e.next=33;break}throw new Error("No key backup found: you need to import the account from JSON or login again.");case 33:return e.next=35,d.Wallet.fromEncryptedJson(JSON.parse(a.primaryKeyBackup),r.password);case 35:return g=e.sent,e.next=38,ee?Object(u.signMessage712)(g,a.id,a.signer,t.domain,t.types,t.message,p):Object(u.signMessage)(g,a.id,a.signer,x(G.txn),p);case 38:return v=e.sent,e.next=41,fe(G,v,null===de||void 0===de?void 0:de.id);case 41:j("Successfully signed!"),X([].concat(Object(o.a)(Q),[{accountId:a.id,networkId:$,date:(new Date).getTime(),typed:ee,signer:a.signer,message:G.txn,signature:v,dApp:Z}])),1===w.length&&k&&k(),y({success:!0,result:v}),e.next=50;break;case 47:e.prev=47,e.t0=e.catch(7),le(e.t0);case 50:C(!1);case 51:case"end":return e.stop()}}),e,null,[[7,47]])})));return function(r){return e.apply(this,arguments)}}(),[a,j,t,w,n,le,ee,O,k,m,de,y,G,fe,Z,$,X,Q]),be=Object(l.useCallback)(function(){var e=Object(c.a)(s.a.mark((function e(r,n){var c,i,d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null===(c=a.signer)||void 0===c?void 0:c.quickAccManager)){e.next=4;break}return e.next=3,he(r);case 3:return e.abrupt("return");case 4:return C(!0),e.prev=5,e.next=8,E(n);case 8:if(i=e.sent){e.next=11;break}return e.abrupt("return");case 11:return e.next=13,ee?Object(u.signMessage712)(i,a.id,a.signer,t.domain,t.types,t.message):Object(u.signMessage)(i,a.id,a.signer,x(G.txn));case 13:return d=e.sent,e.next=16,fe(G,d,null===de||void 0===de?void 0:de.id);case 16:j("Successfully signed!"),X([].concat(Object(o.a)(Q),[{accountId:a.id,networkId:$,date:(new Date).getTime(),typed:ee,signer:a.signer,message:G.txn,signature:d,dApp:Z}])),y({success:!0,result:d}),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(5),le(e.t0);case 24:C(!1);case 25:case"end":return e.stop()}}),e,null,[[5,21]])})));return function(r,t){return e.apply(this,arguments)}}(),[a,j,he,t,E,le,null===de||void 0===de?void 0:de.id,y,G,ee,fe,Q,X,Z,$]);return{approve:be,approveQuickAcc:he,toSign:G,isLoading:I,hasPrivileges:q,hasProviderError:H,typeDataErr:r,isDeployed:L,dataV4:t,requestedNetwork:de,requestedChainId:$,isTypedData:ee,confirmationType:B,verifySignature:fe,dApp:Z}},m=w,j=["https://snapshot.org","https://guild.xyz","https://sudoswap.xyz","https://sigtool.ambire.com/","https://app.swappin.gifts","https://app.swappin.gifts/ref/ambire"],y=(t(1558),t(50)),O=t(221),k=t(536),E=t(48),P=t(87),T=t(222),S=t(4);function I(e){var r=e.everythingToSign,t=e.resolve,a=e.account,o=e.relayerURL,u=e.totalRequests,d=Object(E.a)().addToast,p=Object(l.useState)({codeRequired:!1,passphrase:""}),f=Object(i.a)(p,2),h=f[0],b=f[1],g=Object(l.useState)(null),v=Object(i.a)(g,2),x=v[0],w=v[1],I=Object(l.useRef)(null),A=function(){var e=Object(c.a)(s.a.mark((function e(r,t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){w((function(){return e}))}));case 2:if(n=e.sent){e.next=5;break}throw new Error("You must enter a confirmation code");case 5:return e.next=7,t({password:h.passphrase,code:n});case 7:return e.abrupt("return");case 8:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),D=m({fetch:fetch,account:a,everythingToSign:r,relayerURL:o,addToast:d,resolve:t,onConfirmationCodeRequired:A,getHardwareWallet:function(){return Object(k.a)({signer:a.signer,signerExtra:a.signerExtra,chainId:1})},useStorage:T.a}),L=D.approve,M=D.toSign,N=D.isLoading,_=D.hasPrivileges,q=D.hasProviderError,K=D.typeDataErr,R=D.isDeployed,z=D.dataV4,H=D.requestedNetwork,W=D.requestedChainId,U=D.isTypedData,V=D.confirmationType,B=D.dApp,F=B&&(j.includes(B.url)||j.includes(B.url+"/"));if(Object(l.useEffect)((function(){V&&I.current.focus()}),[V]),!M||!a)return Object(S.jsx)(S.Fragment,{});if(!H)return Object(S.jsxs)("div",{id:"signMessage",children:[Object(S.jsxs)("h3",{className:"error",children:["Inexistant network for chainId : ",W]}),Object(S.jsx)(P.e,{className:"reject",onClick:function(){return t({message:"signature denied"})},children:"Reject"})]});if(K)return Object(S.jsxs)("div",{id:"signMessage",children:[Object(S.jsxs)("h3",{className:"error",children:["Invalid signing request: ",K]}),Object(S.jsx)(P.e,{className:"reject",onClick:function(){return t({message:"signature denied"})},children:"Reject"})]});return Object(S.jsxs)("div",{id:"signMessage",children:[Object(S.jsxs)("div",{id:"signingAccount",className:"panel",children:[Object(S.jsx)("div",{className:"title",children:"Signing with account"}),Object(S.jsxs)("div",{className:"content",children:[Object(S.jsxs)("div",{className:"signingAccount-account",children:[Object(S.jsx)("img",{className:"icon",src:O.create({seed:a.id}).toDataURL(),alt:"Account Icon"}),a.id]}),Object(S.jsxs)("div",{className:"signingAccount-network",children:["on",Object(S.jsx)("div",{className:"icon",style:{backgroundImage:"url(".concat(H.icon,")")}}),Object(S.jsx)("div",{className:"address",children:H.name})]})]})]}),Object(S.jsxs)("div",{className:"panel",children:[Object(S.jsxs)("div",{className:"title signMessageTitle",children:[Object(S.jsx)("span",{className:"signMessageTitle-title",children:"Sign message"}),Object(S.jsx)("span",{className:"signMessageTitle-signatureType",children:Object(S.jsxs)(P.B,{label:"".concat(U?"An EIP-712 typed data signature has been requested":"An ethSign ethereum signature type has been requested"),children:[Object(S.jsx)(y.o,{})," ",Object(S.jsx)("span",{children:U?"EIP-712 type":"standard type"})]})})]}),Object(S.jsxs)("div",{className:"request-message",children:[Object(S.jsxs)("div",{className:"dapp-message",children:[B?Object(S.jsxs)("a",{className:"dapp",href:B.url,target:"_blank",rel:"noreferrer",children:[Object(S.jsx)("div",{className:"icon",style:{backgroundImage:"url(".concat(B.icons?B.icons[0]:"none",")")},children:Object(S.jsx)(y.a,{})}),B.name]}):"A dApp ","is requesting your signature."]}),Object(S.jsx)("span",{children:u>1?"You have ".concat(u-1," more pending requests."):""}),!F&&Object(S.jsx)(P.i,{})]}),Object(S.jsx)("textarea",{className:"sign-message",type:"text",value:z?JSON.stringify(z,"\n"," "):"0x"!==M.txn?C(M.txn):"(Empty message)",readOnly:!0}),Object(S.jsx)("div",{className:"actions",children:Object(S.jsxs)("form",{onSubmit:function(e){e.preventDefault(),L({password:h.passphrase})},children:[a.signer.quickAccManager&&R&&Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(P.z,{password:!0,required:!0,minLength:3,placeholder:"Account password",value:h.passphrase,onChange:function(e){return b(Object(n.a)(Object(n.a)({},h),{},{passphrase:e}))}}),Object(S.jsx)("input",{type:"submit",hidden:!0})]}),V&&Object(S.jsxs)(S.Fragment,{children:["email"===V&&Object(S.jsx)("span",{children:"A confirmation code has been sent to your email, it is valid for 3 minutes."}),"otp"===V&&Object(S.jsx)("span",{children:"Please enter your OTP code"}),Object(S.jsx)(P.z,{ref:I,placeholder:"otp"===V?"Authenticator OTP code":"Confirmation code",onInput:function(e){var r;6===(r=e).length&&x(r)}})]}),null===R&&!q&&Object(S.jsx)("div",{children:Object(S.jsx)(P.n,{})}),!1===R&&Object(S.jsxs)("div",{children:[Object(S.jsx)("h3",{className:"error",children:"You can't sign this message yet."}),Object(S.jsxs)("h3",{className:"error",children:["You need to complete your first transaction on"," ",H.name," network in order to be able to sign messages."]})]}),!1===_&&Object(S.jsx)("div",{children:Object(S.jsx)("h3",{className:"error",children:"You do not have the privileges to sign this message."})}),q&&Object(S.jsx)("div",{children:Object(S.jsxs)("h3",{className:"error",children:["There was an issue with the network provider:"," ",q]})}),Object(S.jsxs)("div",{className:"buttons",children:[Object(S.jsx)(P.e,{type:"button",danger:!0,icon:Object(S.jsx)(y.f,{}),className:"reject",onClick:function(){return t({message:"signature denied"})},children:"Reject"}),null!==R&&R&&_&&Object(S.jsx)(P.e,{type:"submit",className:"approve",disabled:N,children:N?Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(P.n,{}),"Signing..."]}):Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(y.d,{})," Sign"]})})]})]})})]})]})}function C(e){if(Object(p.isHexString)(e))try{return Object(p.toUtf8String)(e)}catch(r){return e}return(null===e||void 0===e?void 0:e.toString)?e.toString():e+""}},526:function(e,r,t){"use strict";t.d(r,"c",(function(){return f})),t.d(r,"a",(function(){return h})),t.d(r,"d",(function(){return b})),t.d(r,"b",(function(){return g})),t.d(r,"e",(function(){return v})),t.d(r,"f",(function(){return x})),t.d(r,"g",(function(){return w}));var n=t(5),a=t(2),s=t.n(a),c=t(12),i=t(546),o=t(57),u=t(528),d=t(529),p=2147483648,l={startPath:[2147483692,2147483708,p,0,0],n:10},f=function(e){var r={name:"Ambire Wallet",crypto:d,privKey:e};return new i.Client(r)},h=function(){var e=Object(c.a)(s.a.mark((function e(r,t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){r.connect(t,(function(r,t){r?n("Lattice connect: ".concat(r," Or check if the DeviceID is correct.")):e({isPaired:!!t,errConnect:!1})}))})).catch((function(e){return console.error(e),{isPaired:!1,errConnect:e}}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),b=function(){var e=Object(c.a)(s.a.mark((function e(r,t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){r.pair(t,(function(r,t){r?n("Lattice connect: ".concat(r)):e({hasActiveWallet:t,errPair:!1})}))})).catch((function(e){return console.error(e),{hasActiveWallet:!1,errPair:e}}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),g=function(){var e=Object(c.a)(s.a.mark((function e(r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,t){r.getAddresses(l,(function(r,n){if(r)t("Lattice get addresses: ".concat(r));else{if(!n)throw new Error("Lattice could not get the addresses.");e({res:n,errGetAddresses:!1})}}))})).catch((function(e){return console.error(e),{res:null,errGetAddresses:e}}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),v=function(){var e=Object(c.a)(s.a.mark((function e(r,t){var n,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={protocol:"signPersonal",payload:o.ethers.utils.hexlify(t),signerPath:[2147483692,2147483708,p,0,0]},a={currency:"ETH_MSG",data:n},e.next=4,new Promise((function(e,t){r.sign(a,(function(r,n){if(r)t(r);else{if(!n)throw new Error("Lattice could not sign the message.");e({signedMsg:"0x"+n.sig.r+n.sig.s+n.sig.v[0].toString(16),errSignMessage:!1})}}))})).catch((function(e){return console.error(e),{signedMsg:null,errSignMessage:e}}));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),x=function(){var e=Object(c.a)(s.a.mark((function e(r,t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={currency:"ETH_MSG",data:{signerPath:[2147483692,2147483708,p,0,0],protocol:"eip712",payload:t}},e.next=3,new Promise((function(e,t){r.sign(n,(function(r,n){if(r)t(r);else{if(!n)throw new Error("Lattice could not sign the message.");e({signedMsg:"0x"+n.sig.r+n.sig.s+n.sig.v[0].toString(16),errSignMessage:!1})}}))})).catch((function(e){return console.error(e),{signedMsg:null,errSignMessage:e}}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),w=function(){var e=Object(c.a)(s.a.mark((function e(r,t,a){var c,i,o,d,l,f,h,b,g,v;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=t.to,i=t.data,o=t.gas,d=t.gasPrice,l=t.nonce,f=t.value,h=void 0===f?0:f,delete(b=Object(n.a)(Object(n.a)({},t),{},{gasLimit:t.gasLimit||t.gas,chainId:a})).from,delete b.gas,g={nonce:l,gasLimit:o||t.gasLimit,gasPrice:d,to:c,value:h,data:i||"",signerPath:[2147483692,2147483708,p,0,0],chainId:a,useEIP155:!0},v={currency:"ETH",data:g},e.next=8,new Promise((function(e,t){r.sign(v,(function(r,n){if(r)t(r);else{if(!n)throw new Error("Lattice could not sign the message.");delete b.v;var a=Object(u.a)(b,{r:"0x"+n.sig.r,s:"0x"+n.sig.s,v:n.sig.v[0].toString(16)});e({serializedSigned:a,errSignTxn:!1})}}))})).catch((function(e){return console.error(e),{serializedSigned:null,errSignTxn:e}}));case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}()},531:function(e,r,t){"use strict";(function(e){t.d(r,"a",(function(){return f})),t.d(r,"b",(function(){return g})),t.d(r,"e",(function(){return y})),t.d(r,"c",(function(){return k})),t.d(r,"d",(function(){return P}));var n=t(5),a=t(2),s=t.n(a),c=t(12),i=t(604),o=t(607),u=t(528),d=t(152),p=t(521),l=null,f="44'/60'/0'/0";function h(){return b.apply(this,arguments)}function b(){return(b=Object(c.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.list();case 2:if(!(l=e.sent).length){e.next=11;break}if(!l[0].opened){e.next=8;break}return e.abrupt("return",new i.a(l[0]));case 8:return e.abrupt("return",i.a.open(l[0]));case 9:e.next=22;break;case 11:return e.prev=11,e.next=14,i.a.request();case 14:return e.abrupt("return",e.sent);case 17:if(e.prev=17,e.t0=e.catch(11),!e.t0.message.includes("reading 'open'")){e.next=21;break}throw new Error("ledger WebHID request denied");case 21:throw new Error("Could not request WebHID ledger: "+e.t0.message);case 22:case"end":return e.stop()}}),e,null,[[11,17]])})))).apply(this,arguments)}function g(){return v.apply(this,arguments)}function v(){return(v=Object(c.a)(s.a.mark((function e(){var r,t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h();case 2:return r=e.sent,e.next=5,x(r);case 5:return t=e.sent,r.close(),e.abrupt("return",t.map((function(e){return e.address})));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return w.apply(this,arguments)}function w(){return(w=Object(c.a)(s.a.mark((function r(t){var n,a,c,i,o;return s.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n="m/".concat(f),r.next=3,m(t,n).then((function(e){return e})).catch((function(e){throw 25871===e.statusCode||27404===e.statusCode?Error("Please make sure your ledger is unlocked and running the Ethereum app. "+e.message):Error("Could not get address from ledger : "+e)}));case 3:return a=r.sent,(c=new p).publicKey=e.from(a.publicKey,"hex"),c.chainCode=e.from(a.chainCode,"hex"),i=I(c),o={hdKey:c,address:i,derivationPath:n,baseDerivationPath:f},r.abrupt("return",S(o,1));case 10:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function m(e,r){return j.apply(this,arguments)}function j(){return(j=Object(c.a)(s.a.mark((function e(r,t){var n,a,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new o.a(r),c=new Promise((function(e,r){n=setTimeout((function(){return r(new Error("Device took too long to respond..."))}),1e4)})),e.abrupt("return",Promise.race([a.getAddress(t,!1,!0),c]).then((function(e){return clearTimeout(n),e})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e,r){return O.apply(this,arguments)}function O(){return(O=Object(c.a)(s.a.mark((function e(r,t){var a,c,i,d,p,l,f,b;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h();case 2:return a=e.sent,c=r.from,delete(i=Object(n.a)(Object(n.a)({},r),{},{gasLimit:r.gasLimit||r.gas,chainId:t})).from,delete i.gas,d=Object(u.a)(i),e.next=10,x(a);case 10:if(p=e.sent,p[0].address.toLowerCase()!==c.toLowerCase()){e.next=30;break}return e.prev=13,e.next=16,new o.a(a).signTransaction(p[0].derivationPath,d.substr(2));case 16:f=e.sent,e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(13),new Error("Could not sign transaction "+e.t0);case 22:if(b=parseInt(f.v,16),Math.floor((b-35)/2)===t){e.next=26;break}throw new Error("Invalid returned V 0x"+f.v);case 26:delete i.v,l=Object(u.a)(i,{r:"0x"+f.r,s:"0x"+f.s,v:b}),e.next=31;break;case 30:throw new Error("Incorrect address. Are you using the correct account/ledger?");case 31:return a.close(),e.abrupt("return",l);case 33:case"end":return e.stop()}}),e,null,[[13,19]])})))).apply(this,arguments)}function k(e,r){return E.apply(this,arguments)}function E(){return(E=Object(c.a)(s.a.mark((function e(r,t){var n,a,c,i,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h();case 2:return n=e.sent,e.next=5,x(n);case 5:if(a=e.sent,(c=a[0]).address.toLowerCase()!==t.toLowerCase()){e.next=20;break}return e.prev=8,e.next=11,new o.a(n).signPersonalMessage(c.derivationPath,r.substr(2));case 11:u=e.sent,i="0x"+u.r+u.s+u.v.toString(16),e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(8),new Error("Signature denied "+e.t0.message);case 18:e.next=21;break;case 20:throw new Error("Incorrect address. Are you using the correct account/ledger?");case 21:return n.close(),e.abrupt("return",i);case 23:case"end":return e.stop()}}),e,null,[[8,15]])})))).apply(this,arguments)}function P(e,r,t){return T.apply(this,arguments)}function T(){return(T=Object(c.a)(s.a.mark((function e(r,t,n){var a,c,i,u,d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h();case 2:return a=e.sent,e.next=5,x(a);case 5:if(c=e.sent,(i=c[0]).address.toLowerCase()!==n.toLowerCase()){e.next=20;break}return e.prev=8,e.next=11,new o.a(a).signEIP712HashedMessage(i.derivationPath,r,t);case 11:d=e.sent,u="0x"+d.r+d.s+d.v.toString(16),e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(8),new Error("Signature denied "+e.t0.message);case 18:e.next=21;break;case 20:throw new Error("Incorrect address. Are you using the correct account/ledger?");case 21:return a.close(),e.abrupt("return",u);case 23:case"end":return e.stop()}}),e,null,[[8,15]])})))).apply(this,arguments)}function S(e,r){for(var t=[],n=0;n<r;n++){var a="m/".concat(e.baseDerivationPath,"/").concat(n),s="m/".concat(n),c=e.hdKey.derive(s),i={address:I(c),hdKey:c,baseDerivationPath:e.baseDerivationPath,derivationPath:a};t.push(i)}return t}function I(e){var r=e.publicKey,t=d.publicToAddress(r,!0).toString("hex");return d.addHexPrefix(t).toLowerCase()}}).call(this,t(29).Buffer)},536:function(e,r,t){"use strict";t.d(r,"a",(function(){return j}));var n=t(2),a=t.n(n),s=t(12),c=t(5),i=t(553),o=t(611),u=t.n(o),d=t(57),p=t(521),l=t.n(p),f=t(563),h=t(598),b=t(531),g=t(526),v=t(17),x=t(99),w=t(59),m={};function j(e){var r=e.signer,t=e.signerExtra,n=e.chainId,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s="".concat(r.address||r.one).concat(n);return m[s]?m[s]:m[s]=y({signer:r,signerExtra:t,chainId:n},a)}function y(e,r){var t=e.chainId,n=e.signer,o=e.signerExtra;if(o&&"trezor"===o.type){u.a.manifest({email:"contactus@ambire.com",appUrl:"https://wallet.ambire.com"});var p=new i.TrezorSubprovider({trezorConnectClientApi:u.a,networkId:t});return p._initialDerivedKeyInfo=function(e){return{hdKey:l.a.fromExtendedKey(e.info.hdKey.xpub),derivationPath:e.info.derivationPath,baseDerivationPath:e.info.baseDerivationPath}}(o),{signMessage:function(e){return p.signPersonalMessageAsync(d.ethers.utils.hexlify(e),n.address)},signTransaction:function(e){return p.signTransactionAsync(Object(c.a)(Object(c.a)({},e),{},{from:n.address}))},sendTransaction:function(){var e=Object(s.a)(a.a.mark((function e(r){var t,n,s,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=w.a.find((function(e){return e.chainId===r.chainId}))){e.next=3;break}throw Error("no network found for chainId : "+r.chainId);case 3:return e.next=5,Object(x.a)(t.id);case 5:if(n=e.sent){e.next=8;break}throw Error("no provider found for network : "+t.id);case 8:return e.t0=d.ethers.utils,e.next=11,n.getTransactionCount(r.from);case 11:return e.t1=e.sent,r.nonce=e.t0.hexlify.call(e.t0,e.t1),s=d.ethers.utils.hexlify(r.gas||r.gasLimit),r.gasPrice=d.ethers.utils.hexlify(r.gasPrice),r=Object(c.a)(Object(c.a)({},r),{},{gas:s}),e.next=18,p.signTransactionAsync(r);case 18:return i=e.sent,e.abrupt("return",n.sendTransaction(i));case 20:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),isConnected:function(){var e=Object(s.a)(a.a.mark((function e(r){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.getAccountsAsync(100);case 2:return t=e.sent,e.abrupt("return",t.map((function(e){return e.toLowerCase()})).includes(r.toLowerCase()));case 4:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),_signTypedData:function(){var e=Object(s.a)(a.a.mark((function e(r,t,s){var c,i,o,u,d,l,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=v._TypedDataEncoder.hashDomain(r),i=v._TypedDataEncoder.hashStruct(v._TypedDataEncoder.getPrimaryType(t),t,s),o=v._TypedDataEncoder.getPayload(r,t,s),e.next=5,p._initialDerivedKeyInfoAsync();case 5:return u=e.sent,d=p._findDerivedKeyInfoForAddress(u,n.address),l=d.derivationPath,e.next=10,p._trezorConnectClientApi.ethereumSignTypedData({path:l,data:o,metamask_v4_compat:!0,domain_separator_hash:c,message_hash:i});case 10:if(!(f=e.sent).success){e.next=15;break}return e.abrupt("return","".concat(f.payload.signature));case 15:throw new Error(f.payload.error);case 16:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}()}}if(o&&"ledger"===o.type){if("webHID"===o.transportProtocol)return{signMessage:function(e){return Object(b.c)(d.ethers.utils.hexlify(e),n.address)},signTransaction:function(e){return Object(b.e)(e,t)},sendTransaction:function(){var e=Object(s.a)(a.a.mark((function e(r){var t,n,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=w.a.find((function(e){return e.chainId===r.chainId}))){e.next=3;break}throw Error("no network found for chainId : "+r.chainId);case 3:return e.next=5,Object(x.a)(t.id);case 5:if(n=e.sent){e.next=8;break}throw Error("no provider found for network : "+t.id);case 8:return e.t0=d.ethers.utils,e.next=11,n.getTransactionCount(r.from);case 11:return e.t1=e.sent,r.nonce=e.t0.hexlify.call(e.t0,e.t1),e.next=15,Object(b.e)(r,r.chainId);case 15:return s=e.sent,e.abrupt("return",n.sendTransaction(s));case 17:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),isConnected:function(){var e=Object(s.a)(a.a.mark((function e(r){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.b)();case 2:if(!(t=e.sent)||!t[0]){e.next=7;break}if(!r){e.next=6;break}return e.abrupt("return",!!t.find((function(e){return e.toLowerCase()===r.toLowerCase()})));case 6:return e.abrupt("return",!0);case 7:return e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),_signTypedData:function(e,r,t){var a=v._TypedDataEncoder.hashDomain(e),s=v._TypedDataEncoder.hashStruct(v._TypedDataEncoder.getPrimaryType(r),r,t);return Object(b.d)(a,s,n.address)}};var m=new f.LedgerSubprovider({networkId:t,ledgerEthereumClientFactoryAsync:h.ledgerEthereumBrowserClientFactoryAsync,baseDerivationPath:o.info.baseDerivationPath});return{signMessage:function(e){return m.signPersonalMessageAsync(d.ethers.utils.hexlify(e),n.address)},signTransaction:function(e){return m.signTransactionAsync(Object(c.a)(Object(c.a)({},e),{},{from:n.address}))},sendTransaction:function(){var e=Object(s.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Please use a chrome based browser to use Ledger");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),isConnected:function(){var e=Object(s.a)(a.a.mark((function e(r){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.getAccountsAsync(1);case 2:return t=e.sent,e.abrupt("return",t.map((function(e){return e.toLowerCase()})).includes(r.toLowerCase()));case 4:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),_signTypedData:function(e,r,t){throw Error("Please, use a chrome based browser to use 721 Typed signatures")}}}if(o&&"Lattice"===o.type)return{signMessage:function(){var e=Object(s.a)(a.a.mark((function e(r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(function(){var e=Object(s.a)(a.a.mark((function e(r){var t,n,s,c,i,u,d,p,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.commKey,n=o.deviceId,s=Object(g.c)(t),e.next=4,Object(g.a)(s,n);case 4:if(c=e.sent,i=c.isPaired,!(u=c.errConnect)){e.next=9;break}throw new Error(u.message||u);case 9:if(i){e.next=12;break}throw s.pair(""),new Error("The Lattice device is not paired! Please re-add your account!");case 12:return e.next=14,Object(g.e)(s,r);case 14:if(d=e.sent,p=d.signedMsg,!(l=d.errSignMessage)){e.next=19;break}throw new Error(l);case 19:return e.abrupt("return",p);case 20:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),[r]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),signTransaction:function(){var e=Object(s.a)(a.a.mark((function e(r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(function(){var e=Object(s.a)(a.a.mark((function e(r){var n,s,c,i,u,d,p,l,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.commKey,s=o.deviceId,c=Object(g.c)(n),e.next=4,Object(g.a)(c,s);case 4:if(i=e.sent,u=i.isPaired,!(d=i.errConnect)){e.next=9;break}throw new Error(d.message||d);case 9:if(u){e.next=12;break}throw c.pair(""),new Error("The Lattice device is not paired! Please re-add your account!");case 12:return e.next=14,Object(g.g)(c,r,t);case 14:if(p=e.sent,l=p.serializedSigned,!(f=p.errSignTxn)){e.next=19;break}throw new Error(f);case 19:return e.abrupt("return",l);case 20:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),[r]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),sendTransaction:function(){var e=Object(s.a)(a.a.mark((function e(r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(function(){var e=Object(s.a)(a.a.mark((function e(r){var n,s,c,i,u,p,l,f,h,b,v;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=w.a.find((function(e){return e.chainId===r.chainId}))){e.next=3;break}throw Error("no network found for chainId : "+r.chainId);case 3:return e.next=5,Object(x.a)(n.id);case 5:if(s=e.sent){e.next=8;break}throw Error("no provider found for network : "+n.id);case 8:return e.t0=d.ethers.utils,e.next=11,s.getTransactionCount(r.from);case 11:return e.t1=e.sent,r.nonce=e.t0.hexlify.call(e.t0,e.t1),c=o.commKey,i=o.deviceId,u=Object(g.c)(c),e.next=17,Object(g.a)(u,i);case 17:if(p=e.sent,l=p.isPaired,!(f=p.errConnect)){e.next=22;break}throw new Error(f.message||f);case 22:if(l){e.next=25;break}throw u.pair(""),new Error("The Lattice device is not paired! Please re-add your account!");case 25:return e.next=27,Object(g.g)(u,r,t);case 27:if(h=e.sent,b=h.serializedSigned,!(v=h.errSignTxn)){e.next=32;break}throw new Error(v);case 32:return e.abrupt("return",s.sendTransaction(b));case 33:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),[r]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),isConnected:function(){var e=Object(s.a)(a.a.mark((function e(r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(function(){var e=Object(s.a)(a.a.mark((function e(r){var t,n,s,c,i,u,d,p,l,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=null,n=o.commKey,s=o.deviceId,c=Object(g.c)(n),e.next=5,Object(g.a)(c,s);case 5:if(i=e.sent,u=i.isPaired,!(d=i.errConnect)){e.next=10;break}throw new Error(d.message||d);case 10:if(u){e.next=13;break}throw c.pair(""),new Error("The Lattice device is not paired! Please re-add your account!");case 13:return e.next=15,Object(g.b)(c);case 15:if(p=e.sent,l=p.res,!(f=p.errGetAddresses)){e.next=20;break}throw new Error("Lattice: ".concat(f),{error:!0});case 20:return t=l,e.abrupt("return",t.map((function(e){return e.toLowerCase()})).includes(r.toLowerCase()));case 22:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),[r]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),_signTypedData:function(){var e=Object(s.a)(a.a.mark((function e(r,t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(function(){var e=Object(s.a)(a.a.mark((function e(r,t,n){var s,c,i,u,d,p,l,f,h,b;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=v._TypedDataEncoder.getPayload(r,t,n),c=o.commKey,i=o.deviceId,u=Object(g.c)(c),e.next=5,Object(g.a)(u,i);case 5:if(d=e.sent,p=d.isPaired,!(l=d.errConnect)){e.next=10;break}throw new Error(l.message||l);case 10:if(p){e.next=13;break}throw u.pair(""),new Error("The Lattice device is not paired! Please re-add your account!");case 13:return e.next=15,Object(g.f)(u,s);case 15:if(f=e.sent,h=f.signedMsg,!(b=f.errSignMessage)){e.next=20;break}throw new Error(b);case 20:return e.abrupt("return",h);case 21:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),[r,t,n]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}()};if(n.address){if(!window.ethereum)throw new Error("No web3 support detected in your browser: if you created this account through MetaMask, please install it.");var j=new d.ethers.providers.Web3Provider(window.ethereum,"any"),y=j.getSigner(n.address);return y.isConnected=function(){var e=Object(s.a)(a.a.mark((function e(r,t){var n,s,c,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.listAccounts();case 2:if(n=e.sent,s=!0,!n.length){e.next=14;break}if(r&&(s=!!n.find((function(e){return e.toLowerCase()===r.toLowerCase()}))),!t){e.next=12;break}return e.next=9,j.getNetwork();case 9:c=e.sent,i=c.chainId,s=s&&i===t;case 12:e.next=15;break;case 14:s=!1;case 15:return e.abrupt("return",s);case 16:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),y}throw n.one?new Error("getWallet not applicable for QuickAccounts: use primaryKeyBackup with the passphrase and /second-sig"):new Error("unknown signer type")}function O(e,r){return k.apply(this,arguments)}function k(){return(k=Object(s.a)(a.a.mark((function e(r,t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.apply(this,t).catch((function(e){throw new Error("Lattice: ".concat(e.message))}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},581:function(e,r){},582:function(e,r){},583:function(e,r){},584:function(e,r){},587:function(e,r){},588:function(e,r){},589:function(e,r){},595:function(e,r){},596:function(e,r){},600:function(e,r){},602:function(e,r){},603:function(e,r){}}]);
//# sourceMappingURL=20.aa322630.chunk.js.map