{"version":3,"sources":["components/SendTransaction/FeeSelector.js","components/SendTransaction/Actions.js","components/SendTransaction/noRelayer.js","components/SendTransaction/SendTransaction.js","../node_modules/adex-protocol-eth/js/ensureTypes.js","lib/icons.js","lib/formatters.js","lib/lattice.js","lib/getWallet.js","lib/ledgerWebHID.js","../node_modules/adex-protocol-eth/js/Bundle.js","../node_modules/adex-protocol-eth/js/index.js","../node_modules/adex-protocol-eth/js/Channel.js","../node_modules/adex-protocol-eth/js/Withdraw.js","../node_modules/adex-protocol-eth/js/MerkleTree.js","../node_modules/adex-protocol-eth/js/splitSig.js","../node_modules/adex-protocol-eth/js/UnbondCommitment.js","../node_modules/adex-protocol-eth/js/Permit.js","../node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js","components/SendTransaction/helpers.js","components/common/TxnPreview/TxnPreview.js","../node_modules/ambire-common/src/services/requestToBundleTxn/requestToBundleTxn.ts"],"names":["SPEEDS","walletDiscountBlogpost","DISCOUNT_TOKENS_SYMBOLS","getBalance","token","balance","decimals","priceInUSD","WalletDiscountBanner","currenciesItems","tokens","estimation","onFeeCurrencyChange","onDismiss","feeSpeed","isGasTankEnabled","network","selectedFeeToken","symbol","includes","discount","walletDiscountTokens","filter","x","isTokenEligible","sort","a","b","parseInt","indexOf","length","discountToken","eligibleWalletToken","find","value","address","action","actionTxt","showSwap","className","href","target","rel","onClick","mini","to","FeeSelector","disabled","signer","setEstimation","setFeeSpeed","useState","editCustomFee","setEditCustomFee","insufficientFee","feeInUSD","success","checkIfDAppIncompatible","message","title","FailingTxn","mapTxnErrMsg","tooltip","getErrHint","feeInNative","gasLimit","nativeAssetSymbol","remainingFeeTokenBalances","nativePrice","gasTankTokens","gasTank","map","nativeAssetPriceInUSD","item","nativeRate","price","toUpperCase","ethers","utils","parseUnits","toFixed","toString","label","localeCompare","tokenNetwork","icon","rest","getTokenIcon","id","extra","feeCurrencySelect","defaultValue","items","onChange","setCustomFee","prevEstimation","customFee","sufficientSpeeds","speed","i","highestSufficientSpeed","checkIsSelectorDisabled","feeAmountSelectors","isETH","getFeesData","feeInFeeToken","discountInFeeToken","getDiscountApplied","discountInFeeInUSD","baseFeeInFeeToken","baseFeeInFeeUSD","showInUSD","selectFeeSpeed","formatFloatTokenAmount","savedGas","minFee","minFeeUSD","maxFee","maxFeeUSD","discountMin","discountMax","discountInUSD","discountBaseMinInUSD","discountBaseMaxInUSD","baseFeeInUSD","baseMinFee","baseMaxFee","baseMinFeeUSD","baseMaxFeeUSD","isUnderpriced","isNaN","parseFloat","isOverpriced","join","isGasTankAvailable","small","placeholder","textOnly","balanceInUSD","Actions","approveTxn","rejectTxn","cancelSigning","signingStatus","code","passphrase","quickAccCredentials","setQuickAccCredentials","useEffect","prev","form","useRef","rejectButton","danger","type","signButtonLabel","inProgress","isRecoveryMode","finalBundle","recoveryMode","quickAcc","confCodeRequired","ref","onSubmit","e","preventDefault","password","required","minLength","style","visibility","pattern","autoComplete","maxLength","clear","current","checkValidity","IdentityInterface","Interface","require","FactoryInterface","sendNoRelayer","account","wallet","provider","quickAccManager","Error","getCode","identity","then","data","encodeFunctionData","txns","getNonce","sign","identityFactoryAddr","bytecode","salt","signature","estimateGas","from","toNumber","hexlify","Math","floor","getTransactionCount","txn","gas","gasPrice","nonce","sendTransaction","signTransaction","signed","txId","hash","getNetwork","chainId","name","ERC20","REJECT_MSG","WALLET_TOKEN_SYMBOLS","isInt","getDefaultFeeToken","currentAccGasTankState","getErrorMessage","SendTransaction","relayerURL","accounts","selectedAcc","requests","resolveMany","replacementBundle","replaceByDefault","mustReplaceNonce","onBroadcastedTxn","gasTankState","eligibleRequests","useMemo","toLowerCase","bundle","networkId","Bundle","toBundleTxn","Array","isArray","extraGas","reduce","requestIds","some","meta","addressLabel","xWalletReq","xWallet","makeBundle","SendTransactionWithBundle","isEnabled","replaceTx","setReplaceTx","setSigningStatus","addToast","useToasts","console","error","isMounted","currentBundle","unmounted","reestimate","estimate","fetch","replacing","minFeeInUSDPerGas","getNextNonce","estimateNoRelayer","getProvider","relayerless","catch","log","intvl","setInterval","clearInterval","getFinalBundle","useCallback","feeToken","addedGas","feeTxn","accountPresets","feeCollector","toHexAmount","nextFreeNonce","nextNonce","nextNonMinedNonce","fToken","gasTankFee","assetId","approveTxnImpl","getWallet","signerExtra","submit","approveTxnImplQuickAcc","canSkip2FA","fetchPost","primaryKeyBackup","undefined","Promise","resolve","setTimeout","pwd","alert","Wallet","fromEncryptedJson","JSON","parse","signatureTwo","accountAvatar","blockies","seed","toDataURL","canProceed","size","isFirstFailing","firstFailing","min","Date","now","TxnPreview","minute","disableDismiss","disableDismissLabel","backgroundImage","networkIconsById","pendingBundle","checked","isDeployed","timeout","bundleResult","match","result","BN","Address","startsWith","Bytes32","Buffer","slice","isBuffer","module","exports","Uint256","bn","isNeg","Bytes","Bytes32Array","bytes32Array","Channel","channel","leader","follower","guardian","tokenAddr","customIcons","zapperStorageTokenIcons","addr","net","amount","useGrouping","maximumFractionDigits","minimumFractionDigits","toLocaleString","max","err","crypto","HARDENED_OFFSET","getAddressesReqOpts","startPath","n","latticeInit","commKey","clientConfig","privKey","Client","latticeConnect","client","deviceId","reject","connect","isPaired","errConnect","latticePair","secret","pair","hasActiveWallet","errPair","latticeGetAddresses","getAddresses","res","errGetAddresses","latticeSignMessage","dataMsg","protocol","payload","signerPath","signOptsMsg","currency","signedTx","signedMsg","sig","r","s","v","errSignMessage","latticeSignMessage712","reqData","latticeSignTransaction","unsignedTxObj","txData","useEIP155","signOpts","serializedSigned","serialize","errSignTxn","wallets","opts","one","getWalletNew","providerTrezor","TrezorSubprovider","trezorConnectClientApi","TrezorConnect","_initialDerivedKeyInfo","hdKey","HDNode","fromExtendedKey","info","xpub","derivationPath","baseDerivationPath","getInitialDerivedKeyInfo","signMessage","signPersonalMessageAsync","params","signTransactionAsync","transaction","networks","broadcastProvider","isConnected","matchAddress","getAccountsAsync","addresses","_signTypedData","domain","types","domainSeparator","_TypedDataEncoder","hashDomain","hashStructMessage","hashStruct","getPrimaryType","getPayload","_initialDerivedKeyInfoAsync","initialDerivedKeyInfo","derivedKeyInfo","_findDerivedKeyInfoForAddress","path","_trezorConnectClientApi","ethereumSignTypedData","metamask_v4_compat","domain_separator_hash","message_hash","response","transportProtocol","ledgerSignMessage","ledgerSignTransaction","ledgerGetAddresses","ledgerSignMessage712","LedgerSubprovider","ledgerEthereumClientFactoryAsync","ledgerEthereumBrowserClientFactoryAsync","wrapLatticeError","window","ethereum","providers","Web3Provider","signerObject","getSigner","matchChain","listAccounts","fn","arg","apply","this","ethUtil","connectedDevices","PARENT_HD_PATH","getTransport","TransportWebHID","list","opened","open","request","transport","getAccounts","close","parentKeyDerivationPath","getAddressInternal","o","statusCode","ledgerResponse","publicKey","chainCode","mainAddress","addressOfHDKey","calculateDerivedHDKeyInfos","appEth","AppEth","ledgerTimeout","timeoutHandle","race","getAddress","clearTimeout","fromAddr","serializedUnsigned","accountsData","substr","rsvResponse","intV","signerAddress","signPersonalMessage","rsvReply","signEIP712HashedMessage","count","derivedKeys","fullDerivationPath","derive","derivedKey","push","derivedPublicKey","ethereumAddressUnprefixed","publicToAddress","addHexPrefix","AbiCoder","arrayify","keccak256","Contract","BigNumber","ensure","IdentityABI","QuickAccManagerABI","args","prototype","queryParams","Object","fromEntries","entries","URLSearchParams","isSingleSigMode","encoded","getSignable","signMsg","cancel","UNPREDICTABLE_GAS_REGEX","signatureOne","abiCoder","sigInner","encode","timelock","signMsg712","userTxnBundle","getChainID","accHash","two","mapSignatureV","sigRaw","useFinalDigestSigMode","typedDataSign","nonces","url","body","headers","method","stringify","json","txParams","blockTag","estimateGasWithCatch","getErrMsg","getFeeData","feeData","baseFee","slow","medium","fast","ape","ERROR_SIG","call","returnData","decode","tx","send","signMessage712","channelLib","withdrawalLib","MerkleTree","splitSig","unbondCommitmentlLib","Permit","bundleLib","abi","freeze","arrayBuffer","rawEncode","hashHex","toSolidityTuple","hashToSign","contractAddr","balanceRoot","getSignableStateRoot","hashToSignHex","stateRoot","getResumeSignableMessage","challengeExpires","solidityPack","getResumeSignableMessageHex","channelId","getBalanceLeaf","acc","amnt","getSpenderBalanceLeaf","ChannelState","Challenged","Active","Withdraw","balanceTreeAmount","sigLeader","sigFollower","proof","combinedHash","first","second","sorted","concat","compare","getLayers","elements","layers","getNextLayer","layer","element","index","arr","_elements","every","buffers","buffer","findIndex","equals","assign","l","root","getRoot","pairIndex","getPair","inputSig","substring","UnbondCommitment","owner","shares","unlocksAt","buf","defaultAbiCoder","toUtf8Bytes","PERMIT_TYPEHASH","getDomainSeparator","tokenAddress","getApprovalDigest","approve","deadline","DOMAIN_SEPARATOR","spender","_objectWithoutProperties","source","excluded","key","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","pow","getAddedGas","contractErrors","msg","contractMsg","round","multiplier","getFeePaymentConsequences","discountMultiplier","totalMultiplier","isCrossChainNativeSelected","getNetworkSymbol","mined","disableExpand","useConstants","constants","tokenList","humanizerInfo","isExpanded","setExpanded","contractName","getName","networkDetails","summary","getTransactionSummary","extended","entry","explorerUrl","stopPropagation","canShowLink","parseExtendedSummaryItem","setKnownAddressNames","isKnown","formatUnits","IdentityFactory","IdentityFactoryABI","deploySalt"],"mappings":"w1EAqBMA,EAAS,CAAC,OAAQ,SAAU,OAAQ,OACpCC,EAAyB,uGAGzBC,EAA0B,CAAC,UAAW,iBAAkB,UAE9D,SAASC,EAAWC,GAElB,OAD0CA,EAAlCC,QAAkCD,EAAzBE,SAAyBF,EAAfG,WAI7B,IAAMC,EAAuB,SAAC,GAAkH,IAAD,IAA/GC,EAA+G,EAA/GA,gBAAiBC,EAA8F,EAA9FA,OAAQC,EAAsF,EAAtFA,WAAYC,EAA0E,EAA1EA,oBAAqBC,EAAqD,EAArDA,UAAWC,EAA0C,EAA1CA,SAAUC,EAAgC,EAAhCA,iBAAkBC,EAAc,EAAdA,QAC/H,IAAI,UAAAL,EAAWM,wBAAX,eAA6BC,UAC3BhB,EAAwBiB,SAAxB,UAAiCR,EAAWM,wBAA5C,aAAiC,EAA6BC,SAC7DP,EAAWM,iBAAiBG,UAEjC,OAAO,KAET,IAAMC,EAAuB,YAAIX,GAC9BY,QAAO,SAAAC,GAAC,OAAIrB,EAAwBiB,SAASI,EAAEL,SAAWK,EAAEH,UAAYI,YAAgBD,EAAGT,EAAUH,EAAYI,EAAkBC,MACnIS,MAAK,SAACC,EAAGC,GAAJ,OACJA,EAAEP,SAAWM,EAAEN,WACTQ,SAASF,EAAErB,UAAauB,SAASD,EAAEtB,SAA4C,EAAhCF,EAAWwB,GAAKxB,EAAWuB,KAC7ExB,EAAwB2B,QAAQH,EAAER,QAAUhB,EAAwB2B,QAAQF,EAAET,WAGrF,IAAKG,EAAqBS,OAAQ,OAAO,KAEzC,IAAMC,EAAgBV,EAAqB,GAEnCD,EAAaW,EAAbX,SACFY,EAAsBvB,EAAgBwB,MAAK,SAAAV,GAAC,OAAIA,EAAEW,QAAsB,WAAZX,EAAEW,OAAsBX,EAAEW,QAAUH,EAAcI,YAC9GC,EAAWJ,EACb,kBAAMpB,EAAoBoB,IAC1B,KAEEK,EAAcL,EAAF,cAA+BD,EAAcb,QAA7C,cAA+Da,EAAcb,QACzFoB,GAAYF,EAElB,OACE,sBAAKG,UAAU,6BAAf,UACE,sBAAKA,UAAU,MAAf,iBACkB,IAAXnB,EADP,IACuB,cAAC,IAAD,IADvB,2BACiE,6CADjE,QAEE,mBACEmB,UAAU,cACVC,KAAMvC,EACNwC,OAAO,SACPC,IAAI,sBAJN,SAKE,cAAC,IAAD,WAGDN,GAAU,cAAC,IAAD,CAAQO,QAASP,EAAQQ,MAAI,EAA7B,SACVP,IAEFC,GAAY,sBAAKC,UAAU,YAAf,mDAEX,cAAC,IAAD,CAASA,UAAU,OAAOM,GAAI,eAAgBF,QAAS9B,EAAvD,kBAFW,4BAuBZ,SAASiC,EAAT,GAAoI,IAAD,UAA5GC,EAA4G,EAA5GA,SAAUC,EAAkG,EAAlGA,OAAQrC,EAA0F,EAA1FA,WAAYK,EAA8E,EAA9EA,QAASiC,EAAqE,EAArEA,cAAenC,EAAsD,EAAtDA,SAAUoC,EAA4C,EAA5CA,YAAarC,EAA+B,EAA/BA,UAAWE,EAAoB,EAApBA,iBACpH,EAA0CoC,oBAAS,GAAnD,mBAAOC,EAAP,KAAsBC,EAAtB,KACA,IAAK1C,EAAY,OAAQ,cAAC,IAAD,IAGzB,IAAM2C,EAAkB3C,GAAcA,EAAW4C,WAC3C/B,YAAgBb,EAAWM,iBAAkBH,EAAUH,EAAYI,EAAkBC,GAC3F,GAAIL,IAAeA,EAAW6C,QAAS,OAASC,YAAwB9C,EAAW+C,SAI5E,cAAC,IAAD,CAA+BC,MAAO,+BAH3C,cAACC,EAAD,CACEF,QAAS,2GAAsEG,YAAalD,EAAW+C,YACvGI,QAASC,YAAWpD,EAAW+C,WAGnC,IAAK/C,EAAWqD,YAAa,OAAQ,6BACrC,GAAIrD,IAAeA,EAAW4C,UAAY5C,EAAWsD,SAAW,IAC9D,OAAQ,gCACN,yCADM,kJACwJ,4BAAIjB,EAAOb,UADnK,wBACqMnB,EAAQkD,kBAD7M,aAIV,GAAIvD,GAAcA,EAAW4C,WAAa5C,EAAWwD,0BACnD,OAAQ,qBAAK5B,UAAU,gBAAf,yHAGV,IApCuB6B,EAoCfF,EAAsBlD,EAAtBkD,kBACFG,EAAa,UAAG1D,EAAW2D,eAAd,aAAG,EAAoBC,KArCnBH,EAqCwCzD,EAAW6D,sBArCpC,SAAAC,GACtC,IAAMC,EAA8B,+CAAjBD,EAAKtC,QAA2D,KAAOiC,EAAcK,EAAKE,MAC7G,OAAO,2BACFF,GADL,IAEEvD,OAAQuD,EAAKvD,OAAO0D,cACpBvE,QAASwE,SAAOC,MAAMC,WACpBN,EAAKpE,QAAQ2E,QAAQP,EAAKnE,UAAU2E,WACpCR,EAAKnE,UACL2E,WACFP,kBA6BIhE,EAAUK,IAAgB,OAAIsD,QAAJ,IAAIA,OAAJ,EAAIA,EAAevC,QAC/CuC,EAEA1D,EAAWwD,2BAA6B,CAAC,CAAEjD,OAAQgD,EAAmB5D,SAAU,GAAI6B,QAAS,+CAE3FvB,EAAsB,SAAC,GAAqB,IAAnBsB,EAAkB,EAAlBA,MAAOgD,EAAW,EAAXA,MAC9B9E,EAAQM,EAAOuB,MAAK,gBAAGE,EAAH,EAAGA,QAASjB,EAAZ,EAAYA,OAAZ,OAA0BiB,IAAYD,GAAWhB,IAAWgE,KACtFjC,EAAc,2BAAKtC,GAAN,IAAkBM,iBAAkBb,MAG7CK,EAAkBC,EAGrBe,MAAK,SAACC,EAAGC,GAAJ,OACLH,YAAgBG,EAAG3B,EAAO,GAAIW,EAAYI,EAAkBC,GAAWQ,YAAgBE,EAAG1B,EAAO,GAAIW,EAAYI,EAAkBC,IAChId,EAAwB2B,QAAQF,EAAET,QAAUhB,EAAwB2B,QAAQH,EAAER,UAC7ES,EAAEP,UAAY,IAAMM,EAAEN,UAAY,KAFvC,OAGGM,QAHH,IAGGA,OAHH,EAGGA,EAAGR,OAAO0D,cAAcO,cAAxB,OAAsCxD,QAAtC,IAAsCA,OAAtC,EAAsCA,EAAGT,OAAO0D,mBAElDL,KAAI,gBAAGpC,EAAH,EAAGA,QAASjB,EAAZ,EAAYA,OAAQE,EAApB,EAAoBA,SAAmBgE,EAAvC,EAA8BpE,QAAuBqE,EAArD,EAAqDA,KAASC,EAA9D,qCACHvC,UAAWvB,YAAgB,aAACW,UAASjB,SAAQE,YAAakE,GAAQtF,EAAO,GAAIW,EAAYI,EAAkBC,GAC3GqE,KAAMA,IAASlD,EAAUoD,YAAaxE,EAAmBqE,EAAepE,EAAQwE,GAAIrD,GAAW,MAC/F+C,MAAOhE,EACPgB,MAAOC,GAAWjB,GACdE,EAAW,CACbqE,MAAO,sBAAKlD,UAAU,WAAf,gBAAyC,IAAXnB,EAA9B,IAA8C,cAAC,IAAD,IAA9C,QACL,OAGFsE,EAAoB/E,EAAW4C,SAAY,mCAC/C,sBAAKhB,UAAU,UAAf,UACE,qBAAKA,UAAU,gBAAf,0BACA,cAAC,IAAD,CACEA,UAAU,aACVQ,SAAUA,EACV4C,cAAc,UAAAhF,EAAWM,wBAAX,eAA6BkB,WAA7B,UAAwCxB,EAAWM,wBAAnD,aAAwC,EAA6BC,QACnF0E,MAAOnF,EACPoF,SAAUjF,SAGR,6BAER,EAA8DD,EAAWM,kBAAoB,GAA7F,IAAQG,gBAAR,MAAmB,EAAnB,EAAsBF,EAAtB,EAAsBA,OAAtB,IAA8BwD,kBAA9B,MAA2C,KAA3C,EAAiDpE,EAAjD,EAAiDA,SAE3CwF,EAAe,SAAA5D,GAAK,OAAIe,GAAc,SAAA8C,GAAc,kCACrDA,GADqD,IAExDC,UAAW9D,QASb,GAAIoB,EAAiB,CACnB,IAAM2C,EAAmBjG,EAAOsB,QAAO,SAAC4E,EAAOC,GAAR,OAAc3E,YAAgBb,EAAWM,iBAAkBiF,EAAOvF,EAAYI,EAAkBC,MACjIoF,GAAyBH,EAAiBA,EAAiBnE,OAAS,GAC1EoB,EAAYkD,IAGd,IAAMC,GAA0B,SAAAH,GAC9B,IAAM5C,GAAmB9B,YAAgBb,EAAWM,iBAAkBiF,EAAOvF,EAAYI,EAAkBC,GAC3G,OAAO+B,GAAYO,GAGfgD,GAAqBtG,EAAOuE,KAAI,SAAA2B,GACpC,IAAMK,EAAmB,QAAXrF,GAA0C,QAAtBgD,EAClC,EAIIsC,YAAY,eAAK7F,EAAWM,kBAAjB,YAAC,eAAyCN,GAA1C,IAAsDqF,UAAW,OAAQE,EAAOnF,EAAkBC,GAH/GyF,EADF,EACEA,cACAlD,EAFF,EAEEA,SAGImD,EAAqBC,YAAmBF,EAAerF,GACvDwF,EAAqBD,YAAmBpD,EAAUnC,GAElDyF,EAAoBJ,EAAgBC,EACpCI,EAAkBvD,EAAWA,EAAWqD,EAAqB,KAE7DG,EAA4B,OAAfrC,GAAwBoC,EAE3C,OACE,sBAEEvE,UAAS,mBAAe5B,EAAWqF,WAAalF,IAAaoF,EAAsB,GAAd,aAA5D,OAA+EG,GAAwBH,GAAS,YAAc,IACvIvD,QAAS,kBAAO0D,GAAwBH,IApCvB,SAAAA,GACrBhD,EAAYgD,GACZJ,EAAa,MACbzC,GAAiB,GAiCqC2D,CAAed,IAHnE,YAKK9E,GAAY,cAAC,IAAD,CAAcmB,UAAU,mBACvC,qBAAKA,UAAU,QAAf,SAAwB2D,IACxB,qBAAK3D,UAAU,gBAAf,UACIgE,EAAQ,UAAO,KACZQ,EAAS,WAAOE,YAAuBH,GAAiB,EAAM,IAAOG,YAAuBJ,GAAmB,EAAMvG,KACpHiG,GAAUQ,EAAuD,GAAlE,WAA2BpG,EAAWM,iBAAiBC,YAG5DqF,IAAUQ,GAAa,qBAAKxE,UAAU,uBAAf,SACtB5B,EAAWM,iBAAiBC,WAb1BgF,MAmBX,GAIIM,YAAY7F,EAAWM,iBAAkBN,EAAYG,EAAUC,EAAkBC,GAHnFyF,GADF,GACEA,cACAlD,GAFF,GAEEA,SACA2D,GAHF,GAGEA,SAGF,GAGIV,YAAY,eAAK7F,EAAWM,kBAAjB,YAAC,eAAyCN,GAA1C,IAAsDqF,UAAW,OAAQ,OAAQjF,EAAkBC,GAFjGmG,GADjB,GACEV,cACUW,GAFZ,GAEE7D,SAGF,GAGIiD,YAAY,eAAK7F,EAAWM,kBAAjB,YAAC,eAAyCN,GAA1C,IAAsDqF,UAAW,OAAQ,MAAOjF,EAAkBC,GAFhGqG,GADjB,GACEZ,cACUa,GAFZ,GAEE/D,SAGIgE,GAAcZ,YAAmBQ,GAAQ/F,GACzCoG,GAAcb,YAAmBU,GAAQjG,GAEzCsF,GAAqBC,YAAmBF,GAAerF,GACvDqG,GAAgBd,YAAmBpD,GAAUnC,GAC7CsG,GAAuBf,YAAmBS,GAAWhG,GACrDuG,GAAuBhB,YAAmBW,GAAWlG,GAGrDyF,GAAoBJ,GAAgBC,GACpCkB,GAAerE,GAAWkE,GAC1BI,GAAaV,GAASI,GACtBO,GAtOsB,KAsORT,GAASG,IACvBO,GAAgBX,GAAYM,GAC5BM,GAxOsB,KAwOLV,GAAYK,IAE7BM,KAAkBtH,EAAWqF,YAC7BkC,MAAMC,WAAWxH,EAAWqF,aAC5Ba,GAAoBgB,GAEpBO,KAAiBzH,EAAWqF,YAC5BkC,MAAMC,WAAWxH,EAAWqF,aAC5Ba,GAAoBiB,GAE1B,OAAQ,qCACLxE,EACE,sBAAKf,UAAU,gBAAf,8CACkC,uBADlC,qBAC2D5B,EAAWwD,2BAA6B,IAAII,KAAI,SAAAhD,GAAC,OAAIA,EAAEL,UAAQmH,KAAK,MAC5HtH,GAAoB,0FAEtB2E,EAGHlF,EAAqB,CACpBS,iBAAkBN,EAAWM,iBAC7BR,kBACAC,SACAC,aACAC,sBACAC,YACAC,WACAC,mBACAC,YAGF,sBAAKuB,UAAU,gBAAf,UACE,qDACEvB,EAAQsH,oBACR,8CAAkBvH,EACf,sBAAMwB,UAAU,mBAAhB,qBACA,sBAAMA,UAAU,oBAAhB,4BAIP,sBAAKA,UAAU,eAAf,UACE,sBAAKA,UAAU,UAAf,UACE,qBAAKiD,GAAG,eAAR,SAAwBc,KAErBlD,EAKC,sBAAKoC,GAAG,sBAAR,UACE,sBAAKjD,UAAU,QAAf,yBAAoCrB,EAApC,OACA,cAAC,IAAD,CACEqH,OAAK,EACLC,YAAY,eACZjG,UAAS,UAAK5B,EAAWqF,UAAY,WAAa,IAClDH,SAAU,SAAA3D,GAAK,OAAI4D,EAAa5D,IAChCA,MAAOvB,EAAWqF,YAEnBiC,IACC,sBAAK1F,UAAU,gBAAf,UACE,qIACA,0DACG,eAAC,IAAD,CAAQkG,UAAQ,EACf9F,QAAS,kBAAMmD,EAAa+B,KAD7B,UAGEA,GAHF,IAGe3G,MAEdgH,MAAMH,KACN,4CAAiBd,YAAuBc,IAAe,EAAM,GAA7D,cAKPK,IACC,sBAAK7F,UAAU,gBAAf,UACE,0JACA,4DACG,eAAC,IAAD,CAAQkG,UAAQ,EACf9F,QAAS,kBAAMmD,EAAagC,KAD7B,UAGEA,GAHF,IAGe5G,MAEdgH,MAAMF,KACN,4CAAiBf,YAAuBe,IAAe,EAAM,GAA7D,iBAtCV,sBAAKxC,GAAG,kBAAkB7C,QAAS,kBAAMU,GAAiB,IAA1D,UACE,cAAC,IAAD,IADF,iBA+CN,sBAAKd,UAAU,iBAAf,UACI,sBAAKA,UAAU,gCAAf,UACA,yCACSnB,GAAY,sBAAMmB,UAAU,iBAAhB,kBACfnB,IAAYlB,EAAwBiB,SAAxB,UAAiCR,EAAWM,wBAA5C,aAAiC,EAA6BC,UAC5E,oBACEqB,UAAU,6BACVC,KAAMvC,EACNwC,OAAO,SACPC,IAAI,aAJN,iBAKQ,cAAC,IAAD,OARZ,OAWA,sBAAKH,UAAU,cAAf,WACI2F,MAAMN,KACN,qCACKX,YAAuBW,IAAc,EAAM,OAGhDM,MAAMrB,KAAsB,8BAC3BI,YAAuBJ,IAAmB,EAAMvG,GAAY,KAA5D,OAAkEK,QAAlE,IAAkEA,GAAlE,UAAkEA,EAAYM,wBAA9E,aAAkE,EAA8BC,kBAMpGE,GAAa,sBAAKmB,UAAU,+CAAf,UACd,6CACwB,IAAXnB,EADb,SAGA,qBAAKmB,UAAU,cAAf,SACE,qCACK0E,YAAuBQ,IAAe,EAAM,aAQlDrG,GAAa,sBAAKmB,UAAU,+CAAf,UACd,2CAGA,qBAAKA,UAAU,cAAf,SACE,qCACK0E,YAAuB1D,IAAU,EAAM,YAI9CxC,IAAqBmH,MAAO3E,GAAW5C,EAAWsD,SAAYiD,KAC5D,sBAAK3E,UAAU,8CAAf,UACE,2DAGA,qBAAKA,UAAU,cAAf,SACE,oCACI0E,YAAyB1D,GAAW5C,EAAWsD,SAAYiD,IAAW,EAAM,aAIrFnG,GAAqB,qCACtB,sBAAKwB,UAAU,+CAAf,UACE,8DAGA,qBAAKA,UAAU,cAAf,SACE,oCACI0E,YAAuBtG,EAAWM,iBAAiByH,cAAc,EAAM,YAI9ER,MAAO3E,GAAW5C,EAAWsD,SAAYiD,KACxC,sBAAK3E,UAAU,+CAAf,UACE,sDAGA,qBAAKA,UAAU,cAAf,SACE,oCACI0E,YAAyB1D,GAAW5C,EAAWsD,SAAYiD,IAAW,EAAM,oBAQ1FvG,EAAW4C,SAER,6BADF,uBAAMhB,UAAU,iBAAhB,UAAiC,yCAAjC,qCAAmF2B,EAAnF,yFAA2L,4BAAIlB,EAAOb,UAAtM,UAKA,SAASyB,EAAT,GAAgD,IAA1BF,EAAyB,EAAzBA,QAAyB,IAAhBI,eAAgB,MAAN,GAAM,EACpD,OAAQ,qBAAKvB,UAAU,aAAf,SACN,eAAC,IAAD,CAAS2C,MAAOpB,EAAhB,UACE,sBAAKvB,UAAU,cAAf,UAA6B,cAAC,IAAD,IAA7B,cACA,qBAAKA,UAAU,gBAAf,SAAgCmB,SCvbvB,SAASiF,EAAT,GAST,IARFhI,EAQC,EARDA,WACAG,EAOC,EAPDA,SACA8H,EAMC,EANDA,WACAC,EAKC,EALDA,UACAC,EAIC,EAJDA,cACAC,EAGC,EAHDA,cACAhI,EAEC,EAFDA,iBACAC,EACC,EADDA,QAEF,EAAsDmC,mBAAS,CAAE6F,KAAM,GAAIC,WAAY,KAAvF,mBAAOC,EAAP,KAA4BC,EAA5B,KAEAC,qBAAU,kBAAOL,GAAiBI,GAAuB,SAAAE,GAAI,kCAAUA,GAAV,IAAgBL,KAAM,UAAQ,CAACD,IAE5F,IAAMO,EAAOC,iBAAO,MAEdC,EAAeX,GAGnB,cAAC,IAAD,CAAQY,QAAM,EAACpE,KAAM,cAAC,IAAD,IAAmBqE,KAAK,SAASnH,UAAU,YAAYI,QAASkG,EAArF,oBAEIvF,EAAkB3C,GAAcA,EAAW4C,WAC3C/B,YAAgBb,EAAWM,iBAAkBH,EAAUH,EAAYI,EAAkBC,GAE3F,GADkBL,IAAeA,EAAW6C,SAAYF,EAEtD,OAAQ,qBAAKf,UAAU,UAAf,SACLiH,IAIL,IAAMG,EAAkBZ,GAAiBA,EAAca,WACrD,qCAAE,cAAC,IAAD,IAAF,gBACE,qCAAE,cAAC,IAAD,IAAF,mBAEEC,EAAiBd,GAAiBA,EAAce,aAAef,EAAce,YAAYC,aAC/F,OAAIhB,GAAiBA,EAAciB,SACzB,qCAEJjB,EAAckB,iBACZ,sBAAK1H,UAAU,yBAAf,UACE,sBAAKA,UAAU,+BAAf,UAA8C,cAAC,IAAD,IAA9C,kBACA,sBAAKA,UAAU,iCAAf,UACsC,QAAnCwG,EAAckB,iBAA6B,qFAAqD,KAC7D,UAAnClB,EAAckB,iBACZJ,EACG,6HACA,6HACI,WAKd,KAGJ,uBAAMK,IAAKZ,EAAM/G,UAAU,sBAAsB4H,SAAU,SAAAC,GAAOA,EAAEC,kBAApE,UACsC,gBAAnCtB,EAAckB,kBACb,mBAAG1H,UAAU,4BAAb,uGAEF,sBAAKA,UAAU,mBAAf,UACE,cAAC,IAAD,CACEgG,OAAK,EACL+B,UAAQ,EACRC,UAAQ,EACRC,UAAW,EACXhC,YAAY,WACZtG,MAAOgH,EAAoBD,WAC3BwB,MAAOZ,EAAiB,CAAEa,WAAY,UAAa,GACnD3H,SAAU8G,EACVhE,SAAU,SAAA3D,GAAK,OAAIiH,EAAuB,2BAAKD,GAAN,IAA2BD,WAAY/G,QAG9C,gBAAnC6G,EAAckB,kBACb,cAAC,IAAD,CACE1B,OAAK,EACLoC,QAAQ,SACRhH,MAAM,uCACNiH,aAAa,OACbL,UAAQ,EAACC,UAAW,EAAGK,UAAW,EAClCrC,YAAgD,QAAnCO,EAAckB,iBAA6B,yBAA2B,oBACnF/H,MAAOgH,EAAoBF,KAC3BnD,SAAU,SAAA3D,GAAK,OAAIiH,EAAuB,2BAAKD,GAAN,IAA2BF,KAAM9G,WAIhF,sBAAKK,UAAU,UAAf,UACE,cAAC,IAAD,CACEuI,OAAK,EACL/H,SAAUgG,GAAiBA,EAAca,WACzCvE,KAAM,cAAC,IAAD,IACNqE,KAAK,SACLnH,UAAU,gBACVI,QAASmG,EANX,oBAUA,cAAC,IAAD,CACEvG,UAAU,iBACVI,QAAS,WACF2G,EAAKyB,QAAQC,iBAClBpC,EAAW,CAAEM,yBAJjB,SAOIH,GAAiBA,EAAca,WAAa,cAAC,IAAD,IAAa,qCAAE,cAAC,IAAD,IAAF,yBAO7D,sBAAKrH,UAAU,UAAf,UACHiH,EACD,cAAC,IAAD,CAAQjH,UAAU,aAAaQ,UAAWpC,GAAcoI,EAAepG,QAASiG,EAAhF,SACGe,O,aCrHHsB,EAAoB,IAAIC,YAAUC,EAAQ,MAC1CC,EAAmB,IAAIF,YAAUC,EAAQ,OAExC,SAAeE,EAAtB,kC,4CAAO,2DAAA3J,EAAA,yDAAgCoI,EAAhC,EAAgCA,YAAawB,EAA7C,EAA6CA,QAAStK,EAAtD,EAAsDA,QAASuK,EAA/D,EAA+DA,OAAQ5K,EAAvE,EAAuEA,WAAYG,EAAnF,EAAmFA,SAAU0K,EAA7F,EAA6FA,WACxFxI,EAAW8G,EAAX9G,QAGGyI,gBAJR,sBAI+B,IAAIC,MAAM,yDAJzC,uBAWsBF,EAASG,QAAQ7B,EAAY8B,UAAUC,MAAK,SAAA7C,GAAI,MAAa,OAATA,KAX1E,mCAeD/E,EAAWtD,EAAWsD,SAAW,IACjCpB,EAAKiH,EAAY8B,SACjBE,EAAOb,EAAkBc,mBAAmB,kBAAmB,CAACjC,EAAYkC,OAjB3E,yCAmBKlC,EAAYmC,SAAST,GAnB1B,eAqBD1B,EAAY7F,SAAW,IArBtB,UAsBK6F,EAAYoC,KAAKX,GAtBtB,eAuBD1I,EAAKyI,EAAQa,oBACbL,EAAOV,EAAiBW,mBAAmB,mBAAoB,CAACT,EAAQc,SAAUd,EAAQe,KAAMvC,EAAYkC,KAAMlC,EAAYwC,YAxB7H,UAyBiBd,EAASe,YAAY,CAAE1J,KAAIiJ,OAAMU,KAAMxJ,EAAOb,UAzB/D,oBAyB2EsK,WAA5ExI,EAzBC,KAyBwF,IAzBxF,oBA6BKjB,EAAOb,QA7BZ,KA8BDU,EA9BC,KA8BGiJ,EA9BH,KA+BIY,kBAAQzI,GA/BZ,KAgCSyI,kBAAQC,KAAKC,MAAMjM,EAAWqD,YAAYlD,GAAYH,EAAWsD,SAAW,OAhCrF,KAiCMyI,UAjCN,UAiCoBlB,EAASqB,oBAAoB7J,EAAOb,SAjCxD,2CA4BG2K,EA5BH,CA6BDN,KA7BC,KA8BD3J,GA9BC,KA8BGiJ,KA9BH,KA+BDiB,IA/BC,KAgCDC,SAhCC,KAiCDC,MAjCC,gBAqCI1B,EAAO2B,gBArCX,kCAuCsB3B,EAAO4B,gBAAgBL,GAvC7C,eAuCOM,EAvCP,iBAwCe5B,EAAS0B,gBAAgBE,GAxCxC,QAwCCC,EAxCD,OAwCiDC,KAxCjD,4BA4CK/B,EAAOC,SA5CZ,kCA6C6BD,EAAOC,SAAS+B,aA7C7C,oBA6CWC,EA7CX,EA6CWA,QACJxM,EAAQwM,UAAYA,EA9C3B,uBA8C0C,IAAI9B,MAAJ,2DAA8D1K,EAAQyM,OA9ChH,yBA+CiBlC,EAAO2B,gBAAgB,CAAEV,KAAMM,EAAIN,KAAM3J,GAAIiK,EAAIjK,GAAIiJ,KAAMgB,EAAIhB,KAAMkB,SAAUF,EAAIE,SAAUC,MAAOH,EAAIG,QA/CzH,QA+CGI,EA/CH,OA+CmIC,KA/CnI,yCAiDiB/B,EAAO2B,gBAAgB,CAAEV,KAAMM,EAAIN,KAAM3J,GAAIiK,EAAIjK,GAAIiJ,KAAMgB,EAAIhB,KAAMkB,SAAUF,EAAIE,SAAUD,IAAKD,EAAIC,IAAKE,MAAOH,EAAIG,MAAOO,QAASxM,EAAQwM,UAjD/J,QAiDGH,EAjDH,OAiD2KC,KAjD3K,iCAqDM,CAAE9J,SAAS,EAAM6J,SArDvB,sCAuDc,uBAAX,KAAErE,KAvDL,uBAuD0C,IAAI0C,MAAJ,kDAAqD1K,EAAQkD,kBAA7D,eAAqFlB,EAAOb,UAvDtI,+E,mDC8BDuL,EAAQ,IAAIxC,YAAUC,EAAQ,MAK9BwC,EAAa,mCAEbC,EAAuB,CAAC,UAAW,UAEnCC,EAAQ,SAAAtM,GAAC,OAAK2G,MAAM3G,IAAY,OAANA,GAE1BuM,EAAqB,SAAC3J,EAA2BnD,EAASF,EAAUH,EAAYoN,GACpF,OAAG,OAAC5J,QAAD,IAACA,OAAD,EAACA,EAA2BrC,QAIxBqC,EACN1C,MAAK,SAACC,EAAGC,GAAJ,OACHiM,EAAqB/L,QAArB,OAA6BF,QAA7B,IAA6BA,OAA7B,EAA6BA,EAAGT,QAAU0M,EAAqB/L,QAArB,OAA6BH,QAA7B,IAA6BA,OAA7B,EAA6BA,EAAGR,WACrE,OAADS,QAAC,IAADA,OAAA,EAAAA,EAAGP,WAAY,KAAO,OAADM,QAAC,IAADA,OAAA,EAAAA,EAAGN,WAAY,KADzC,OAEGM,QAFH,IAEGA,OAFH,EAEGA,EAAGR,OAAO0D,cAAcO,cAAxB,OAAsCxD,QAAtC,IAAsCA,OAAtC,EAAsCA,EAAGT,OAAO0D,mBAEpD3C,MAAK,SAAA7B,GAAK,OAAIoB,YAAgBpB,EAAOU,EAAUH,EAAYoN,EAAwB/M,OACjFmD,EAA0B,GAVpB,CAAEjD,OAAQF,EAAQkD,kBAAmB5D,SAAU,GAAI6B,QAAS,+CAyCvE,SAAS6L,EAAgB5D,GACvB,OAAIA,GAAmB,aAAdA,EAAE1G,QACF,wHACE0G,GAAmB,yBAAdA,EAAE1G,QACT,2EAEE0G,GAAmB,sBAAdA,EAAE1G,QACT,mGACE0G,GAAmB,2BAAdA,EAAE1G,QACT,iGAEA0G,EAAE1G,SAAW0G,EAIT,SAAS6D,EAAT,GAAmM,IAAxKC,EAAuK,EAAvKA,WAAYC,EAA2J,EAA3JA,SAAUnN,EAAiJ,EAAjJA,QAASoN,EAAwI,EAAxIA,YAAaC,EAA2H,EAA3HA,SAAUC,EAAiH,EAAjHA,YAAaC,EAAoG,EAApGA,kBAAmBC,EAAiF,EAAjFA,iBAAkBC,EAA+D,EAA/DA,iBAAkBC,EAA6C,EAA7CA,iBAAkB7N,EAA2B,EAA3BA,UAAW8N,EAAgB,EAAhBA,aAGzLrD,EAAU6C,EAASlM,MAAK,SAAAV,GAAC,OAAIA,EAAEiE,KAAO4I,KAGtCQ,EAAmBC,mBAAQ,kBAAMR,EACpC/M,QAAO,gBAAGoI,EAAH,EAAGA,KAAM8D,EAAT,EAASA,QAASlC,EAAlB,EAAkBA,QAASwB,EAA3B,EAA2BA,IAA3B,MACG,wBAATpD,GACG8D,IAAYxM,EAAQwM,SACpBlC,IAAY8C,GACZtB,KAASA,EAAIN,MAAQM,EAAIN,KAAKsC,gBAAkBV,EAAYU,oBAG9D,CAACT,EAAS9J,KAAI,SAAAhD,GAAC,OAAIA,EAAEiE,MAAI6C,KAAK,KAAMrH,EAAQwM,QAASY,IACpDW,EAASF,mBACb,kBAAMN,GA3DV,SAAoBjD,EAAS0D,EAAWX,GACtC,IAAMU,EAAS,IAAIE,SAAO,CACxBjO,QAASgO,EACTpD,SAAUN,EAAQ9F,GAElBwG,KAAMqC,EAAS9J,KAAI,gBAAGuI,EAAH,EAAGA,IAAH,OAAaoC,YAAYC,MAAMC,QAAQtC,GAAOA,EAAI,GAAKA,EAAKxB,EAAQ9F,OACvFxC,OAAQsI,EAAQtI,SAMlB,GAJA+L,EAAOM,SAAWhB,EAAS9J,KAAI,SAAAhD,GAAC,OAAIA,EAAE8N,UAAY,KAAGC,QAAO,SAAC5N,EAAGC,GAAJ,OAAUD,EAAIC,IAAG,GAC7EoN,EAAOQ,WAAalB,EAAS9J,KAAI,SAAAhD,GAAC,OAAIA,EAAEiE,MAGpC6I,EAASmB,MAAK,SAAA/K,GAAI,OAAIA,EAAKgL,QAAO,CACpCV,EAAOU,KAAO,GAEVpB,EAASmB,MAAK,SAAA/K,GAAI,uBAAIA,EAAKgL,YAAT,aAAI,EAAWC,kBACnCX,EAAOU,KAAKC,aAAerB,EAAS9J,KAAI,SAAAhD,GAAC,aAAK,UAACA,EAAEkO,YAAH,aAAC,EAAQC,cAAenO,EAAEkO,KAAKC,aAAe,CAAEA,aAAc,GAAIvN,QAAS,QAG3H,IAAMwN,EAAatB,EAASpM,MAAK,SAAAV,GAAC,uBAAIA,EAAEkO,YAAN,aAAI,EAAQG,WAC1CD,IACFZ,EAAOU,KAAKG,QAAUD,EAAWF,KAAKG,SAI1C,OAAOb,EAkCsBc,CAAWvE,EAAStK,EAAQwE,GAAIoJ,KAC3D,CAACL,EAAmBvN,EAAQwE,GAAI8F,EAASsD,IAG3C,OAAKtD,GAAYyD,EAAO/C,KAAKlK,OAGrB,cAACgO,GAAD,CACN5B,WAAYA,EACZa,OAAQA,EACRP,iBAAkBA,EAClBC,iBAAkBA,EAClBzN,QAASA,EACTsK,QAASA,EACTgD,YAAaA,EACbI,iBAAkBA,EAClB7N,UAAWA,EACX8N,aAAcA,IAb6B,qBAAKnJ,GAAG,kBAAR,SAC3C,oBAAIjD,UAAU,QAAd,iFAgBJ,SAASuN,GAAT,GAA0K,IAAD,MAApIf,EAAoI,EAApIA,OAAQP,EAA4H,EAA5HA,iBAAkBC,EAA0G,EAA1GA,iBAAkBzN,EAAwF,EAAxFA,QAASsK,EAA+E,EAA/EA,QAASgD,EAAsE,EAAtEA,YAAaJ,EAAyD,EAAzDA,WAAYQ,EAA6C,EAA7CA,iBAAkB7N,EAA2B,EAA3BA,UAAW8N,EAAgB,EAAhBA,aACjJZ,EAAyB/M,EAAQsH,mBACrCqG,EAAa1M,MAAK,SAAAkE,GAAC,OAAIA,EAAEmF,UAAYA,EAAQ9F,MAC7C,CAAE8F,QAASA,EAAQ9F,GAAIuK,WAAW,GACpC,EAAoC5M,mBAAS,MAA7C,mBAAOxC,EAAP,KAAmBsC,EAAnB,KACA,EAAkCE,qBAAWqL,GAA7C,mBAAOwB,EAAP,KAAkBC,GAAlB,KACA,GAA0C9M,oBAAS,GAAnD,qBAAO4F,GAAP,MAAsBmH,GAAtB,MACA,GAAgC/M,mBA/GZ,QA+GpB,qBAAOrC,GAAP,MAAiBoC,GAAjB,MACQiN,GAAaC,cAAbD,UAGJtC,EAAMY,IAAuBD,GAAoBX,EAAMkB,EAAO9B,SAChEoD,QAAQC,MAAM,wHACdD,QAAQC,MAAM,iJAIhB,IAAMC,GAAYhH,kBAAO,GACzBH,qBAAU,WAER,OADAmH,GAAUxF,SAAU,EACb,WAAQwF,GAAUxF,SAAU,MAIrC3B,qBAAU,WACH2F,EAAO/C,KAAKlK,QACjBmB,EAAc,QACb,CAAC8L,EAAQ9L,IAGZ,IAAMuN,GAAgBjH,iBAAO,MAC7BiH,GAAczF,QAAUgE,EACxB3F,qBAAU,WAER,IAAIL,IAECgG,EAAO/C,KAAKlK,OAAjB,CAGA,IAAI2O,GAAY,EAIVC,EAAa,kBAAOxC,EACpBa,EAAO4B,SAAS,CAAEzC,aAAY0C,YAAOC,YAAa9B,EAAO+B,kBAAmBC,cAAc,EAAMzM,QAASyJ,EAAuBgC,YAChIhB,EAAOiC,kBAAkB,CAAExF,SAAUyF,YAAYjQ,EAAQwE,OAE5DqG,MAAK,SAAClL,GAAgB,IAAD,EACpB,IAAI8P,GAAa1B,IAAWyB,GAAczF,QAA1C,CACApK,EAAWuQ,aAAehD,EAC1B,IAAM7J,EAAa,UAAG1D,EAAW2D,eAAd,aAAG,EAAoBC,KAAI,SAAAE,GAC5C,OAAO,2BACFA,GADL,IAEEvD,OAAQuD,EAAKvD,OAAO0D,cACpBvE,QAASwE,SAAOC,MAAMC,WAAWN,EAAKpE,QAAQ2E,QAAQP,EAAKnE,UAAU2E,WAAYR,EAAKnE,UAAU2E,WAChGP,WAA6B,+CAAjBD,EAAKtC,QAA2D,KAAOxB,EAAW6D,sBAAwBC,EAAKE,WAG3HoJ,EAAuBgC,YAAWpP,EAAWwD,0BAA4BE,GAC7E1D,EAAWM,iBAAmB6M,EAAmBnN,EAAWwD,0BAA2BnD,EAASF,GAAUH,EAAYoN,EAAuBgC,WAC7I9M,GAAc,SAAA8C,GACZ,OAAIA,GAAkBA,EAAeC,UAAkBD,GACnDpF,EAAWwD,4BAEbxD,EAAWM,iBACP8E,GACGvE,YAAgBuE,EAAe9E,iBAAkBH,GAAUH,EAAYoN,EAAuBgC,UAAW/O,IACzG+E,EAAe9E,kBAEjB6M,EAAmBnN,EAAWwD,0BAA2BnD,EAASF,GAAUH,EAAYoN,EAAuBgC,YAE/GpP,UAGVwQ,OAAM,SAAA/G,GACDqG,IACJJ,QAAQe,IAAI,mBAAoBhH,GAChC+F,GAAS,qBAAD,OAAsB/F,EAAE1G,SAAW0G,GAAK,CAAEkG,OAAO,SAG7DI,IACA,IAAMW,EAAQC,YAAYZ,EAxLF,MA0LxB,OAAO,WACLD,GAAY,EACZc,cAAcF,OAEf,CAACtC,EAAQ9L,EAAenC,GAAUqP,GAAUnP,EAASkN,EAAYnF,GAAegF,EAAuBgC,YAI1G,IAAMyB,GAAiBC,uBAAY,WAAO,IAAD,IACvC,IAAKvD,EACH,OAAO,IAAIe,SAAJ,2BACFF,GADE,IAEL9K,SAAUtD,EAAWsD,YAIzB,IAAMyN,EAAW/Q,EAAWM,iBAE5B,EAMIuF,YAAYkL,EAAU/Q,EAAYG,GAAUiN,EAAuBgC,UAAW/O,GALhFgD,EADF,EACEA,YAGAyC,EAJF,EAIEA,cACAkL,EALF,EAKEA,SAEIC,EAASF,EAASxQ,SAAWF,EAAQkD,kBAEvC,CAAC2N,IAAeC,aAAcC,YAAY/N,EAAa,IAAK,MAC5D,CAAC0N,EAASvP,QAAS,MAAOuL,EAAM3B,mBAAmB,WAAY,CAC/D8F,IAAeC,aACfC,YAAYtL,EAAeiL,EAASpR,aAGlC0R,EAAa,UAAGrR,EAAWsR,iBAAd,aAAG,EAAsBhF,MACtCiF,EAAiB,UAAGvR,EAAWsR,iBAAd,aAAG,EAAsBC,kBAG1CjF,EAAQY,EAAMkB,EAAO9B,OAAS8B,EAAO9B,MAAS+C,EAAYkC,EAAoBF,EAEpF,GAAMjE,EAAuBgC,UAAW,CACtC,IAAI9L,EAIA/B,EACJ,GAJ4B+B,EAAxB8K,EAAO/C,KAAKlK,OAAS,EAAcnB,EAAWsD,UAAY8K,EAAOM,UAAY,GACjE1O,EAAWsD,SAGF,+CAArByN,EAASvP,QAA0DD,EAAQ8B,MAC1E,CACH,IAAMmO,EAASxR,EAAWwD,0BAA0BlC,MAAK,SAAAkE,GAAC,OAAIA,EAAEX,KAAOkM,EAASlM,MAChFtD,EAAQiQ,GAAUxR,EAAWqD,YAAYlD,IAAYqR,EAAOzN,WAG9D,OAAO,IAAIuK,SAAJ,2BACFF,GADE,IAELqD,WAAY,CACVC,QAASX,EAASlM,GAClBtD,MAAO2C,SAAOC,MAAMC,WAAW7C,EAAM8C,QAAQ0M,EAASpR,UAAWoR,EAASpR,UAAU2E,YAEtF+G,KAAK,YAAK+C,EAAO/C,MACjB/H,WACAgJ,WAIJ,OAAO,IAAIgC,SAAJ,2BACFF,GADE,IAEL/C,KAAK,GAAD,mBAAM+C,EAAO/C,MAAb,CAAmB4F,IACvBQ,WAAY,KACZnO,SAAUtD,EAAWsD,SAAW0N,GAAY5C,EAAOM,UAAY,GAC/DpC,aAED,CAACiB,EAAYvN,EAAYG,GAAUiN,EAAuBgC,UAAW/O,EAAS+N,EAAQiB,IAEnFsC,GAAc,uCAAG,kCAAA5Q,EAAA,yDAChBf,EADgB,sBACE,IAAI+K,MAAM,sCADZ,UAGf5B,EAAc0H,KACdhG,EAAWyF,YAAYjQ,EAAQwE,IAC/BxC,EAAS8G,EAAY9G,OAI3BkN,GAAiB,CAAEtG,YAAY,EAAME,gBAE/ByB,EAASgH,YAAU,CACvBvP,SACAwP,YAAalH,EAAQkH,YACrBhF,QAASxM,EAAQwM,WAGfU,EAjBiB,kCAqBbpE,EAAYoC,KAAKX,GArBJ,yBAsBNzB,EAAY2I,OAAO,CAAEvE,aAAY0C,cAtB3B,0EAwBNvF,EAAc,CACzBvB,cAAawB,UAAStK,UAASuK,SAAQ5K,aAAYG,YAAU0K,aAzB5C,4CAAH,qDA8BdkH,GAAsB,uCAAG,iDAAAhR,EAAA,yDAASwH,EAAT,EAASA,oBACjCvI,EADwB,sBACN,IAAI+K,MAAM,sCADJ,UAExBwC,EAFwB,sBAEN,IAAIxC,MAAM,2EAFJ,cAIvB5B,EAAef,IAAiBA,GAAce,aAAgB0H,KAC9DxO,EAAS8G,EAAY9G,OAErB2P,EAAa5J,IAAoD,gBAAnCA,GAAckB,iBAPrB,UAQmC2I,YAAU,GAAD,OACpE1E,EADoE,uBAC3Ca,EAAOnD,SADoC,YACxB5K,EAAQwE,GADgB,qBAAC,aAEtExC,SAAQgJ,KAAMlC,EAAYkC,KAAMiB,MAAOnD,EAAYmD,MAAOhJ,SAAU6F,EAAY7F,WAC3E0O,GAAe,CAAC3J,KAAME,GAAuBA,EAAoBF,OAHD,IAKrEe,aAAcD,EAAYC,aAC1B4I,WAAYA,KAda,oBAQrBrG,EARqB,EAQrBA,UAAW9I,EARU,EAQVA,QAASE,EARC,EAQDA,QAASuG,EARR,EAQQA,iBAShCzG,EAjBwB,oBAkBtBE,EAlBsB,uBAkBP,IAAIgI,MAAJ,kDAlBO,YAmBvBhI,EAAQvC,SAAS,6BAnBM,wBAoBzBgP,GAAS,0CAA2C,CAAEG,OAAO,IApBpC,iCAuBrB,IAAI5E,MAAJ,+BAAkChI,IAvBb,YAyBzBuG,EAzByB,iBA0B3BiG,GAAiB,CAAElG,UAAU,EAAMF,cAAaG,qBA1BrB,2BA4BtBqC,EA5BsB,uBA4BL,IAAIZ,MAAJ,wDA5BK,WA6BtBJ,EAAQuH,iBA7Bc,uBA6BU,IAAInH,MAAJ,iFA7BV,WA8B3BwE,GAAiB,CAAElG,UAAU,EAAMJ,YAAY,EAAMK,iBAAkB0I,EAAa,mBAAgBG,IAC/FhJ,EAAYC,aA/BU,kCAiCnB,IAAIgJ,SAAQ,SAAAC,GAAO,OAAIC,WAAWD,EAAS,MAjCxB,eAkCnBE,EAAMhK,EAAoBD,YAAckK,MAAM,kBAlC3B,UAmCJC,SAAOC,kBAAkBC,KAAKC,MAAMjI,EAAQuH,kBAAmBK,GAnC3D,eAmCnB3H,EAnCmB,iBAoCnBzB,EAAYoC,KAAKX,GApCE,gCAwCzBzB,EAAYwC,UAAYA,EAxCC,eA0C3BxC,EAAY0J,aAAelH,EA1CA,UA2CdxC,EAAY2I,OAAO,CAAEvE,aAAY0C,cA3CnB,qFAAH,sDAqGtB/H,GAAY,WAChBhI,IACAkO,EAAOQ,YAAcjB,EAAYS,EAAOQ,WAAY,CAAE7L,QAASiK,KAG3D8F,GAAgBC,SAAgB,CAAEC,KAAMrI,EAAQ9F,KAAMoO,YAGtDC,IAAahG,EAAMY,KAErBZ,EAAK,OAAClN,QAAD,IAACA,GAAD,UAACA,EAAYsR,iBAAb,aAAC,EAAuBC,mBACzBzD,IAAgB,OAAI9N,QAAJ,IAAIA,GAAJ,UAAIA,EAAYsR,iBAAhB,aAAI,EAAuBC,mBAC3C,MAIR,OACE,sBAAK1M,GAAG,kBAAR,UACE,qBAAKA,GAAG,WAAR,SACE,sBAAKjD,UAAU,UAAUI,QAAS9B,EAAlC,UACE,cAAC,IAAD,CAAeiT,KAAM,KADvB,OAGE,cAAC,IAAD,CAAS5O,MAAM,2HAAf,SACE,cAAC,IAAD,CAAe4O,KAAM,YAK3B,sBAAKvR,UAAU,YAAf,UACE,sBAAKiD,GAAG,mBAAmBjD,UAAU,QAArC,UACE,qBAAKA,UAAU,UAAf,SACE,sBAAKA,UAAU,QAAf,UAAyBwM,EAAO/C,KAAKlK,OAArC,eAA2DiN,EAAO/C,KAAKlK,OAAS,EAAI,IAAM,GAA1F,gBAEF,sBAAKS,UAAU,UAAf,UACE,qBAAKA,UAAS,4BAAuBwM,EAAOQ,WAAa,GAAK,WAA9D,SACGR,EAAO/C,KAAKzH,KAAI,SAACuI,EAAK3G,GACrB,IAAM4N,EAAiBpT,IAAeA,EAAW6C,SAAW7C,EAAWqT,eAAiB7N,EAElF8N,EAAMtH,KAAKC,MAAMsH,KAAKC,MAAQ,KACpC,OAAQ,cAACC,EAAA,EAAD,CAGNC,OAAQJ,EACRpT,UAAWkO,EAAOQ,YAAe,kBAAMjB,EAAY,CAACS,EAAOQ,WAAWpJ,IAAK,CAAEzC,QAASiK,KACtFb,IAAKA,EAAK9L,QAAS+N,EAAO/N,QAASsK,QAASyD,EAAOnD,SACnDmI,eAAgBA,EAChBO,iBAAkBvL,GAClBwL,oBAAqB,wEACrB7E,eAAgBX,EAAOU,MAAQV,EAAOU,KAAKC,cARtC,sBAAI5C,GAAJ,CAAS3G,IAAGkC,KAAK,WAc5B,qBAAK9F,UAAU,cAEf,qBAAKA,UAAU,mBAAf,SAGIwM,EAAOQ,YACL,qCACE,8BAAG,cAAC,IAAD,CAAWuE,KAAM,KAApB,gBACA,4OAOZ,sBAAKtO,GAAG,eAAejD,UAAU,QAAjC,UACE,sBAAKiD,GAAG,oBAAR,UACE,sBAAKjD,UAAU,UAAUiD,GAAG,kBAA5B,UACE,qBAAKjD,UAAU,gBAAf,0BACA,sBAAKA,UAAU,kBAAf,UACE,sBAAKA,UAAU,UAAf,UACE,qBAAKA,UAAU,OAAOkI,MAAO,CAAE+J,gBAAgB,OAAD,OAASf,GAAT,QAC9C,qBAAKlR,UAAU,UAAf,SAA2B+I,EAAQ9F,QAErC,sBAAKjD,UAAU,UAAf,eAEE,qBAAKA,UAAU,OAAOkI,MAAO,CAAE+J,gBAAgB,OAAD,OAASC,IAAiBzT,EAAQwE,IAAlC,QAC9C,qBAAKjD,UAAU,UAAf,SAA2BvB,EAAQyM,gBAOvCoG,IACA,cAAC,EAAD,CACE9Q,SAAUgG,IAAiBA,GAAce,eAAiBnJ,IAAeA,EAAW6C,SACpFR,OAAQ+L,EAAO/L,OACfrC,WAAYA,EACZsC,cAAeA,EACfjC,QAASA,EACTF,SAAUA,GACVoC,YAAaA,GACbrC,UAAWA,EACXE,iBAAkBgN,EAAuBgC,aAAe7B,QAS3DL,EAAMkB,EAAO9B,SAAWY,EAAMY,OAAsB,OAAC9N,QAAD,IAACA,GAAD,UAACA,EAAYsR,iBAAb,aAAC,EAAuByC,gBAE3E,8BACC,cAAC,IAAD,CACKxP,MAAM,wCACNyP,QAAS3E,EACTnK,SAAU,gBAAGpD,EAAH,EAAGA,OAAH,OAAgBwN,GAAaxN,EAAOkS,cAStD9G,EAAMY,IACN,sCAIKoF,IAA6B,OAAfA,KAAwB,sBAAKtR,UAAU,sBAAf,UAAsC,cAAC,KAAD,IAAa,6GAK3E,OAAfsR,IACA,8BACE,cAAC,IAAD,OAKa,IAAfA,IACA,sBAAKrO,GAAG,4BAAR,UACE,sBAAKjD,UAAU,mBAAf,UAAmC,cAAC,IAAD,IAAU,0GAC7C,qBAAKA,UAAU,UAAf,SACE,cAAC,IAAD,CAAQuI,OAAK,EAACzF,KAAM,cAAC,IAAD,IAAmBqE,KAAK,SAASnH,UAAU,YAAYI,QAASkG,GAApF,2BAQRgL,IACA,qCAEIlT,GAAcA,EAAW6C,UAAqC,IAA1B7C,EAAWiU,YAAwB7F,EAAO9K,SAC5E,sBAAK1B,UAAU,gBAAf,UACE,sBAAKA,UAAU,sBAAf,UAAqC,cAAC,IAAD,IAArC,UACA,sBAAKA,UAAU,wBAAf,yEAC+D,IAAQwM,EAAO9K,SAAW,KAAKe,UAD9F,iHAMF,KAGJ,qBAAKQ,GAAG,oBAAR,SAEIuJ,EAAO/L,OAAOyI,kBAAoByC,EAChC,cAACtK,EAAD,CAAYF,QAAQ,+GAEpB,qBAAKnB,UAAU,UAAUiD,GAAG,UAA5B,SACE,cAACmD,EAAD,CACEhI,WAAYA,EACZiI,WApOH,SAAC,GAA6B,IAA3BM,EAA0B,EAA1BA,oBACpB,IAAIH,KAAiBA,GAAca,WAAnC,CACAsG,GAAiBnH,IAAiB,CAAEa,YAAY,IAE5C0B,EAAQkH,aAA4C,WAA7BlH,EAAQkH,YAAY9I,MAC7CyG,GAAS,yDAA0D,CAAE0E,QAAS,MAG5EvJ,EAAQkH,aAA4C,YAA7BlH,EAAQkH,YAAY9I,MAC7CyG,GAAS,0DAA2D,CAAE0E,QAAS,MAGjF,IAAMtF,EAAaR,EAAOQ,YACAR,EAAO/L,OAAOyI,gBACtCiH,GAAuB,CAAExJ,wBACvBoJ,MACczG,MAAK,SAAAiJ,GAEhBA,IAGDvE,GAAUxF,SAASmF,GAAiB,SAGnB4E,EAAatR,SAAWsR,EAAapR,SAAWoR,EAAapR,QAAQqR,MAAM,kBAC5ExF,GAAYjB,EAAYiB,EAAY,CAAE/L,QAASsR,EAAatR,QAASwR,OAAQF,EAAazH,KAAM3J,QAASoR,EAAapR,UAEtIoR,EAAatR,SACfkL,EAAiBoG,EAAazH,MAC9BxM,MAIIiU,EAAapR,QAAQvC,SAAS,sBAChCN,IAEFsP,GAAS,sBAAD,OAAuBnC,EAAgB8G,IAAiB,CAAExE,OAAO,SAG5Ea,OAAM,SAAA/G,GACDmG,GAAUxF,SAASmF,GAAiB,MACxCG,QAAQC,MAAMlG,GACVA,GAAKA,EAAE1G,QAAQvC,SAAS,oCAC1BgP,GAAS,0FAAD,OAA2FpB,EAAO/L,OAAOb,QAAzG,KAAqH,CAAEmO,OAAO,IAC7HlG,GAAKA,EAAE1G,QAAQvC,SAAS,UAGjCgP,GAAS,2FAA4F,CAAEG,OAAO,IAE9GH,GAAS,kBAAD,OAAmBnC,EAAgB5D,IAAM,CAAEkG,OAAO,SAoL1CzH,UAAWA,GACXC,cAAe,kBAAMoH,GAAiB,OACtCnH,cAAeA,GACfjI,SAAUA,GACVC,iBAAkBgN,EAAuBgC,aAAe7B,EACxDlN,QAASA,sB,qBC9lBjC,gBAAQiU,EAAO9J,EAAQ,KAAf8J,GAQR,SAASC,EAAQ3T,GAChB,GAAmB,kBAANA,GAA+B,KAAbA,EAAEO,SAAiBP,EAAE4T,WAAW,MAC9D,MAAM,IAAIzJ,MAAM,mEACjB,OAAOnK,EAGR,SAAS6T,EAAQzT,GAChB,GAAiB,kBAANA,GAAkBA,EAAEwT,WAAW,OAAsB,KAAbxT,EAAEG,OACpD,OAAOuT,EAAO7I,KAAK7K,EAAE2T,MAAM,GAAI,OAEhC,GAAmB,KAAb3T,EAAEG,SAAiBuT,EAAOE,SAAS5T,GAAK,MAAM,IAAI+J,MAAM,2BAC9D,OAAO/J,EA4BR6T,EAAOC,QAAU,CAAEC,QA7CnB,SAAiBnU,GAChB,IAAMoU,EAAK,IAAIV,EAAG1T,EAAG,IACrB,GAAIoU,EAAGC,QAAS,MAAM,IAAIlK,MAAM,2CAChC,OAAOiK,GA0CoBP,UAASF,UAASW,MAzB9C,SAAelU,GACd,GAAiB,kBAANA,GAAkBA,EAAEwT,WAAW,MACzC,OAAOE,EAAO7I,KAAK7K,EAAE2T,MAAM,GAAI,OAEhC,IAAKD,EAAOE,SAAS5T,GAAI,MAAM,IAAI+J,MAAM,mBACzC,OAAO/J,GAoB6CmU,aAjBrD,SAAsBC,EAAcjC,GAEnC,QAAc,IAAVA,QAAwBhB,IAATgB,GAGZiC,EAAajU,SAAWgS,IAFvBiC,EAAaxR,KAAI,SAAAhD,GAAC,OAAI6T,EAAQ7T,OAc4ByU,QATnE,SAAiBC,GAMhB,OALAf,EAAQe,EAAQC,QAChBhB,EAAQe,EAAQE,UAChBjB,EAAQe,EAAQG,UAChBlB,EAAQe,EAAQI,WAChBjB,EAAQa,EAAQhJ,OACTgJ,M,0DC5CR,sCAAMK,EAAc,CAChB,6CAA8C,4KAC9C,6CAA8C,wGAC9C,6CAA8C,2FAC9C,6CAA8C,4FAC9C,6CAA8C,iGAC9C,6CAA8C,2FAC9C,6CAA8C,+FAC9C,6CAA8C,mIAG5CC,EAA0B,yDAEzB,SAAShR,IAA4C,IAA/ByJ,EAA8B,uDAAlB,GAAI7M,EAAc,uDAAJ,GAC7CqU,EAAOrU,EAAQ2M,cACf2H,EAAMzH,EAAUF,cACtB,OAAOwH,EAAYE,IAAZ,UAAwBD,EAAxB,YAAmDE,EAAnD,YAA0DD,EAA1D,U,4sEChBJ,SAASvP,EAAuByP,GAAyD,IAAjDC,IAAgD,yDAA5BC,EAA4B,uDAAJ,GACvF,GAAI1O,MAAMwO,IAAWxO,MAAMC,WAAWuO,KAAgC,kBAAXA,GAAyC,kBAAXA,EAAsB,OAAOA,EAEtH,IACI,IAAMG,EAAwBlK,KAAKsH,IAAI,EAAG2C,GAAyB,GACnE,OAA2B,kBAAXF,EAAuBA,EAASvO,WAAWuO,IACtDI,oBAAehE,EACZ,CACI6D,cACAC,sBAAuBjK,KAAKoK,IAAIF,EAAuBD,GACvDC,0BAEd,MAAOG,GAEL,OADA3G,QAAQC,MAAM0G,GACPN,GAdf,mC,4UCIMO,EAAS9L,EAAQ,KACjB+L,EAAkB,WAElBC,EAAsB,CACxBC,UAAW,CACPF,WACAA,WACAA,EACA,EACA,GAEJG,EAAG,IAGDC,EAAc,SAAAC,GAChB,IAAMC,EAAe,CACjB/J,KAAM,gBACNwJ,OAAQA,EACRQ,QAASF,GAGb,OAAO,IAAIG,SAAOF,IAGhBG,EAAc,uCAAG,WAAMC,EAAQC,GAAd,SAAAnW,EAAA,sEACN,IAAIqR,SAAQ,SAACC,EAAS8E,GAC/BF,EAAOG,QAAQF,GAAU,SAACb,EAAKgB,GACvBhB,EACAc,EAAO,oBAAD,OAAqBd,EAArB,0CAIVhE,EAAQ,CAAEgF,WAAYA,EAAUC,YAAY,UAEjD9G,OAAM,SAAA6F,GAEL,OADA3G,QAAQC,MAAM0G,GACP,CAAEgB,UAAU,EAAOC,WAAYjB,MAZvB,mFAAH,wDAgBdkB,EAAW,uCAAG,WAAMN,EAAQO,GAAd,SAAAzW,EAAA,sEACH,IAAIqR,SAAQ,SAACC,EAAS8E,GAC/BF,EAAOQ,KAAKD,GAAQ,SAACnB,EAAKqB,GAClBrB,EACAc,EAAO,oBAAD,OAAqBd,IAI/BhE,EAAQ,CAAEqF,kBAAiBC,SAAS,UAEzCnH,OAAM,SAAA6F,GAEL,OADA3G,QAAQC,MAAM0G,GACP,CAAEqB,iBAAiB,EAAOC,QAAStB,MAZ9B,mFAAH,wDAgBXuB,EAAmB,uCAAG,WAAMX,GAAN,SAAAlW,EAAA,sEACX,IAAIqR,SAAQ,SAACC,EAAS8E,GAC/BF,EAAOY,aAAarB,GAAqB,SAACH,EAAKyB,GAC3C,GAAIzB,EACAc,EAAO,0BAAD,OAA2Bd,QADrC,CAKA,IAAKyB,EAAK,MAAM,IAAI/M,MAAM,wCAE1BsH,EAAQ,CAACyF,MAAKC,iBAAiB,WAEpCvH,OAAM,SAAA6F,GAEL,OADA3G,QAAQC,MAAM0G,GACP,CAAEyB,IAAK,KAAMC,gBAAiB1B,MAdjB,mFAAH,sDAkBnB2B,EAAkB,uCAAG,WAAMf,EAAQtK,GAAd,iBAAA5L,EAAA,6DACjBkX,EAAU,CACZC,SAAU,eACVC,QAASjU,SAAOC,MAAM4H,QAAQY,GAC9ByL,WAAY,CAAC7B,WAAoBA,WAAoBA,EAAiB,EAAG,IAGvE8B,EAAc,CAChBC,SAAU,UACVnN,KAAM8M,GATa,SAaV,IAAI7F,SAAQ,SAACC,EAAS8E,GAC/BF,EAAO1L,KAAK8M,GAAa,SAAChC,EAAKkC,GAC3B,GAAIlC,EACAc,EAAOd,OADX,CAKA,IAAKkC,EAAU,MAAM,IAAIxN,MAAM,uCAE/BsH,EAAQ,CAAEmG,UAAW,KAAOD,EAASE,IAAIC,EAAIH,EAASE,IAAIE,EAAIJ,EAASE,IAAIG,EAAE,GAAGtU,SAAS,IAAKuU,gBAAgB,WAEnHrI,OAAM,SAAA6F,GAEL,OADA3G,QAAQC,MAAM0G,GACP,CAAEmC,UAAW,KAAMK,eAAgBxC,MA1BvB,mFAAH,wDA8BlByC,EAAqB,uCAAG,WAAM7B,EAAQlU,GAAd,eAAAhC,EAAA,6DACpBgY,EAAU,CACZT,SAAU,UACVnN,KAAM,CACJiN,WAAY,CAAC7B,WAAoBA,WAAoBA,EAAiB,EAAG,GACzE2B,SAAU,SACVC,QAASpV,IANW,SAUb,IAAIqP,SAAQ,SAACC,EAAS8E,GAC/BF,EAAO1L,KAAKwN,GAAS,SAAC1C,EAAKkC,GACvB,GAAIlC,EACAc,EAAOd,OADX,CAKA,IAAKkC,EAAU,MAAM,IAAIxN,MAAM,uCAE/BsH,EAAQ,CAAEmG,UAAW,KAAOD,EAASE,IAAIC,EAAIH,EAASE,IAAIE,EAAIJ,EAASE,IAAIG,EAAE,GAAGtU,SAAS,IAAKuU,gBAAgB,WAEnHrI,OAAM,SAAA6F,GAEL,OADA3G,QAAQC,MAAM0G,GACP,CAAEmC,UAAW,KAAMK,eAAgBxC,MAvBpB,mFAAH,wDA2BrB2C,EAAsB,uCAAG,WAAM/B,EAAQ9K,EAAKU,GAAnB,iCAAA9L,EAAA,6DACnBmB,EAA8CiK,EAA9CjK,GAAIiJ,EAA0CgB,EAA1ChB,KAAMiB,EAAoCD,EAApCC,IAAKC,EAA+BF,EAA/BE,SAAUC,EAAqBH,EAArBG,MADN,EAC2BH,EAAd5K,aADb,MACqB,EADrB,SAErB0X,EAFqB,2BAGpB9M,GAHoB,IAIvB7I,SAAU6I,EAAI7I,UAAY6I,EAAIC,IAC9BS,aAEiBhB,YACdoN,EAAc7M,IAEf8M,EAAS,CACX5M,QACAhJ,SAAU8I,GAAOD,EAAI7I,SACrB+I,WACAnK,KACAX,QACA4J,KAAMA,GAAQ,GAEdiN,WAAY,CAAC7B,WAAoBA,WAAoBA,EAAiB,EAAG,GACzE1J,UACAsM,WAAW,GAGTC,EAAW,CACbd,SAAU,MACVnN,KAAM+N,GAzBiB,SA6Bd,IAAI9G,SAAQ,SAACC,EAAS8E,GAC/BF,EAAO1L,KAAK6N,GAAU,SAAC/C,EAAKkC,GACxB,GAAIlC,EACAc,EAAOd,OADX,CAKA,IAAKkC,EAAU,MAAM,IAAIxN,MAAM,8CAExBkO,EAAcL,EACrB,IAAMS,EAAmBC,YAAUL,EAAe,CAC9CP,EAAG,KAAOH,EAASE,IAAIC,EACvBC,EAAG,KAAOJ,EAASE,IAAIE,EACvBC,EAAGL,EAASE,IAAIG,EAAE,GAAGtU,SAAS,MAGlC+N,EAAQ,CAAEgH,mBAAkBE,YAAY,WAE7C/I,OAAM,SAAA6F,GAEL,OADA3G,QAAQC,MAAM0G,GACP,CAAEgD,iBAAkB,KAAME,WAAYlD,MAjDtB,mFAAH,2D,uNCpHxBmD,EAAU,GAKP,SAAS5H,EAAT,GAAiE,IAA5CvP,EAA2C,EAA3CA,OAAQwP,EAAmC,EAAnCA,YAAahF,EAAsB,EAAtBA,QAAW4M,EAAW,uDAAJ,GAC3D5U,EAAE,UAAMxC,EAAOb,SAAWa,EAAOqX,KAA/B,OAAqC7M,GAC7C,OAAI2M,EAAQ3U,GAAY2U,EAAQ3U,GACzB2U,EAAQ3U,GAAM8U,EAAa,CAAEtX,SAAQwP,cAAahF,WAAW4M,GAGtE,SAASE,EAAT,EAAwDF,GAAO,IAAvC5M,EAAsC,EAAtCA,QAASxK,EAA6B,EAA7BA,OAAQwP,EAAqB,EAArBA,YACvC,GAAIA,GAAoC,WAArBA,EAAY9I,KAAmB,CAChD,IAAM6Q,EAAiB,IAAIC,oBAAkB,CAC3CC,uBAAwBC,IACxB1L,UAAWxB,IAIb,OAFA+M,EAAeI,uBA+PnB,SAAkCnI,GAChC,MAAO,CACLoI,MAAOC,IAAOC,gBAAgBtI,EAAYuI,KAAKH,MAAMI,MACrDC,eAAgBzI,EAAYuI,KAAKE,eACjCC,mBAAoB1I,EAAYuI,KAAKG,oBAnQGC,CAAyB3I,GAE1D,CACL4I,YAAa,SAAA9N,GAAI,OAAIiN,EAAec,yBAAyBxW,SAAOC,MAAM4H,QAAQY,GAAOtK,EAAOb,UAChGgL,gBAAiB,SAAAmO,GAAM,OAAIf,EAAegB,qBAAf,2BAAyCD,GAAzC,IAAiD9O,KAAMxJ,EAAOb,YACzF+K,gBAAgB,WAAD,4BAAE,WAAOsO,GAAP,qBAAA9Z,EAAA,yDACTV,EAAUya,IAASxZ,MAAK,SAAAoV,GAAC,OAAIA,EAAE7J,UAAYgO,EAAYhO,WAD9C,sBAEK9B,MAAM,kCAAoC8P,EAAYhO,SAF3D,uBAGiByD,YAAYjQ,EAAQwE,IAHrC,UAGTkW,EAHS,6BAIehQ,MAAM,mCAAqC1K,EAAQwE,IAJlE,mBAMKX,SAAOC,MANZ,UAMgC4W,EAAkB7O,oBAAoB2O,EAAYhP,MANlF,2BAMfgP,EAAYvO,MANG,KAMkBP,QANlB,gBAOTK,EAAMlI,SAAOC,MAAM4H,QAAQ8O,EAAYzO,KAAOyO,EAAYvX,UAChEuX,EAAYxO,SAAWnI,SAAOC,MAAM4H,QAAQ8O,EAAYxO,UAExDwO,EAAW,2BACNA,GADM,IAETzO,QAZa,UAgBQwN,EAAegB,qBAAqBC,GAhB5C,eAgBTtC,EAhBS,yBAkBRwC,EAAkBxO,gBAAgBgM,IAlB1B,4CAAF,mDAAC,GAoBhByC,YAAY,WAAD,4BAAE,WAAOC,GAAP,eAAAla,EAAA,sEACa6Y,EAAesB,iBAAiB,KAD7C,cACLC,EADK,yBAEJA,EAAUvX,KAAI,SAAA4B,GAAC,OAAIA,EAAE2I,iBAAe3N,SAASya,EAAa9M,gBAFtD,2CAAF,mDAAC,GAIZiN,eAAe,WAAD,4BAAE,WAAOC,EAAQC,EAAO/Z,GAAtB,2BAAAR,EAAA,6DAERwa,EAAkBC,oBAAkBC,WAAWJ,GAC/CK,EAAoBF,oBAAkBG,WAAWH,oBAAkBI,eAAeN,GAAQA,EAAO/Z,GACjG4J,EAAOqQ,oBAAkBK,WAAWR,EAAQC,EAAO/Z,GAJ3C,SAKsBqY,EAAekC,8BALrC,cAKRC,EALQ,OAMRC,EAAiBpC,EAAeqC,8BAA8BF,EAAuB1Z,EAAOb,SAC5F0a,EAAOF,EAAe1B,eAPd,UASSV,EAAeuC,wBAAwBC,sBAAsB,CAClFF,OACA/Q,OACAkR,oBAAoB,EACpBC,sBAAuBf,EACvBgB,aAAcb,IAdF,aASRc,EATQ,QAiBD3Z,QAjBC,oDAkBF2Z,EAASrE,QAAQxM,YAlBf,cAoBJ,IAAIZ,MAAMyR,EAASrE,QAAQxI,OApBvB,4CAAF,uDAAC,IAwBZ,GAAIkC,GAAoC,WAArBA,EAAY9I,KAAmB,CACvD,GAAsC,WAAlC8I,EAAY4K,kBACd,MAAO,CACLhC,YAAa,SAAA9N,GAAI,OAAI+P,YAAkBxY,SAAOC,MAAM4H,QAAQY,GAAOtK,EAAOb,UAC1EgL,gBAAiB,SAAAmO,GAAM,OAAIgC,YAAsBhC,EAAQ9N,IACzDN,gBAAgB,WAAD,4BAAE,WAAOsO,GAAP,mBAAA9Z,EAAA,yDACTV,EAAUya,IAASxZ,MAAK,SAAAoV,GAAC,OAAIA,EAAE7J,UAAYgO,EAAYhO,WAD9C,sBAEK9B,MAAM,kCAAoC8P,EAAYhO,SAF3D,uBAGQyD,YAAYjQ,EAAQwE,IAH5B,UAGTgG,EAHS,6BAIME,MAAM,mCAAqC1K,EAAQwE,IAJzD,mBAMKX,SAAOC,MANZ,UAMgC0G,EAASqB,oBAAoB2O,EAAYhP,MANzE,2BAMfgP,EAAYvO,MANG,KAMkBP,QANlB,0BAQQ4Q,YAAsB9B,EAAaA,EAAYhO,SARvD,eAQT0L,EARS,yBAUR1N,EAAS0B,gBAAgBgM,IAVjB,4CAAF,mDAAC,GAYhByC,YAAY,WAAD,4BAAE,WAAOC,GAAP,eAAAla,EAAA,sEACa6b,cADb,YACLzB,EADK,UAEMA,EAAU,GAFhB,oBAGLF,EAHK,2CAIEE,EAAU7Z,MAAK,SAAAP,GAAC,OAAIA,EAAEoN,gBAAkB8M,EAAa9M,kBAJvD,iCAMF,GANE,iCAQJ,GARI,2CAAF,mDAAC,GAUZiN,eAAgB,SAACC,EAAQC,EAAO/Z,GAC9B,IAAMga,EAAkBC,oBAAkBC,WAAWJ,GAC/CK,EAAoBF,oBAAkBG,WAAWH,oBAAkBI,eAAeN,GAAQA,EAAO/Z,GACvG,OAAOsb,YAAqBtB,EAAiBG,EAAmBrZ,EAAOb,WAI3E,IAAMqJ,EAAW,IAAIiS,oBAAkB,CACrCzO,UAAWxB,EACXkQ,iCAAkCC,0CAClCzC,mBAAoB1I,EAAYuI,KAAKG,qBAEvC,MAAO,CACLE,YAAa,SAAA9N,GAAI,OAAI9B,EAAS6P,yBAAyBxW,SAAOC,MAAM4H,QAAQY,GAAOtK,EAAOb,UAC1FgL,gBAAiB,SAAAmO,GAAM,OAAI9P,EAAS+P,qBAAT,2BAAmCD,GAAnC,IAA2C9O,KAAMxJ,EAAOb,YACnF+K,gBAAgB,WAAD,4BAAE,sBAAAxL,EAAA,4DACTgK,MAAM,mDADG,2CAAF,kDAAC,GAGhBiQ,YAAY,WAAD,4BAAE,WAAOC,GAAP,eAAAla,EAAA,sEACa8J,EAASqQ,iBAAiB,GADvC,cACLC,EADK,yBAEJA,EAAUvX,KAAI,SAAA4B,GAAC,OAAIA,EAAE2I,iBAAe3N,SAASya,EAAa9M,gBAFtD,2CAAF,mDAAC,GAIZiN,eAAgB,SAACC,EAAQC,EAAO/Z,GAC9B,MAAMwJ,MAAM,oEAIb,GAAI8G,GAAoC,YAArBA,EAAY9I,KACpC,MAAO,CACL0R,YAAY,WAAD,4BAAE,WAAM9N,GAAN,SAAA5L,EAAA,sEACEkc,EAAgB,uCAAC,WAAMtQ,GAAN,+BAAA5L,EAAA,6DACpB6V,EAAsB/E,EAAtB+E,QAASM,EAAarF,EAAbqF,SACXD,EAASN,YAAYC,GAFC,SAGUI,YAAeC,EAAQC,GAHjC,mBAGrBG,EAHqB,EAGrBA,WAAUC,EAHW,EAGXA,YAHW,sBAKN,IAAIvM,MAAMuM,EAAWvU,SAAWuU,GAL1B,UAOvBD,EAPuB,uBAS1BJ,EAAOQ,KAAK,IACN,IAAI1M,MAAM,iEAVU,yBAagBiN,YAAmBf,EAAQtK,GAb3C,oBAapB6L,EAboB,EAapBA,YAAWK,EAbS,EAaTA,gBAbS,uBAcF,IAAI9N,MAAM8N,GAdR,iCAgBrBL,GAhBqB,4CAAD,sDAiB1B,CAAC7L,IAlBO,mFAAF,mDAAC,GAoBZH,gBAAgB,WAAD,4BAAE,WAAMmO,GAAN,SAAA5Z,EAAA,sEACFkc,EAAgB,uCAAE,WAAMtC,GAAN,+BAAA5Z,EAAA,6DACrB6V,EAAsB/E,EAAtB+E,QAASM,EAAarF,EAAbqF,SACXD,EAASN,YAAYC,GAFE,SAGSI,YAAeC,EAAQC,GAHhC,mBAGtBG,EAHsB,EAGtBA,WAAUC,EAHY,EAGZA,YAHY,sBAKP,IAAIvM,MAAMuM,EAAWvU,SAAWuU,GALzB,UAOxBD,EAPwB,uBAS3BJ,EAAOQ,KAAK,IACN,IAAI1M,MAAM,iEAVW,yBAakBiO,YAAuB/B,EAAQ0D,EAAQ9N,GAbzD,oBAarBwM,EAbqB,EAarBA,mBAAkBE,EAbG,EAaHA,YAbG,uBAcP,IAAIxO,MAAMwO,GAdH,iCAgBtBF,GAhBsB,4CAAF,sDAiB1B,CAACsB,IAlBW,mFAAF,mDAAC,GAoBhBpO,gBAAgB,WAAD,4BAAE,WAAMsO,GAAN,SAAA9Z,EAAA,sEACFkc,EAAgB,uCAAC,WAAOpC,GAAP,mCAAA9Z,EAAA,yDACtBV,EAAUya,IAASxZ,MAAK,SAAAoV,GAAC,OAAIA,EAAE7J,UAAYgO,EAAYhO,WADjC,sBAER9B,MAAM,kCAAoC8P,EAAYhO,SAF9C,uBAGIyD,YAAYjQ,EAAQwE,IAHxB,UAGtBkW,EAHsB,6BAIEhQ,MAAM,mCAAqC1K,EAAQwE,IAJrD,mBAKRX,SAAOC,MALC,UAKmB4W,EAAkB7O,oBAAoB2O,EAAYhP,MALrE,2BAK5BgP,EAAYvO,MALgB,KAKKP,QALL,gBAMpB6K,EAAsB/E,EAAtB+E,QAASM,EAAarF,EAAbqF,SACXD,EAASN,YAAYC,GAPC,UAQWI,YAAeC,EAAQC,GARlC,oBAQpBG,EARoB,EAQpBA,WAAUC,EARU,EAQVA,YARU,uBAUN,IAAIvM,MAAMuM,EAAWvU,SAAWuU,GAV1B,WAYvBD,EAZuB,uBAc1BJ,EAAOQ,KAAK,IACN,IAAI1M,MAAM,iEAfU,yBAkBmBiO,YAAuB/B,EAAQ4D,EAAahO,GAlB/D,oBAkBpBwM,EAlBoB,EAkBpBA,mBAAkBE,EAlBE,EAkBFA,YAlBE,uBAmBN,IAAIxO,MAAMwO,GAnBJ,iCAqBrBwB,EAAkBxO,gBAAgB8M,IArBb,4CAAD,sDAsB1B,CAACwB,IAvBW,mFAAF,mDAAC,GAyBhBG,YAAY,WAAD,4BAAE,WAAMC,GAAN,SAAAla,EAAA,sEACEkc,EAAgB,uCAAC,WAAOhC,GAAP,iCAAAla,EAAA,6DACxBoa,EAAY,KAERvE,EAAsB/E,EAAtB+E,QAASM,EAAarF,EAAbqF,SACXD,EAASN,YAAYC,GAJC,SAKWI,YAAeC,EAAQC,GALlC,mBAKpBG,EALoB,EAKpBA,WAAUC,EALU,EAKVA,YALU,uBAON,IAAIvM,MAAMuM,EAAWvU,SAAWuU,GAP1B,WASvBD,EATuB,uBAW1BJ,EAAOQ,KAAK,IACN,IAAI1M,MAAM,iEAZU,yBAeW6M,YAAoBX,GAf/B,oBAepBa,EAfoB,EAepBA,MAAKC,EAfe,EAefA,iBAfe,uBAiBpB,IAAIhN,MAAJ,mBAAsBgN,GAAmB,CAAEpI,OAAO,IAjB9B,eAoB5BwL,EAAYrD,EApBgB,kBAqBrBqD,EAAUvX,KAAI,SAAA4B,GAAC,OAAIA,EAAE2I,iBAAe3N,SAASya,EAAa9M,gBArBrC,4CAAD,sDAsB1B,CAAC8M,IAvBO,mFAAF,mDAAC,GAyBdG,eAAe,WAAD,4BAAE,WAAOC,EAAQC,EAAO/Z,GAAtB,SAAAR,EAAA,sEACDkc,EAAgB,uCAAC,WAAO5B,EAAQC,EAAO/Z,GAAtB,iCAAAR,EAAA,6DACtBoX,EAAUqD,oBAAkBK,WAAWR,EAAQC,EAAO/Z,GACpDqV,EAAsB/E,EAAtB+E,QAASM,EAAarF,EAAbqF,SACXD,EAASN,YAAYC,GAHC,SAIUI,YAAeC,EAAQC,GAJjC,mBAIrBG,EAJqB,EAIrBA,WAAUC,EAJW,EAIXA,YAJW,uBAMN,IAAIvM,MAAMuM,EAAWvU,SAAWuU,GAN1B,WAQvBD,EARuB,uBAU1BJ,EAAOQ,KAAK,IACN,IAAI1M,MAAM,iEAXU,yBAcgB+N,YAAsB7B,EAAQkB,GAd9C,oBAcpBK,EAdoB,EAcpBA,YAAWK,EAdS,EAcTA,gBAdS,uBAeF,IAAI9N,MAAM8N,GAfR,iCAiBrBL,GAjBqB,4CAAD,0DAkB1B,CAAC6C,EAAQC,EAAO/Z,IAnBL,mFAAF,uDAAC,IAsBV,GAAIc,EAAOb,QAAS,CACzB,IAAK0b,OAAOC,SAAU,MAAM,IAAIpS,MAAM,8GAGtC,IAAMF,EAAW,IAAI3G,SAAOkZ,UAAUC,aAAaH,OAAOC,SAAU,OAE9DG,EAAezS,EAAS0S,UAAUlb,EAAOb,SAoB/C,OAlBA8b,EAAatC,YAAb,uCAA2B,WAAOC,EAAcuC,GAArB,qBAAAzc,EAAA,sEACF8J,EAAS4S,eADP,UACnBjQ,EADmB,OAGrB4G,GAAQ,GACL5G,EAASrM,OAJS,oBAKnB8Z,IACF7G,IAAU5G,EAASlM,MAAK,SAAAP,GAAC,OAAIA,EAAEoN,gBAAkB8M,EAAa9M,mBAE5DqP,EARmB,iCASK3S,EAAS+B,aATd,gBASbC,EATa,EASbA,QACRuH,EAAQA,GAASvH,IAAY2Q,EAVR,gCAavBpJ,GAAQ,EAbe,iCAelBA,GAfkB,4CAA3B,wDAkBOkJ,EACF,MAAIjb,EAAOqX,IACV,IAAI3O,MAAM,wGAEV,IAAIA,MAAM,uB,SAYLkS,E,gFAAf,WAAgCS,EAAIC,GAApC,SAAA5c,EAAA,sEACe2c,EAAGE,MAAMC,KAAMF,GAC1BnN,OAAM,SAAA/G,GACL,MAAM,IAAIsB,MAAJ,mBAAsBtB,EAAE1G,aAHnC,yF,8SCrSM+a,EAAUtT,EAAQ,KAClB0P,EAAS1P,EAAQ,KAEnBuT,EAAmB,KAEVC,EAAiB,e,SAEfC,I,2EAAf,sBAAAld,EAAA,sEAC2Bmd,IAAgBC,OAD3C,YACEJ,EADF,QAEuB5c,OAFvB,qBAGQ4c,EAAiB,GAAGK,OAH5B,yCAIa,IAAIF,IAAgBH,EAAiB,KAJlD,gCAMaG,IAAgBG,KAAKN,EAAiB,KANnD,0DAUmBG,IAAgBI,UAVnC,gFAYU,KAAEvb,QAAQvC,SAAS,kBAZ7B,uBAac,IAAIuK,MAAM,gCAbxB,cAeY,IAAIA,MAAM,oCAAsC,KAAEhI,SAf9D,4D,sBAoBO,SAAe6Z,IAAtB,+B,4CAAO,8BAAA7b,EAAA,sEACmBkd,IADnB,cACCM,EADD,gBAEkBC,EAAYD,GAF9B,cAEC/Q,EAFD,OAGL+Q,EAAUE,QAHL,kBAKEjR,EAAS5J,KAAI,SAAA7C,GAAC,OAAIA,EAAES,YALtB,4C,+BAQQgd,E,8EAAf,WAA2BD,GAA3B,uBAAAxd,EAAA,6DACQ2d,EADR,YACuCV,GADvC,SAGyBW,EAAmBJ,EAAWG,GAAyBxT,MAAK,SAAA0T,GAAC,OAAIA,KAAGpO,OAAM,SAAA6F,GAC/F,MAAuB,QAAnBA,EAAIwI,YAA2C,QAAnBxI,EAAIwI,WAC5B9T,MAAM,0EAA4EsL,EAAItT,SAEtFgI,MAAM,uCAAyCsL,MAP3D,cAGEyI,EAHF,QAWQ7E,EAAQ,IAAIC,GACZ6E,UAAYrK,EAAO7I,KAAKiT,EAAeC,UAAW,OACxD9E,EAAM+E,UAAYtK,EAAO7I,KAAKiT,EAAeE,UAAW,OAClDC,EAAcC,EAAejF,GAE7B8B,EAAwB,CAC5B9B,QACAzY,QAASyd,EACT3E,eAAgBoE,EAChBnE,mBAAoByD,GApBxB,kBAwBSmB,EAA2BpD,EAAuB,IAxB3D,6C,+BA4Be4C,E,gFAAf,WAAkCJ,EAAWG,GAA7C,mBAAA3d,EAAA,6DAEQqe,EAAS,IAAIC,IAAOd,GAEpBe,EAAgB,IAAIlN,SAAQ,SAACC,EAAS8E,GAC1CoI,EAAgBjN,YAAW,WACzB,OAAO6E,EAAO,IAAIpM,MAAM,yCACvB,QAPP,kBAUSqH,QAAQoN,KAAK,CAClBJ,EAAOK,WAAWf,GAAyB,GAAO,GAClDY,IACCpU,MAAK,SAAC4M,GAEP,OADA4H,aAAaH,GACNzH,MAfX,4C,sBAmBO,SAAe6E,EAAtB,oC,4CAAO,WAAqCxQ,EAAKU,GAA1C,6BAAA9L,EAAA,sEACmBkd,IADnB,cACCM,EADD,OAGCoB,EAAWxT,EAAIN,YAEfoN,EALD,2BAMA9M,GANA,IAOH7I,SAAU6I,EAAI7I,UAAY6I,EAAIC,IAC9BS,QAASA,KAEUhB,YACdoN,EAAc7M,IAEjBwT,EAAqBtG,YAAUL,GAb9B,UAcsBuF,EAAYD,GAdlC,WAcCsB,EAdD,OAiBWA,EAAa,GAAGre,QAGpB2M,gBAAkBwR,EAASxR,cApBlC,4CAuBmB,IAAIkR,IAAOd,GAAW/R,gBAAgBqT,EAAa,GAAGvF,eAAgBsF,EAAmBE,OAAO,IAvBnH,QAuBDC,EAvBC,gEAyBK,IAAIhV,MAAM,oCAzBf,WA4BGiV,EAAO/e,SAAS8e,EAAYnH,EAAG,IACf5M,KAAKC,OAAO+T,EAjHb,IAiHwC,KAEvCnT,EA/BnB,uBAgCK,IAAI9B,MAAM,wBAA0BgV,EAAYnH,GAhCrD,eAmCIK,EAAcL,EACrBS,EAAmBC,YAAUL,EAAe,CAC1CP,EAAG,KAAOqH,EAAYrH,EACtBC,EAAG,KAAOoH,EAAYpH,EACtBC,EAAGoH,IAvCF,8BA0CG,IAAIjV,MAAM,gEA1Cb,eA6CLwT,EAAUE,QA7CL,kBA+CEpF,GA/CF,4D,sBAkDA,SAAeqD,EAAtB,oC,4CAAO,WAAiC/P,EAAMsT,GAAvC,uBAAAlf,EAAA,sEACmBkd,IADnB,cACCM,EADD,gBAGsBC,EAAYD,GAHlC,UAGCsB,EAHD,QAMClV,EAAUkV,EAAa,IAGjBre,QAAQ2M,gBAAkB8R,EAAc9R,cAT/C,2CAWsB,IAAIkR,IAAOd,GAAW2B,oBAAoBvV,EAAQ2P,eAAgB3N,EAAKmT,OAAO,IAXpG,QAWKK,EAXL,OAYD3H,EAAY,KAAO2H,EAASzH,EAAIyH,EAASxH,EAAIwH,EAASvH,EAAEtU,SAAS,IAZhE,wDAcK,IAAIyG,MAAM,oBAAsB,KAAEhI,SAdvC,sCAiBG,IAAIgI,MAAM,gEAjBb,eAmBLwT,EAAUE,QAnBL,kBAoBEjG,GApBF,2D,sBAuBA,SAAeqE,EAAtB,sC,4CAAO,WAAoCtB,EAAiBG,EAAmBuE,GAAxE,uBAAAlf,EAAA,sEACmBkd,IADnB,cACCM,EADD,gBAGsBC,EAAYD,GAHlC,UAGCsB,EAHD,QAMClV,EAAUkV,EAAa,IAGjBre,QAAQ2M,gBAAkB8R,EAAc9R,cAT/C,2CAWsB,IAAIkR,IAAOd,GAAW6B,wBAAwBzV,EAAQ2P,eAAgBiB,EAAiBG,GAX7G,QAWKyE,EAXL,OAYD3H,EAAY,KAAO2H,EAASzH,EAAIyH,EAASxH,EAAIwH,EAASvH,EAAEtU,SAAS,IAZhE,wDAcK,IAAIyG,MAAM,oBAAsB,KAAEhI,SAdvC,sCAiBG,IAAIgI,MAAM,gEAjBb,eAmBLwT,EAAUE,QAnBL,kBAoBEjG,GApBF,2D,sBAuBP,SAAS2G,EAA2BpD,EAAuBsE,GAEzD,IADA,IAAMC,EAAc,GACX9a,EAAI,EAAGA,EAAI6a,EAAO7a,IAAK,CAE9B,IAAM+a,EAAkB,YAAQxE,EAAsBxB,mBAA9B,YAAoD/U,GACtE0W,EAAI,YAAQ1W,GACZyU,EAAQ8B,EAAsB9B,MAAMuG,OAAOtE,GAE3CuE,EAAa,CACjBjf,QAFc0d,EAAejF,GAG7BA,QACAM,mBAAoBwB,EAAsBxB,mBAC1CD,eAAgBiG,GAGlBD,EAAYI,KAAKD,GAEnB,OAAOH,EAGF,SAASpB,EAAejF,GAC7B,IACM0G,EAAmB1G,EAAM8E,UACzB6B,EAA4B9C,EAC/B+C,gBAAgBF,GAHa,GAI7Brc,SAAS,OACZ,OAAOwZ,EAAQgD,aAAaF,GAA2BzS,iB,0EClNzD,EAA8D3D,EAAQ,IAAUrG,MAAxE4c,EAAR,EAAQA,SAAUhV,EAAlB,EAAkBA,QAASiV,EAA3B,EAA2BA,SAAUC,EAArC,EAAqCA,UAAW1W,EAAhD,EAAgDA,UAChD,EAAgCC,EAAQ,IAAhC0W,EAAR,EAAQA,SAAUC,EAAlB,EAAkBA,UAEZC,EAAS5W,EAAQ,KAEjB6W,EAAc7W,EAAQ,KACtB8W,EAAqB9W,EAAQ,KAE7BF,EAAoB,IAAIC,EAAU8W,GAExC,SAAS/S,EAAOiT,GAaf,OAZA1D,KAAK5S,SAAWmW,EAAO7M,QAAQgN,EAAKtW,UACpC4S,KAAKxd,QAAUkhB,EAAKlhB,QAEpBwd,KAAKxb,OAASkf,EAAKlf,OACnBwb,KAAKxS,KAAOkW,EAAKlW,KACjBwS,KAAKva,SAAWie,EAAKje,SACrBua,KAAKvR,MAAQiV,EAAKjV,MAClBuR,KAAKlS,UAAY4V,EAAK5V,UACtBkS,KAAK1N,kBAAoBoR,EAAKpR,kBAC9B0N,KAAKzU,aAAemY,EAAKnY,aACzByU,KAAK/O,KAAOyS,EAAKzS,KACjB+O,KAAKpM,WAAa8P,EAAK9P,WAChBoM,KAGRvP,EAAOkT,UAAUlW,SAAjB,2BAA4B,WAAeT,GAAf,+EACRS,EAAST,EAAUgT,MADX,cAC3BA,KAAKvR,MADsB,yBAEpBuR,KAAKvR,OAFe,gDAA5B,sDAKAgC,EAAOkT,UAAUxR,SAAjB,2BAA4B,sGAAiBC,EAAjB,EAAiBA,MAAO1C,EAAxB,EAAwBA,WAAY2C,EAApC,EAAoCA,UAAWE,EAA/C,EAA+CA,aAAczM,EAA7D,EAA6DA,QAClF8d,EAAcC,OAAOC,YAAYD,OAAOE,QAAQ,CAACxR,eAAczM,YAAUhD,QAAO,8CAD3D,SAETsR,EACjBhC,EAD0B,UAEvB1C,EAFuB,qBAEAsQ,KAAK5S,SAFL,YAEiB4S,KAAKxd,QAFtB,qBAGxB,IAAIwhB,gBAAgBJ,GAAcnd,YAEpC,CAAE+G,KAAMwS,KAAKxS,KAAMhJ,OAAQwb,KAAKxb,OAAQ6N,YAAWC,kBAAmB0N,KAAK1N,oBAPjD,cAErB2H,EAFqB,OAS3B+F,KAAKva,SAAWwU,EAAIxU,SATO,kBAUpBwU,GAVoB,gDAA5B,sDAaAxJ,EAAOkT,UAAUjW,KAAjB,2BAAwB,WAAeX,EAAQkX,GAAvB,6EACnBva,MAAMsW,KAAKvR,OADQ,sBACM,IAAIvB,MAAM,oBADhB,WAEnBxD,MAAMsW,KAAKva,UAFQ,sBAES,IAAIyH,MAAM,uBAFnB,cAGjBgX,EAAUC,EAAYnE,KAAMiE,GAC5BnV,EAAOqU,EAASC,EAAUc,IAJT,SAKCE,EAAQrX,EAAQ+B,GALjB,cAKjBhB,EALiB,OAMvBkS,KAAKlS,UAAYA,EANM,kBAOhBA,GAPgB,iDAAxB,wDAUA2C,EAAOkT,UAAU1P,OAAjB,2BAA0B,8FAAiB7B,EAAjB,EAAiBA,MAAO1C,EAAxB,EAAwBA,WAAxB,SACP0E,EACjBhC,EAD0B,UAEvB1C,EAFuB,qBAEAsQ,KAAK5S,SAFL,YAEiB4S,KAAKxd,QAFtB,WAG1B,CACCiM,MAAOuR,KAAKvR,MACZjK,OAAQwb,KAAKxb,OACbgJ,KAAMwS,KAAKxS,KACX/H,SAAUua,KAAKva,SACfqI,UAAWkS,KAAKlS,UAChBkH,aAAcgL,KAAKhL,aACnB/D,KAAM+O,KAAK/O,KACX2C,WAAYoM,KAAKpM,aAZM,cACnBqG,EADmB,yBAelBA,GAfkB,gDAA1B,sDAkBAxJ,EAAOkT,UAAUU,OAAjB,2BAA0B,8FAAiBjS,EAAjB,EAAiBA,MAAO1C,EAAxB,EAAwBA,WAAxB,SACP0E,EACjBhC,EAD0B,UAEvB1C,EAFuB,qBAEAsQ,KAAK5S,SAFL,YAEiB4S,KAAKxd,QAFtB,WAG1B,CAAEiM,MAAOuR,KAAKvR,MAAOjK,OAAQwb,KAAKxb,SAJV,cACnByV,EADmB,yBAMlBA,GANkB,gDAA1B,sDASA,IAAMqK,EAA0B,+E,gCAqChC,WAA2BvX,EAAQK,EAAU5I,EAAQU,EAAS8P,GAA9D,+EACKxQ,EAAOb,QADZ,yCAC4BygB,EAAQrX,EAAQ7H,GAAS,IADrD,WAEKV,EAAOyI,gBAFZ,iCAG6BmX,EAAQrX,EAAQ7H,GAAS,GAHtD,cAGQqf,EAHR,OAKQC,EAAW,IAAItB,EACfuB,EAAWD,EAASE,OACzB,CAAC,OAAQ,QAAS,SAClB,CAAClgB,EAAOmgB,SAAUJ,EAAcvP,IAG3B4F,EAXR,UAWiB6J,EAAWD,EAASE,OAAO,CAAC,WAAY,CAAClgB,EAAOyI,kBAAkB6J,MAAM,GAXzF,wBAYS8D,GAZT,cAcO,IAAI1N,MAAJ,yBAdP,6C,sDAkBA,WAA8BH,EAAQK,EAAU5I,EAAQgZ,EAAQC,EAAO/Z,EAAOsR,GAA9E,+EACKxQ,EAAOb,QADZ,yCAC4BihB,EAAW7X,EAAQyQ,EAAQC,EAAO/Z,IAD9D,WAEKc,EAAOyI,gBAFZ,iCAG6B2X,EAAW7X,EAAQyQ,EAAQC,EAAO/Z,GAH/D,cAGQ6gB,EAHR,OAKQC,EAAW,IAAItB,EACfuB,EAAWD,EAASE,OACzB,CAAC,OAAQ,QAAS,SAClB,CAAClgB,EAAOmgB,SAAUJ,EAAcvP,IAG3B4F,EAXR,UAWiB6J,EAAWD,EAASE,OAAO,CAAC,WAAY,CAAClgB,EAAOyI,kBAAkB6J,MAAM,GAXzF,wBAYS8D,GAZT,cAcO,IAAI1N,MAAJ,yBAdP,6C,sBAiBA,SAASiX,EAAYU,EAAeZ,GACnC,IAAMO,EAAW,IAAItB,EACf1e,EAASqgB,EAAcrgB,OAC7B,GAAIA,EAAOb,QACV,OAAO6gB,EAASE,OACf,CAAC,UAAW,OAAQ,OAAQ,iCAC5B,CACCG,EAAczX,SACd0X,EAAWD,EAAcriB,SACzBqiB,EAAcpW,MACdoW,EAAcrX,OAGjB,GAAIhJ,EAAOyI,gBAAiB,CAC3B,IAAM8X,EAAU3B,EACfoB,EAASE,OACR,CAAC,iCACD,CAAC,CAACG,EAAcrgB,OAAOmgB,SAAUE,EAAcrgB,OAAOqX,IAAKgJ,EAAcrgB,OAAOwgB,QAKlF,OAAOR,EAASE,OACf,CAAC,UAAW,OAAQ,UAAW,UAAW,OAAQ,gCAAiC,QACnF,CACClgB,EAAOyI,gBACP6X,EAAWD,EAAcriB,SACzBqiB,EAAczX,SACd2X,EACAF,EAAcpW,MACdoW,EAAcrX,MACbyW,IAIJ,MAAM,IAAI/W,MAAJ,yBAGP,SAAS4X,EAAWtiB,GACnB,GAAgB,aAAZA,EAAwB,OAAO,EACnC,GAAgB,YAAZA,EAAuB,OAAO,IAClC,GAAgB,wBAAZA,EAAmC,OAAO,GAC9C,GAAgB,QAAZA,EAAmB,OAAO,GAC9B,GAAgB,WAAZA,EAAsB,OAAO,IACjC,GAAgB,cAAZA,EAAyB,OAAO,MACpC,GAAgB,aAAZA,EAAwB,OAAO,MACnC,GAAgB,aAAZA,EAAwB,OAAO,KACnC,GAAgB,cAAZA,EAAyB,OAAO,KACpC,GAAgB,WAAZA,EAAsB,OAAO,IACjC,GAAgB,WAAZA,EAAsB,OAAO,IACjC,GAAgB,cAAZA,EAAyB,OAAO,KACpC,GAAgB,WAAZA,EAAsB,OAAO,GACjC,GAAgB,WAAZA,EAAsB,OAAO,WACjC,GAAgB,YAAZA,EAAuB,OAAO,EAClC,GAAgB,aAAZA,EAAwB,OAAO,GACnC,MAAM,IAAI0K,MAAJ,8BAAiC1K,IAGxC,SAASyiB,EAAcC,GACtB,IAAMtK,EAAMuI,EAAS+B,GAErB,OADItK,EAAI,IAAM,KAAIA,EAAI,KAAO,IACtB1M,EAAQ0M,G,SAGDwJ,E,oEAAf,WAAuBrX,EAAQ7H,GAA/B,wFAAwCigB,EAAxC,6CAGWF,EAHX,SAG+BlY,EAAO6P,YAAY1X,GAHlD,mGAG8DigB,EAAwB,KAAO,OAH7F,2C,iCAMeP,E,wEAAf,WAA0B7X,EAAQyQ,EAAQC,EAAO/Z,GAAjD,qFAE6BqJ,EAAOwQ,eAAeC,EAAQC,EAAO/Z,GAFlE,cAEO0hB,EAFP,mCAGWH,EAAcG,GAHzB,mD,+BAMe3X,E,oEAAf,WAAwBT,EAAU6X,GAAlC,4EAEUA,EAAcrgB,OAAOyI,gBAF/B,gCAGW,IAAIoW,EACVwB,EAAcrgB,OAAOyI,gBACrBwW,EACAzW,GACEqY,OAAOR,EAAczX,UAP5B,0DAQW,IAAIiW,EAASwB,EAAczX,SAAUoW,EAAaxW,GAAUyB,QARvE,yDASIR,YATJ,0CAYiB,mBAAX,KAAEzD,MAZR,uCAY4CwC,EAASG,QAAQ0X,EAAczX,UAZ3E,yBAY0F,OAZ1F,gEAaU,GAbV,8E,+BAkBegH,E,sEAAf,WAAyBhC,EAAOkT,EAAKC,GAArC,qFACiBnT,EAAMkT,EAAK,CAC1BE,QAAS,CAAE,eAAgB,oBAC3BC,OAAQ,OACRF,KAAMzQ,KAAK4Q,UAAUH,KAJvB,cACO1K,EADP,yBAMQA,EAAE8K,QANV,4C,sBArKAlV,EAAOkT,UAAUnR,kBAAjB,2BAAqC,8GAAiBxF,EAAjB,EAAiBA,SAAUqF,EAA3B,EAA2BA,UACzDuT,EAAW,CAChB5X,KAAMgS,KAAKxb,OAAOyI,iBAAmB+S,KAAKxb,OAAOb,QACjDU,GAAI2b,KAAK5S,SACTE,KAAMb,EAAkBc,mBAAmB,kBAAmB,CAACyS,KAAKxS,QAE/DqY,EAAWxT,EAAY,SAAW,UANJ,SAOFyT,EAAqB9Y,EAAU6Y,EAAUD,GAPvC,mBAO5B9T,EAP4B,EAO5BA,MAAOrM,EAPqB,EAOrBA,UACXqM,IAASA,EAAM5M,QAAQyR,WAAW,wBARF,wBAS7BzR,EAAU4M,EAAM5M,QAAQ4R,MAAM,IATD,kBAU5B,CAAE9R,SAAS,EAAOE,YAVU,YAYhC4M,EAZgC,oBAcd,4BAAfA,EAAMtH,MAAsCsH,EAAM5M,QAAQqR,MAAM+N,GAdnC,uBAe5BxS,EAf4B,yBAgBKiU,EAAU/Y,EAAU4Y,EAAUC,GAhBnC,8CAgB1B7gB,SAAS,EAAOE,QAhBU,sBAkBpC8a,KAAKva,SAAWA,EAASwI,WAlBW,UAoBdjB,EAASgZ,aApBK,eAoB9BC,EApB8B,OAqB9BzX,EAAWyX,EAAQzX,SAASP,WAC5BiY,EAAW1X,EAAW/I,EAAY,KAtBJ,kBAuB7B,CACNT,SAAS,EACTS,SAAUua,KAAKva,SACf+I,WACAhJ,YAAa,CACZ2gB,KAAgB,GAAVD,EACNE,OAAkB,EAAVF,EACRG,KAAgB,KAAVH,EACNI,IAAe,IAAVJ,KA/B6B,iDAArC,sDAiLA,IAAMK,EAAY,a,SAEHR,E,sEAAf,WAAyB/Y,EAAU4Y,EAAUC,GAA7C,8FAG2B7Y,EAASwZ,KAAKZ,EAAUC,GAHnD,cAGQY,EAHR,yBAISA,EAAW9P,WAAW4P,IAC1B,IAAIrD,GAAWwD,OAAO,CAAC,UAAvB,YAAuCD,EAAW3P,MAAM,MAAO,GAC/D2P,GANL,mCASiB,4BAAX,KAAEjc,OAAsC,KAAEsH,MAThD,0CAS8D,KAAEA,MAAM5M,QAAQ4R,MAAM,KATpF,WAUiB,mBAAX,KAAEtM,KAVR,0CAU0C,iDAV1C,WAWiB,qBAAX,KAAEA,KAXR,2EAWsE0D,EAAQ,KAAExK,SAXhF,6E,+BAgBeoiB,E,sEAAf,WAAoC9Y,EAAU6Y,EAAUc,GAAxD,wFAEE3Z,EACE4Z,KAAK,kBAAmB,CAACD,EAAId,IAC7BxY,MAAK,SAAA5H,GAAQ,MAAK,CAAEA,SAAU6d,EAAUtV,KAAKvI,OAE7CkN,OAAM,SAAA/G,GAAC,MAAgB,iBAAXA,EAAEpB,KAA0B,CAAEsH,MAAOlG,EAAEkG,OAAU,CAAEA,MAAOlG,OAN1E,4C,sBAYAoL,EAAOC,QAAU,CAAExG,SAAQmM,Y,oDAAaiK,e,wDAAgB1C,cAAaC,UAASQ,e,iCChSxEkC,EAAana,EAAQ,KACrBoa,EAAgBpa,EAAQ,KACxBqa,EAAara,EAAQ,KACrBsa,EAAWta,EAAQ,KAGnBua,EAAuBva,EAAQ,KAC/Bwa,EAASxa,EAAQ,KAGjBya,EAAYza,EAAQ,KAE1BqK,EAAOC,QAAP,eACI6P,GACAC,GACAG,GACAC,GACAC,GALJ,IAMCJ,aACAC,c,qBCpBD,gBAAMI,EAAM1a,EAAQ,KACdyW,EAAYzW,EAAQ,IAAWyW,UAC/BG,EAAS5W,EAAQ,KAQvB,SAAS6K,EAAQkM,GAShB,OARA1D,KAAKtI,OAAS6L,EAAO7M,QAAQgN,EAAKhM,QAClCsI,KAAKrI,SAAW4L,EAAO7M,QAAQgN,EAAK/L,UACpCqI,KAAKpI,SAAW2L,EAAO7M,QAAQgN,EAAK9L,UACpCoI,KAAKnI,UAAY0L,EAAO7M,QAAQgN,EAAK7L,WACrCmI,KAAKvR,MAAQ8U,EAAO3M,QAAQ8M,EAAKjV,OAEjCoV,OAAOyD,OAAOtH,MAEPA,KAGRxI,EAAQmM,UAAU7U,KAAO,WACxB,OAAO+H,EAAO7I,KACboV,EAAUmE,YACTF,EAAIG,UACH,CAAC,UAAW,UAAW,UAAW,UAAW,WAC7C,CAACxH,KAAKtI,OAAQsI,KAAKrI,SAAUqI,KAAKpI,SAAUoI,KAAKnI,UAAWmI,KAAKvR,WAMrE+I,EAAQmM,UAAU8D,QAAU,WAC3B,kBAAYzH,KAAKlR,OAAOrI,SAAS,SAGlC+Q,EAAQmM,UAAU+D,gBAAkB,WACnC,MAAO,CAAC1H,KAAKtI,OAAQsI,KAAKrI,SAAUqI,KAAKpI,SAAUoI,KAAKnI,UAAWmI,KAAKvR,QAGzE+I,EAAQmM,UAAUgE,WAAa,SAASC,EAAcC,GAErD,OAAOrQ,EAAQsQ,qBAAqBF,EAAc5H,KAAKyH,UAAWI,IAGnErQ,EAAQmM,UAAUoE,cAAgB,SAASH,EAAcI,GACxD,kBAAYhI,KAAK2H,WAAWC,EAAcI,GAAWvhB,SAAS,SAG/D+Q,EAAQmM,UAAUsE,yBAA2B,SAASC,GACrD,OAAOrR,EAAO7I,KACboV,EAAUmE,YACTF,EAAIc,aACH,CAAC,SAAU,UAAW,WACtB,CAAC,SAAUnI,KAAKyH,UAAWS,OAM/B1Q,EAAQmM,UAAUyE,4BAA8B,SAASF,GACxD,kBAAYlI,KAAKiI,yBAAyBC,GAAkBzhB,SAAS,SAItE+Q,EAAQsQ,qBAAuB,SAASF,EAAcS,EAAWR,GAChE,OAAOhR,EAAO7I,KACboV,EAAUmE,YACTF,EAAIG,UAAU,CAAC,UAAW,UAAW,WAAY,CAACI,EAAcS,EAAWR,OAK9ErQ,EAAQ8Q,eAAiB,SAASC,EAAKC,GACtC,OAAO3R,EAAO7I,KAAKoV,EAAUmE,YAAYF,EAAIG,UAAU,CAAC,UAAW,WAAY,CAACe,EAAKC,OAGtFhR,EAAQiR,sBAAwB,SAASF,EAAKC,GAC7C,OAAO3R,EAAO7I,KACboV,EAAUmE,YAAYF,EAAIG,UAAU,CAAC,UAAW,SAAU,WAAY,CAACe,EAAK,UAAWC,OAIzFxR,EAAOC,QAAU,CAAEO,UAASkR,aAhFP,CAEpBC,WAAY,iFACZC,OAAQ,Q,6CCPT,IAAMrF,EAAS5W,EAAQ,KAEvB,SAASkc,EAASnF,GAUjB,OATA1D,KAAKvI,QAAUiM,EAAKjM,QACpBuI,KAAK8I,kBAAoBvF,EAAOrM,QAAQwM,EAAKoF,mBAC7C9I,KAAKgI,UAAYzE,EAAO3M,QAAQ8M,EAAKsE,WACrChI,KAAK+I,UAAYxF,EAAOjM,aAAaoM,EAAKqF,UAAW,GACrD/I,KAAKgJ,YAAczF,EAAOjM,aAAaoM,EAAKsF,YAAa,GACzDhJ,KAAKiJ,MAAQ1F,EAAOjM,aAAaoM,EAAKuF,OAAQ,GAE9CpF,OAAOyD,OAAOtH,MAEPA,KAGR6I,EAASlF,UAAU+D,gBAAkB,WAEpC,MAAO,CACN1H,KAAKvI,QAAQiQ,kBADP,YAED1H,KAAK8I,kBAAkBriB,SAAS,KACrCuZ,KAAKgI,UACLhI,KAAK+I,UACL/I,KAAKgJ,YACLhJ,KAAKiJ,QAIPjS,EAAOC,QAAU,CAAE4R,a,yCC1BbhS,EAASlK,EAAQ,IAAUkK,OAC3BuM,EAAYzW,EAAQ,IAAWyW,UAErC,SAAS8F,EAAaC,EAAOC,GAC5B,IAAKA,EACJ,OAAOD,EAER,IAAKA,EACJ,OAAOC,EAER,IAAMC,EAASxS,EAAOyS,OAAO,CAACH,EAAOC,GAAQnmB,KAAK4T,EAAO0S,UAEzD,OAAO1S,EAAO7I,KAAKoV,EAAUmE,YAAY8B,IAkB1C,SAASG,EAAUC,GAClB,GAAwB,IAApBA,EAASnmB,OACZ,MAAO,CAAC,CAACuT,EAAO7I,KAAK,MAEtB,IAAM0b,EAAS,GAEf,IADAA,EAAO7G,KAAK4G,GACLC,EAAOA,EAAOpmB,OAAS,GAAGA,OAAS,GACzComB,EAAO7G,KAAK8G,EAAaD,EAAOA,EAAOpmB,OAAS,KAEjD,OAAOomB,EAGR,SAASC,EAAaF,GACrB,OAAOA,EAAS3Y,QAAO,SAAC8Y,EAAOC,EAASC,EAAOC,GAI9C,OAHID,EAAQ,IAAM,GACjBF,EAAM/G,KAAKqG,EAAaW,EAASE,EAAID,EAAQ,KAEvCF,IACL,I,IAGE5C,E,wBACL,WAAYgD,GACX,GADsB,WACjBA,EAAUC,OAAM,SAAA9mB,GAAC,OAAiB,KAAbA,EAAEG,QAAiBuT,EAAOE,SAAS5T,MAC5D,MAAM,IAAI+J,MAAM,oCAEjB,IAzCmBgd,EAyCbte,EAAI,CAAE6d,UAzCOS,EAyCeF,EAvC5BE,EAAQpnB,QAAO,SAACqnB,EAAQxiB,GAC9B,OAAOuiB,EAAQE,WAAU,SAAAxe,GAAC,OAAIA,EAAEye,OAAOF,QAAaxiB,OAuCpDkc,OAAOyG,OAAOtK,KAAMpU,GACpBoU,KAAKyJ,SAASxmB,KAAK4T,EAAO0S,SAE1B,IAAMgB,EAAI,CAAEb,OAAQF,EAAUxJ,KAAKyJ,WACnC5F,OAAOyG,OAAOtK,KAAMuK,G,iCAGrB,WACC,IAAKvK,KAAKwK,KAAM,CACf,IAAM3P,EAAI,CAAE2P,KAAMxK,KAAK0J,OAAO1J,KAAK0J,OAAOpmB,OAAS,GAAG,IACtDugB,OAAOyG,OAAOtK,KAAMnF,GAErB,OAAOmF,KAAKwK,O,oBAGb,SAAOvB,EAAOY,GACb,OAAO7J,KAAKyK,UAAUJ,OAAOpB,EAAMnY,QAAO,SAAChC,EAAM8K,GAAP,OAAgBsP,EAAapa,EAAM8K,KAAOiQ,M,mBAGrF,SAAMA,GACL,IAAIC,EAAQ9J,KAAKyJ,SAASW,WAAU,SAAAxe,GAAC,OAAIA,EAAEye,OAAOR,MAElD,IAAe,IAAXC,EACH,MAAM,IAAI5c,MAAM,oCAGjB,OAAO8S,KAAK0J,OAAO5Y,QAAO,SAACmY,EAAOW,GACjC,IAAMhQ,EA9DT,SAAiBkQ,EAAOF,GACvB,IAAMc,EAAYZ,EAAQ,EAAIA,EAAQ,EAAIA,EAAQ,EAClD,OAAIY,EAAYd,EAAMtmB,OACdsmB,EAAMc,GAEP,KAyDQC,CAAQb,EAAOF,GAK5B,OAJIhQ,GACHqP,EAAMpG,KAAKjJ,GAEZkQ,EAAQ3b,KAAKC,MAAM0b,EAAQ,GACpBb,IACL,Q,KAGLjS,EAAOC,QAAU+P,G,kBCjFjBhQ,EAAOC,QAbP,SAAkB2T,GACjB,IAAMhQ,EAAMgQ,EAASjU,WAAW,MAAQiU,EAAS9T,MAAM,GAAK8T,EACtD/P,EAAI,KAAH,OAAQD,EAAIiQ,UAAU,EAAG,KAC1B/P,EAAI,KAAH,OAAQF,EAAIiQ,UAAU,GAAI,MAC7B9P,EAAI3X,SAASwX,EAAIiQ,UAAU,IAAK,KAAM,IAM1C,OALI9P,EAAI,KAAIA,GAAK,IAKV,CAHS,OAAN,OAAeA,EAAEtU,SAC1B,IADS,gEAGIoU,EAAGC,K,qBCVlB,gBAAMuM,EAAM1a,EAAQ,KACdyW,EAAYzW,EAAQ,IAAWyW,UAC/BG,EAAS5W,EAAQ,KAEvB,SAASme,EAAiBpH,GAMzB,OALA1D,KAAK+K,MAAQxH,EAAO7M,QAAQgN,EAAKqH,OACjC/K,KAAKgL,OAASzH,EAAOrM,QAAQwM,EAAKsH,QAClChL,KAAKiL,UAAY1H,EAAOrM,QAAQwM,EAAKuH,WAErCpH,OAAOyD,OAAOtH,MACPA,KAGR8K,EAAiBnH,UAAU7U,KAAO,WACjC,IAAMoc,EAAM7D,EAAIG,UACf,CAAC,UAAW,UAAW,WACvB,CAACxH,KAAK+K,MAAO/K,KAAKgL,OAAQhL,KAAKiL,YAEhC,OAAOpU,EAAO7I,KAAKoV,EAAUmE,YAAY2D,KAG1CJ,EAAiBnH,UAAU8D,QAAU,WACpC,kBAAYzH,KAAKlR,OAAOrI,SAAS,SAGlCuQ,EAAOC,QAAU,CAAE6T,sB,6CCzBnB,MAAkEne,EAAQ,IAAUrG,MAA5E8c,EAAR,EAAQA,UAAW+H,EAAnB,EAAmBA,gBAAiBC,EAApC,EAAoCA,YAAajD,EAAjD,EAAiDA,aAE3CkD,EAAkBjI,EACvBgI,EAAY,uFAGb,SAASE,EAAmBrc,EAAMsc,EAAcvc,GAC/C,OAAOoU,EACN+H,EAAgBzG,OACf,CAAC,UAAW,UAAW,UAAW,UAAW,WAC7C,CACCtB,EACCgI,EACC,uFAGFhI,EAAUgI,EAAYnc,IACtBmU,EAAUgI,EAAY,MACtBpc,EACAuc,KA2BJvU,EAAOC,QAAU,CAAEqU,qBAAoBE,kBArBvC,SAA2B5pB,EAAO6pB,EAAShd,EAAOid,GACjD,IAAMC,EAAmBL,EAAmB1pB,EAAMqN,KAAMrN,EAAM+B,QAAS/B,EAAMoN,SAE7E,OAAOoU,EACN+E,EACC,CAAC,SAAU,SAAU,UAAW,WAChC,CACC,OACA,OACAwD,EACAvI,EACC+H,EAAgBzG,OACf,CAAC,UAAW,UAAW,UAAW,UAAW,UAAW,WACxD,CAAC2G,EAAiBI,EAAQV,MAAOU,EAAQG,QAASH,EAAQ/nB,MAAO+K,EAAOid,W,k9MCtC9E,+CACe,SAASG,EAAyBC,EAAQC,GACvD,GAAc,MAAVD,EAAgB,MAAO,GAC3B,IACIE,EAAKrkB,EADL1D,EAAS,YAA6B6nB,EAAQC,GAGlD,GAAIlI,OAAOoI,sBAAuB,CAChC,IAAIC,EAAmBrI,OAAOoI,sBAAsBH,GAEpD,IAAKnkB,EAAI,EAAGA,EAAIukB,EAAiB5oB,OAAQqE,IACvCqkB,EAAME,EAAiBvkB,GACnBokB,EAAS1oB,QAAQ2oB,IAAQ,GACxBnI,OAAOF,UAAUwI,qBAAqB3F,KAAKsF,EAAQE,KACxD/nB,EAAO+nB,GAAOF,EAAOE,IAIzB,OAAO/nB,I,iRCjBT,gRAOO,SAASjB,EAAgBpB,EAAO8F,EAAOvF,EAAYI,EAAkBC,GAC1E,IAAc,OAAVL,QAAU,IAAVA,OAAA,EAAAA,EAAYuQ,cAAkC,gDAAd,OAAL9Q,QAAK,IAALA,OAAA,EAAAA,EAAO+B,SAA0D,OAAO,EACvG,IAAK/B,EAAO,OAAO,EACnB,IAAQqG,EAAkBD,EAAYpG,EAAOO,EAAYuF,EAAOnF,EAAkBC,GAA1EyF,cAER,OAD2B7E,SAASxB,EAAMC,SAAWsM,KAAKie,IAAI,GAAIxqB,EAAME,UAC7CmG,EAGtB,SAASokB,EAAYzqB,GAC1B,OAAO,OAACA,QAAD,IAACA,OAAD,EAACA,EAAO+B,UAA8B,gDAAd,OAAL/B,QAAK,IAALA,OAAA,EAAAA,EAAO+B,SAZX,IACC,KAgCzB,IAAM2oB,EAAiB,CAAC,uBAAwB,6BAA8B,uBAAwB,yBAA0B,uBAAwB,cAAsB,oBAAgC,yBAA0B,qBAAsB,uBAAwB,4BAE/Q,SAASjnB,EAAaknB,GAC3B,GAAKA,EACL,OAAIA,EAAI5pB,SAAS,mBAA2B,eACxC4pB,EAAI5pB,SAAS,sCAA8C,0DAC3D4pB,EAAI5pB,SAAS,0BAAkC,yCAC/C2pB,EAAe7oB,MAAK,SAAA+oB,GAAW,OAAID,EAAI5pB,SAAS6pB,MAAsB,4CACnED,EAGF,SAAShnB,EAAWgnB,GACzB,GAAKA,EACL,OAAIA,EAAI5pB,SAAS,mBAA2B,gCACxC4pB,EAAI5pB,SAAS,sCAA8C,uEAC3D4pB,EAAI5pB,SAAS,0BAAkC,uEAC/C2pB,EAAe7oB,MAAK,SAAA+oB,GAAW,OAAID,EAAI5pB,SAAS6pB,MAC3C,0QAGF,sFAGF,SAASvnB,EAAwBsnB,GACtC,OAAOD,EAAe7oB,MAAK,SAAA+oB,GAAW,OAAID,EAAI5pB,SAAS6pB,MAGlD,SAASjZ,EAAYiV,EAAM1mB,GAChC,MAAO,KAAOqM,KAAKse,MAAMjE,EAAOra,KAAKie,IAAI,GAAItqB,IAAW2E,SAAS,IAG5D,SAAS0B,EAAmBqgB,GAAqB,IAAf5lB,EAAc,uDAAH,EAClD,OAAKA,GACA4lB,EACY,IAAb5lB,EAAuB4lB,EACpBA,GAAQ,EAAI5lB,GAAYA,EAHT,EAOjB,SAASoF,EAAYkL,EAAU/Q,EAAYuF,EAAOnF,EAAkBC,GACzE,MAvDK,SAAmCZ,EAAOO,EAAYI,GAE3D,KAAI,OAACJ,QAAD,IAACA,OAAD,EAACA,EAAY4C,YAAanD,EAAO,MAAO,CAAE8qB,WAAY,EAAGvZ,SAAU,GAEvE,IAAMA,EAAWkZ,EAAYzqB,GAE7B,OAAMW,EAAyB,CAAE4Q,SAAU,EAAGuZ,WAAY,GAEnD,CAELA,WAAY/iB,aAAaxH,EAAWsD,SAAW0N,GAAYhR,EAAWsD,UAAUe,QAAQ,IACxF2M,YA4C+BwZ,CAA0BzZ,EAAU/Q,EAAYI,GAAzE4Q,EAAR,EAAQA,SAAUuZ,EAAlB,EAAkBA,WACZhkB,EAAW2jB,EAAYnZ,GACvB0Z,EAAqB,IAAa,OAAR1Z,QAAQ,IAARA,OAAA,EAAAA,EAAUtQ,WAAY,GAChDiqB,EAAkBH,EAAaE,EAC/B1mB,GAAqB,OAARgN,QAAQ,IAARA,OAAA,EAAAA,EAAUhN,aAAc,EACrC4mB,EAA6BvqB,GAAyC,+CAArB2Q,EAASvP,SAA6DnB,EAAQwE,KAAOkM,EAAS1Q,QAC/IgD,EAAcrD,EAAWqF,UACzBrF,EAAWqF,UAAYolB,EAAsB1mB,EAC9C4mB,EAEI3qB,EAAWqD,YAAYkC,GAASmlB,EAAmB3mB,EAAc/D,EAAW6D,sBAAyBkN,EAAS/M,MADjHhE,EAAWqD,YAAYkC,GAASmlB,EAStC,MAAO,CACLrnB,cACAT,SATgB2E,MAAMvH,EAAW6D,4BAIjCsO,EAHCwY,EAECtnB,EAAc0N,EAAS/M,MADvBX,EAAcrD,EAAW6D,sBAQ3BiC,cALoBzC,EAAcU,EAMlCiN,WACAzK,c,2LCpFJ,SAASqkB,EAAiBvc,GACxB,IAAMhO,EAAUya,IAASxZ,MAAK,SAAAV,GAAC,OAAIA,EAAEiE,KAAOwJ,KAC5C,OAAOhO,EAAUA,EAAQkD,kBAAoB,QAqEhC,SAASkQ,EAAT,GAA4J,IAAD,OAApItH,EAAoI,EAApIA,IAAKjM,EAA+H,EAA/HA,UAAWG,EAAoH,EAApHA,QAASsK,EAA2G,EAA3GA,QAASyI,EAAkG,EAAlGA,eAAgByX,EAAkF,EAAlFA,MAAOC,EAA2E,EAA3EA,cAAenX,EAA4D,EAA5DA,eAAgBC,EAA4C,EAA5CA,oBAA4C,IAAvB7E,oBAAuB,MAAR,KAAQ,EACxK,EAAoDgc,cAA5CC,UAAaC,EAArB,EAAqBA,UAAWC,EAAhC,EAAgCA,cAChC,EAAkC1oB,oBAAS,GAA3C,mBAAO2oB,EAAP,KAAmBC,EAAnB,KACMC,EAAeC,YAAQJ,EAAe/e,EAAI,IAE1Cof,EAAiBzQ,IAASxZ,MAAK,qBAAGuD,KAAgBxE,KAGlDmrB,EAFkBC,YAAsBP,EAAeD,EAAW9e,EAAK9L,EAASsK,EAAS,CAAEkgB,QAAOa,UAAU,IAEjF9nB,KAAI,SAAA+nB,GAAK,OAAInd,MAAMC,QAAQkd,GAASA,EAAM/nB,KAAI,SAACE,EAAM0B,GAAP,OA1EjF,SAAkC1B,EAAM0B,EAAG+lB,GACzC,GAAoB,IAAhBznB,EAAK3C,OAAc,OAAO2C,EAE9B,GAAU,IAAN0B,EAAS,OAAQ,qBAAK5D,UAAS,iBAAYkC,EAAKqK,eAA/B,SAAoErK,GAApE,eAA6D0B,IAElF,IAAK1B,EAAKiF,KAAM,OAAQ,qBAAKnH,UAAU,OAAf,SAA0CkC,GAA1C,eAAmC0B,IAC3D,GAAkB,UAAd1B,EAAKiF,KACP,OACA,sBAAKnH,UAAU,QAAf,UACIkC,EAAKiS,OAAS,GAAK,+BAAQzP,YAAuBxC,EAAKiS,QAAQ,EAAMjS,EAAKnE,YACxD,OAAlBmE,EAAKnE,UAAqBmE,EAAKvD,OAC/B,eAAC,WAAD,WACGuD,EAAKtC,SACJ,qBAAKI,UAAU,OACbkI,MAAO,CAAE+J,gBAAgB,OAAD,OAASjP,YAAa2mB,EAAe1mB,GAAIf,EAAKtC,SAA9C,QAE3BsC,EAAKvD,UAELuD,EAAKiS,OAAS,EAAK,yBAA2B,OAVrD,eAAoCvQ,IAetC,GAAkB,YAAd1B,EAAKiF,KAAoB,OAC3B,mBACEnH,UAAU,UAEVC,KAAMiC,EAAKtC,QAAL,UAAkB+pB,EAAeK,YAAjC,oBAAwD9nB,EAAKtC,SAAY,KAC/EM,OAAO,SACPC,IAAI,aACJC,QAAS,SAAAyH,GAAC,OAAIA,EAAEoiB,mBANlB,SAQE,eAAC,IAAD,CAASzpB,UAAW0B,EAAKtC,QAAS+C,MAAOT,EAAKtC,QAA9C,UACIsC,EAAKgJ,KAAOhJ,EAAKgJ,KAAOhJ,EAAKtC,QAC7BsC,EAAKtC,QAAU,cAAC,IAAD,IAA2B,SAVhD,eAEegE,IAajB,GAAkB,YAAd1B,EAAKiF,KAAoB,OAC3B,sBAAKnH,UAAU,UAAf,UACIkC,EAAKY,KAAO,qBAAK9C,UAAU,OAAOkI,MAAO,CAAE+J,gBAAgB,OAAD,OAAS/P,EAAKY,KAAd,QAAkC,KAC5FZ,EAAKgJ,OAFT,eAAsCtH,IAMxC,GAAkB,WAAd1B,EAAKiF,KAAmB,CAC1B,IAAM+iB,EAAchoB,EAAKzD,SAAWyD,EAAKtC,SAAWsC,EAAKe,GACzD,OACE,oBACEjD,UAAU,SAEVC,KAAMiqB,EAAW,uBAAmBhoB,EAAKzD,QAAxB,YAAmCyD,EAAKtC,QAAxC,YAAmDsC,EAAKe,IAAO,KAChF/C,OAAO,SACPC,IAAI,aACJC,QAAS,SAAAyH,GAAC,OAAIA,EAAEoiB,mBANlB,UAQI/nB,EAAKgJ,KACLgf,EAAc,cAAC,IAAD,IAA2B,OAT7C,eAEetmB,IAYnB,OAAO,6BAWqFumB,CAAyBjoB,EAAM0B,EAAG+lB,MAAoBI,KAGlJ,OAFAljB,qBAAU,mBAAQsG,GAAgBid,YAAqBjd,KAAe,CAACA,IAGrE,sBAAKnN,UAAWwR,EAAiB,0BAA4B,aAA7D,UACI,sBAAKxR,UAAU,UAAf,UACE,sBAAKA,UAAU,OAAOI,QAAS,kBAAO8oB,GAAiBM,GAAY,SAAA3hB,GAAC,OAAKA,MAAzE,UACE,sBAAK7H,UAAU,oBAAf,WACIkpB,GAAkB,qBAAKlpB,UAAU,YAAf,SACjBupB,EAAc,cAAC,IAAD,IAAmB,cAAC,IAAD,MAEpC,qBAAKvpB,UAAU,UAAf,SAA2B4pB,OAE5BpY,GAAmB,qBAAKxR,UAAU,oBAAf,qDAChBwR,IAAmByX,IAAUoB,YAAQf,EAAe/e,EAAKxB,IAAa,qBAAK/I,UAAU,iBAAf,0EAE5E,qBAAKA,UAAU,cAAf,SACG1B,EACC,cAAC,IAAD,CAASkC,UAAWuR,IAAmBC,EAAqBrP,MAAOqP,EAAnE,SACE,qBAAKhS,UAAS,qBAAgB+R,EAAiB,WAAa,IAAM3R,QAAS,SAAAyH,GAAOA,EAAEoiB,mBAAoBlY,GAAkBzT,EAAU0d,MAAM,EAAMnU,IAAhJ,SAAsJ,cAAC,IAAD,QAErJ,kCAIP0hB,EAAc,sBAAKvpB,UAAU,WAAf,UACZ,gCAAK,mDAAqB,mCAArB,QAAL,IAA2CuK,EAAI,GAAIkf,EAAY,YAAQA,EAAR,KAA0B,MACzF,gCAAK,mDAAqB,sCAArB,QAAL,IAA8Ca,sBAAY/f,EAAI,IAAM,MAAO,IAA3E,IAAiFye,EAAiBvqB,MAClG,gCAAK,sCAAL,IAAmB8L,EAAI,SACd,kC,uHCtHfggB,EAAkB,IAAI5hB,YAAU6hB,GAG/B,SAAS7d,EAAT,EAEL1C,GACC,IAFC3J,EAEF,EAFEA,GAAIX,EAEN,EAFMA,MAAO4J,EAEb,EAFaA,KAAMkhB,EAEnB,EAFmBA,WAKnB,GAAW,OAAPnqB,IAAgBA,EAAI,CACtB,IAAMwJ,EACJ2gB,GAAU,0BAAuB9Y,KAAKC,MAAMlP,SAAS,IAAIqQ,MAAM,EAAG,GAAxD,aAA+D9I,EAAK8I,MAAM,IACtF,MAAO,CACLzD,IAAe1F,oBACfjK,EACA4qB,EAAgB/gB,mBAAmB,SAAU,CAACD,EAAMO,KAGxD,MAAO,CAACxJ,EAAIX,GAAS,MAAO4J,GAAQ","file":"static/js/11.0cc92467.chunk.js","sourcesContent":["import './FeeSelector.scss'\n\nimport { AiOutlineWarning } from 'react-icons/ai'\nimport { Loading, Select, ToolTip, Button, TextInput, DAppIncompatibilityWarningMsg } from 'components/common'\nimport {\n  isTokenEligible,\n  mapTxnErrMsg,\n  getErrHint,\n  getFeesData,\n  getDiscountApplied,\n  checkIfDAppIncompatible\n} from './helpers'\nimport { FaPercentage } from 'react-icons/fa'\nimport { MdInfoOutline } from 'react-icons/md'\nimport { NavLink } from 'react-router-dom'\nimport { MdEdit } from 'react-icons/md'\nimport { useState } from 'react'\nimport { getTokenIcon } from 'lib/icons'\nimport { formatFloatTokenAmount } from 'lib/formatters'\nimport { ethers } from 'ethers'\n\nconst SPEEDS = ['slow', 'medium', 'fast', 'ape']\nconst walletDiscountBlogpost = 'https://blog.ambire.com/move-crypto-with-ambire-pay-gas-with-wallet-and-save-30-on-fees-35dca1002697'\nconst OVERPRICED_MULTIPLIER = 1.2\n// NOTE: Order matters for for secondary fort after the one by discount\nconst DISCOUNT_TOKENS_SYMBOLS = ['xWALLET', 'WALLET-STAKING', 'WALLET']\n\nfunction getBalance(token) {\n  const { balance, decimals, priceInUSD } = token\n  return balance / decimals * priceInUSD\n}\n\nconst WalletDiscountBanner = ({ currenciesItems, tokens, estimation, onFeeCurrencyChange, onDismiss, feeSpeed, isGasTankEnabled, network }) => {\n  if (estimation.selectedFeeToken?.symbol\n    && (DISCOUNT_TOKENS_SYMBOLS.includes(estimation.selectedFeeToken?.symbol)\n      || estimation.selectedFeeToken.discount)\n  ) {\n    return null\n  }\n  const walletDiscountTokens = [...tokens]\n    .filter(x => DISCOUNT_TOKENS_SYMBOLS.includes(x.symbol) && x.discount && isTokenEligible(x, feeSpeed, estimation, isGasTankEnabled, network))\n    .sort((a, b) =>\n      b.discount - a.discount\n      || ((!parseInt(a.balance) || !parseInt(b.balance)) ? getBalance(b) - getBalance(a) : 0)\n      || DISCOUNT_TOKENS_SYMBOLS.indexOf(a.symbol) - DISCOUNT_TOKENS_SYMBOLS.indexOf(b.symbol)\n    )\n\n  if (!walletDiscountTokens.length) return null\n\n  const discountToken = walletDiscountTokens[0]\n\n  const { discount } = discountToken\n  const eligibleWalletToken = currenciesItems.find(x => x.value && (x.value === 'WALLET' || x.value === discountToken.address))\n  const action = !!eligibleWalletToken\n    ? () => onFeeCurrencyChange(eligibleWalletToken)\n    : null\n  //TODO: go to swap \n  const actionTxt = !!eligibleWalletToken ? `USE ${discountToken.symbol}` : `BUY ${discountToken.symbol}`\n  const showSwap = !action\n\n  return (\n    <div className='wallet-discount-banner row'>\n      <div className='row'>\n        Get {discount * 100} <FaPercentage /> fees discount with &nbsp;<strong>$WALLET</strong> &nbsp;\n        <a\n          className=\"address row\"\n          href={walletDiscountBlogpost}\n          target=\"_blank\"\n          rel=\"noreferrer noopener\">\n          <MdInfoOutline />\n        </a>\n      </div>\n      {!!action && <Button onClick={action} mini>\n        {actionTxt}\n      </Button>}\n      {showSwap && <div className='swap-info'>\n        You can get $WALLET, just use the &nbsp;\n        <NavLink className='link' to={'/wallet/swap'} onClick={onDismiss}>\n          Swap\n        </NavLink> menu on the left!\n      </div>}\n    </div>\n  )\n}\n\nconst mapGasTankTokens = nativePrice => item => {\n  const nativeRate = item.address === '0x0000000000000000000000000000000000000000' ? null : nativePrice / item.price\n  return {\n    ...item,\n    symbol: item.symbol.toUpperCase(),\n    balance: ethers.utils.parseUnits(\n      item.balance.toFixed(item.decimals).toString(),\n      item.decimals\n    ).toString(),\n    nativeRate\n  }\n}\n\nexport function FeeSelector({ disabled, signer, estimation, network, setEstimation, feeSpeed, setFeeSpeed, onDismiss, isGasTankEnabled }) {\n  const [editCustomFee, setEditCustomFee] = useState(false)\n  if (!estimation) return (<Loading />)\n  // Only check for insufficient fee in relayer mode (.feeInUSD is available)\n  // Otherwise we don't care whether the user has enough for fees, their signer wallet will take care of it\n  const insufficientFee = estimation && estimation.feeInUSD\n    && !isTokenEligible(estimation.selectedFeeToken, feeSpeed, estimation, isGasTankEnabled, network)\n  if (estimation && !estimation.success) return (!checkIfDAppIncompatible(estimation.message) ?\n    <FailingTxn\n      message={<>The current transaction batch cannot be sent because it will fail: {mapTxnErrMsg(estimation.message)}</>}\n      tooltip={getErrHint(estimation.message)}\n    /> : <DAppIncompatibilityWarningMsg title={'Unable to send transaction'} />)\n\n  if (!estimation.feeInNative) return (<></>)\n  if (estimation && !estimation.feeInUSD && estimation.gasLimit < 40000) {\n    return (<div>\n      <b>WARNING:</b> Fee estimation unavailable when you're doing your first account transaction and you are not connected to a relayer. You will pay the fee from <b>{signer.address}</b>, make sure you have {network.nativeAssetSymbol} there.\n    </div>)\n  }\n  if (estimation && estimation.feeInUSD && !estimation.remainingFeeTokenBalances) {\n    return (<div className='balance-error'>Internal error: fee balances not available. This should never happen, please report this on help.ambire.com</div>)\n  }\n\n  const { nativeAssetSymbol } = network\n  const gasTankTokens = estimation.gasTank?.map(mapGasTankTokens(estimation.nativeAssetPriceInUSD))\n  const tokens = (isGasTankEnabled && gasTankTokens?.length)\n    ? gasTankTokens\n    // fallback to the native asset if fee tokens cannot be retrieved for wh  atever reason\n    : estimation.remainingFeeTokenBalances || [{ symbol: nativeAssetSymbol, decimals: 18, address: '0x0000000000000000000000000000000000000000' }]\n\n  const onFeeCurrencyChange = ({ value, label}) => {\n    const token = tokens.find(({ address, symbol }) => (address === value) && (symbol === label))\n    setEstimation({ ...estimation, selectedFeeToken: token })\n  }\n\n  const currenciesItems = tokens\n    // NOTE: filter by slowest and then will disable the higher fees speeds otherwise \n    // it will just hide the token from the select\n    .sort((a, b) =>\n    (isTokenEligible(b, SPEEDS[0], estimation, isGasTankEnabled, network) - isTokenEligible(a, SPEEDS[0], estimation, isGasTankEnabled, network))\n    || (DISCOUNT_TOKENS_SYMBOLS.indexOf(b.symbol) - DISCOUNT_TOKENS_SYMBOLS.indexOf(a.symbol))\n    || ((b.discount || 0) - (a.discount || 0))\n    || a?.symbol.toUpperCase().localeCompare(b?.symbol.toUpperCase())\n  )\n    .map(({ address, symbol, discount, network: tokenNetwork, icon, ...rest }) => ({\n      disabled: !isTokenEligible({address, symbol, discount, ...rest }, SPEEDS[0], estimation, isGasTankEnabled, network),\n      icon: icon || (address ? getTokenIcon(isGasTankEnabled ? tokenNetwork : network.id, address) : null),\n      label: symbol,\n      value: address || symbol,\n      ...(discount ? {\n        extra: <div className='discount'> - {discount * 100} <FaPercentage /> </div>\n      } : {})\n    }))\n\n  const feeCurrencySelect = estimation.feeInUSD ? (<>\n    <div className='section'>\n      <div className='section-title'>Fee Currency</div>\n      <Select\n        className=\"fee-select\"\n        disabled={disabled}\n        defaultValue={estimation.selectedFeeToken?.address || estimation.selectedFeeToken?.symbol}\n        items={currenciesItems}\n        onChange={onFeeCurrencyChange}\n      />\n    </div>\n  </>) : (<></>)\n\n  const { discount = 0, symbol, nativeRate = null, decimals } = estimation.selectedFeeToken || {}\n\n  const setCustomFee = value => setEstimation(prevEstimation => ({\n    ...prevEstimation,\n    customFee: value\n  }))\n\n  const selectFeeSpeed = speed => {\n    setFeeSpeed(speed)\n    setCustomFee(null)\n    setEditCustomFee(false)\n  }\n\n  if (insufficientFee) {\n    const sufficientSpeeds = SPEEDS.filter((speed, i) => isTokenEligible(estimation.selectedFeeToken, speed, estimation, isGasTankEnabled, network))\n    const highestSufficientSpeed = sufficientSpeeds[sufficientSpeeds.length - 1]\n    setFeeSpeed(highestSufficientSpeed)\n  }\n\n  const checkIsSelectorDisabled = speed => {\n    const insufficientFee = !isTokenEligible(estimation.selectedFeeToken, speed, estimation, isGasTankEnabled, network)\n    return disabled || insufficientFee\n  }\n\n  const feeAmountSelectors = SPEEDS.map(speed => {\n    const isETH = symbol === 'ETH' && nativeAssetSymbol === 'ETH'\n    const {\n      feeInFeeToken,\n      feeInUSD,\n      // NOTE: get the estimation res data w/o custom fee for the speeds\n    } = getFeesData({ ...estimation.selectedFeeToken }, { ...estimation, customFee: null }, speed, isGasTankEnabled, network)\n    const discountInFeeToken = getDiscountApplied(feeInFeeToken, discount)\n    const discountInFeeInUSD = getDiscountApplied(feeInUSD, discount)\n\n    const baseFeeInFeeToken = feeInFeeToken + discountInFeeToken\n    const baseFeeInFeeUSD = feeInUSD ? feeInUSD + discountInFeeInUSD : null\n\n    const showInUSD = (nativeRate !== null) && baseFeeInFeeUSD\n\n    return (\n      <div\n        key={speed}\n        className={`feeSquare${!estimation.customFee && feeSpeed === speed ? ' selected' : ''}${checkIsSelectorDisabled(speed) ? ' disabled' : ''}`}\n        onClick={() => !checkIsSelectorDisabled(speed) && selectFeeSpeed(speed)}\n      >\n        {!!discount && <FaPercentage className='discount-badge' />}\n        <div className='speed'>{speed}</div>\n        <div className='feeEstimation'>\n          {(isETH ? ' ' : '')\n            + (showInUSD ? `$${formatFloatTokenAmount(baseFeeInFeeUSD, true, 4)}` : formatFloatTokenAmount(baseFeeInFeeToken, true, decimals))\n            + (!isETH && !showInUSD ? ` ${estimation.selectedFeeToken.symbol}` : '')\n          }\n        </div>\n        {!isETH && !showInUSD && <div className='feeEstimation symbol'>\n          {estimation.selectedFeeToken.symbol}\n        </div>}\n      </div>\n    )\n  })\n\n  const {\n    feeInFeeToken,\n    feeInUSD,\n    savedGas,\n  } = getFeesData(estimation.selectedFeeToken, estimation, feeSpeed, isGasTankEnabled, network)\n\n  const {\n    feeInFeeToken: minFee,\n    feeInUSD: minFeeUSD,\n  } = getFeesData({ ...estimation.selectedFeeToken }, { ...estimation, customFee: null }, 'slow', isGasTankEnabled, network)\n\n  const {\n    feeInFeeToken: maxFee,\n    feeInUSD: maxFeeUSD,\n  } = getFeesData({ ...estimation.selectedFeeToken }, { ...estimation, customFee: null }, 'ape', isGasTankEnabled, network)\n\n  const discountMin = getDiscountApplied(minFee, discount)\n  const discountMax = getDiscountApplied(maxFee, discount)\n\n  const discountInFeeToken = getDiscountApplied(feeInFeeToken, discount)\n  const discountInUSD = getDiscountApplied(feeInUSD, discount)\n  const discountBaseMinInUSD = getDiscountApplied(minFeeUSD, discount)\n  const discountBaseMaxInUSD = getDiscountApplied(maxFeeUSD, discount)\n\n  // Fees with no discounts applied\n  const baseFeeInFeeToken = feeInFeeToken + discountInFeeToken\n  const baseFeeInUSD = feeInUSD + discountInUSD\n  const baseMinFee = minFee + discountMin\n  const baseMaxFee = (maxFee + discountMax) * OVERPRICED_MULTIPLIER\n  const baseMinFeeUSD = minFeeUSD + discountBaseMinInUSD\n  const baseMaxFeeUSD = (maxFeeUSD + discountBaseMaxInUSD) * OVERPRICED_MULTIPLIER\n\n  const isUnderpriced = !!estimation.customFee\n    && !isNaN(parseFloat(estimation.customFee))\n    && (baseFeeInFeeToken < baseMinFee)\n\n  const isOverpriced = !!estimation.customFee\n    && !isNaN(parseFloat(estimation.customFee))\n    && (baseFeeInFeeToken > baseMaxFee)\n\n  return (<>\n    {insufficientFee ?\n      (<div className='balance-error'>\n        Insufficient balance for the fee.<br />Accepted tokens: {(estimation.remainingFeeTokenBalances || []).map(x => x.symbol).join(', ')}\n        { isGasTankEnabled && <div>Disable your Gas Tank to use the default fee tokens.</div> }\n      </div>)\n      : feeCurrencySelect\n    }\n\n    {WalletDiscountBanner({\n      selectedFeeToken: estimation.selectedFeeToken,\n      currenciesItems,\n      tokens,\n      estimation,\n      onFeeCurrencyChange,\n      onDismiss,\n      feeSpeed,\n      isGasTankEnabled,\n      network\n    })}\n\n    <div className='section-title'>\n      <span>Transaction Speed</span>\n      { network.isGasTankAvailable && \n        <span>Gas Tank: { isGasTankEnabled ? \n          (<span className='gas-tank-enabled'>Enabled</span>) : \n          (<span className='gas-tank-disabled'>Disabled</span>)}\n        </span> \n      }\n    </div>\n    <div className='fee-selector'>\n      <div className='section'>\n        <div id='fee-selector'>{feeAmountSelectors}</div>\n        {\n          !editCustomFee ?\n            <div id='edit-custom-fee' onClick={() => setEditCustomFee(true)}>\n              <MdEdit />Edit fee\n            </div>\n            :\n            <div id='custom-fee-selector'>\n              <div className='title'>Custom Fee ({symbol})</div>\n              <TextInput\n                small\n                placeholder='Enter amount'\n                className={`${estimation.customFee ? 'selected' : ''}`}\n                onChange={value => setCustomFee(value)}\n                value={estimation.customFee}\n              />\n              {isUnderpriced &&\n                <div className='price-warning'>\n                  <div>Custom Fee too low. You can try to \"sign and send\" the transaction but most probably it will fail.</div>\n                  <div>Min estimated fee: &nbsp;\n                    {<Button textOnly\n                      onClick={() => setCustomFee(baseMinFee)}\n                    >\n                      {baseMinFee} {symbol}\n                    </Button>}\n                    {!isNaN(baseMinFeeUSD) &&\n                      <span>&nbsp; (~${formatFloatTokenAmount(baseMinFeeUSD, true, 4)}) </span>\n                    }\n                  </div>\n                </div>\n              }\n              {isOverpriced &&\n                <div className='price-warning'>\n                  <div>Custom Fee is higher than the APE speed. You will pay more than probably needed. Make sure you know what are you doing!</div>\n                  <div>Recommended max fee: &nbsp;\n                    {<Button textOnly\n                      onClick={() => setCustomFee(baseMaxFee)}\n                    >\n                      {baseMaxFee} {symbol}\n                    </Button>}\n                    {!isNaN(baseMaxFeeUSD) &&\n                      <span>&nbsp; (~${formatFloatTokenAmount(baseMaxFeeUSD, true, 4)}) </span>\n                    }\n                  </div>\n                </div>\n              }\n            </div>\n        }\n      </div>\n\n      <div className='fees-breakdown'>\n        {(<div className='fee-row native-fee-estimation'>\n          <div>\n            Fee {!!discount && <span className='discount-label'>*</span>}\n            {!!(discount && DISCOUNT_TOKENS_SYMBOLS.includes(estimation.selectedFeeToken?.symbol)) &&\n              <a\n                className=\"address row discount-label\"\n                href={walletDiscountBlogpost}\n                target=\"_blank\"\n                rel=\"noreferrer\">\n                &nbsp;<MdInfoOutline />\n              </a>}:\n          </div>\n          <div className='fee-amounts'>\n            {!isNaN(baseFeeInUSD) &&\n              <div>\n                ~${formatFloatTokenAmount(baseFeeInUSD, true, 4)}\n              </div>\n            }\n            {!isNaN(baseFeeInFeeToken) && <div>\n              {formatFloatTokenAmount(baseFeeInFeeToken, true, decimals) + ' ' + estimation?.selectedFeeToken?.symbol}\n            </div>\n            }\n          </div>\n        </div>)}\n\n        {!!discount && (<div className='fee-row native-fee-estimation discount-label'>\n          <div>\n            You save ({discount * 100}%):\n          </div>\n          <div className='fee-amounts'>\n            <div>\n              ~${formatFloatTokenAmount(discountInUSD, true, 4)}\n            </div>\n            {/* <div>\n              {discountInFeeToken + ' ' + estimation.selectedFeeToken.symbol}\n            </div> */}\n          </div>\n        </div>)}\n\n        {!!discount && (<div className='fee-row native-fee-estimation discount-label'>\n          <div>\n            You pay:\n          </div>\n          <div className='fee-amounts'>\n            <div>\n              ~${formatFloatTokenAmount(feeInUSD, true, 4)}\n            </div>\n          </div>\n        </div>)}\n        {!isGasTankEnabled && !isNaN((feeInUSD / estimation.gasLimit) * savedGas) && \n            <div className='fee-row native-fee-estimation warning-label'>\n              <div>\n              Enable Gas Tank to save:\n              </div>\n              <div className='fee-amounts'>\n                <div>\n                  ${formatFloatTokenAmount(((feeInUSD / estimation.gasLimit) * savedGas), true, 4)}\n                </div>\n              </div>\n            </div>}\n        {!!isGasTankEnabled && (<>\n          <div className='fee-row native-fee-estimation discount-label'>\n            <div>\n              Gas Tank fee token balance:\n            </div>\n            <div className='fee-amounts'>\n              <div>\n                ${formatFloatTokenAmount(estimation.selectedFeeToken.balanceInUSD, true, 4)}\n              </div>\n            </div>\n          </div>\n         {!isNaN((feeInUSD / estimation.gasLimit) * savedGas) && \n            <div className='fee-row native-fee-estimation discount-label'>\n              <div>\n                Gas Tank saves you:\n              </div>\n              <div className='fee-amounts'>\n                <div>\n                  ${formatFloatTokenAmount(((feeInUSD / estimation.gasLimit) * savedGas), true, 4)}\n                </div>\n              </div>\n            </div>}\n        </>)}\n      </div>\n    </div>\n\n    {!estimation.feeInUSD ?\n      (<span className='no-relayer-msg'><b>WARNING:</b> Paying fees in tokens other than {nativeAssetSymbol} is unavailable because you are not connected to a relayer. You will pay the fee from <b>{signer.address}</b>.</span>)\n      : (<></>)}\n  </>)\n}\n\nexport function FailingTxn({ message, tooltip = '' }) {\n  return (<div className='failingTxn'>\n    <ToolTip label={tooltip}>\n      <div className='error-title'><AiOutlineWarning></AiOutlineWarning> Warning</div>\n      <div className='error-message'>{message}</div>\n    </ToolTip>\n  </div>)\n}","import { useState, useRef, useEffect } from 'react'\nimport { Button, Loading, TextInput } from 'components/common'\nimport { isTokenEligible } from './helpers'\nimport { MdCheck, MdCheckCircle, MdOutlineCheck, MdOutlineClose } from 'react-icons/md'\n\nexport default function Actions({ \n    estimation, \n    feeSpeed, \n    approveTxn, \n    rejectTxn, \n    cancelSigning, \n    signingStatus, \n    isGasTankEnabled, \n    network\n  }) {\n  const [quickAccCredentials, setQuickAccCredentials] = useState({ code: '', passphrase: '' })\n  // reset this every time the signing status changes\n  useEffect(() => !signingStatus && setQuickAccCredentials(prev => ({ ...prev, code: '' })), [signingStatus])\n\n  const form = useRef(null)\n\n  const rejectButton = rejectTxn && (\n    // WARNING: DO NOT remove type='button' here, it indicates that this button is not a submit button in the <form>\n    // if it is, pressing Enter will reject the transaction rather than submit it\n    <Button danger icon={<MdOutlineClose/>} type='button' className='rejectTxn' onClick={rejectTxn}>Reject</Button>\n  )\n  const insufficientFee = estimation && estimation.feeInUSD\n    && !isTokenEligible(estimation.selectedFeeToken, feeSpeed, estimation, isGasTankEnabled, network)\n  const willFail = (estimation && !estimation.success) || insufficientFee\n  if (willFail) {\n    return (<div className='buttons'>\n      {rejectButton}\n    </div>)\n  }\n\n  const signButtonLabel = signingStatus && signingStatus.inProgress ?\n    <><Loading/>Signing...</>\n    : <><MdOutlineCheck/>Sign and send</>\n\n  const isRecoveryMode = signingStatus && signingStatus.finalBundle && signingStatus.finalBundle.recoveryMode\n  if (signingStatus && signingStatus.quickAcc) {\n    return (<>\n      {\n        signingStatus.confCodeRequired ?\n          <div className='confirmation-code-info'>\n            <div className='confirmation-code-info-title'><MdCheckCircle/>Confirmation</div>\n            <div className='confirmation-code-info-message'>\n              {signingStatus.confCodeRequired === 'otp' ? <>Please enter your OTP code and your password.</> : null}\n              {signingStatus.confCodeRequired === 'email' ?\n                (isRecoveryMode\n                  ? <>A confirmation code was sent to your email, please enter it to initiate the recovery.</>\n                  : <>A confirmation code was sent to your email, please enter it along with your password.</>)\n                      : null\n\t      }\n            </div>\n          </div>\n          :\n          null\n      }\n  \n      <form ref={form} className='quickAccSigningForm' onSubmit={e => { e.preventDefault() }}>\n        {signingStatus.confCodeRequired === 'notRequired' &&\n          <p className='code-2fa-not-required-msg'>You already sent 3 or more transactions to this address, confirmation code is not needed.</p>\n        }\n        <div className='inputs-container'>\n          <TextInput\n            small\n            password\n            required\n            minLength={3}\n            placeholder='Password'\n            value={quickAccCredentials.passphrase}\n            style={isRecoveryMode ? { visibility: 'hidden' } : {} }\n            disabled={isRecoveryMode}\n            onChange={value => setQuickAccCredentials({ ...quickAccCredentials, passphrase: value })}\n          ></TextInput>\n          {/* Changing the autoComplete prop to a random string seems to disable it in more cases */}\n          {signingStatus.confCodeRequired !== 'notRequired' &&\n            <TextInput\n              small\n              pattern='[0-9]+'\n              title='Confirmation code should be 6 digits'\n              autoComplete='nope'\n              required minLength={6} maxLength={6}\n              placeholder={signingStatus.confCodeRequired === 'otp' ? 'Authenticator OTP code' : 'Confirmation code'}\n              value={quickAccCredentials.code}\n              onChange={value => setQuickAccCredentials({ ...quickAccCredentials, code: value })}\n            ></TextInput>\n          }\n        </div>\n        <div className='buttons'>\n          <Button\n            clear\n            disabled={signingStatus && signingStatus.inProgress}\n            icon={<MdOutlineClose/>}\n            type='button'\n            className='cancelSigning'\n            onClick={cancelSigning}\n          >\n            Cancel\n          </Button>\n          <Button \n            className='confirmSigning'\n            onClick={() => {\n              if (!form.current.checkValidity()) return\n              approveTxn({ quickAccCredentials })\n            }}\n          >\n            { signingStatus && signingStatus.inProgress ? <Loading/> : <><MdCheck/> Confirm</>}\n          </Button>\n        </div>\n      </form>\n    </>)\n  }\n\n  return (<div className='buttons'>\n      {rejectButton}\n      <Button className='approveTxn' disabled={!estimation || signingStatus} onClick={approveTxn}>\n        {signButtonLabel}\n      </Button>\n  </div>)\n}\n","import { Interface, hexlify } from 'ethers/lib/utils'\nconst IdentityInterface = new Interface(require('adex-protocol-eth/abi/Identity5.2'))\nconst FactoryInterface = new Interface(require('adex-protocol-eth/abi/IdentityFactory5.2'))\n\nexport async function sendNoRelayer ({ finalBundle, account, network, wallet, estimation, feeSpeed, provider }) {\n    const { signer } = finalBundle\n    // @TODO: in case we need deploying, run using deployAndCall pipeline with signed msgs\n    // @TODO: quickAccManager\n    if (signer.quickAccManager) throw new Error('quickAccManager not supported in relayerless mode yet')\n    // currently disabled quickAccManager cause 1) we don't have a means of getting the second sig 2) we still have to sign txes so it's inconvenient\n    // if (signer.quickAccManager) await finalBundle.sign(wallet)\n    //const [to, data] = signer.quickAccManager ? [signer.quickAccManager, QuickAccManagerInterface.encodeFunctionData('send', [finalBundle.identity, [signer.timelock, signer.one, signer.two], [false, finalBundle.signature, '0x']])] :\n\n    // NOTE: just adding values to gasLimit is bad because 1) they're hardcoded estimates\n    // and 2) the fee displayed in the UI does not reflect that\n    const isDeployed = await provider.getCode(finalBundle.identity).then(code => code !== '0x')\n    let gasLimit\n    let to, data\n    if (isDeployed) {\n      gasLimit = estimation.gasLimit + 20000\n      to = finalBundle.identity\n      data = IdentityInterface.encodeFunctionData('executeBySender', [finalBundle.txns])\n    } else {\n      await finalBundle.getNonce(provider)\n      // just some hardcoded value to make the signing pass\n      finalBundle.gasLimit = 400000\n      await finalBundle.sign(wallet)\n      to = account.identityFactoryAddr\n      data = FactoryInterface.encodeFunctionData('deployAndExecute', [account.bytecode, account.salt, finalBundle.txns, finalBundle.signature])\n      gasLimit = (await provider.estimateGas({ to, data, from: signer.address })).toNumber() + 20000\n    }\n\n    const txn = {\n      from: signer.address,\n      to, data,\n      gas: hexlify(gasLimit),\n      gasPrice: hexlify(Math.floor(estimation.feeInNative[feeSpeed] / estimation.gasLimit * 1e18)),\n      nonce: hexlify(await provider.getTransactionCount(signer.address))\n    }\n    try {\n      let txId\n      if (!wallet.sendTransaction) {\n        // HW wallets which only sign\n        const signed = await wallet.signTransaction(txn)\n        txId = (await provider.sendTransaction(signed)).hash\n      } else {\n        // web3 injectors which can't sign, but can sign+send\n        // they also don't like the gas arg they fully control the chain ID\n        if (wallet.provider) {\n          const { chainId } = await wallet.provider.getNetwork()\n          if (network.chainId !== chainId) throw new Error(`Connected to the wrong network: please switch to ${network.name}`)\n          txId = (await wallet.sendTransaction({ from: txn.from, to: txn.to, data: txn.data, gasPrice: txn.gasPrice, nonce: txn.nonce })).hash\n        } else { // implementation of sendTransaction in getWallet\n          txId = (await wallet.sendTransaction({ from: txn.from, to: txn.to, data: txn.data, gasPrice: txn.gasPrice, gas: txn.gas, nonce: txn.nonce, chainId: network.chainId })).hash\n        }\n\n      }\n      return { success: true, txId }\n    } catch(e) {\n      if (e.code === 'INSUFFICIENT_FUNDS') throw new Error(`Insufficient gas fees: you need to have ${network.nativeAssetSymbol} on ${signer.address}`)\n      throw e\n    }\n  }\n","//import { GrInspect } from 'react-icons/gr'\n// GiObservatory is also interesting\nimport { GiGorilla } from 'react-icons/gi'\nimport { FaChevronLeft } from 'react-icons/fa'\nimport { MdOutlineClose, MdOutlineInfo, MdWarning } from 'react-icons/md'\nimport './SendTransaction.scss'\nimport { useEffect, useState, useMemo, useRef } from 'react'\nimport { Bundle } from 'adex-protocol-eth/js'\nimport { Wallet } from 'ethers'\nimport { Interface } from 'ethers/lib/utils'\nimport * as blockies from 'blockies-ts'\nimport { useToasts } from 'hooks/toasts'\nimport { getWallet } from 'lib/getWallet'\nimport accountPresets from 'ambire-common/src/constants/accountPresets'\nimport { networkIconsById } from 'consts/networks'\nimport { FeeSelector, FailingTxn } from './FeeSelector'\nimport Actions from './Actions'\nimport TxnPreview from 'components/common/TxnPreview/TxnPreview'\nimport { sendNoRelayer } from './noRelayer'\nimport {\n  isTokenEligible,\n  // getFeePaymentConsequences,\n  getFeesData,\n  toHexAmount\n } from './helpers'\nimport { fetchPost } from 'lib/fetch'\nimport { toBundleTxn } from 'ambire-common/src/services/requestToBundleTxn'\nimport { getProvider } from 'lib/provider'\nimport { MdInfo } from 'react-icons/md'\nimport { useCallback } from 'react'\nimport { ToolTip, Button, Loading } from 'components/common'\nimport { ethers } from 'ethers'\nimport { Checkbox } from 'components/common'\n\nconst ERC20 = new Interface(require('adex-protocol-eth/abi/ERC20'))\n\nconst DEFAULT_SPEED = 'fast'\nconst REESTIMATE_INTERVAL = 15000\n\nconst REJECT_MSG = 'Ambire user rejected the request'\n\nconst WALLET_TOKEN_SYMBOLS = ['xWALLET', 'WALLET']\n\nconst isInt = x => !isNaN(x) && x !== null\n\nconst getDefaultFeeToken = (remainingFeeTokenBalances, network, feeSpeed, estimation, currentAccGasTankState) => {\n  if(!remainingFeeTokenBalances?.length) {\n    return { symbol: network.nativeAssetSymbol, decimals: 18, address: '0x0000000000000000000000000000000000000000' }\n  }\n\n  return remainingFeeTokenBalances\n  .sort((a, b) =>\n    (WALLET_TOKEN_SYMBOLS.indexOf(b?.symbol) - WALLET_TOKEN_SYMBOLS.indexOf(a?.symbol))\n    || ((b?.discount || 0) - (a?.discount || 0))\n    || a?.symbol.toUpperCase().localeCompare(b?.symbol.toUpperCase())\n  )\n  .find(token => isTokenEligible(token, feeSpeed, estimation, currentAccGasTankState, network))\n  || remainingFeeTokenBalances[0]\n}\n\nfunction makeBundle(account, networkId, requests) {\n  const bundle = new Bundle({\n    network: networkId,\n    identity: account.id,\n    // checking txn isArray because sometimes we receive txn in array from walletconnect. Also we use Array.isArray because txn object can have prop 0\n    txns: requests.map(({ txn }) => toBundleTxn(Array.isArray(txn) ? txn[0] : txn, account.id)),\n    signer: account.signer\n  })\n  bundle.extraGas = requests.map(x => x.extraGas || 0).reduce((a, b) => a + b, 0)\n  bundle.requestIds = requests.map(x => x.id)\n\n  // Attach bundle's meta\n  if (requests.some(item => item.meta)) {\n    bundle.meta = {}\n\n    if (requests.some(item => item.meta?.addressLabel)) {\n      bundle.meta.addressLabel = requests.map(x => !!x.meta?.addressLabel ? x.meta.addressLabel : { addressLabel: '', address: ''})\n    }\n\n    const xWalletReq = requests.find(x => x.meta?.xWallet)\n    if (xWalletReq) {\n      bundle.meta.xWallet = xWalletReq.meta.xWallet\n    }\n  }\n\n  return bundle\n}\n\nfunction getErrorMessage(e) {\n  if (e && e.message === 'NOT_TIME') {\n    return 'Your 72 hour recovery waiting period still hasn\\'t ended. You will be able to use your account after this lock period.'\n  } else if (e && e.message === 'WRONG_ACC_OR_NO_PRIV') {\n    return 'Unable to sign with this email/password account. Please contact support.'\n  // NOTE: is INVALID_SIGNATURE even a real error?\n  } else if (e && e.message === 'INVALID_SIGNATURE') {\n    return 'Invalid signature. This may happen if you used password/derivation path on your hardware wallet.'\n  } else if (e && e.message === 'INSUFFICIENT_PRIVILEGE') {\n    return 'Wrong signature. This may happen if you used password/derivation path on your hardware wallet.'\n  } else {\n    return e.message || e\n  }\n}\n\nexport default function SendTransaction({ relayerURL, accounts, network, selectedAcc, requests, resolveMany, replacementBundle, replaceByDefault, mustReplaceNonce, onBroadcastedTxn, onDismiss, gasTankState }) {\n  // NOTE: this can be refactored at a top level to only pass the selected account (full object)\n  // keeping it that way right now (selectedAcc, accounts) cause maybe we'll need the others at some point?\n  const account = accounts.find(x => x.id === selectedAcc)\n\n  // Also filtered in App.js, but better safe than sorry here\n  const eligibleRequests = useMemo(() => requests\n    .filter(({ type, chainId, account, txn }) =>\n      type === 'eth_sendTransaction'\n      && chainId === network.chainId\n      && account === selectedAcc\n      && txn && (!txn.from || txn.from.toLowerCase() === selectedAcc.toLowerCase())\n    // we only need to update on change of IDs\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    ), [requests.map(x => x.id).join(','), network.chainId, selectedAcc])\n  const bundle = useMemo(\n    () => replacementBundle || makeBundle(account, network.id, eligibleRequests),\n    [replacementBundle, network.id, account, eligibleRequests]\n  )\n\n  if (!account || !bundle.txns.length) return (<div id='sendTransaction'>\n    <h3 className='error'>SendTransactions: No account or no requests: should never happen.</h3>\n  </div>)\n  return (<SendTransactionWithBundle\n    relayerURL={relayerURL}\n    bundle={bundle}\n    replaceByDefault={replaceByDefault}\n    mustReplaceNonce={mustReplaceNonce}\n    network={network}\n    account={account}\n    resolveMany={resolveMany}\n    onBroadcastedTxn={onBroadcastedTxn}\n    onDismiss={onDismiss}\n    gasTankState={gasTankState}\n  />)\n}\n\nfunction SendTransactionWithBundle({ bundle, replaceByDefault, mustReplaceNonce, network, account, resolveMany, relayerURL, onBroadcastedTxn, onDismiss, gasTankState }) {\n  const currentAccGasTankState = network.isGasTankAvailable ? \n    gasTankState.find(i => i.account === account.id) : \n    { account: account.id, isEnabled: false }\n  const [estimation, setEstimation] = useState(null)\n  const [replaceTx, setReplaceTx] = useState(!!replaceByDefault)\n  const [signingStatus, setSigningStatus] = useState(false)\n  const [feeSpeed, setFeeSpeed] = useState(DEFAULT_SPEED)\n  const { addToast } = useToasts()\n\n  // Safety check: make sure our input parameters make sense\n  if (isInt(mustReplaceNonce) && !(replaceByDefault || isInt(bundle.nonce))) {\n    console.error('ERROR: SendTransactionWithBundle: mustReplaceNonce is set but we are not using replacementBundle or replaceByDefault')\n    console.error('ERROR: SendTransactionWithBundle: This is a huge logical error as mustReplaceNonce is intended to be used only when we want to replace a txn')\n  }\n\n  // Keep track of unmounted: we need this to not try to modify state after async actions if the component is unmounted\n  const isMounted = useRef(false)\n  useEffect(() => {\n    isMounted.current = true\n    return () => { isMounted.current = false }\n  })\n\n  // Reset the estimation when there are no txns in the bundle\n  useEffect(() => {\n    if (!bundle.txns.length) return\n    setEstimation(null)\n  }, [bundle, setEstimation])\n\n  // Estimate the bundle & reestimate periodically\n  const currentBundle = useRef(null)\n  currentBundle.current = bundle\n  useEffect(() => {    // eslint-disable-next-line react-hooks/exhaustive-deps\n    // We don't need to reestimate the fee when a signing process is in progress\n    if (signingStatus) return\n    // nor when there are no txns in the bundle, if this is even possible\n    if (!bundle.txns.length) return\n\n    // track whether the effect has been unmounted\n    let unmounted = false\n\n    // Note: currently, there's no point of getting the nonce if the bundle already has a nonce\n    // We may want to change this if we make a check if the currently replaced txn was already mined\n    const reestimate = () => (relayerURL\n        ? bundle.estimate({ relayerURL, fetch, replacing: !!bundle.minFeeInUSDPerGas, getNextNonce: true, gasTank: currentAccGasTankState.isEnabled })\n        : bundle.estimateNoRelayer({ provider: getProvider(network.id) })\n    )\n      .then((estimation) => {\n        if (unmounted || bundle !== currentBundle.current) return\n        estimation.relayerless = !relayerURL\n        const gasTankTokens = estimation.gasTank?.map(item => { \n          return { \n            ...item,\n            symbol: item.symbol.toUpperCase(), \n            balance: ethers.utils.parseUnits(item.balance.toFixed(item.decimals).toString(), item.decimals).toString(),\n            nativeRate: item.address === '0x0000000000000000000000000000000000000000' ? null : estimation.nativeAssetPriceInUSD / item.price\n          }\n        })\n        if (currentAccGasTankState.isEnabled) estimation.remainingFeeTokenBalances = gasTankTokens\n        estimation.selectedFeeToken = getDefaultFeeToken(estimation.remainingFeeTokenBalances, network, feeSpeed, estimation, currentAccGasTankState.isEnabled, network)\n        setEstimation(prevEstimation => {\n          if (prevEstimation && prevEstimation.customFee) return prevEstimation\n          if (estimation.remainingFeeTokenBalances) {\n            // If there's no eligible token, set it to the first one cause it looks more user friendly (it's the preferred one, usually a stablecoin)\n            estimation.selectedFeeToken = (\n                prevEstimation\n                && isTokenEligible(prevEstimation.selectedFeeToken, feeSpeed, estimation, currentAccGasTankState.isEnabled, network)\n                && prevEstimation.selectedFeeToken\n              )\n              || getDefaultFeeToken(estimation.remainingFeeTokenBalances, network, feeSpeed, estimation, currentAccGasTankState.isEnabled, network)\n          }\n          return estimation\n        })\n      })\n      .catch(e => {\n        if (unmounted) return\n        console.log('estimation error', e)\n        addToast(`Estimation error: ${e.message || e}`, { error: true })\n      })\n\n    reestimate()\n    const intvl = setInterval(reestimate, REESTIMATE_INTERVAL)\n\n    return () => {\n      unmounted = true\n      clearInterval(intvl)\n    }\n  }, [bundle, setEstimation, feeSpeed, addToast, network, relayerURL, signingStatus, currentAccGasTankState.isEnabled ])\n\n  // The final bundle is used when signing + sending it\n  // the bundle before that is used for estimating\n  const getFinalBundle = useCallback(() => {\n    if (!relayerURL) {\n      return new Bundle({\n        ...bundle,\n        gasLimit: estimation.gasLimit,\n      })\n    }\n\n    const feeToken = estimation.selectedFeeToken\n\n    const {\n      feeInNative,\n      // feeInUSD, // don't need fee in USD for stables as it will work with feeInFeeToken\n      // Also it can be stable but not in USD\n      feeInFeeToken,\n      addedGas\n    } = getFeesData(feeToken, estimation, feeSpeed, currentAccGasTankState.isEnabled, network)\n    const feeTxn = feeToken.symbol === network.nativeAssetSymbol\n      // TODO: check native decimals\n      ? [accountPresets.feeCollector, toHexAmount(feeInNative, 18), '0x']\n      : [feeToken.address, '0x0', ERC20.encodeFunctionData('transfer', [\n        accountPresets.feeCollector,\n        toHexAmount(feeInFeeToken, feeToken.decimals)\n    ])]\n\n    const nextFreeNonce = estimation.nextNonce?.nonce\n    const nextNonMinedNonce = estimation.nextNonce?.nextNonMinedNonce\n    // If we've passed in a bundle, use it's nonce (when using a replacementBundle); else, depending on whether we want to replace the current pending bundle,\n    // either use the next non-mined nonce or the next free nonce\n    const nonce = isInt(bundle.nonce) ? bundle.nonce : (replaceTx ? nextNonMinedNonce : nextFreeNonce)\n\n    if (!!currentAccGasTankState.isEnabled) {\n      let gasLimit\n      if (bundle.txns.length > 1) gasLimit = estimation.gasLimit + (bundle.extraGas || 0)\n      else gasLimit = estimation.gasLimit\n\n      let value\n      if (feeToken.address === \"0x0000000000000000000000000000000000000000\") value = feeInNative\n      else {\n        const fToken = estimation.remainingFeeTokenBalances.find(i => i.id === feeToken.id)\n        value = fToken && estimation.feeInNative[feeSpeed] * fToken.nativeRate\n      }\n      \n      return new Bundle({\n        ...bundle,\n        gasTankFee: {\n          assetId: feeToken.id,\n          value: ethers.utils.parseUnits(value.toFixed(feeToken.decimals), feeToken.decimals).toString()\n        },\n        txns: [...bundle.txns],\n        gasLimit,\n        nonce\n      })\n    }\n\n    return new Bundle({\n      ...bundle,\n      txns: [...bundle.txns, feeTxn],\n      gasTankFee: null,\n      gasLimit: estimation.gasLimit + addedGas + (bundle.extraGas || 0),\n      nonce\n    })\n  }, [relayerURL, estimation, feeSpeed, currentAccGasTankState.isEnabled, network, bundle, replaceTx])\n\n  const approveTxnImpl = async () => {\n    if (!estimation) throw new Error('no estimation: should never happen')\n\n    const finalBundle = getFinalBundle()\n    const provider = getProvider(network.id)\n    const signer = finalBundle.signer\n\n    // a bit redundant cause we already called it at the beginning of approveTxn, but\n    // we need to freeze finalBundle in the UI in case signing takes a long time (currently only to freeze the fee selector)\n    setSigningStatus({ inProgress: true, finalBundle })\n\n    const wallet = getWallet({\n      signer,\n      signerExtra: account.signerExtra,\n      chainId: network.chainId\n    })\n\n    if (relayerURL) {\n      // Temporary way of debugging the fee cost\n      // const initialLimit = finalBundle.gasLimit - getFeePaymentConsequences(estimation.selectedFeeToken, estimation).addedGas\n      // finalBundle.estimate({ relayerURL, fetch }).then(estimation => console.log('fee costs: ', estimation.gasLimit - initialLimit), estimation.selectedFeeToken).catch(console.error)\n      await finalBundle.sign(wallet)\n      return await finalBundle.submit({ relayerURL, fetch })\n    } else {\n      return await sendNoRelayer({\n        finalBundle, account, network, wallet, estimation, feeSpeed, provider\n      })\n    }\n  }\n\n  const approveTxnImplQuickAcc = async ({ quickAccCredentials }) => {\n    if (!estimation) throw new Error('no estimation: should never happen')\n    if (!relayerURL) throw new Error('Email/Password account signing without the relayer is not supported yet')\n\n    const finalBundle = (signingStatus && signingStatus.finalBundle) || getFinalBundle()\n    const signer = finalBundle.signer\n\n    const canSkip2FA = signingStatus && signingStatus.confCodeRequired === 'notRequired'\n    const { signature, success, message, confCodeRequired } = await fetchPost(\n      `${relayerURL}/second-key/${bundle.identity}/${network.id}/sign`, {\n        signer, txns: finalBundle.txns, nonce: finalBundle.nonce, gasLimit: finalBundle.gasLimit,\n        ...(!canSkip2FA) && {code: quickAccCredentials && quickAccCredentials.code},\n        // This can be a boolean but it can also contain the new signer/primaryKeyBackup, which instructs /second-key to update acc upon successful signature\n        recoveryMode: finalBundle.recoveryMode,\n        canSkip2FA: canSkip2FA\n      }\n    )\n    if (!success) {\n      if (!message) throw new Error(`Secondary key: no success but no error message`)\n      if (message.includes('invalid confirmation code')) {\n        addToast('Unable to sign: wrong confirmation code', { error: true })\n        return\n      }\n      throw new Error(`Secondary key error: ${message}`)\n    }\n    if (confCodeRequired) {\n      setSigningStatus({ quickAcc: true, finalBundle, confCodeRequired })\n    } else {\n      if (!signature) throw new Error(`QuickAcc internal error: there should be a signature`)\n      if (!account.primaryKeyBackup) throw new Error(`No key backup found: you need to import the account from JSON or login again.`)\n      setSigningStatus({ quickAcc: true, inProgress: true, confCodeRequired: canSkip2FA ? 'notRequired' : undefined })\n      if (!finalBundle.recoveryMode) {\n        // Make sure we let React re-render without blocking (decrypting and signing will block)\n        await new Promise(resolve => setTimeout(resolve, 0))\n        const pwd = quickAccCredentials.passphrase || alert('Enter password')\n        const wallet = await Wallet.fromEncryptedJson(JSON.parse(account.primaryKeyBackup), pwd)\n        await finalBundle.sign(wallet)\n      } else {\n        // set both .signature and .signatureTwo to the same value: the secondary signature\n        // this will trigger a timelocked txn\n        finalBundle.signature = signature\n      }\n      finalBundle.signatureTwo = signature\n      return await finalBundle.submit({ relayerURL, fetch })\n    }\n  }\n\n  const approveTxn = ({ quickAccCredentials }) => {\n    if (signingStatus && signingStatus.inProgress) return\n    setSigningStatus(signingStatus || { inProgress: true })\n\n    if (account.signerExtra && account.signerExtra.type === 'ledger') {\n      addToast('Please confirm this transaction on your Ledger device.', { timeout: 10000 })\n    }\n\n    if (account.signerExtra && account.signerExtra.type === 'Lattice') {\n      addToast('Please confirm this transaction on your Lattice device.', { timeout: 10000 })\n    }\n\n    const requestIds = bundle.requestIds\n    const approveTxnPromise = bundle.signer.quickAccManager ?\n      approveTxnImplQuickAcc({ quickAccCredentials })\n      : approveTxnImpl()\n    approveTxnPromise.then(bundleResult => {\n      // special case for approveTxnImplQuickAcc: when a user interaction prevents the operation from completing\n      if (!bundleResult) return\n\n      // do not to call this after onDimiss, cause it might cause state to be changed post-unmount\n      if (isMounted.current) setSigningStatus(null)\n\n      // Inform everything that's waiting for the results (eg WalletConnect)\n      const skipResolve = !bundleResult.success && bundleResult.message && bundleResult.message.match(/underpriced/i)\n      if (!skipResolve && requestIds) resolveMany(requestIds, { success: bundleResult.success, result: bundleResult.txId, message: bundleResult.message })\n\n      if (bundleResult.success) {\n        onBroadcastedTxn(bundleResult.txId)\n        onDismiss()\n      } else {\n        // to force replacementBundle to be null, so it's not filled from previous state change in App.js in useEffect\n        // basically close the modal if the txn was already mined\n        if (bundleResult.message.includes('was already mined')) {\n          onDismiss()\n        }\n        addToast(`Transaction error: ${getErrorMessage(bundleResult)}`, { error: true })  //'unspecified error'\n      }\n    })\n    .catch(e => {\n      if (isMounted.current) setSigningStatus(null)\n      console.error(e)\n      if (e && e.message.includes('must provide an Ethereum address')) {\n        addToast(`Signing error: not connected with the correct address. Make sure you're connected with ${bundle.signer.address}.`, { error: true })\n      } else if (e && e.message.includes('0x6b0c')) {\n        // not sure if that's actually the case with this hellish error, but after unlocking the device it no longer appeared\n        // however, it stopped appearing after that even if the device is locked, so I'm not sure it's related...\n        addToast(`Ledger: unknown error (0x6b0c): is your Ledger unlocked and in the Ethereum application?`, { error: true })\n      } else {\n        addToast(`Signing error: ${getErrorMessage(e)}`, { error: true })\n      }\n    })\n  }\n\n  const rejectTxn = () => {\n    onDismiss()\n    bundle.requestIds && resolveMany(bundle.requestIds, { message: REJECT_MSG })\n  }\n\n  const accountAvatar = blockies.create({ seed: account.id }).toDataURL()\n\n  // `mustReplaceNonce` is set on speedup/cancel, to prevent the user from broadcasting the txn if the same nonce has been mined\n  const canProceed = isInt(mustReplaceNonce)\n    ? (\n      isInt(estimation?.nextNonce?.nextNonMinedNonce)\n        ? mustReplaceNonce >= estimation?.nextNonce?.nextNonMinedNonce\n        : null // null = waiting to get nonce data from relayer\n    )\n    : true\n\n  return (\n    <div id='sendTransaction'>\n      <div id=\"titleBar\">\n        <div className='dismiss' onClick={onDismiss}>\n          <FaChevronLeft size={35}/>\n          back\n          <ToolTip label=\"You can go back to the main dashboard and add more transactions to this bundle in order to sign & send them all at once.\">\n            <MdOutlineInfo size={25}/>\n          </ToolTip>\n        </div>\n      </div>\n\n      <div className='container'>\n        <div id='transactionPanel' className='panel'>\n          <div className='heading'>\n            <div className='title'>{ bundle.txns.length } Transaction{ bundle.txns.length > 1 ? 's' : '' } Waiting</div>\n          </div>\n          <div className='content'>\n            <div className={`listOfTransactions${bundle.requestIds ? '' : ' frozen'}`}>\n              {bundle.txns.map((txn, i) => {\n                const isFirstFailing = estimation && !estimation.success && estimation.firstFailing === i\n                // we need to re-render twice per minute cause of DEX deadlines\n                const min = Math.floor(Date.now() / 30000)\n                return (<TxnPreview\n                  key={[...txn, i].join(':')}\n                  // pasing an unused property to make it update\n                  minute={min}\n                  onDismiss={bundle.requestIds && (() => resolveMany([bundle.requestIds[i]], { message: REJECT_MSG }))}\n                  txn={txn} network={bundle.network} account={bundle.identity}\n                  isFirstFailing={isFirstFailing}\n                  disableDismiss={!!signingStatus}\n                  disableDismissLabel={\"Cannot modify transaction bundle while a signing procedure is pending\"}\n                  addressLabel={!!bundle.meta && bundle.meta.addressLabel}\n                  />\n                )\n              })}\n            </div>\n\n            <div className='separator'></div>\n\n            <div className='transactionsNote'>\n              {\n                // only render this if we're using the queue\n                bundle.requestIds &&\n                  <>\n                    <b><GiGorilla size={16}/> DEGEN TIP</b>\n                    <span>You can sign multiple transactions at once. Add more transactions to this batch by interacting with a connected dApp right now. Alternatively, you may click \"Back\" to add more transactions.</span>\n                  </>\n              }\n            </div>\n          </div>\n        </div>\n\n        <div id='detailsPanel' className='panel'>\n          <div id=\"options-container\">\n            <div className='section' id=\"signing-details\">\n              <div className='section-title'>Signing With</div>\n              <div className='section-content'>\n                <div className='account'>\n                  <div className='icon' style={{ backgroundImage: `url(${accountAvatar})` }}/>\n                  <div className='address'>{ account.id }</div>\n                </div>\n                <div className='network'>\n                  on\n                  <div className='icon' style={{ backgroundImage: `url(${networkIconsById[network.id]})` }}/>\n                  <div className='address'>{ network.name }</div>\n                </div>\n              </div>\n            </div>\n\n            { /* Only lock the fee selector when the bundle is locked too - to make sure that the fee really is set in stone (won't change on the next getFinalBundle()) */ }\n            {\n              canProceed &&\n              <FeeSelector\n                disabled={signingStatus && signingStatus.finalBundle && !(estimation && !estimation.success)}\n                signer={bundle.signer}\n                estimation={estimation}\n                setEstimation={setEstimation}\n                network={network}\n                feeSpeed={feeSpeed}\n                setFeeSpeed={setFeeSpeed}\n                onDismiss={onDismiss}\n                isGasTankEnabled={currentAccGasTankState.isEnabled && !!relayerURL}\n              ></FeeSelector>\n            }\n\n          </div>\n\n         {\n            // If there's `bundle.nonce` set, it means we're cancelling or speeding up, so this shouldn't even be visible\n            // We also don't show this in any case in which we're forced to replace a particular transaction (mustReplaceNonce)\n            !isInt(bundle.nonce) && !isInt(mustReplaceNonce) && !!estimation?.nextNonce?.pendingBundle &&\n            (\n              <div>\n               <Checkbox\n                    label='Replace currently pending transaction'\n                    checked={replaceTx}\n                    onChange={({ target }) => setReplaceTx(target.checked)}\n                />\n              </div>\n            )\n          }\n\n          {\n            // NOTE there's a case in which both \"This transaction will replace the current pending transaction\" and the checkbox will render - when we're doing a modify\n            // If we are replacing a txn, look at whether canProceed is true\n            isInt(mustReplaceNonce) &&\n            <>\n              {\n                // We always warn the user if they're trying to replace a particular transaction\n                // This doesn't need to show when replacing is optional\n                (canProceed || canProceed === null) && <div className='replaceInfo warning' ><MdWarning /><span>This transaction bundle will replace the one that's currently pending.</span></div>\n              }\n\n              {\n                // canProceed equals null means we don't have data yet\n                canProceed === null &&\n                <div>\n                  <Loading />\n                </div>\n              }\n\n              {\n                canProceed === false &&\n                <div id='actions-container-replace'>\n                  <div className='replaceInfo info' ><MdInfo /><span>The transaction you're trying to replace has already been confirmed</span></div>\n                  <div className='buttons'>\n                    <Button clear icon={<MdOutlineClose/>} type='button' className='rejectTxn' onClick={rejectTxn}>Close</Button>\n                  </div>\n                </div>\n              }\n            </>\n          }\n\n          {\n            canProceed &&\n            <>\n              {\n                estimation && estimation.success && estimation.isDeployed === false && bundle.gasLimit ?\n                  <div className='first-tx-note'>\n                    <div className='first-tx-note-title'><MdInfo/>Note</div>\n                    <div className='first-tx-note-message'>\n                      Because this is your first Ambire transaction, this fee is {(60000 / bundle.gasLimit * 100).toFixed()}% higher than usual because we have to deploy your smart wallet.\n                      Subsequent transactions will be cheaper\n                    </div>\n                  </div>\n                  :\n                  null\n              }\n\n              <div id=\"actions-container\">\n                {\n                  bundle.signer.quickAccManager && !relayerURL ?\n                    <FailingTxn message='Signing transactions with an email/password account without being connected to the relayer is unsupported.'></FailingTxn>\n                    :\n                    <div className='section' id=\"actions\">\n                      <Actions\n                        estimation={estimation}\n                        approveTxn={approveTxn}\n                        rejectTxn={rejectTxn}\n                        cancelSigning={() => setSigningStatus(null)}\n                        signingStatus={signingStatus}\n                        feeSpeed={feeSpeed}\n                        isGasTankEnabled={currentAccGasTankState.isEnabled && !!relayerURL}\n                        network={network}\n                      />\n                    </div>\n                }\n              </div>\n            </>\n          }\n\n        </div>\n      </div>\n    </div>\n  )\n}\n","const { BN } = require('bn.js')\n\nfunction Uint256(x) {\n\tconst bn = new BN(x, 10)\n\tif (bn.isNeg()) throw new Error('uint256 expected, negative number given')\n\treturn bn\n}\n\nfunction Address(x) {\n\tif (!(typeof x === 'string' && x.length === 42 && x.startsWith('0x')))\n\t\tthrow new Error('invalid address: must start with a 0x and be 42 characters long')\n\treturn x\n}\n\nfunction Bytes32(b) {\n\tif (typeof b === 'string' && b.startsWith('0x') && b.length === 66) {\n\t\treturn Buffer.from(b.slice(2), 'hex')\n\t}\n\tif (!(b.length === 32 && Buffer.isBuffer(b))) throw new Error('32 byte Buffer expected')\n\treturn b\n}\n\nfunction Bytes(b) {\n\tif (typeof b === 'string' && b.startsWith('0x')) {\n\t\treturn Buffer.from(b.slice(2), 'hex')\n\t}\n\tif (!Buffer.isBuffer(b)) throw new Error('Buffer expected')\n\treturn b\n}\n\nfunction Bytes32Array(bytes32Array, size) {\n\t// no size specified\n\tif (size === -1 || size === undefined) {\n\t\treturn bytes32Array.map(x => Bytes32(x))\n\t}\n\treturn bytes32Array.length === size && bytes32Array.map(x => Bytes32(x))\n}\n\nfunction Channel(channel) {\n\tAddress(channel.leader)\n\tAddress(channel.follower)\n\tAddress(channel.guardian)\n\tAddress(channel.tokenAddr)\n\tBytes32(channel.nonce)\n\treturn channel\n}\n\nmodule.exports = { Uint256, Bytes32, Address, Bytes, Bytes32Array, Channel }\n","const customIcons = {\n    '0xb468a1e5596cfbcdf561f21a10490d99b4bb7b68': 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5a/Jeff_Sessions_with_Elmo_and_Rosita_%28cropped%29.jpg/220px-Jeff_Sessions_with_Elmo_and_Rosita_%28cropped%29.jpg', // TEST Polygon ELMO token,\n    '0x88800092ff476844f74dc2fc427974bbee2794ae': 'https://raw.githubusercontent.com/AmbireTech/ambire-brand/main/logos/ambire_logo_white_bg_250x250.png', // Ambire Wallet Token\n    '0x47cd7e91c3cbaaf266369fe8518345fc4fc12935': 'https://raw.githubusercontent.com/AmbireTech/ambire-brand/main/logos/xwallet_250x250.png', //xWallet\n    '0xb6456b57f03352be48bf101b46c1752a0813491a': 'https://raw.githubusercontent.com/AmbireTech/adex-brand/master/logos/vaporwave-adex-2.png', // ADX-STAKING\n    '0xd9a4cb9dc9296e111c66dfacab8be034ee2e1c2c': 'https://raw.githubusercontent.com/AmbireTech/adex-brand/master/logos/ADX-loyalty%40256x256.png', // ADX-LOYALTY\n    '0xec3b10ce9cabab5dbf49f946a623e294963fbb4e': 'https://raw.githubusercontent.com/AmbireTech/ambire-brand/main/logos/xwallet_250x250.png', // Polygons test xWallet\n    '0xe9415e904143e42007865e6864f7f632bd054a08': 'https://raw.githubusercontent.com/AmbireTech/ambire-brand/main/logos/Ambire_logo_250x250.png', // Polygons test Wallet\n    '0xade00c28244d5ce17d72e40330b1c318cd12b7c3': 'https://raw.githubusercontent.com/AmbireTech/ambire-brand/main/official-logos/Ambire-AdEx/Ambire_AdEx_Symbol_color_white_bg.png' //ADX-TOKEN\n}\n\nconst zapperStorageTokenIcons = 'https://storage.googleapis.com/zapper-fi-assets/tokens'\n\nexport function getTokenIcon(networkId = '', address = '') {\n    const addr = address.toLowerCase()\n    const net = networkId.toLowerCase()\n    return customIcons[addr] || `${zapperStorageTokenIcons}/${net}/${addr}.png`\n}\n","export function formatFloatTokenAmount(amount, useGrouping = true, maximumFractionDigits = 18) {\n    if (isNaN(amount) || isNaN(parseFloat(amount)) || !(typeof amount === 'number' || typeof amount === 'string')) return amount\n\n    try {\n        const minimumFractionDigits = Math.min(2, maximumFractionDigits || 0)\n        return ((typeof amount === 'number') ? amount : parseFloat(amount))\n            .toLocaleString(undefined,\n                {\n                    useGrouping,\n                    maximumFractionDigits: Math.max(minimumFractionDigits, maximumFractionDigits),\n                    minimumFractionDigits\n                })\n    } catch (err) {\n        console.error(err)\n        return amount\n    }\n}\n\n// Round a floating point number to a specific decimal places, i.e. 1.156 => 1.16\nexport function roundFloatingNumber(number, places = 2) {\n  const decimals = Math.pow(10, places)\n\n  return Math.round((number + Number.EPSILON) * decimals) / decimals\n}\n","import { Client } from 'gridplus-sdk'\nimport { ethers } from 'ethers'\nimport { serialize } from '@ethersproject/transactions'\n\nconst crypto = require('crypto')\nconst HARDENED_OFFSET = 0x80000000\n\nconst getAddressesReqOpts = {\n    startPath: [\n        HARDENED_OFFSET + 44,\n        HARDENED_OFFSET + 60,\n        HARDENED_OFFSET,\n        0,\n        0,\n    ],\n    n: 10,\n}\n\nconst latticeInit = commKey => {\n    const clientConfig = {\n        name: 'Ambire Wallet',\n        crypto: crypto,\n        privKey: commKey,\n    }\n\n    return new Client(clientConfig)\n}\n\nconst latticeConnect = async(client, deviceId) => {\n    return await new Promise((resolve, reject) => {\n        client.connect(deviceId, (err, isPaired) => {\n            if (err) {\n                reject(`Lattice connect: ${err} Or check if the DeviceID is correct.`)\n                return\n            }\n            \n            resolve({ isPaired: !!isPaired, errConnect: false })\n        })\n    }).catch(err => {\n        console.error(err)\n        return { isPaired: false, errConnect: err }\n    })\n}\n\nconst latticePair = async(client, secret) => {\n    return await new Promise((resolve, reject) => {\n        client.pair(secret, (err, hasActiveWallet) => {\n            if (err) {\n                reject(`Lattice connect: ${err}`)\n                return\n            }\n            \n            resolve({ hasActiveWallet, errPair: false })\n        })\n    }).catch(err => {\n        console.error(err)\n        return { hasActiveWallet: false, errPair: err }\n    })\n}\n\nconst latticeGetAddresses = async client => {\n    return await new Promise((resolve, reject) => {\n        client.getAddresses(getAddressesReqOpts, (err, res) => {\n            if (err) {\n                reject(`Lattice get addresses: ${err}`)\n                return\n            }\n\n            if (!res) throw new Error('Lattice could not get the addresses.')\n\n            resolve({res, errGetAddresses: false })\n        })\n    }).catch(err => {\n        console.error(err)\n        return { res: null, errGetAddresses: err }\n    })\n}\n\nconst latticeSignMessage = async(client, hash) => {\n    const dataMsg = {\n        protocol: 'signPersonal',\n        payload: ethers.utils.hexlify(hash),\n        signerPath: [HARDENED_OFFSET+44, HARDENED_OFFSET+60, HARDENED_OFFSET, 0, 0],\n    }\n\n    const signOptsMsg = {\n        currency: 'ETH_MSG',\n        data: dataMsg,\n    }\n\n    \n    return await new Promise((resolve, reject) => {\n        client.sign(signOptsMsg, (err, signedTx) => {\n            if (err) {\n                reject(err)\n                return\n            }\n\n            if (!signedTx) throw new Error('Lattice could not sign the message.')\n            \n            resolve({ signedMsg: '0x' + signedTx.sig.r + signedTx.sig.s + signedTx.sig.v[0].toString(16), errSignMessage: false })  \n        })\n    }).catch(err => {\n        console.error(err)\n        return { signedMsg: null, errSignMessage: err }\n    })\n}\n\nconst latticeSignMessage712 = async(client, message) => {\n    const reqData = {\n        currency: 'ETH_MSG',\n        data: {\n          signerPath: [HARDENED_OFFSET+44, HARDENED_OFFSET+60, HARDENED_OFFSET, 0, 0],\n          protocol: 'eip712', // You must use this string to specify this protocol\n          payload: message\n        }\n      }\n\n    return await new Promise((resolve, reject) => {\n        client.sign(reqData, (err, signedTx) => {\n            if (err) {\n                reject(err)\n                return\n            }\n\n            if (!signedTx) throw new Error('Lattice could not sign the message.')\n            \n            resolve({ signedMsg: '0x' + signedTx.sig.r + signedTx.sig.s + signedTx.sig.v[0].toString(16), errSignMessage: false })  \n        })\n    }).catch(err => {\n        console.error(err)\n        return { signedMsg: null, errSignMessage: err }\n    })\n}\n\nconst latticeSignTransaction = async(client, txn, chainId) => {\n    const { to, data, gas, gasPrice, nonce, value = 0 } = txn\n    const unsignedTxObj = {\n        ...txn,\n        gasLimit: txn.gasLimit || txn.gas,\n        chainId\n    }\n    delete unsignedTxObj.from\n    delete unsignedTxObj.gas\n\n    const txData = {\n        nonce,\n        gasLimit: gas || txn.gasLimit,\n        gasPrice,\n        to,\n        value,\n        data: data || '',\n        // -- m/44'/60'/0'/0/0\n        signerPath: [HARDENED_OFFSET+44, HARDENED_OFFSET+60, HARDENED_OFFSET, 0, 0],\n        chainId,\n        useEIP155: true,\n    }\n\n    const signOpts = {\n        currency: 'ETH',\n        data: txData,\n    }\n\n    \n    return await new Promise((resolve, reject) => {\n        client.sign(signOpts, (err, signedTx) => {\n            if (err) {\n                reject(err)\n                return\n            }\n\n            if (!signedTx) throw new Error('Lattice could not sign the message.')\n            \n            delete unsignedTxObj.v\n            const serializedSigned = serialize(unsignedTxObj, {\n                r: '0x' + signedTx.sig.r,\n                s: '0x' + signedTx.sig.s,\n                v: signedTx.sig.v[0].toString(16)\n            })\n            \n            resolve({ serializedSigned, errSignTxn: false })\n        })\n    }).catch(err => {\n        console.error(err)\n        return { serializedSigned: null, errSignTxn: err }\n    })\n}\n\nexport { \n    latticeInit,\n    latticeConnect,\n    latticePair,\n    latticeGetAddresses,\n    latticeSignMessage,\n    latticeSignMessage712,\n    latticeSignTransaction\n }\n","import { TrezorSubprovider } from '@0x/subproviders/lib/src/subproviders/trezor' // https://github.com/0xProject/0x-monorepo/issues/1400\nimport TrezorConnect from '@trezor/connect-web'\nimport { ethers } from 'ethers'\nimport HDNode from 'hdkey'\nimport { LedgerSubprovider } from '@0x/subproviders/lib/src/subproviders/ledger' // https://github.com/0xProject/0x-monorepo/issues/1400\nimport { ledgerEthereumBrowserClientFactoryAsync } from '@0x/subproviders/lib/src' // https://github.com/0xProject/0x-monorepo/issues/1400\nimport { ledgerSignMessage, ledgerSignTransaction, ledgerSignMessage712, ledgerGetAddresses } from './ledgerWebHID'\nimport { \n  latticeInit, \n  latticeConnect, \n  latticeSignMessage, \n  latticeSignTransaction, \n  latticeGetAddresses, \n  latticeSignMessage712\n } from 'lib/lattice'\nimport { _TypedDataEncoder } from 'ethers/lib/utils'\nimport { getProvider } from 'lib/provider'\nimport networks from 'consts/networks'\n\nlet wallets = {}\n\n// opts\n// passphrase: string\n// noCache: boolean\nexport function getWallet({ signer, signerExtra, chainId }, opts = {}) {\n  const id = `${signer.address || signer.one}${chainId}`\n  if (wallets[id]) return wallets[id]\n  return wallets[id] = getWalletNew({ signer, signerExtra, chainId }, opts)\n}\n\nfunction getWalletNew({ chainId, signer, signerExtra }, opts) {\n  if (signerExtra && signerExtra.type === 'trezor') {\n    const providerTrezor = new TrezorSubprovider({\n      trezorConnectClientApi: TrezorConnect,\n      networkId: chainId\n    })\n    providerTrezor._initialDerivedKeyInfo = getInitialDerivedKeyInfo(signerExtra)\n    // for Trezor/ledger, alternatively we can shim using https://www.npmjs.com/package/web3-provider-engine and then wrap in Web3Provider\n    return {\n      signMessage: hash => providerTrezor.signPersonalMessageAsync(ethers.utils.hexlify(hash), signer.address),\n      signTransaction: params => providerTrezor.signTransactionAsync({ ...params, from: signer.address }),\n      sendTransaction: async (transaction) => {\n        const network = networks.find(n => n.chainId === transaction.chainId)\n        if (!network) throw Error('no network found for chainId : ' + transaction.chainId)\n        const broadcastProvider = await getProvider(network.id)\n        if (!broadcastProvider) throw Error('no provider found for network : ' + network.id)\n\n        transaction.nonce = ethers.utils.hexlify(await broadcastProvider.getTransactionCount(transaction.from))\n        const gas = ethers.utils.hexlify(transaction.gas || transaction.gasLimit)\n        transaction.gasPrice = ethers.utils.hexlify(transaction.gasPrice)\n        \n        transaction = {\n          ...transaction,\n          gas // trezor params requires gas prop\n          // no chainId prop but chainId already known by providerTrezor\n        }\n        \n        const signedTx = await providerTrezor.signTransactionAsync(transaction)\n        \n        return broadcastProvider.sendTransaction(signedTx)\n      },\n      isConnected: async (matchAddress) => { // chain is provided to trezor. Not necessary to check network\n        const addresses = await providerTrezor.getAccountsAsync(100)\n        return addresses.map(i => i.toLowerCase()).includes(matchAddress.toLowerCase())\n      },\n      _signTypedData: async (domain, types, value) => {\n        \n        const domainSeparator = _TypedDataEncoder.hashDomain(domain)\n        const hashStructMessage = _TypedDataEncoder.hashStruct(_TypedDataEncoder.getPrimaryType(types), types, value)\n        const data = _TypedDataEncoder.getPayload(domain, types, value)\n        const initialDerivedKeyInfo = await providerTrezor._initialDerivedKeyInfoAsync()\n        const derivedKeyInfo = providerTrezor._findDerivedKeyInfoForAddress(initialDerivedKeyInfo, signer.address)\n        const path = derivedKeyInfo.derivationPath\n\n        const response = await providerTrezor._trezorConnectClientApi.ethereumSignTypedData({\n          path,\n          data,\n          metamask_v4_compat: true,\n          domain_separator_hash: domainSeparator,\n          message_hash: hashStructMessage\n        })\n\n        if (response.success) {\n          return `${response.payload.signature}`;\n        } else {\n            throw new Error(response.payload.error);\n        }\n      }\n    }\n  } else if (signerExtra && signerExtra.type === 'ledger') {\n    if (signerExtra.transportProtocol === 'webHID') {\n      return {\n        signMessage: hash => ledgerSignMessage(ethers.utils.hexlify(hash), signer.address),\n        signTransaction: params => ledgerSignTransaction(params, chainId),\n        sendTransaction: async (transaction) => {\n          const network = networks.find(n => n.chainId === transaction.chainId)\n          if (!network) throw Error('no network found for chainId : ' + transaction.chainId)\n          const provider = await getProvider(network.id)\n          if (!provider) throw Error('no provider found for network : ' + network.id)\n\n          transaction.nonce = ethers.utils.hexlify(await provider.getTransactionCount(transaction.from))\n\n          const signedTx = await ledgerSignTransaction(transaction, transaction.chainId)\n\n          return provider.sendTransaction(signedTx)\n        },\n        isConnected: async (matchAddress) => { // chain is provided to ledger. Not necessary to check network\n          const addresses = await ledgerGetAddresses()\n          if (addresses && addresses[0]) {\n            if (matchAddress) {\n              return !!addresses.find(a => a.toLowerCase() === matchAddress.toLowerCase())\n            }\n            return true\n          }\n          return false\n        },\n        _signTypedData: (domain, types, value) => {\n          const domainSeparator = _TypedDataEncoder.hashDomain(domain)\n          const hashStructMessage = _TypedDataEncoder.hashStruct(_TypedDataEncoder.getPrimaryType(types), types, value)\n          return ledgerSignMessage712(domainSeparator, hashStructMessage, signer.address)\n        }\n      }\n    } else {\n      const provider = new LedgerSubprovider({\n        networkId: chainId,\n        ledgerEthereumClientFactoryAsync: ledgerEthereumBrowserClientFactoryAsync,\n        baseDerivationPath: signerExtra.info.baseDerivationPath\n      })\n      return {\n        signMessage: hash => provider.signPersonalMessageAsync(ethers.utils.hexlify(hash), signer.address),\n        signTransaction: params => provider.signTransactionAsync({ ...params, from: signer.address }),\n        sendTransaction: async () => {\n          throw Error('Please use a chrome based browser to use Ledger')\n        },\n        isConnected: async (matchAddress) => { // chain is provided to ledger. Not necessary to check network\n          const addresses = await provider.getAccountsAsync(1)\n          return addresses.map(i => i.toLowerCase()).includes(matchAddress.toLowerCase())\n        },\n        _signTypedData: (domain, types, value) => {\n          throw Error('Please, use a chrome based browser to use 721 Typed signatures')\n        }\n      }\n    }\n  } else if (signerExtra && signerExtra.type === 'Lattice') {\n    return {\n      signMessage: async hash => {\n        return await wrapLatticeError(async hash => {\n          const { commKey, deviceId } = signerExtra\n          const client = latticeInit(commKey)\n          const {isPaired, errConnect } = await latticeConnect(client, deviceId)\n\n          if (errConnect) throw new Error(errConnect.message || errConnect)\n\n          if (!isPaired) {\n            // Canceling the visualization of the secret code on the device's screen.\n            client.pair('')\n            throw new Error('The Lattice device is not paired! Please re-add your account!')\n          }\n\n          const { signedMsg, errSignMessage } = await latticeSignMessage(client, hash)\n          if (errSignMessage) throw new Error(errSignMessage)\n\n          return signedMsg\n        }, [hash])\n      },\n      signTransaction: async params => {\n        return await wrapLatticeError( async params => {\n          const { commKey, deviceId } = signerExtra\n          const client = latticeInit(commKey)\n          const {isPaired, errConnect } = await latticeConnect(client, deviceId)\n\n          if (errConnect) throw new Error(errConnect.message || errConnect)\n\n          if (!isPaired) {\n            // Canceling the visualization of the secret code on the device's screen.\n            client.pair('')\n            throw new Error('The Lattice device is not paired! Please re-add your account!')\n          }\n\n          const { serializedSigned, errSignTxn } = await latticeSignTransaction(client, params, chainId)\n          if (errSignTxn) throw new Error(errSignTxn)\n\n          return serializedSigned\n        }, [params])\n      },\n      sendTransaction: async transaction => { \n        return await wrapLatticeError(async (transaction) => {\n          const network = networks.find(n => n.chainId === transaction.chainId)\n          if (!network) throw Error('no network found for chainId : ' + transaction.chainId)\n          const broadcastProvider = await getProvider(network.id)\n          if (!broadcastProvider) throw Error('no provider found for network : ' + network.id)\n          transaction.nonce = ethers.utils.hexlify(await broadcastProvider.getTransactionCount(transaction.from))\n          const { commKey, deviceId } = signerExtra\n          const client = latticeInit(commKey)\n          const { isPaired, errConnect } = await latticeConnect(client, deviceId)\n\n          if (errConnect) throw new Error(errConnect.message || errConnect)\n\n          if (!isPaired) {\n            // Canceling the visualization of the secret code on the device's screen.\n            client.pair('')\n            throw new Error('The Lattice device is not paired! Please re-add your account!')\n          }\n\n          const { serializedSigned, errSignTxn } = await latticeSignTransaction(client, transaction, chainId)\n          if (errSignTxn) throw new Error(errSignTxn)\n\n          return broadcastProvider.sendTransaction(serializedSigned)\n        }, [transaction])\n      },\n      isConnected: async matchAddress => { \n        return await wrapLatticeError(async (matchAddress) => {\n          let addresses = null\n\n          const { commKey, deviceId } = signerExtra\n          const client = latticeInit(commKey)\n          const { isPaired, errConnect } = await latticeConnect(client, deviceId)\n\n          if (errConnect) throw new Error(errConnect.message || errConnect)\n\n          if (!isPaired) {\n            // Canceling the visualization of the secret code on the device's screen.\n            client.pair('')\n            throw new Error('The Lattice device is not paired! Please re-add your account!')\n          }\n\n          const { res, errGetAddresses } = await latticeGetAddresses(client)\n          if (errGetAddresses) { \n            throw new Error(`Lattice: ${errGetAddresses}`, { error: true })\n          }\n\n          addresses = res\n          return addresses.map(i => i.toLowerCase()).includes(matchAddress.toLowerCase())\n        }, [matchAddress])\n    },\n    _signTypedData: async (domain, types, value) => {\n      return await wrapLatticeError(async (domain, types, value) => {\n        const payload = _TypedDataEncoder.getPayload(domain, types, value)\n        const { commKey, deviceId } = signerExtra\n        const client = latticeInit(commKey)\n        const {isPaired, errConnect } = await latticeConnect(client, deviceId)\n\n        if (errConnect) throw new Error(errConnect.message || errConnect)\n\n        if (!isPaired) {\n          // Canceling the visualization of the secret code on the device's screen.\n          client.pair('')\n          throw new Error('The Lattice device is not paired! Please re-add your account!')\n        }\n\n        const { signedMsg, errSignMessage } = await latticeSignMessage712(client, payload)\n        if (errSignMessage) throw new Error(errSignMessage)\n\n        return signedMsg\n      }, [domain, types, value])\n    }\n  }\n  } else if (signer.address) {\n    if (!window.ethereum) throw new Error('No web3 support detected in your browser: if you created this account through MetaMask, please install it.')\n    // NOTE: for metamask, use `const provider = new ethers.providers.Web3Provider(window.ethereum)`\n    // 'any' is explained here: https://github.com/ethers-io/ethers.js/issues/1107\n    const provider = new ethers.providers.Web3Provider(window.ethereum, 'any')\n\n    const signerObject = provider.getSigner(signer.address)\n\n    signerObject.isConnected = async (matchAddress, matchChain) => {\n      const accounts = await provider.listAccounts()\n\n      let match = true\n      if (!!(accounts.length)) {\n        if (matchAddress) {\n          match = !!accounts.find(a => a.toLowerCase() === matchAddress.toLowerCase())\n        }\n        if (matchChain) {\n          const { chainId } = await provider.getNetwork()\n          match = match && chainId === matchChain\n        }\n      } else {\n        match = false\n      }\n      return match\n    }\n\n    return signerObject\n  } else if (signer.one) {\n    throw new Error('getWallet not applicable for QuickAccounts: use primaryKeyBackup with the passphrase and /second-sig')\n  } else {\n    throw new Error('unknown signer type')\n  }\n}\n\nfunction getInitialDerivedKeyInfo(signerExtra) {\n  return {\n    hdKey: HDNode.fromExtendedKey(signerExtra.info.hdKey.xpub),\n    derivationPath: signerExtra.info.derivationPath,\n    baseDerivationPath: signerExtra.info.baseDerivationPath\n  }\n}\n\nasync function wrapLatticeError(fn, arg) {\n  return await fn.apply(this, arg)\n   .catch(e => {\n     throw new Error(`Lattice: ${e.message}`)\n    })\n}\n","import TransportWebHID from '@ledgerhq/hw-transport-webhid'\nimport AppEth from '@ledgerhq/hw-app-eth'\nimport { serialize } from '@ethersproject/transactions'\n\nconst EIP_155_CONSTANT = 35\n\nconst ethUtil = require('ethereumjs-util')\nconst HDNode = require('hdkey')\n\nlet connectedDevices = null\n\nexport const PARENT_HD_PATH = \"44'/60'/0'/0\"\n\nasync function getTransport() {\n  connectedDevices = await TransportWebHID.list()\n  if (connectedDevices.length) {\n    if (connectedDevices[0].opened) {\n      return new TransportWebHID(connectedDevices[0])\n    } else { // when transport is still not closed and time between 2 requests is short\n      return TransportWebHID.open(connectedDevices[0])\n    }\n  } else {\n    try {\n      return await TransportWebHID.request()\n    } catch (e) {\n      if (e.message.includes('reading \\'open\\'')) {\n        throw new Error('ledger WebHID request denied')\n      }\n      throw new Error('Could not request WebHID ledger: ' + e.message)\n    }\n  }\n}\n\nexport async function ledgerGetAddresses() {\n  const transport = await getTransport()\n  const accounts = await getAccounts(transport)\n  transport.close()\n\n  return accounts.map(a => a.address)\n}\n\nasync function getAccounts(transport) {\n  const parentKeyDerivationPath = `m/${PARENT_HD_PATH}`\n  let ledgerResponse\n  ledgerResponse = await getAddressInternal(transport, parentKeyDerivationPath).then(o => o).catch(err => {\n    if (err.statusCode === 25871 || err.statusCode === 27404) {\n      throw Error('Please make sure your ledger is unlocked and running the Ethereum app. ' + err.message)\n    } else {\n      throw Error('Could not get address from ledger : ' + err)\n    }\n  })\n\n  const hdKey = new HDNode()\n  hdKey.publicKey = Buffer.from(ledgerResponse.publicKey, 'hex')\n  hdKey.chainCode = Buffer.from(ledgerResponse.chainCode, 'hex')\n  const mainAddress = addressOfHDKey(hdKey)\n\n  const initialDerivedKeyInfo = {\n    hdKey,\n    address: mainAddress,\n    derivationPath: parentKeyDerivationPath,\n    baseDerivationPath: PARENT_HD_PATH,\n  }\n\n  // currently we can't get addrs to match with what appears in MM/Ledger live so only one is derived\n  return calculateDerivedHDKeyInfos(initialDerivedKeyInfo, 1)\n}\n\n\nasync function getAddressInternal(transport, parentKeyDerivationPath) {\n  let timeoutHandle\n  const appEth = new AppEth(transport)\n\n  const ledgerTimeout = new Promise((resolve, reject) => {\n    timeoutHandle = setTimeout(() => {\n      return reject(new Error('Device took too long to respond...'))\n    }, 10000)\n  })\n\n  return Promise.race([\n    appEth.getAddress(parentKeyDerivationPath, false, true),\n    ledgerTimeout\n  ]).then((res) => {\n    clearTimeout(timeoutHandle)\n    return res\n  })\n}\n\nexport async function ledgerSignTransaction(txn, chainId) {\n  const transport = await getTransport()\n\n  const fromAddr = txn.from\n\n  const unsignedTxObj = {\n    ...txn,\n    gasLimit: txn.gasLimit || txn.gas,\n    chainId: chainId\n  }\n  delete unsignedTxObj.from\n  delete unsignedTxObj.gas\n\n  let serializedUnsigned = serialize(unsignedTxObj)\n  const accountsData = await getAccounts(transport)\n\n  //Managing only 1 addr for now\n  const address = accountsData[0].address\n\n  let serializedSigned\n  if (address.toLowerCase() === fromAddr.toLowerCase()) {\n    let rsvResponse\n    try {\n      rsvResponse = await new AppEth(transport).signTransaction(accountsData[0].derivationPath, serializedUnsigned.substr(2))\n    } catch (e) {\n      throw new Error('Could not sign transaction ' + e)\n    }\n\n    const intV = parseInt(rsvResponse.v, 16)\n    const signedChainId = Math.floor((intV - EIP_155_CONSTANT) / 2)\n\n    if (signedChainId !== chainId) {\n      throw new Error('Invalid returned V 0x' + rsvResponse.v)\n    }\n\n    delete unsignedTxObj.v\n    serializedSigned = serialize(unsignedTxObj, {\n      r: '0x' + rsvResponse.r,\n      s: '0x' + rsvResponse.s,\n      v: intV\n    })\n  } else {\n    throw new Error('Incorrect address. Are you using the correct account/ledger?')\n  }\n\n  transport.close()\n\n  return serializedSigned\n}\n\nexport async function ledgerSignMessage(hash, signerAddress) {\n  const transport = await getTransport()\n\n  const accountsData = await getAccounts(transport)\n\n  //TODO for multiple accs?\n  const account = accountsData[0]\n\n  let signedMsg\n  if (account.address.toLowerCase() === signerAddress.toLowerCase()) {\n    try {\n      const rsvReply = await new AppEth(transport).signPersonalMessage(account.derivationPath, hash.substr(2))\n      signedMsg = '0x' + rsvReply.r + rsvReply.s + rsvReply.v.toString(16)\n    } catch (e) {\n      throw new Error('Signature denied ' + e.message)\n    }\n  } else {\n    throw new Error('Incorrect address. Are you using the correct account/ledger?')\n  }\n  transport.close()\n  return signedMsg\n}\n\nexport async function ledgerSignMessage712(domainSeparator, hashStructMessage, signerAddress) {\n  const transport = await getTransport()\n\n  const accountsData = await getAccounts(transport)\n\n  //TODO for multiple accs?\n  const account = accountsData[0]\n\n  let signedMsg\n  if (account.address.toLowerCase() === signerAddress.toLowerCase()) {\n    try {\n      const rsvReply = await new AppEth(transport).signEIP712HashedMessage(account.derivationPath, domainSeparator, hashStructMessage)\n      signedMsg = '0x' + rsvReply.r + rsvReply.s + rsvReply.v.toString(16)\n    } catch (e) {\n      throw new Error('Signature denied ' + e.message)\n    }\n  } else {\n    throw new Error('Incorrect address. Are you using the correct account/ledger?')\n  }\n  transport.close()\n  return signedMsg\n}\n\nfunction calculateDerivedHDKeyInfos(initialDerivedKeyInfo, count) {\n  const derivedKeys = []\n  for (let i = 0; i < count; i++) {\n\n    const fullDerivationPath = `m/${initialDerivedKeyInfo.baseDerivationPath}/${i}`\n    const path = `m/${i}`\n    const hdKey = initialDerivedKeyInfo.hdKey.derive(path)\n    const address = addressOfHDKey(hdKey)\n    const derivedKey = {\n      address,\n      hdKey,\n      baseDerivationPath: initialDerivedKeyInfo.baseDerivationPath,\n      derivationPath: fullDerivationPath,\n    }\n\n    derivedKeys.push(derivedKey)\n  }\n  return derivedKeys\n}\n\nexport function addressOfHDKey(hdKey) {\n  const shouldSanitizePublicKey = true\n  const derivedPublicKey = hdKey.publicKey\n  const ethereumAddressUnprefixed = ethUtil\n    .publicToAddress(derivedPublicKey, shouldSanitizePublicKey)\n    .toString('hex')\n  return ethUtil.addHexPrefix(ethereumAddressUnprefixed).toLowerCase()\n}\n","const { AbiCoder, hexlify, arrayify, keccak256, Interface } = require('ethers').utils\nconst { Contract, BigNumber } = require('ethers')\n\nconst ensure = require('./ensureTypes')\n\nconst IdentityABI = require('../abi/Identity5.2')\nconst QuickAccManagerABI = require('../abi/QuickAccManager')\n\nconst IdentityInterface = new Interface(IdentityABI)\n\nfunction Bundle(args) {\n\tthis.identity = ensure.Address(args.identity)\n\tthis.network = args.network\n\t// @TODO validate this\n\tthis.signer = args.signer\n\tthis.txns = args.txns\n\tthis.gasLimit = args.gasLimit\n\tthis.nonce = args.nonce\n\tthis.signature = args.signature\n\tthis.minFeeInUSDPerGas = args.minFeeInUSDPerGas\n\tthis.recoveryMode = args.recoveryMode\n\tthis.meta = args.meta\n\tthis.gasTankFee = args.gasTankFee\n\treturn this\n}\n\nBundle.prototype.getNonce = async function(provider) {\n\tthis.nonce = await getNonce(provider, this)\n\treturn this.nonce\n}\n\nBundle.prototype.estimate = async function({ fetch, relayerURL, replacing, getNextNonce, gasTank }) {\n\tconst queryParams = Object.fromEntries(Object.entries({getNextNonce, gasTank}).filter(([_, v]) => v))\n\tconst res = await fetchPost(\n\t\tfetch,\n\t\t`${relayerURL}/identity/${this.identity}/${this.network}/estimate?${\n\t\t\t(new URLSearchParams(queryParams)).toString()\n\t\t}`,\n\t\t{ txns: this.txns, signer: this.signer, replacing, minFeeInUSDPerGas: this.minFeeInUSDPerGas }\n\t)\n\tthis.gasLimit = res.gasLimit\n\treturn res\n}\n\nBundle.prototype.sign = async function(wallet, isSingleSigMode) {\n\tif (isNaN(this.nonce)) throw new Error('nonce is not set')\n\tif (isNaN(this.gasLimit)) throw new Error('gasLimit is not set')\n\tconst encoded = getSignable(this, isSingleSigMode)\n\tconst hash = arrayify(keccak256(encoded))\n\tconst signature = await signMsg(wallet, hash)\n\tthis.signature = signature\n\treturn signature\n}\n\nBundle.prototype.submit = async function({ fetch, relayerURL }) {\n\tconst res = await fetchPost(\n\t\tfetch,\n\t\t`${relayerURL}/identity/${this.identity}/${this.network}/submit`,\n\t\t{\n\t\t\tnonce: this.nonce,\n\t\t\tsigner: this.signer,\n\t\t\ttxns: this.txns,\n\t\t\tgasLimit: this.gasLimit,\n\t\t\tsignature: this.signature,\n\t\t\tsignatureTwo: this.signatureTwo,\n\t\t\tmeta: this.meta,\n\t\t\tgasTankFee: this.gasTankFee\n\t\t}\n\t)\n\treturn res\n}\n\nBundle.prototype.cancel = async function({ fetch, relayerURL }) {\n\tconst res = await fetchPost(\n\t\tfetch,\n\t\t`${relayerURL}/identity/${this.identity}/${this.network}/cancel`,\n\t\t{ nonce: this.nonce, signer: this.signer }\n\t)\n\treturn res\n}\n\nconst UNPREDICTABLE_GAS_REGEX = /gas required exceeds allowance|always failing transaction|execution reverted/\nBundle.prototype.estimateNoRelayer = async function({ provider, replacing }) {\n\tconst txParams = {\n\t\tfrom: this.signer.quickAccManager || this.signer.address,\n\t\tto: this.identity,\n\t\tdata: IdentityInterface.encodeFunctionData('executeBySender', [this.txns])\n\t}\n\tconst blockTag = replacing ? 'latest' : 'pending'\n\tconst { error, gasLimit } = await estimateGasWithCatch(provider, blockTag, txParams)\n\tif (error && error.message.startsWith('execution reverted: ')) {\n\t\tconst message = error.message.slice(20)\n\t\treturn { success: false, message }\n\t}\n\tif (error) {\n\t\t// Match both the code and the regex to handle both errs from ethers and raw ones from nodes in case we use .send\n\t\tif (!(error.code === 'UNPREDICTABLE_GAS_LIMIT' || error.message.match(UNPREDICTABLE_GAS_REGEX)))\n\t\t\tthrow error\n\t\treturn { success: false, message: await getErrMsg(provider, txParams, blockTag) }\n\t}\n\tthis.gasLimit = gasLimit.toNumber()\n\t// @TODO EIP1559-optimized estimations (good first issue for external contributors)\n\tconst feeData = await provider.getFeeData()\n\tconst gasPrice = feeData.gasPrice.toNumber()\n\tconst baseFee = (gasPrice * gasLimit) / 1e18\n\treturn {\n\t\tsuccess: true,\n\t\tgasLimit: this.gasLimit,\n\t\tgasPrice,\n\t\tfeeInNative: {\n\t\t\tslow: baseFee * 0.9,\n\t\t\tmedium: baseFee * 1.0,\n\t\t\tfast: baseFee * 1.15,\n\t\t\tape: baseFee * 1.4\n\t\t}\n\t}\n}\n\nasync function signMessage(wallet, identity, signer, message, signatureTwo) {\n\tif (signer.address) return signMsg(wallet, message, true)\n\tif (signer.quickAccManager) {\n\t\tconst signatureOne = await signMsg(wallet, message, true)\n\t\t// the inner sig is the one that the QuickAccManager interprets by doing an abi.decode and sending each individual signature to isValidSignature\n\t\tconst abiCoder = new AbiCoder()\n\t\tconst sigInner = abiCoder.encode(\n\t\t\t['uint', 'bytes', 'bytes'],\n\t\t\t[signer.timelock, signatureOne, signatureTwo]\n\t\t)\n\t\t// 02 is the SmartWallet type sig; we're essentially formatting this as a smart wallet type sig, verified by the quickAccManager\n\t\tconst sig = `${sigInner + abiCoder.encode(['address'], [signer.quickAccManager]).slice(2)}02`\n\t\treturn sig\n\t}\n\tthrow new Error(`invalid signer object`)\n}\n\n\nasync function signMessage712(wallet, identity, signer, domain, types, value, signatureTwo) {\n\tif (signer.address) return signMsg712(wallet, domain, types, value)\n\tif (signer.quickAccManager) {\n\t\tconst signatureOne = await signMsg712(wallet, domain, types, value)\n\t\t// the inner sig is the one that the QuickAccManager interprets by doing an abi.decode and sending each individual signature to isValidSignature\n\t\tconst abiCoder = new AbiCoder()\n\t\tconst sigInner = abiCoder.encode(\n\t\t\t['uint', 'bytes', 'bytes'],\n\t\t\t[signer.timelock, signatureOne, signatureTwo]\n\t\t)\n\t\t// 02 is the SmartWallet type sig; we're essentially formatting this as a smart wallet type sig, verified by the quickAccManager\n\t\tconst sig = `${sigInner + abiCoder.encode(['address'], [signer.quickAccManager]).slice(2)}02`\n\t\treturn sig\n\t}\n\tthrow new Error(`invalid signer object`)\n}\n\nfunction getSignable(userTxnBundle, isSingleSigMode) {\n\tconst abiCoder = new AbiCoder()\n\tconst signer = userTxnBundle.signer\n\tif (signer.address)\n\t\treturn abiCoder.encode(\n\t\t\t['address', 'uint', 'uint', 'tuple(address, uint, bytes)[]'],\n\t\t\t[\n\t\t\t\tuserTxnBundle.identity,\n\t\t\t\tgetChainID(userTxnBundle.network),\n\t\t\t\tuserTxnBundle.nonce,\n\t\t\t\tuserTxnBundle.txns\n\t\t\t]\n\t\t)\n\tif (signer.quickAccManager) {\n\t\tconst accHash = keccak256(\n\t\t\tabiCoder.encode(\n\t\t\t\t['tuple(uint, address, address)'],\n\t\t\t\t[[userTxnBundle.signer.timelock, userTxnBundle.signer.one, userTxnBundle.signer.two]]\n\t\t\t)\n\t\t)\n\t\t// @TODO typed data\n\t\t// if (signer.isTypedData)\n\t\treturn abiCoder.encode(\n\t\t\t['address', 'uint', 'address', 'bytes32', 'uint', 'tuple(address, uint, bytes)[]', 'bool'],\n\t\t\t[\n\t\t\t\tsigner.quickAccManager,\n\t\t\t\tgetChainID(userTxnBundle.network),\n\t\t\t\tuserTxnBundle.identity,\n\t\t\t\taccHash,\n\t\t\t\tuserTxnBundle.nonce,\n\t\t\t\tuserTxnBundle.txns,\n\t\t\t\t!isSingleSigMode\n\t\t\t]\n\t\t)\n\t}\n\tthrow new Error(`invalid signer object`)\n}\n\nfunction getChainID(network) {\n\tif (network === 'ethereum') return 1\n\tif (network === 'polygon') return 137\n\tif (network === 'binance-smart-chain') return 56\n\tif (network === 'bsc') return 56\n\tif (network === 'fantom') return 250\n\tif (network === 'avalanche') return 43114\n\tif (network === 'arbitrum') return 42161\n\tif (network === 'moonbeam') return 1284\n\tif (network === 'moonriver') return 1285\n\tif (network === 'gnosis') return 100\n\tif (network === 'kucoin') return 321\n\tif (network === 'andromeda') return 1088\n\tif (network === 'cronos') return 25\n\tif (network === 'aurora') return 1313161554\n\tif (network === 'rinkeby') return 4\n\tif (network === 'optimism') return 10\n\tthrow new Error(`unsupported network ${network}`)\n}\n\nfunction mapSignatureV(sigRaw) {\n\tconst sig = arrayify(sigRaw)\n\tif (sig[64] < 27) sig[64] += 27\n\treturn hexlify(sig)\n}\n\nasync function signMsg(wallet, message, useFinalDigestSigMode = false) {\n\t// assert.equal(hash.length, 32, 'hash must be 32byte array buffer')\n\t// was 01 originally but to avoid prefixing in solidity, we changed it to 00\n\treturn `${mapSignatureV(await wallet.signMessage(message))}${useFinalDigestSigMode ? '00' : '01'}`\n}\n\nasync function signMsg712(wallet, domain, types, value) {\n\t// 00 is the enum number of SignatureMode.EIP712\n\tconst typedDataSign = await wallet._signTypedData(domain, types, value)\n\treturn `${mapSignatureV(typedDataSign)}00`\n}\n\nasync function getNonce(provider, userTxnBundle) {\n\ttry {\n\t\treturn (userTxnBundle.signer.quickAccManager\n\t\t\t? await new Contract(\n\t\t\t\t\tuserTxnBundle.signer.quickAccManager,\n\t\t\t\t\tQuickAccManagerABI,\n\t\t\t\t\tprovider\n\t\t\t  ).nonces(userTxnBundle.identity)\n\t\t\t: await new Contract(userTxnBundle.identity, IdentityABI, provider).nonce()\n\t\t).toNumber()\n\t} catch (e) {\n\t\t// means the identity isn't deployed, which certainly implies nonce 0\n\t\tif (e.code === 'CALL_EXCEPTION' && (await provider.getCode(userTxnBundle.identity)) === '0x')\n\t\t\treturn 0\n\t\tthrow e\n\t}\n}\n\nasync function fetchPost(fetch, url, body) {\n\tconst r = await fetch(url, {\n\t\theaders: { 'content-type': 'application/json' },\n\t\tmethod: 'POST',\n\t\tbody: JSON.stringify(body)\n\t})\n\treturn r.json()\n}\n\n// helpers for estimateNoRelayer\n\n// Signature of Error(string)\nconst ERROR_SIG = '0x08c379a0'\n\nasync function getErrMsg(provider, txParams, blockTag) {\n\t// .call always returns a hex string with ethers\n\ttry {\n\t\tconst returnData = await provider.call(txParams, blockTag)\n\t\treturn returnData.startsWith(ERROR_SIG)\n\t\t\t? new AbiCoder().decode(['string'], `0x${returnData.slice(10)}`)[0]\n\t\t\t: returnData\n\t} catch (e) {\n\t\t// weird infura case\n\t\tif (e.code === 'UNPREDICTABLE_GAS_LIMIT' && e.error) return e.error.message.slice(20)\n\t\tif (e.code === 'CALL_EXCEPTION') return 'no error string, possibly insufficient amount'\n\t\tif (e.code === 'INVALID_ARGUMENT') return `unable to deserialize: ${hexlify(e.value)}`\n\t\tthrow e\n\t}\n}\n\nasync function estimateGasWithCatch(provider, blockTag, tx) {\n\treturn (\n\t\tprovider\n\t\t\t.send('eth_estimateGas', [tx, blockTag])\n\t\t\t.then(gasLimit => ({ gasLimit: BigNumber.from(gasLimit) }))\n\t\t\t// with .send, the error is wrapped in another error\n\t\t\t.catch(e => (e.code === 'SERVER_ERROR' ? { error: e.error } : { error: e }))\n\t)\n}\n\n// getNonce(require('ethers').getDefaultProvider('homestead'), { identity: '0x23c2c34f38ce66ccc10e71e9bb2a06532d52c5e8', signer: {address: '0x942f9CE5D9a33a82F88D233AEb3292E680230348'}, txns: [] }).then(console.log)\n\nmodule.exports = { Bundle, signMessage, signMessage712, getSignable, signMsg, signMsg712 }\n","// Needed for OUTPACE\nconst channelLib = require('./Channel')\nconst withdrawalLib = require('./Withdraw')\nconst MerkleTree = require('./MerkleTree')\nconst splitSig = require('./splitSig')\n\n// Other utilities\nconst unbondCommitmentlLib = require('./UnbondCommitment')\nconst Permit = require('./Permit')\n\n// Identity and QuickAccManager\nconst bundleLib = require('./Bundle')\n\nmodule.exports = {\n\t...channelLib,\n\t...withdrawalLib,\n\t...unbondCommitmentlLib,\n\t...Permit,\n\t...bundleLib,\n\tMerkleTree,\n\tsplitSig\n}\n","const abi = require('ethereumjs-abi')\nconst keccak256 = require('js-sha3').keccak256\nconst ensure = require('./ensureTypes')\n\nconst ChannelState = {\n\t// hex representation of solidity type(uint256).max\n\tChallenged: '115792089237316195423570985008687907853269984665640564039457584007913129639935',\n\tActive: '0'\n}\n\nfunction Channel(args) {\n\tthis.leader = ensure.Address(args.leader)\n\tthis.follower = ensure.Address(args.follower)\n\tthis.guardian = ensure.Address(args.guardian)\n\tthis.tokenAddr = ensure.Address(args.tokenAddr)\n\tthis.nonce = ensure.Bytes32(args.nonce)\n\n\tObject.freeze(this)\n\n\treturn this\n}\n\nChannel.prototype.hash = function() {\n\treturn Buffer.from(\n\t\tkeccak256.arrayBuffer(\n\t\t\tabi.rawEncode(\n\t\t\t\t['address', 'address', 'address', 'address', 'bytes32'],\n\t\t\t\t[this.leader, this.follower, this.guardian, this.tokenAddr, this.nonce]\n\t\t\t)\n\t\t)\n\t)\n}\n\nChannel.prototype.hashHex = function() {\n\treturn `0x${this.hash().toString('hex')}`\n}\n\nChannel.prototype.toSolidityTuple = function() {\n\treturn [this.leader, this.follower, this.guardian, this.tokenAddr, this.nonce]\n}\n\nChannel.prototype.hashToSign = function(contractAddr, balanceRoot) {\n\t// contains the channel hash (channelId), so that it's not replayable\n\treturn Channel.getSignableStateRoot(contractAddr, this.hashHex(), balanceRoot)\n}\n\nChannel.prototype.hashToSignHex = function(contractAddr, stateRoot) {\n\treturn `0x${this.hashToSign(contractAddr, stateRoot).toString('hex')}`\n}\n\nChannel.prototype.getResumeSignableMessage = function(challengeExpires) {\n\treturn Buffer.from(\n\t\tkeccak256.arrayBuffer(\n\t\t\tabi.solidityPack(\n\t\t\t\t['string', 'bytes32', 'uint256'],\n\t\t\t\t['resume', this.hashHex(), challengeExpires]\n\t\t\t)\n\t\t)\n\t)\n}\n\nChannel.prototype.getResumeSignableMessageHex = function(challengeExpires) {\n\treturn `0x${this.getResumeSignableMessage(challengeExpires).toString('hex')}`\n}\n\n// This returns the same as .hashToSign, .hashToSignHex, but it takes the channelId rather than (the whole channel + contract addr)\nChannel.getSignableStateRoot = function(contractAddr, channelId, balanceRoot) {\n\treturn Buffer.from(\n\t\tkeccak256.arrayBuffer(\n\t\t\tabi.rawEncode(['address', 'bytes32', 'bytes32'], [contractAddr, channelId, balanceRoot])\n\t\t)\n\t)\n}\n\nChannel.getBalanceLeaf = function(acc, amnt) {\n\treturn Buffer.from(keccak256.arrayBuffer(abi.rawEncode(['address', 'uint256'], [acc, amnt])))\n}\n\nChannel.getSpenderBalanceLeaf = function(acc, amnt) {\n\treturn Buffer.from(\n\t\tkeccak256.arrayBuffer(abi.rawEncode(['address', 'string', 'uint256'], [acc, 'spender', amnt]))\n\t)\n}\n\nmodule.exports = { Channel, ChannelState }\n","const ensure = require('./ensureTypes')\n\nfunction Withdraw(args) {\n\tthis.channel = args.channel\n\tthis.balanceTreeAmount = ensure.Uint256(args.balanceTreeAmount)\n\tthis.stateRoot = ensure.Bytes32(args.stateRoot)\n\tthis.sigLeader = ensure.Bytes32Array(args.sigLeader, 3)\n\tthis.sigFollower = ensure.Bytes32Array(args.sigFollower, 3)\n\tthis.proof = ensure.Bytes32Array(args.proof, -1)\n\n\tObject.freeze(this)\n\n\treturn this\n}\n\nWithdraw.prototype.toSolidityTuple = function() {\n\t// etherjs doesn't seem to want BN.js instances; hex is the lowest common denominator for web3/ethers\n\treturn [\n\t\tthis.channel.toSolidityTuple(),\n\t\t`0x${this.balanceTreeAmount.toString(16)}`,\n\t\tthis.stateRoot,\n\t\tthis.sigLeader,\n\t\tthis.sigFollower,\n\t\tthis.proof\n\t]\n}\n\nmodule.exports = { Withdraw }\n","// from https://github.com/ConnextProject/connext-client/blob/master/src/helpers/MerkleTree.js\nconst Buffer = require('buffer').Buffer\nconst keccak256 = require('js-sha3').keccak256\n\nfunction combinedHash(first, second) {\n\tif (!second) {\n\t\treturn first\n\t}\n\tif (!first) {\n\t\treturn second\n\t}\n\tconst sorted = Buffer.concat([first, second].sort(Buffer.compare))\n\n\treturn Buffer.from(keccak256.arrayBuffer(sorted))\n}\n\nfunction deduplicate(buffers) {\n\t// NOTE: performance?\n\treturn buffers.filter((buffer, i) => {\n\t\treturn buffers.findIndex(e => e.equals(buffer)) === i\n\t})\n}\n\nfunction getPair(index, layer) {\n\tconst pairIndex = index % 2 ? index - 1 : index + 1\n\tif (pairIndex < layer.length) {\n\t\treturn layer[pairIndex]\n\t}\n\treturn null\n}\n\nfunction getLayers(elements) {\n\tif (elements.length === 0) {\n\t\treturn [[Buffer.from('')]]\n\t}\n\tconst layers = []\n\tlayers.push(elements)\n\twhile (layers[layers.length - 1].length > 1) {\n\t\tlayers.push(getNextLayer(layers[layers.length - 1]))\n\t}\n\treturn layers\n}\n\nfunction getNextLayer(elements) {\n\treturn elements.reduce((layer, element, index, arr) => {\n\t\tif (index % 2 === 0) {\n\t\t\tlayer.push(combinedHash(element, arr[index + 1]))\n\t\t}\n\t\treturn layer\n\t}, [])\n}\n\nclass MerkleTree {\n\tconstructor(_elements) {\n\t\tif (!_elements.every(b => b.length === 32 && Buffer.isBuffer(b))) {\n\t\t\tthrow new Error('elements must be 32 byte buffers')\n\t\t}\n\t\tconst e = { elements: deduplicate(_elements) }\n\t\tObject.assign(this, e)\n\t\tthis.elements.sort(Buffer.compare)\n\n\t\tconst l = { layers: getLayers(this.elements) }\n\t\tObject.assign(this, l)\n\t}\n\n\tgetRoot() {\n\t\tif (!this.root) {\n\t\t\tconst r = { root: this.layers[this.layers.length - 1][0] }\n\t\t\tObject.assign(this, r)\n\t\t}\n\t\treturn this.root\n\t}\n\n\tverify(proof, element) {\n\t\treturn this.getRoot().equals(proof.reduce((hash, pair) => combinedHash(hash, pair), element))\n\t}\n\n\tproof(element) {\n\t\tlet index = this.elements.findIndex(e => e.equals(element))\n\n\t\tif (index === -1) {\n\t\t\tthrow new Error('element not found in merkle tree')\n\t\t}\n\n\t\treturn this.layers.reduce((proof, layer) => {\n\t\t\tconst pair = getPair(index, layer)\n\t\t\tif (pair) {\n\t\t\t\tproof.push(pair)\n\t\t\t}\n\t\t\tindex = Math.floor(index / 2)\n\t\t\treturn proof\n\t\t}, [])\n\t}\n}\nmodule.exports = MerkleTree\n","function splitSig(inputSig) {\n\tconst sig = inputSig.startsWith('0x') ? inputSig.slice(2) : inputSig\n\tconst r = `0x${sig.substring(0, 64)}`\n\tconst s = `0x${sig.substring(64, 128)}`\n\tlet v = parseInt(sig.substring(128, 130), 16)\n\tif (v < 27) v += 27\n\t// 02 mode is GETH\n\tconst pack = `${'0x02'}${v.toString(\n\t\t16\n\t)}000000000000000000000000000000000000000000000000000000000000`\n\treturn [pack, r, s]\n}\n\nmodule.exports = splitSig\n","const abi = require('ethereumjs-abi')\nconst keccak256 = require('js-sha3').keccak256\nconst ensure = require('./ensureTypes')\n\nfunction UnbondCommitment(args) {\n\tthis.owner = ensure.Address(args.owner)\n\tthis.shares = ensure.Uint256(args.shares)\n\tthis.unlocksAt = ensure.Uint256(args.unlocksAt)\n\n\tObject.freeze(this)\n\treturn this\n}\n\nUnbondCommitment.prototype.hash = function() {\n\tconst buf = abi.rawEncode(\n\t\t['address', 'uint256', 'uint256'],\n\t\t[this.owner, this.shares, this.unlocksAt]\n\t)\n\treturn Buffer.from(keccak256.arrayBuffer(buf))\n}\n\nUnbondCommitment.prototype.hashHex = function() {\n\treturn `0x${this.hash().toString('hex')}`\n}\n\nmodule.exports = { UnbondCommitment }\n","const { keccak256, defaultAbiCoder, toUtf8Bytes, solidityPack } = require('ethers').utils\n\nconst PERMIT_TYPEHASH = keccak256(\n\ttoUtf8Bytes('Permit(address owner,address spender,uint256 value,uint256 nonce,uint256 deadline)')\n)\n\nfunction getDomainSeparator(name, tokenAddress, chainId) {\n\treturn keccak256(\n\t\tdefaultAbiCoder.encode(\n\t\t\t['bytes32', 'bytes32', 'bytes32', 'uint256', 'address'],\n\t\t\t[\n\t\t\t\tkeccak256(\n\t\t\t\t\ttoUtf8Bytes(\n\t\t\t\t\t\t'EIP712Domain(string name,string version,uint256 chainId,address verifyingContract)'\n\t\t\t\t\t)\n\t\t\t\t),\n\t\t\t\tkeccak256(toUtf8Bytes(name)),\n\t\t\t\tkeccak256(toUtf8Bytes('1')),\n\t\t\t\tchainId,\n\t\t\t\ttokenAddress\n\t\t\t]\n\t\t)\n\t)\n}\n\nfunction getApprovalDigest(token, approve, nonce, deadline) {\n\tconst DOMAIN_SEPARATOR = getDomainSeparator(token.name, token.address, token.chainId)\n\n\treturn keccak256(\n\t\tsolidityPack(\n\t\t\t['bytes1', 'bytes1', 'bytes32', 'bytes32'],\n\t\t\t[\n\t\t\t\t'0x19',\n\t\t\t\t'0x01',\n\t\t\t\tDOMAIN_SEPARATOR,\n\t\t\t\tkeccak256(\n\t\t\t\t\tdefaultAbiCoder.encode(\n\t\t\t\t\t\t['bytes32', 'address', 'address', 'uint256', 'uint256', 'uint256'],\n\t\t\t\t\t\t[PERMIT_TYPEHASH, approve.owner, approve.spender, approve.value, nonce, deadline]\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t]\n\t\t)\n\t)\n}\n\nmodule.exports = { getDomainSeparator, getApprovalDigest }\n","import objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nexport default function _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}","// It costs around 19k to send a token, if that token was interacted with before in the same transaction,\n// because of SLOAD costs - they depend on whether a slot has been read\n// however, it costs 30k if the token has not been interacted with\n// we may decrease it a bit and lean on the relayer failsafe values (cfg.gasAddedOnEstimate) later on\nconst ADDED_GAS_TOKEN = 30000\nconst ADDED_GAS_NATIVE = 12000\n\nexport function isTokenEligible(token, speed, estimation, isGasTankEnabled, network) {\n  if (estimation?.relayerless && token?.address === '0x0000000000000000000000000000000000000000') return true\n  if (!token) return false\n  const { feeInFeeToken } = getFeesData(token, estimation, speed, isGasTankEnabled, network)\n  const balanceInFeeToken = (parseInt(token.balance) / Math.pow(10, token.decimals))\n  return balanceInFeeToken > feeInFeeToken\n}\n\nexport function getAddedGas(token) {\n  return !token?.address || token?.address === '0x0000000000000000000000000000000000000000'\n    ? ADDED_GAS_NATIVE\n    : ADDED_GAS_TOKEN\n}\n\n// can't think of a less funny name for that\nexport function getFeePaymentConsequences(token, estimation, isGasTankEnabled) {\n  // Relayerless mode\n  if (!estimation?.feeInUSD || !token) return { multiplier: 1, addedGas: 0 }\n  // Relayer mode\n  const addedGas = getAddedGas(token)\n  // If Gas Tank enabled\n  if (!!isGasTankEnabled) return { addedGas: 0, multiplier: 1 }\n\n  return {\n    // otherwise we get very long floating point numbers with trailing .999999\n    multiplier: parseFloat(((estimation.gasLimit + addedGas) / estimation.gasLimit).toFixed(4)),\n    addedGas\n  }\n}\n\nconst contractErrors = ['caller is a contract', 'caller is another contract', 'contract not allowed', 'contract not supported', 'No contractz allowed', 'o contracts', /*no */'contracts allowed', /* c or C*/'ontract is not allowed', 'aller must be user', 'aller must be a user', 'ontract call not allowed']\n\nexport function mapTxnErrMsg(msg) {\n  if (!msg) return\n  if (msg.includes('Router: EXPIRED')) return 'Swap expired'\n  if (msg.includes('Router: INSUFFICIENT_OUTPUT_AMOUNT')) return 'Swap will suffer slippage higher than your requirements'\n  if (msg.includes('INSUFFICIENT_PRIVILEGE')) return 'Your signer address is not authorized.'\n  if (contractErrors.find(contractMsg => msg.includes(contractMsg))) return 'This dApp does not support smart wallets.'\n  return msg\n}\n\nexport function getErrHint(msg) {\n  if (!msg) return\n  if (msg.includes('Router: EXPIRED')) return 'Try performing the swap again'\n  if (msg.includes('Router: INSUFFICIENT_OUTPUT_AMOUNT')) return 'Try performing the swap again or increase your slippage requirements'\n  if (msg.includes('INSUFFICIENT_PRIVILEGE')) return 'If you set a new signer for this account, try re-adding the account.'\n  if (contractErrors.find(contractMsg => msg.includes(contractMsg))) {\n    return 'WARNING! We detected that this dApp intentionally blocks smart contract calls. This is a highly disruptive practice, as it breaks support for all smart wallets (Ambire, Gnosis Safe and others). We recommend you report this to the dApp ASAP and ask them to fix it.'\n    // return 'This dApp does not support smart wallets or purposefully excludes them. Contact the dApp developers to tell them to implement smart wallets by not blocking contract interactions and/or implementing EIP1271.'\n  }\n  return 'Sending this transaction batch would have resulted in an error, so we prevented it.'\n}\n\nexport function checkIfDAppIncompatible(msg) {\n  return contractErrors.find(contractMsg => msg.includes(contractMsg))\n}\n\nexport function toHexAmount(amnt, decimals) {\n  return '0x' + Math.round(amnt * Math.pow(10, decimals)).toString(16)\n}\n\nexport function getDiscountApplied(amnt, discount = 0) {\n  if (!discount) return 0\n  if (!amnt) return 0\n  if (discount === 1) return amnt\n  return amnt / (1 - discount) * discount\n}\n\n// Returns feeToken data with all multipliers applied\nexport function getFeesData(feeToken, estimation, speed, isGasTankEnabled, network) {\n  const { addedGas, multiplier } = getFeePaymentConsequences(feeToken, estimation, isGasTankEnabled)\n  const savedGas = getAddedGas(feeToken)\n  const discountMultiplier = 1 - (feeToken?.discount || 0)\n  const totalMultiplier = multiplier * discountMultiplier\n  const nativeRate = feeToken?.nativeRate || 1\n  const isCrossChainNativeSelected = isGasTankEnabled && feeToken.address === '0x0000000000000000000000000000000000000000' && (network.id !== feeToken.network)\n  const feeInNative = estimation.customFee\n    ? ((estimation.customFee * discountMultiplier) / nativeRate)\n    : !isCrossChainNativeSelected ? \n        estimation.feeInNative[speed] * totalMultiplier : \n        (((estimation.feeInNative[speed] * totalMultiplier) / nativeRate) * estimation.nativeAssetPriceInUSD) / feeToken.price\n  const feeInUSD = !isNaN(estimation.nativeAssetPriceInUSD) ? \n    !isCrossChainNativeSelected ? \n      feeInNative * estimation.nativeAssetPriceInUSD : \n      feeInNative * feeToken.price : \n    undefined\n  const feeInFeeToken = feeInNative * nativeRate\n\n  return {\n    feeInNative,\n    feeInUSD,\n    feeInFeeToken,\n    addedGas, // use it bundle data\n    savedGas,\n  }\n}\n","import './TxnPreview.scss'\n\nimport { useState, Fragment, useEffect  } from 'react'\n\nimport { getName, getTransactionSummary, isKnown } from 'lib/humanReadableTransactions'\nimport networks from 'consts/networks'\nimport { formatUnits } from 'ethers/lib/utils'\nimport { ToolTip } from 'components/common'\nimport { HiOutlineExternalLink } from 'react-icons/hi'\nimport { MdOutlineClose } from 'react-icons/md'\nimport { BsChevronDown, BsChevronUp } from 'react-icons/bs'\nimport { getTokenIcon } from 'lib/icons'\nimport { formatFloatTokenAmount } from 'lib/formatters'\nimport { setKnownAddressNames } from 'lib/humanReadableTransactions'\nimport useConstants from 'hooks/useConstants'\n\nfunction getNetworkSymbol(networkId) {\n  const network = networks.find(x => x.id === networkId)\n  return network ? network.nativeAssetSymbol : 'UNKNW'\n}\n\nfunction parseExtendedSummaryItem(item, i, networkDetails) {\n  if (item.length === 1) return item\n\n  if (i === 0) return (<div className={`action ${item.toLowerCase()}`} key={`item-${i}`}>{ item }</div>)\n\n  if (!item.type) return (<div className='word' key={`item-${i}`}>{ item }</div>)\n  if (item.type === 'token') {\n    return (\n    <div className='token' key={`item-${i}`}>\n      { item.amount > 0 && <span>{ formatFloatTokenAmount(item.amount, true, item.decimals) }</span> }\n      { item.decimals !== null && item.symbol ? \n        <Fragment>\n          {item.address &&\n            <div className='icon' \n              style={{ backgroundImage: `url(${getTokenIcon(networkDetails.id, item.address)})` }}>\n            </div>}\n          {item.symbol}\n        </Fragment>\n        : (item.amount > 0) ? 'units of unknown token' : null \n      }\n    </div>\n  )}\n\n  if (item.type === 'address') return (\n    <a\n      className='address'\n      key={`item-${i}`}\n      href={item.address ? `${networkDetails.explorerUrl}/address/${item.address}` : null}\n      target=\"_blank\"\n      rel=\"noreferrer\"\n      onClick={e => e.stopPropagation()}\n    >\n      <ToolTip disabled={!item.address} label={item.address}>\n        { item.name ? item.name : item.address }\n        { item.address ? <HiOutlineExternalLink/> : null }\n      </ToolTip>\n    </a>\n  )\n\n  if (item.type === 'network') return (\n    <div className='network' key={`item-${i}`}>\n      { item.icon ? <div className='icon' style={{ backgroundImage: `url(${item.icon})` }}></div> : null }\n      { item.name }\n    </div>\n  )\n\n  if (item.type === 'erc721') {\n    const canShowLink = item.network && item.address && item.id\n    return (\n      <a\n        className='erc721'\n        key={`item-${i}`}\n        href={canShowLink ? `#/wallet/nft/${item.network}/${item.address}/${item.id}` : null}\n        target=\"_blank\"\n        rel=\"noreferrer\"\n        onClick={e => e.stopPropagation()}\n      >\n        { item.name }\n        { canShowLink ? <HiOutlineExternalLink/> : null }\n      </a>\n    )\n  }\n\n  return <></>\n}\n\nexport default function TxnPreview ({ txn, onDismiss, network, account, isFirstFailing, mined, disableExpand, disableDismiss, disableDismissLabel, addressLabel = null }) {\n  const { constants: { tokenList, humanizerInfo } } = useConstants()\n  const [isExpanded, setExpanded] = useState(false)\n  const contractName = getName(humanizerInfo, txn[0])\n\n  const networkDetails = networks.find(({ id }) => id === network)\n  const extendedSummary = getTransactionSummary(humanizerInfo, tokenList, txn, network, account, { mined, extended: true })\n\n  const summary = (extendedSummary.map(entry => Array.isArray(entry) ? entry.map((item, i) => parseExtendedSummaryItem(item, i, networkDetails)) : (entry))) // If entry is extended summary parse it\n  useEffect(() => !!addressLabel && setKnownAddressNames(addressLabel), [addressLabel])\n  \n  return (\n    <div className={isFirstFailing ? 'txnPreview firstFailing' : 'txnPreview'}>\n        <div className=\"heading\">\n          <div className=\"info\" onClick={() => !disableExpand && setExpanded(e => !e)}>\n            <div className=\"summary-container\">\n              {!disableExpand && (<div className='expandTxn'>\n                {isExpanded ? (<BsChevronUp/>) : (<BsChevronDown/>)}\n              </div>)}\n              <div className=\"summary\">{ summary }</div>\n            </div>\n            {isFirstFailing && (<div className='firstFailingLabel'>This is the first failing transaction.</div>)}\n              {!isFirstFailing && !mined && !isKnown(humanizerInfo, txn, account) && (<div className='unknownWarning'>Warning: interacting with an unknown contract or address.</div>)}\n          </div>\n          <div className='actionIcons'>\n            {onDismiss ? (\n              <ToolTip disabled={!disableDismiss || !disableDismissLabel} label={disableDismissLabel}>\n                <div className={`dismissTxn ${disableDismiss ? 'disabled' : ''}`} onClick={e => { e.stopPropagation(); !disableDismiss && onDismiss.apply(this, e) }}><MdOutlineClose/></div>\n              </ToolTip>\n            ) : (<></>)}\n          </div>\n        </div>\n        {\n          isExpanded ? (<div className='advanced'>\n            <div><b>Interacting with (<i>to</i>):</b> {txn[0]}{contractName ? ` (${contractName})` : ''}</div>\n            <div><b>Value to be sent (<i>value</i>):</b> {formatUnits(txn[1] || '0x0', 18)} {getNetworkSymbol(network)}</div>\n            <div><b>Data:</b> {txn[2]}</div>\n          </div>) : (<></>)\n        }\n    </div>\n  )\n}\n","// @ts-ignore adex-protocol-eth package doesn't have any types written\nimport IdentityFactoryABI from 'adex-protocol-eth/abi/IdentityFactory'\nimport { Interface } from 'ethers/lib/utils'\n\nimport accountPresets from '../../constants/accountPresets'\n\nconst IdentityFactory = new Interface(IdentityFactoryABI)\n\n// Pass deploySalt (eg `id('IsAmbireIdentity')`) to deploy contracts at the same address across chains\nexport function toBundleTxn(\n  { to, value, data, deploySalt }: { to: string; value: string; data: string; deploySalt: string },\n  from: string\n) {\n  // Transactions with no `to` are interpreted by the Ethereum network as CREATE (contract deployment) if they come from an EOA\n  // however, our accounts are not EOAs, so we will just call the factory with a user-specific nonce, that's also identifiable (0x6942)\n  if (to === '0x' || !to) {\n    const salt =\n      deploySalt || `0x69420000000000${Date.now().toString(16).slice(1, 9)}00${from.slice(2)}`\n    return [\n      accountPresets.identityFactoryAddr,\n      value,\n      IdentityFactory.encodeFunctionData('deploy', [data, salt])\n    ]\n  }\n  return [to, value || '0x0', data || '0x']\n}\n"],"sourceRoot":""}