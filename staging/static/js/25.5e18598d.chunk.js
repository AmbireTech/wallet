(this["webpackJsonpambire-wallet"]=this["webpackJsonpambire-wallet"]||[]).push([[25],{1551:function(e,t,n){var r=n(3),s=n(177),a=n(62).ethers,i=["function isValidSignature(bytes32 hash, bytes signature) view returns (bytes4)"],c=function(){var e=s(r.mark((function e(t){var n,s,i,c,l,p,b;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.provider,s=t.signer,i=t.message,c=t.typedData,l=t.finalDigest,p=t.signature,b=t.undeployedCallback,!i){e.next=5;break}l=a.utils.hashMessage(i),e.next=13;break;case 5:if(!c){e.next=11;break}if(c.domain&&c.types&&c.message){e.next=8;break}throw Error("Missing one or more properties for typedData (domain, types, message)");case 8:l=a.utils._TypedDataEncoder.hash(c.domain,c.types,c.message),e.next=13;break;case 11:if(l){e.next=13;break}throw Error("Missing one of the properties: message, unPrefixedMessage, typedData or finalDigest");case 13:if(!u(o(l,p),s)){e.next=15;break}return e.abrupt("return",!0);case 15:return e.next=17,d(n,s,l,p);case 17:if(e.t0=e.sent,"0x1626ba7e"!==e.t0){e.next=20;break}return e.abrupt("return",!0);case 20:if(!b){e.next=29;break}if(e.prev=21,!b(s,l,p)){e.next=24;break}return e.abrupt("return",!0);case 24:e.next=29;break;case 26:throw e.prev=26,e.t1=e.catch(21),new Error("undeployedCallback error: "+e.t1.message);case 29:return e.abrupt("return",!1);case 30:case"end":return e.stop()}}),e,null,[[21,26]])})));return function(t){return e.apply(this,arguments)}}(),o=function(e,t){try{return a.utils.recoverAddress(e,t)}catch(n){return!1}},u=function(e,t){if(!1===e)return!1;if(!a.utils.isAddress(e))throw new Error("Invalid recovered address: "+e);return e.toLowerCase()===t.toLowerCase()},d=function(){var e=s(r.mark((function e(t,n,s,c){var o,u,d;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=a.providers.Provider.isProvider(t)?t:new a.providers.Web3Provider(t),e.next=3,o.getCode(n);case 3:if(!(u=e.sent)||"0x"===u){e.next=7;break}return d=new a.Contract(n,i,o),e.abrupt("return",d.isValidSignature(s,c));case 7:return e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e)})));return function(t,n,r,s){return e.apply(this,arguments)}}();e.exports={verifyMessage:c}},1552:function(e,t,n){},1630:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return T}));var r=n(8),s=n(3),a=n.n(s),i=n(12),c=n(9),o=n(567),u=n(106),d=n(21),l=n(2),p=n(1551),b=n(146),g=n(74),j=n(51),h=n(215);function v(e){return Object(d.isHexString)(e)?Object(d.arrayify)(e):Object(d.toUtf8Bytes)(e)}var f=function(e){var t,n,r=e.fetch,s=e.account,f=e.everythingToSign,x=e.relayerURL,m=e.addToast,O=e.resolve,y=e.onConfirmationCodeRequired,k=e.onLastMessageSign,w=e.getHardwareWallet,S=Object(l.useState)(!1),N=Object(c.a)(S,2),I=N[0],T=N[1],A=Object(l.useState)(null),D=Object(c.a)(A,2),E=D[0],C=D[1],M=Object(l.useState)(null),q=Object(c.a)(M,2),P=q[0],R=q[1],L=Object(l.useState)(null),U=Object(c.a)(L,2),_=U[0],J=U[1],V=Object(l.useState)(null),B=Object(c.a)(V,2),F=B[0],W=B[1],Y=Object(l.useMemo)((function(){return f[0]||{}}),[f]),z=Y.chainId,H=-1!==["eth_signTypedData_v4","eth_signTypedData"].indexOf(null===Y||void 0===Y?void 0:Y.type);if(H){n=Y.txn;try{n.startsWith("{")&&(n=JSON.parse(Y.txn))}catch(ue){n=Y.txn}if("object"===typeof n&&null!==n)try{var G,K,Q,X,Z,$,ee,te;if(null===(G=n)||void 0===G||null===(K=G.types)||void 0===K?void 0:K.EIP712Domain)null===($=n)||void 0===$||(null===(ee=$.types)||void 0===ee||delete ee.EIP712Domain);if(d._TypedDataEncoder.hash(null===(Q=n)||void 0===Q?void 0:Q.domain,n.types,null===(X=n)||void 0===X?void 0:X.message),null===(Z=n.domain)||void 0===Z?void 0:Z.chainId)z=null===(te=n.domain)||void 0===te?void 0:te.chainId}catch(de){t=".txn has Invalid TypedData object. Should be {domain, types, message}"}else t=".txn should be a TypedData object"}var ne,re=(ne=z)?j.b.find((function(e){return e.chainId===parseInt(ne.toString(),10)})):null,se=Object(l.useCallback)(Object(i.a)(a.a.mark((function e(){var t,n,i,c,u,l,p,j,v,f,x,m,O,y;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(re){e.next=2;break}return e.abrupt("return");case 2:return i=new o.Bundle({network:null===re||void 0===re?void 0:re.id,identity:null===s||void 0===s?void 0:s.id,signer:null===s||void 0===s?void 0:s.signer}),e.next=5,Object(h.a)(null===re||void 0===re?void 0:re.id);case 5:c=e.sent,(null===s||void 0===s||null===(t=s.signer)||void 0===t?void 0:t.quickAccManager)?(f=b.a.quickAccTimelock,x=[f,null===s||void 0===s||null===(p=s.signer)||void 0===p?void 0:p.one,null===s||void 0===s||null===(j=s.signer)||void 0===j?void 0:j.two],m=new d.AbiCoder,l=Object(d.keccak256)(m.encode(["tuple(uint, address, address)"],[x])),u=null===(v=s.signer)||void 0===v?void 0:v.quickAccManager):u=null===(O=s.signer)||void 0===O?void 0:O.address,y={method:"eth_call",params:[{to:i.identity,data:"0xc066a5b1000000000000000000000000".concat(u.toLowerCase().substring(2))},"latest"],id:1,jsonrpc:"2.0"},Object(g.b)(r,null===c||void 0===c||null===(n=c.connection)||void 0===n?void 0:n.url,y).then((function(e){var t;e.result&&"0x"!==e.result?(C(!0),(null===s||void 0===s||null===(t=s.signer)||void 0===t?void 0:t.quickAccManager)?R(e.result===l):"0x0000000000000000000000000000000000000000000000000000000000000001"===e.result?R(!0):R(!1)):C(!1)})).catch((function(e){J(e.message)}));case 9:case"end":return e.stop()}}),e)}))),[s,re,r]);Object(l.useEffect)((function(){se()}),[se]);var ae=Object(l.useCallback)((function(e){var t;e&&e.message.includes("must provide an Ethereum address")?m("Signing error: not connected with the correct address. Make sure you're connected with ".concat(null===(t=s.signer)||void 0===t?void 0:t.address,"."),{error:!0}):m("Signing error: ".concat(e.message||e),{error:!0})}),[s,m]),ie=Object(l.useCallback)((function(e,t,r){var a=Object(h.a)(r);return Object(p.verifyMessage)({provider:a,signer:s.id,message:H?null:v(e.txn),typedData:H?n:null,signature:t}).then((function(t){t?m("".concat(e.type," SIGNATURE VALID")):m("".concat(e.type," SIGNATURE INVALID"),{error:!0})})).catch((function(t){m("".concat(e.type," SIGNATURE INVALID: ").concat(t.message),{error:!0})}))}),[s,m,n,H]),ce=Object(l.useCallback)(function(){var e=Object(i.a)(a.a.mark((function e(t){var i,c,d,l,p,b,j,h;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x){e.next=3;break}return m("Email/pass accounts not supported without a relayer connection",{error:!0}),e.abrupt("return");case 3:if(t.password){e.next=6;break}return m("Password required to unlock the account",{error:!0}),e.abrupt("return");case 6:return T(!0),e.prev=7,e.next=10,Object(g.b)(r,"".concat(x,"/second-key/").concat(s.id,"/ethereum/sign").concat(H?"?typedData=true":""),{toSign:Y.txn,code:(null===(i=t.code)||void 0===i?void 0:i.length)?t.code:void 0});case 10:if(c=e.sent,d=c.signature,l=c.success,p=c.message,b=c.confCodeRequired,l){e.next=24;break}if(T(!1),p){e.next=19;break}throw new Error("Secondary key: no success but no error message");case 19:return p.includes("invalid confirmation code")&&m("Unable to sign: wrong confirmation code",{error:!0}),m("Second signature error: ".concat(p),{error:!0}),W(null),T(!1),e.abrupt("return");case 24:if(!b){e.next=31;break}if(W(b),!y){e.next=29;break}return e.next=29,y(b,ce);case 29:return T(!1),e.abrupt("return");case 31:if(s.primaryKeyBackup){e.next=33;break}throw new Error("No key backup found: you need to import the account from JSON or login again.");case 33:return e.next=35,u.Wallet.fromEncryptedJson(JSON.parse(s.primaryKeyBackup),t.password);case 35:return j=e.sent,e.next=38,H?Object(o.signMessage712)(j,s.id,s.signer,n.domain,n.types,n.message,d):Object(o.signMessage)(j,s.id,s.signer,v(Y.txn),d);case 38:return h=e.sent,e.next=41,ie(Y,h,null===re||void 0===re?void 0:re.id);case 41:O({success:!0,result:h}),m("Successfully signed!"),1===f.length&&k&&k(),e.next=49;break;case 46:e.prev=46,e.t0=e.catch(7),ae(e.t0);case 49:T(!1);case 50:case"end":return e.stop()}}),e,null,[[7,46]])})));return function(t){return e.apply(this,arguments)}}(),[s,m,n,f,r,ae,H,y,k,x,re,O,Y,ie]),oe=Object(l.useCallback)(function(){var e=Object(i.a)(a.a.mark((function e(t,r){var i,c,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null===(i=s.signer)||void 0===i?void 0:i.quickAccManager)){e.next=4;break}return e.next=3,ce(t);case 3:return e.abrupt("return");case 4:return T(!0),e.prev=5,e.next=8,w(r);case 8:if(c=e.sent){e.next=11;break}return e.abrupt("return");case 11:return e.next=13,"eth_signTypedData_v4"===Y.type||"eth_signTypedData"===Y.type?Object(o.signMessage712)(c,s.id,s.signer,n.domain,n.types,n.message):Object(o.signMessage)(c,s.id,s.signer,v(Y.txn));case 13:return u=e.sent,e.next=16,ie(Y,u,null===re||void 0===re?void 0:re.id);case 16:O({success:!0,result:u}),m("Successfully signed!"),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(5),ae(e.t0);case 23:T(!1);case 24:case"end":return e.stop()}}),e,null,[[5,20]])})));return function(t,n){return e.apply(this,arguments)}}(),[s,m,ce,n,w,ae,null===re||void 0===re?void 0:re.id,O,Y,ie]);return{approve:oe,approveQuickAcc:ce,toSign:Y,isLoading:I,hasPrivileges:P,hasProviderError:_,typeDataErr:t,isDeployed:E,dataV4:n,requestedNetwork:re,requestedChainId:z,isTypedData:H,confirmationType:F}},x=f,m=["https://snapshot.org","https://guild.xyz","https://sudoswap.xyz","https://evm-sigtools.ambire.com","https://app.swappin.gifts"],O=(n(1552),n(48)),y=n(212),k=n(531),w=n(46),S=n(85),N=n(214),I=n(4);function T(e){var t=e.everythingToSign,n=e.resolve,s=e.account,o=e.relayerURL,u=e.totalRequests,d=Object(w.a)().addToast,p=Object(l.useState)({codeRequired:!1,passphrase:""}),b=Object(c.a)(p,2),g=b[0],j=b[1],h=Object(l.useState)(null),v=Object(c.a)(h,2),f=v[0],T=v[1],D=Object(l.useRef)(null),E=function(){var e=Object(i.a)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){T((function(){return e}))}));case 2:if(r=e.sent){e.next=5;break}throw new Error("You must enter a confirmation code");case 5:return e.next=7,n({password:g.passphrase,code:r});case 7:return e.abrupt("return");case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),C=x({fetch:fetch,account:s,everythingToSign:t,relayerURL:o,addToast:d,resolve:n,onConfirmationCodeRequired:E,getHardwareWallet:function(){return Object(k.a)({signer:s.signer,signerExtra:s.signerExtra,chainId:1})},useStorage:N.a}),M=C.approve,q=C.toSign,P=C.isLoading,R=C.hasPrivileges,L=C.hasProviderError,U=C.typeDataErr,_=C.isDeployed,J=C.dataV4,V=C.requestedNetwork,B=C.requestedChainId,F=C.isTypedData,W=C.confirmationType,Y=C.dApp,z=Y&&m.includes(Y.url);if(Object(l.useEffect)((function(){W&&D.current.focus()}),[W]),!q||!s)return Object(I.jsx)(I.Fragment,{});if(!V)return Object(I.jsxs)("div",{id:"signMessage",children:[Object(I.jsxs)("h3",{className:"error",children:["Inexistant network for chainId : ",B]}),Object(I.jsx)(S.e,{className:"reject",onClick:function(){return n({message:"signature denied"})},children:"Reject"})]});if(U)return Object(I.jsxs)("div",{id:"signMessage",children:[Object(I.jsxs)("h3",{className:"error",children:["Invalid signing request: ",U]}),Object(I.jsx)(S.e,{className:"reject",onClick:function(){return n({message:"signature denied"})},children:"Reject"})]});return Object(I.jsxs)("div",{id:"signMessage",children:[Object(I.jsxs)("div",{id:"signingAccount",className:"panel",children:[Object(I.jsx)("div",{className:"title",children:"Signing with account"}),Object(I.jsxs)("div",{className:"content",children:[Object(I.jsxs)("div",{className:"signingAccount-account",children:[Object(I.jsx)("img",{className:"icon",src:y.create({seed:s.id}).toDataURL(),alt:"Account Icon"}),s.id]}),Object(I.jsxs)("div",{className:"signingAccount-network",children:["on",Object(I.jsx)("div",{className:"icon",style:{backgroundImage:"url(".concat(V.icon,")")}}),Object(I.jsx)("div",{className:"address",children:V.name})]})]})]}),Object(I.jsxs)("div",{className:"panel",children:[Object(I.jsxs)("div",{className:"title signMessageTitle",children:[Object(I.jsx)("span",{className:"signMessageTitle-title",children:"Sign message"}),Object(I.jsx)("span",{className:"signMessageTitle-signatureType",children:Object(I.jsxs)(S.B,{label:"".concat(F?"An EIP-712 typed data signature has been requested":"An ethSign ethereum signature type has been requested"),children:[Object(I.jsx)(O.o,{})," ",Object(I.jsx)("span",{children:F?"EIP-712 type":"standard type"})]})})]}),Object(I.jsxs)("div",{className:"request-message",children:[Object(I.jsxs)("div",{className:"dapp-message",children:[Y?Object(I.jsxs)("a",{className:"dapp",href:Y.url,target:"_blank",rel:"noreferrer",children:[Object(I.jsx)("div",{className:"icon",style:{backgroundImage:"url(".concat(Y.icons?Y.icons[0]:"none",")")},children:Object(I.jsx)(O.a,{})}),Y.name]}):"A dApp ","is requesting your signature."]}),Object(I.jsx)("span",{children:u>1?"You have ".concat(u-1," more pending requests."):""}),!z&&Object(I.jsx)(S.i,{})]}),Object(I.jsx)("textarea",{className:"sign-message",type:"text",value:J?JSON.stringify(J,"\n"," "):"0x"!==q.txn?A(q.txn):"(Empty message)",readOnly:!0}),Object(I.jsx)("div",{className:"actions",children:Object(I.jsxs)("form",{onSubmit:function(e){e.preventDefault(),M({password:g.passphrase})},children:[s.signer.quickAccManager&&_&&Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)(S.z,{password:!0,required:!0,minLength:3,placeholder:"Account password",value:g.passphrase,onChange:function(e){return j(Object(r.a)(Object(r.a)({},g),{},{passphrase:e}))}}),Object(I.jsx)("input",{type:"submit",hidden:!0})]}),W&&Object(I.jsxs)(I.Fragment,{children:["email"===W&&Object(I.jsx)("span",{children:"A confirmation code has been sent to your email, it is valid for 3 minutes."}),"otp"===W&&Object(I.jsx)("span",{children:"Please enter your OTP code"}),Object(I.jsx)(S.z,{ref:D,placeholder:"otp"===W?"Authenticator OTP code":"Confirmation code",onInput:function(e){var t;6===(t=e).length&&f(t)}})]}),null===_&&!L&&Object(I.jsx)("div",{children:Object(I.jsx)(S.n,{})}),!1===_&&Object(I.jsxs)("div",{children:[Object(I.jsx)("h3",{className:"error",children:"You can't sign this message yet."}),Object(I.jsxs)("h3",{className:"error",children:["You need to complete your first transaction on"," ",V.name," network in order to be able to sign messages."]})]}),!1===R&&Object(I.jsx)("div",{children:Object(I.jsx)("h3",{className:"error",children:"You do not have the privileges to sign this message."})}),L&&Object(I.jsx)("div",{children:Object(I.jsxs)("h3",{className:"error",children:["There was an issue with the network provider:"," ",L]})}),Object(I.jsxs)("div",{className:"buttons",children:[Object(I.jsx)(S.e,{type:"button",danger:!0,icon:Object(I.jsx)(O.f,{}),className:"reject",onClick:function(){return n({message:"signature denied"})},children:"Reject"}),null!==_&&_&&R&&Object(I.jsx)(S.e,{type:"submit",className:"approve",disabled:P,children:P?Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)(S.n,{}),"Signing..."]}):Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)(O.d,{})," Sign"]})})]})]})})]})]})}function A(e){if(Object(d.isHexString)(e))try{return Object(d.toUtf8String)(e)}catch(t){return e}return(null===e||void 0===e?void 0:e.toString)?e.toString():e+""}},585:function(e,t){}}]);
//# sourceMappingURL=25.5e18598d.chunk.js.map