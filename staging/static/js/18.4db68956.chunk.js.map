{"version":3,"sources":["components/Wallet/Deposit/Deposit.module.scss","components/Wallet/Deposit/Deposit.js","lib/lattice.js","lib/ledgerWebHID.js","lib/getWallet.js","consts/specialAddresses.js","lib/assetMigrationDetector.js","consts/permittableCoins.js","components/Wallet/AssetsMigration/AssetsMigrationSelector.js","components/Wallet/AssetsMigration/AssetsMigrationPermitter.js","components/Wallet/AssetsMigration/AssetsMigrationNative.js","components/Wallet/AssetsMigration/AssetsMigration.js","components/Modals/AssetsMigrationModal/AssetsMigrationModal.js","components/Wallet/AssetsMigration/AssetsMigrationBanner.js"],"names":["module","exports","Deposit","selectedAcc","selectedNetwork","accounts","addRequest","relayerURL","portfolio","useStorage","networkDetails","networks","find","id","useState","qrCodeUrl","setQrCodeUrl","generateQRCode","useCallback","QRCode","toDataURL","quality","margin","error","url","console","useEffect","className","styles","deposit","panel","heading","title","subtitle","description","depositAddress","inputContainerClass","inputClass","label","nativeAssetSymbol","value","copy","qrCode","alt","src","networksTitle","list","filter","n","hide","map","icon","name","network","style","backgroundImage","selectedAccount","linkMargin","cn","walletAddress","crypto","require","HARDENED_OFFSET","getAddressesReqOpts","startPath","latticeInit","commKey","clientConfig","privKey","Client","latticeConnect","client","deviceId","a","Promise","resolve","reject","connect","err","isPaired","errConnect","catch","latticePair","secret","pair","hasActiveWallet","errPair","latticeGetAddresses","getAddresses","res","Error","errGetAddresses","latticeSignMessage","hash","dataMsg","protocol","payload","ethers","utils","hexlify","signerPath","signOptsMsg","currency","data","sign","signedTx","signedMsg","sig","r","s","v","toString","errSignMessage","latticeSignMessage712","message","reqData","latticeSignTransaction","txn","chainId","to","gas","gasPrice","nonce","unsignedTxObj","gasLimit","from","txData","useEIP155","signOpts","serializedSigned","serialize","errSignTxn","ethUtil","HDNode","connectedDevices","PARENT_HD_PATH","getTransport","TransportWebHID","length","opened","open","request","includes","ledgerGetAddresses","transport","getAccounts","close","address","parentKeyDerivationPath","getAddressInternal","then","o","statusCode","ledgerResponse","hdKey","publicKey","Buffer","chainCode","mainAddress","addressOfHDKey","initialDerivedKeyInfo","derivationPath","baseDerivationPath","calculateDerivedHDKeyInfos","appEth","AppEth","ledgerTimeout","timeoutHandle","setTimeout","race","getAddress","clearTimeout","ledgerSignTransaction","fromAddr","serializedUnsigned","accountsData","toLowerCase","signTransaction","substr","rsvResponse","intV","parseInt","Math","floor","ledgerSignMessage","signerAddress","account","signPersonalMessage","rsvReply","ledgerSignMessage712","domainSeparator","hashStructMessage","signEIP712HashedMessage","count","derivedKeys","i","fullDerivationPath","path","derive","derivedKey","push","derivedPublicKey","ethereumAddressUnprefixed","publicToAddress","addHexPrefix","wallets","getWallet","signer","signerExtra","opts","one","getWalletNew","type","TrezorConnect","manifest","email","appUrl","providerTrezor","TrezorSubprovider","trezorConnectClientApi","networkId","_initialDerivedKeyInfo","fromExtendedKey","info","xpub","getInitialDerivedKeyInfo","signMessage","signPersonalMessageAsync","params","signTransactionAsync","sendTransaction","transaction","getProvider","broadcastProvider","getTransactionCount","isConnected","matchAddress","getAccountsAsync","addresses","_signTypedData","domain","types","_TypedDataEncoder","hashDomain","hashStruct","getPrimaryType","getPayload","_initialDerivedKeyInfoAsync","derivedKeyInfo","_findDerivedKeyInfoForAddress","_trezorConnectClientApi","ethereumSignTypedData","metamask_v4_compat","domain_separator_hash","message_hash","response","success","signature","transportProtocol","provider","LedgerSubprovider","ledgerEthereumClientFactoryAsync","ledgerEthereumBrowserClientFactoryAsync","wrapLatticeError","window","ethereum","providers","Web3Provider","signerObject","getSigner","matchChain","listAccounts","match","getNetwork","fn","arg","apply","this","e","ZERO_ADDRESS","assetMigrationDetector","relayerlessOnly","fetchGet","VELCRO_API_ENDPOINT","ZAPPER_API_KEY","velcroResponse","signer_","products","customTokens","assets","tokens","symbol","decimals","urlCustomTokens","JSON","stringify","finalResponse","tokenImageUrl","native","availableBalance","balanceRaw","balanceUSD","rate","PERMIT_TYPE_2612","PERMIT_TYPE_DAI","EIP712DomainWithVersion","EIP712DomainWithoutNameNorVersion","EIP712Domain","EIP712DomainWithSalt","PERMITTABLE_COINS","version","domainType","permitType","nonceFunction","salt","ERC20PermittableInterface","Interface","AssetsMigrationSelector","signerAccount","identityAccount","setIsSelectionConfirmed","setStep","setModalButtons","hideModal","setSelectedTokensWithAllowance","setGasSpeed","setStepperSteps","hidden","selectableTokens","setSelectableTokens","selectableTokensUserInputs","setSelectableTokensUserInputs","nativeToken","setNativeToken","isLoading","setIsLoading","failedImg","setFailedImg","gasData","setGasData","estimatedGasFees","setEstimatedGasFees","selectedGasSpeed","setSelectedGasSpeed","tokensAllowances","setTokenAllowances","isAddCustomTokenFormShown","setIsAddCustomTokenFormShown","isCustomTokenPending","setIsCustomTokenPending","customTokenAddress","setCustomTokenAddress","customTokenError","setCustomTokenError","customTokenInput","useRef","inputRefs","updateSelectableTokenUserInputs","callback","index","findIndex","updated","slice","toggleTokenSelection","minHumanAmount","sort","b","t","current","focus","old","selected","currentHumanAmount","humanAmount","amount","BigNumber","multipliedBy","toFixed","addCustomToken","isAddress","tokenContract","Contract","symbolPromise","decimalsPromise","allowancePromise","allowance","availableSignerBalancePromise","balanceOf","all","promises","signerBalance","toNumber","selectedAmount","div","gt","log","canCoverGasFees","speed","nativeToSpend","gasFees","signerTransactionsCost","plus","lte","getMaxTransferableNative","minus","consolidatedSelectableTokens","st","confirmTokenSelection","tokensToMigrate","consolidatedTokens","regularTransfersCount","nativeTransfersCount","signerTransactionsConsumption","nativeRate","gasFeeAssets","GAS_SPEEDS","forEach","maxPriorityFeePerGas","signerTransactionsCostUSD","allowanceResults","clear","small","onClick","onAssetAmountChange","val","item","endsWith","split","isEqualTo","isNaN","newHumanAmount","comparedTo","dividedBy","replace","steps","tokensTitleActions","join","AmbireLoading","labelClassName","size","draggable","onError","failed","checked","onChange","ref","element","placeholder","ROUND_DOWN","Object","values","f","AssetsMigrationPermitter","selectedTokensWithAllowance","setError","gasSpeed","tokensPermissions","setTokensPermissions","tokensTransfers","setTokensTransfers","tokensPendingStatus","setTokensPendingStatus","hasRefusedOnce","setHasRefusedOnce","lastRefusalError","setLastRefusalError","hasCorrectAccountAndChainId","setHasCorrectAccountAndChainId","currentGasPrice","setCurrentGasPrice","wallet","setWallet","getConsolidatedTokensPure","remapped","signing","sent","pending","checkWalletConnection","connected","readyTokensCount","sendToken","waitForRcpt","tokenToMigrate","sendData","encodeFunctionData","transferResult","rcpt","wait","cancelMigration","completeMigration","nextTokenToAsk","signed","initialTokensTransfers","Button","gte","AssetsMigrationNative","nativeTokenData","hasERC20Tokens","setBeforeCloseModalHandler","hasMigratedNative","setHasMigratedNative","isMigrationPending","setIsMigrationPending","nativeAmount","setNativeAmount","maxRecommendedAmount","setMaxRecommendedAmount","transactionEstimationCost","setTransactionEstimationCost","nativeHumanAmount","setNativeHumanAmount","hasModifiedAmount","setHasModifiedAmount","continueMigration","erc20TransfersCount","permittable","migrateNative","updateAmount","nativeTransactionCost","transfersTransactionCost","recommendedBN","onAmountChange","initialHumanAmount","buttons","getDisplayedButtons","AssetsMigration","setModalSteps","setNativeTokenData","setHasERC20Tokens","isSelectionConfirmed","step","stepperSteps","showCloseConfirmation","setShowCloseConfirmation","currentAccount","stepIndex","beforeCloseHandle","AssetsMigrationModal","useModals","modalButtons","modalSteps","currentStep","noLabels","AssetsMigrationBanner","closeable","hasSignerAssets","setHasSignerAssets","migrationMessageSeen","setMigrationMessageSeen","showModal","key","defaultValue","migrationMessageSeenStorage","setMigrationMessageSeenStorage","closeMigrationMessage","unmounted","relevantAssets","checkSignerAssets"],"mappings":"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","file":"static/js/18.4db68956.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"deposit\":\"Deposit_deposit__MVFPl\",\"depositAddress\":\"Deposit_depositAddress__8GtBi\",\"inputClass\":\"Deposit_inputClass__1kOnb\",\"panel\":\"Deposit_panel__3vfYo\",\"heading\":\"Deposit_heading__37Rps\",\"title\":\"Deposit_title__FtpVm\",\"subtitle\":\"Deposit_subtitle__28DJk\",\"description\":\"Deposit_description__1u2D2\",\"margin\":\"Deposit_margin__8HgjN\",\"qrCode\":\"Deposit_qrCode__3gFm8\",\"networks\":\"Deposit_networks__20Jgz\",\"networksTitle\":\"Deposit_networksTitle___H2Hn\",\"list\":\"Deposit_list__2V21e\",\"network\":\"Deposit_network__3IP_d\",\"icon\":\"Deposit_icon__2OVP1\",\"name\":\"Deposit_name__3iAeA\",\"logos\":\"Deposit_logos__1W5P7\"};","import cn from 'classnames'\nimport { useCallback, useEffect, useState } from 'react'\nimport { Panel } from 'components/common'\nimport QRCode from 'qrcode'\nimport TextInput from 'components/common/TextInput/TextInput'\nimport Providers from './Providers/Providers'\n\nimport networks from 'consts/networks'\n\nimport AssetsMigrationBanner from 'components/Wallet/AssetsMigration/AssetsMigrationBanner'\n\nimport styles from './Deposit.module.scss'\n\nexport default function Deposit({ selectedAcc, selectedNetwork, accounts, addRequest, relayerURL, portfolio, useStorage }) {\n    const networkDetails = networks.find(({ id }) => id === selectedNetwork.id)\n    const [qrCodeUrl, setQrCodeUrl] = useState('')\n\n    const generateQRCode = useCallback(() => {\n        QRCode.toDataURL(selectedAcc, {\n            quality: 1,\n            margin: 1\n        }, (error, url) => {\n            if (error) return console.error(error)\n            setQrCodeUrl(url)\n        })\n    }, [selectedAcc])\n\n    useEffect(() => generateQRCode(), [generateQRCode])\n\n    return (\n        <section className={styles.deposit}>\n            <Panel className={styles.panel}>\n                <div className={styles.heading}>\n                     <div className={styles.title}>\n                        Deposit Tokens\n                    </div>\n                    <div className={styles.subtitle}>\n                        Direct Deposit\n                    </div>\n                </div>\n                <div className={styles.description}>\n                    <TextInput \n                        className={styles.depositAddress}\n                        inputContainerClass={styles.inputClass}\n                        label={`Send ${networkDetails.nativeAssetSymbol}, tokens or collectibles (NFTs) to this address:`} \n                        value={selectedAcc} \n                        copy\n                    />\n                    <img className={styles.qrCode} alt=\"QR Code\" src={qrCodeUrl}></img>\n                </div>\n                <div className={styles.networks}>\n                    <label className={styles.networksTitle}>Following networks supported on this address:</label>\n                    <div className={styles.list}>\n                        {\n                            networks.filter(n => !n.hide).map(({ id, icon, name }) => (\n                                <div className={styles.network} key={id}>\n                                    <div className={styles.icon} style={{backgroundImage: `url(${icon})`}}></div>\n                                    <div className={styles.name}>{ id === 'binance-smart-chain' ? 'BSC' : name }</div>\n                                </div>\n                            ))\n                        }\n                    </div>\n                </div>\n                <AssetsMigrationBanner\n                    selectedNetwork={selectedNetwork}\n                    selectedAccount={selectedAcc}\n                    accounts={accounts}\n                    addRequest={addRequest}\n                    linkMargin={true}\n                    relayerURL={relayerURL}\n                    portfolio={portfolio}\n                    useStorage={useStorage}\n                />\n            </Panel>\n            <Panel className={styles.panel}>\n                <div className={styles.heading}>\n                    <div className={styles.title}>\n                        Fiat Currency\n                    </div>\n                    <div className={styles.subtitle}>\n                        Credit Card & Bank Transfer\n                    </div>\n                </div>\n                <div className={cn(styles.description, styles.margin)}>\n                    Deposit with credit card to your account directly using one of our partners\n                </div>\n                <Providers walletAddress={selectedAcc} networkDetails={networkDetails} relayerURL={relayerURL} portfolio={portfolio}/>\n            </Panel>\n        </section>\n    )\n}\n","import { Client } from 'gridplus-sdk'\nimport { ethers } from 'ethers'\nimport { serialize } from '@ethersproject/transactions'\n\nconst crypto = require('crypto')\nconst HARDENED_OFFSET = 0x80000000\n\nconst getAddressesReqOpts = {\n    startPath: [\n        HARDENED_OFFSET + 44,\n        HARDENED_OFFSET + 60,\n        HARDENED_OFFSET,\n        0,\n        0,\n    ],\n    n: 10,\n}\n\nconst latticeInit = commKey => {\n    const clientConfig = {\n        name: 'Ambire Wallet',\n        crypto: crypto,\n        privKey: commKey,\n    }\n\n    return new Client(clientConfig)\n}\n\nconst latticeConnect = async(client, deviceId) => {\n    return await new Promise((resolve, reject) => {\n        client.connect(deviceId, (err, isPaired) => {\n            if (err) {\n                reject(`Lattice connect: ${err} Or check if the DeviceID is correct.`)\n                return\n            }\n            \n            resolve({ isPaired: !!isPaired, errConnect: false })\n        })\n    }).catch(err => {\n        console.error(err)\n        return { isPaired: false, errConnect: err }\n    })\n}\n\nconst latticePair = async(client, secret) => {\n    return await new Promise((resolve, reject) => {\n        client.pair(secret, (err, hasActiveWallet) => {\n            if (err) {\n                reject(`Lattice connect: ${err}`)\n                return\n            }\n            \n            resolve({ hasActiveWallet, errPair: false })\n        })\n    }).catch(err => {\n        console.error(err)\n        return { hasActiveWallet: false, errPair: err }\n    })\n}\n\nconst latticeGetAddresses = async client => {\n    return await new Promise((resolve, reject) => {\n        client.getAddresses(getAddressesReqOpts, (err, res) => {\n            if (err) {\n                reject(`Lattice get addresses: ${err}`)\n                return\n            }\n\n            if (!res) throw new Error('Lattice could not get the addresses.')\n\n            resolve({res, errGetAddresses: false })\n        })\n    }).catch(err => {\n        console.error(err)\n        return { res: null, errGetAddresses: err }\n    })\n}\n\nconst latticeSignMessage = async(client, hash) => {\n    const dataMsg = {\n        protocol: 'signPersonal',\n        payload: ethers.utils.hexlify(hash),\n        signerPath: [HARDENED_OFFSET+44, HARDENED_OFFSET+60, HARDENED_OFFSET, 0, 0],\n    }\n\n    const signOptsMsg = {\n        currency: 'ETH_MSG',\n        data: dataMsg,\n    }\n\n    \n    return await new Promise((resolve, reject) => {\n        client.sign(signOptsMsg, (err, signedTx) => {\n            if (err) {\n                reject(err)\n                return\n            }\n\n            if (!signedTx) throw new Error('Lattice could not sign the message.')\n            \n            resolve({ signedMsg: '0x' + signedTx.sig.r + signedTx.sig.s + signedTx.sig.v[0].toString(16), errSignMessage: false })  \n        })\n    }).catch(err => {\n        console.error(err)\n        return { signedMsg: null, errSignMessage: err }\n    })\n}\n\nconst latticeSignMessage712 = async(client, message) => {\n    const reqData = {\n        currency: 'ETH_MSG',\n        data: {\n          signerPath: [HARDENED_OFFSET+44, HARDENED_OFFSET+60, HARDENED_OFFSET, 0, 0],\n          protocol: 'eip712', // You must use this string to specify this protocol\n          payload: message\n        }\n      }\n\n    return await new Promise((resolve, reject) => {\n        client.sign(reqData, (err, signedTx) => {\n            if (err) {\n                reject(err)\n                return\n            }\n\n            if (!signedTx) throw new Error('Lattice could not sign the message.')\n            \n            resolve({ signedMsg: '0x' + signedTx.sig.r + signedTx.sig.s + signedTx.sig.v[0].toString(16), errSignMessage: false })  \n        })\n    }).catch(err => {\n        console.error(err)\n        return { signedMsg: null, errSignMessage: err }\n    })\n}\n\nconst latticeSignTransaction = async(client, txn, chainId) => {\n    const { to, data, gas, gasPrice, nonce, value = 0 } = txn\n    const unsignedTxObj = {\n        ...txn,\n        gasLimit: txn.gasLimit || txn.gas,\n        chainId\n    }\n    delete unsignedTxObj.from\n    delete unsignedTxObj.gas\n\n    const txData = {\n        nonce,\n        gasLimit: gas || txn.gasLimit,\n        gasPrice,\n        to,\n        value,\n        data: data || '',\n        // -- m/44'/60'/0'/0/0\n        signerPath: [HARDENED_OFFSET+44, HARDENED_OFFSET+60, HARDENED_OFFSET, 0, 0],\n        chainId,\n        useEIP155: true,\n    }\n\n    const signOpts = {\n        currency: 'ETH',\n        data: txData,\n    }\n\n    \n    return await new Promise((resolve, reject) => {\n        client.sign(signOpts, (err, signedTx) => {\n            if (err) {\n                reject(err)\n                return\n            }\n\n            if (!signedTx) throw new Error('Lattice could not sign the message.')\n            \n            delete unsignedTxObj.v\n            const serializedSigned = serialize(unsignedTxObj, {\n                r: '0x' + signedTx.sig.r,\n                s: '0x' + signedTx.sig.s,\n                v: signedTx.sig.v[0].toString(16)\n            })\n            \n            resolve({ serializedSigned, errSignTxn: false })\n        })\n    }).catch(err => {\n        console.error(err)\n        return { serializedSigned: null, errSignTxn: err }\n    })\n}\n\nexport { \n    latticeInit,\n    latticeConnect,\n    latticePair,\n    latticeGetAddresses,\n    latticeSignMessage,\n    latticeSignMessage712,\n    latticeSignTransaction\n }\n","import TransportWebHID from '@ledgerhq/hw-transport-webhid'\nimport AppEth from '@ledgerhq/hw-app-eth'\nimport { serialize } from '@ethersproject/transactions'\n\nconst EIP_155_CONSTANT = 35\n\nconst ethUtil = require('ethereumjs-util')\nconst HDNode = require('hdkey')\n\nlet connectedDevices = null\n\nexport const PARENT_HD_PATH = \"44'/60'/0'/0\"\n\nasync function getTransport() {\n  connectedDevices = await TransportWebHID.list()\n  if (connectedDevices.length) {\n    if (connectedDevices[0].opened) {\n      return new TransportWebHID(connectedDevices[0])\n    } else { // when transport is still not closed and time between 2 requests is short\n      return TransportWebHID.open(connectedDevices[0])\n    }\n  } else {\n    try {\n      return await TransportWebHID.request()\n    } catch (e) {\n      if (e.message.includes('reading \\'open\\'')) {\n        throw new Error('ledger WebHID request denied')\n      }\n      throw new Error('Could not request WebHID ledger: ' + e.message)\n    }\n  }\n}\n\nexport async function ledgerGetAddresses() {\n  const transport = await getTransport()\n  const accounts = await getAccounts(transport)\n  transport.close()\n\n  return accounts.map(a => a.address)\n}\n\nasync function getAccounts(transport) {\n  const parentKeyDerivationPath = `m/${PARENT_HD_PATH}`\n  let ledgerResponse\n  ledgerResponse = await getAddressInternal(transport, parentKeyDerivationPath).then(o => o).catch(err => {\n    if (err.statusCode === 25871 || err.statusCode === 27404) {\n      throw Error('Please make sure your ledger is unlocked and running the Ethereum app. ' + err.message)\n    } else {\n      throw Error('Could not get address from ledger : ' + err)\n    }\n  })\n\n  const hdKey = new HDNode()\n  hdKey.publicKey = Buffer.from(ledgerResponse.publicKey, 'hex')\n  hdKey.chainCode = Buffer.from(ledgerResponse.chainCode, 'hex')\n  const mainAddress = addressOfHDKey(hdKey)\n\n  const initialDerivedKeyInfo = {\n    hdKey,\n    address: mainAddress,\n    derivationPath: parentKeyDerivationPath,\n    baseDerivationPath: PARENT_HD_PATH,\n  }\n\n  // currently we can't get addrs to match with what appears in MM/Ledger live so only one is derived\n  return calculateDerivedHDKeyInfos(initialDerivedKeyInfo, 1)\n}\n\n\nasync function getAddressInternal(transport, parentKeyDerivationPath) {\n  let timeoutHandle\n  const appEth = new AppEth(transport)\n\n  const ledgerTimeout = new Promise((resolve, reject) => {\n    timeoutHandle = setTimeout(() => {\n      return reject(new Error('Device took too long to respond...'))\n    }, 10000)\n  })\n\n  return Promise.race([\n    appEth.getAddress(parentKeyDerivationPath, false, true),\n    ledgerTimeout\n  ]).then((res) => {\n    clearTimeout(timeoutHandle)\n    return res\n  })\n}\n\nexport async function ledgerSignTransaction(txn, chainId) {\n  const transport = await getTransport()\n\n  const fromAddr = txn.from\n\n  const unsignedTxObj = {\n    ...txn,\n    gasLimit: txn.gasLimit || txn.gas,\n    chainId: chainId\n  }\n  delete unsignedTxObj.from\n  delete unsignedTxObj.gas\n\n  let serializedUnsigned = serialize(unsignedTxObj)\n  const accountsData = await getAccounts(transport)\n\n  //Managing only 1 addr for now\n  const address = accountsData[0].address\n\n  let serializedSigned\n  if (address.toLowerCase() === fromAddr.toLowerCase()) {\n    let rsvResponse\n    try {\n      rsvResponse = await new AppEth(transport).signTransaction(accountsData[0].derivationPath, serializedUnsigned.substr(2))\n    } catch (e) {\n      throw new Error('Could not sign transaction ' + e)\n    }\n\n    const intV = parseInt(rsvResponse.v, 16)\n    const signedChainId = Math.floor((intV - EIP_155_CONSTANT) / 2)\n\n    if (signedChainId !== chainId) {\n      throw new Error('Invalid returned V 0x' + rsvResponse.v)\n    }\n\n    delete unsignedTxObj.v\n    serializedSigned = serialize(unsignedTxObj, {\n      r: '0x' + rsvResponse.r,\n      s: '0x' + rsvResponse.s,\n      v: intV\n    })\n  } else {\n    throw new Error('Incorrect address. Are you using the correct account/ledger?')\n  }\n\n  transport.close()\n\n  return serializedSigned\n}\n\nexport async function ledgerSignMessage(hash, signerAddress) {\n  const transport = await getTransport()\n\n  const accountsData = await getAccounts(transport)\n\n  //TODO for multiple accs?\n  const account = accountsData[0]\n\n  let signedMsg\n  if (account.address.toLowerCase() === signerAddress.toLowerCase()) {\n    try {\n      const rsvReply = await new AppEth(transport).signPersonalMessage(account.derivationPath, hash.substr(2))\n      signedMsg = '0x' + rsvReply.r + rsvReply.s + rsvReply.v.toString(16)\n    } catch (e) {\n      throw new Error('Signature denied ' + e.message)\n    }\n  } else {\n    throw new Error('Incorrect address. Are you using the correct account/ledger?')\n  }\n  transport.close()\n  return signedMsg\n}\n\nexport async function ledgerSignMessage712(domainSeparator, hashStructMessage, signerAddress) {\n  const transport = await getTransport()\n\n  const accountsData = await getAccounts(transport)\n\n  //TODO for multiple accs?\n  const account = accountsData[0]\n\n  let signedMsg\n  if (account.address.toLowerCase() === signerAddress.toLowerCase()) {\n    try {\n      const rsvReply = await new AppEth(transport).signEIP712HashedMessage(account.derivationPath, domainSeparator, hashStructMessage)\n      signedMsg = '0x' + rsvReply.r + rsvReply.s + rsvReply.v.toString(16)\n    } catch (e) {\n      throw new Error('Signature denied ' + e.message)\n    }\n  } else {\n    throw new Error('Incorrect address. Are you using the correct account/ledger?')\n  }\n  transport.close()\n  return signedMsg\n}\n\nfunction calculateDerivedHDKeyInfos(initialDerivedKeyInfo, count) {\n  const derivedKeys = []\n  for (let i = 0; i < count; i++) {\n\n    const fullDerivationPath = `m/${initialDerivedKeyInfo.baseDerivationPath}/${i}`\n    const path = `m/${i}`\n    const hdKey = initialDerivedKeyInfo.hdKey.derive(path)\n    const address = addressOfHDKey(hdKey)\n    const derivedKey = {\n      address,\n      hdKey,\n      baseDerivationPath: initialDerivedKeyInfo.baseDerivationPath,\n      derivationPath: fullDerivationPath,\n    }\n\n    derivedKeys.push(derivedKey)\n  }\n  return derivedKeys\n}\n\nexport function addressOfHDKey(hdKey) {\n  const shouldSanitizePublicKey = true\n  const derivedPublicKey = hdKey.publicKey\n  const ethereumAddressUnprefixed = ethUtil\n    .publicToAddress(derivedPublicKey, shouldSanitizePublicKey)\n    .toString('hex')\n  return ethUtil.addHexPrefix(ethereumAddressUnprefixed).toLowerCase()\n}\n","import { TrezorSubprovider } from '@0x/subproviders/lib/src/subproviders/trezor' // https://github.com/0xProject/0x-monorepo/issues/1400\nimport TrezorConnect from '@trezor/connect-web'\nimport { ethers } from 'ethers'\nimport HDNode from 'hdkey'\nimport { LedgerSubprovider } from '@0x/subproviders/lib/src/subproviders/ledger' // https://github.com/0xProject/0x-monorepo/issues/1400\nimport { ledgerEthereumBrowserClientFactoryAsync } from '@0x/subproviders/lib/src' // https://github.com/0xProject/0x-monorepo/issues/1400\nimport { ledgerSignMessage, ledgerSignTransaction, ledgerSignMessage712, ledgerGetAddresses } from './ledgerWebHID'\nimport { \n  latticeInit, \n  latticeConnect, \n  latticeSignMessage, \n  latticeSignTransaction, \n  latticeGetAddresses, \n  latticeSignMessage712\n } from 'lib/lattice'\nimport { _TypedDataEncoder } from 'ethers/lib/utils'\nimport { getProvider } from 'lib/provider'\nimport networks from 'consts/networks'\n\nlet wallets = {}\n\n// opts\n// passphrase: string\n// noCache: boolean\nexport function getWallet({ signer, signerExtra, chainId }, opts = {}) {\n  const id = `${signer.address || signer.one}${chainId}`\n  if (wallets[id]) return wallets[id]\n  return wallets[id] = getWalletNew({ signer, signerExtra, chainId }, opts)\n}\n\nfunction getWalletNew({ chainId, signer, signerExtra }, opts) {\n  if (signerExtra && signerExtra.type === 'trezor') {\n    TrezorConnect.manifest({\n      email: 'contactus@ambire.com',\n      appUrl: 'https://wallet.ambire.com'\n    })\n    const providerTrezor = new TrezorSubprovider({\n      trezorConnectClientApi: TrezorConnect,\n      networkId: chainId\n    })\n    providerTrezor._initialDerivedKeyInfo = getInitialDerivedKeyInfo(signerExtra)\n    // for Trezor/ledger, alternatively we can shim using https://www.npmjs.com/package/web3-provider-engine and then wrap in Web3Provider\n    return {\n      signMessage: hash => providerTrezor.signPersonalMessageAsync(ethers.utils.hexlify(hash), signer.address),\n      signTransaction: params => providerTrezor.signTransactionAsync({ ...params, from: signer.address }),\n      sendTransaction: async (transaction) => {\n        const network = networks.find(n => n.chainId === transaction.chainId)\n        if (!network) throw Error('no network found for chainId : ' + transaction.chainId)\n        const broadcastProvider = await getProvider(network.id)\n        if (!broadcastProvider) throw Error('no provider found for network : ' + network.id)\n\n        transaction.nonce = ethers.utils.hexlify(await broadcastProvider.getTransactionCount(transaction.from))\n        const gas = ethers.utils.hexlify(transaction.gas || transaction.gasLimit)\n        transaction.gasPrice = ethers.utils.hexlify(transaction.gasPrice)\n        \n        transaction = {\n          ...transaction,\n          gas // trezor params requires gas prop\n          // no chainId prop but chainId already known by providerTrezor\n        }\n        \n        const signedTx = await providerTrezor.signTransactionAsync(transaction)\n        \n        return broadcastProvider.sendTransaction(signedTx)\n      },\n      isConnected: async (matchAddress) => { // chain is provided to trezor. Not necessary to check network\n        const addresses = await providerTrezor.getAccountsAsync(100)\n        return addresses.map(i => i.toLowerCase()).includes(matchAddress.toLowerCase())\n      },\n      _signTypedData: async (domain, types, value) => {\n        \n        const domainSeparator = _TypedDataEncoder.hashDomain(domain)\n        const hashStructMessage = _TypedDataEncoder.hashStruct(_TypedDataEncoder.getPrimaryType(types), types, value)\n        const data = _TypedDataEncoder.getPayload(domain, types, value)\n        const initialDerivedKeyInfo = await providerTrezor._initialDerivedKeyInfoAsync()\n        const derivedKeyInfo = providerTrezor._findDerivedKeyInfoForAddress(initialDerivedKeyInfo, signer.address)\n        const path = derivedKeyInfo.derivationPath\n\n        const response = await providerTrezor._trezorConnectClientApi.ethereumSignTypedData({\n          path,\n          data,\n          metamask_v4_compat: true,\n          domain_separator_hash: domainSeparator,\n          message_hash: hashStructMessage\n        })\n\n        if (response.success) {\n          return `${response.payload.signature}`;\n        } else {\n            throw new Error(response.payload.error);\n        }\n      }\n    }\n  } else if (signerExtra && signerExtra.type === 'ledger') {\n    if (signerExtra.transportProtocol === 'webHID') {\n      return {\n        signMessage: hash => ledgerSignMessage(ethers.utils.hexlify(hash), signer.address),\n        signTransaction: params => ledgerSignTransaction(params, chainId),\n        sendTransaction: async (transaction) => {\n          const network = networks.find(n => n.chainId === transaction.chainId)\n          if (!network) throw Error('no network found for chainId : ' + transaction.chainId)\n          const provider = await getProvider(network.id)\n          if (!provider) throw Error('no provider found for network : ' + network.id)\n\n          transaction.nonce = ethers.utils.hexlify(await provider.getTransactionCount(transaction.from))\n\n          const signedTx = await ledgerSignTransaction(transaction, transaction.chainId)\n\n          return provider.sendTransaction(signedTx)\n        },\n        isConnected: async (matchAddress) => { // chain is provided to ledger. Not necessary to check network\n          const addresses = await ledgerGetAddresses()\n          if (addresses && addresses[0]) {\n            if (matchAddress) {\n              return !!addresses.find(a => a.toLowerCase() === matchAddress.toLowerCase())\n            }\n            return true\n          }\n          return false\n        },\n        _signTypedData: (domain, types, value) => {\n          const domainSeparator = _TypedDataEncoder.hashDomain(domain)\n          const hashStructMessage = _TypedDataEncoder.hashStruct(_TypedDataEncoder.getPrimaryType(types), types, value)\n          return ledgerSignMessage712(domainSeparator, hashStructMessage, signer.address)\n        }\n      }\n    } else {\n      const provider = new LedgerSubprovider({\n        networkId: chainId,\n        ledgerEthereumClientFactoryAsync: ledgerEthereumBrowserClientFactoryAsync,\n        baseDerivationPath: signerExtra.info.baseDerivationPath\n      })\n      return {\n        signMessage: hash => provider.signPersonalMessageAsync(ethers.utils.hexlify(hash), signer.address),\n        signTransaction: params => provider.signTransactionAsync({ ...params, from: signer.address }),\n        sendTransaction: async () => {\n          throw Error('Please use a chrome based browser to use Ledger')\n        },\n        isConnected: async (matchAddress) => { // chain is provided to ledger. Not necessary to check network\n          const addresses = await provider.getAccountsAsync(1)\n          return addresses.map(i => i.toLowerCase()).includes(matchAddress.toLowerCase())\n        },\n        _signTypedData: (domain, types, value) => {\n          throw Error('Please, use a chrome based browser to use 721 Typed signatures')\n        }\n      }\n    }\n  } else if (signerExtra && signerExtra.type === 'Lattice') {\n    return {\n      signMessage: async hash => {\n        return await wrapLatticeError(async hash => {\n          const { commKey, deviceId } = signerExtra\n          const client = latticeInit(commKey)\n          const {isPaired, errConnect } = await latticeConnect(client, deviceId)\n\n          if (errConnect) throw new Error(errConnect.message || errConnect)\n\n          if (!isPaired) {\n            // Canceling the visualization of the secret code on the device's screen.\n            client.pair('')\n            throw new Error('The Lattice device is not paired! Please re-add your account!')\n          }\n\n          const { signedMsg, errSignMessage } = await latticeSignMessage(client, hash)\n          if (errSignMessage) throw new Error(errSignMessage)\n\n          return signedMsg\n        }, [hash])\n      },\n      signTransaction: async params => {\n        return await wrapLatticeError( async params => {\n          const { commKey, deviceId } = signerExtra\n          const client = latticeInit(commKey)\n          const {isPaired, errConnect } = await latticeConnect(client, deviceId)\n\n          if (errConnect) throw new Error(errConnect.message || errConnect)\n\n          if (!isPaired) {\n            // Canceling the visualization of the secret code on the device's screen.\n            client.pair('')\n            throw new Error('The Lattice device is not paired! Please re-add your account!')\n          }\n\n          const { serializedSigned, errSignTxn } = await latticeSignTransaction(client, params, chainId)\n          if (errSignTxn) throw new Error(errSignTxn)\n\n          return serializedSigned\n        }, [params])\n      },\n      sendTransaction: async transaction => { \n        return await wrapLatticeError(async (transaction) => {\n          const network = networks.find(n => n.chainId === transaction.chainId)\n          if (!network) throw Error('no network found for chainId : ' + transaction.chainId)\n          const broadcastProvider = await getProvider(network.id)\n          if (!broadcastProvider) throw Error('no provider found for network : ' + network.id)\n          transaction.nonce = ethers.utils.hexlify(await broadcastProvider.getTransactionCount(transaction.from))\n          const { commKey, deviceId } = signerExtra\n          const client = latticeInit(commKey)\n          const { isPaired, errConnect } = await latticeConnect(client, deviceId)\n\n          if (errConnect) throw new Error(errConnect.message || errConnect)\n\n          if (!isPaired) {\n            // Canceling the visualization of the secret code on the device's screen.\n            client.pair('')\n            throw new Error('The Lattice device is not paired! Please re-add your account!')\n          }\n\n          const { serializedSigned, errSignTxn } = await latticeSignTransaction(client, transaction, chainId)\n          if (errSignTxn) throw new Error(errSignTxn)\n\n          return broadcastProvider.sendTransaction(serializedSigned)\n        }, [transaction])\n      },\n      isConnected: async matchAddress => { \n        return await wrapLatticeError(async (matchAddress) => {\n          let addresses = null\n\n          const { commKey, deviceId } = signerExtra\n          const client = latticeInit(commKey)\n          const { isPaired, errConnect } = await latticeConnect(client, deviceId)\n\n          if (errConnect) throw new Error(errConnect.message || errConnect)\n\n          if (!isPaired) {\n            // Canceling the visualization of the secret code on the device's screen.\n            client.pair('')\n            throw new Error('The Lattice device is not paired! Please re-add your account!')\n          }\n\n          const { res, errGetAddresses } = await latticeGetAddresses(client)\n          if (errGetAddresses) { \n            throw new Error(`Lattice: ${errGetAddresses}`, { error: true })\n          }\n\n          addresses = res\n          return addresses.map(i => i.toLowerCase()).includes(matchAddress.toLowerCase())\n        }, [matchAddress])\n    },\n    _signTypedData: async (domain, types, value) => {\n      return await wrapLatticeError(async (domain, types, value) => {\n        const payload = _TypedDataEncoder.getPayload(domain, types, value)\n        const { commKey, deviceId } = signerExtra\n        const client = latticeInit(commKey)\n        const {isPaired, errConnect } = await latticeConnect(client, deviceId)\n\n        if (errConnect) throw new Error(errConnect.message || errConnect)\n\n        if (!isPaired) {\n          // Canceling the visualization of the secret code on the device's screen.\n          client.pair('')\n          throw new Error('The Lattice device is not paired! Please re-add your account!')\n        }\n\n        const { signedMsg, errSignMessage } = await latticeSignMessage712(client, payload)\n        if (errSignMessage) throw new Error(errSignMessage)\n\n        return signedMsg\n      }, [domain, types, value])\n    }\n  }\n  } else if (signer.address) {\n    if (!window.ethereum) throw new Error('No web3 support detected in your browser: if you created this account through MetaMask, please install it.')\n    // NOTE: for metamask, use `const provider = new ethers.providers.Web3Provider(window.ethereum)`\n    // 'any' is explained here: https://github.com/ethers-io/ethers.js/issues/1107\n    const provider = new ethers.providers.Web3Provider(window.ethereum, 'any')\n\n    const signerObject = provider.getSigner(signer.address)\n\n    signerObject.isConnected = async (matchAddress, matchChain) => {\n      const accounts = await provider.listAccounts()\n\n      let match = true\n      if (!!(accounts.length)) {\n        if (matchAddress) {\n          match = !!accounts.find(a => a.toLowerCase() === matchAddress.toLowerCase())\n        }\n        if (matchChain) {\n          const { chainId } = await provider.getNetwork()\n          match = match && chainId === matchChain\n        }\n      } else {\n        match = false\n      }\n      return match\n    }\n\n    return signerObject\n  } else if (signer.one) {\n    throw new Error('getWallet not applicable for QuickAccounts: use primaryKeyBackup with the passphrase and /second-sig')\n  } else {\n    throw new Error('unknown signer type')\n  }\n}\n\nfunction getInitialDerivedKeyInfo(signerExtra) {\n  return {\n    hdKey: HDNode.fromExtendedKey(signerExtra.info.hdKey.xpub),\n    derivationPath: signerExtra.info.derivationPath,\n    baseDerivationPath: signerExtra.info.baseDerivationPath\n  }\n}\n\nasync function wrapLatticeError(fn, arg) {\n  return await fn.apply(this, arg)\n   .catch(e => {\n     throw new Error(`Lattice: ${e.message}`)\n    })\n}\n","export const ZERO_ADDRESS = '0x0000000000000000000000000000000000000000'\n","import { VELCRO_API_ENDPOINT, ZAPPER_API_KEY } from 'config'\nimport { fetchGet } from 'lib/fetch'\nimport {ZERO_ADDRESS} from 'consts/specialAddresses'\nimport networks from 'consts/networks'\n\nexport default function assetMigrationDetector({ networkId, account }) {\n  if (networks.find(({id}) => id === networkId)?.relayerlessOnly) return Promise.resolve([])\n  if (!account) return Promise.resolve([])// for web accounts\n\n  //First pass\n  return fetchGet(`${VELCRO_API_ENDPOINT}/protocols/tokens/balances?addresses[]=${account}&network=${networkId}&api_key=${ZAPPER_API_KEY}&newBalances=true&available_on_coingecko=true`)\n    .then(velcroResponse => {\n\n      const signer_ = account.toLowerCase()\n      if (!velcroResponse[signer_]) return []\n      if (!velcroResponse[signer_].products[0]) return []\n\n      const filteredAssets = velcroResponse[signer_].products[0].assets;\n\n      //Second pass to get real time data\n      const customTokens = filteredAssets.map(a => ({\n        address: a.tokens[0].address,\n        symbol: a.tokens[0].symbol,\n        decimals: a.tokens[0].decimals,\n      }))\n      const urlCustomTokens = `${VELCRO_API_ENDPOINT}/protocols/tokens/balances?addresses[]=${account}&network=${networkId}&api_key=${ZAPPER_API_KEY}&customTokens=${JSON.stringify(customTokens)}&available_on_coingecko=true`\n      return fetchGet(urlCustomTokens)\n        .then(finalResponse => {\n          const filteredAssets = finalResponse[signer_]?.products[0]?.assets\n\n          return filteredAssets.map(a => {\n            return {\n              name: a.tokens[0].symbol,\n              icon: a.tokens[0].tokenImageUrl,\n              address: a.tokens[0].address.toLowerCase(),\n              native: a.tokens[0].address === ZERO_ADDRESS,\n              decimals: a.tokens[0].decimals,\n              availableBalance: a.tokens[0].balanceRaw,\n              balanceUSD: a.tokens[0].balanceUSD,\n              rate: a.tokens[0].balanceUSD / a.tokens[0].balanceRaw\n            }\n          })\n        })\n        .catch(err => {\n          throw Error('Could not get customToken assets from velcro')\n        })\n    })\n    .catch(err => {\n      throw Error('Could not get assets from velcro')\n    })\n}\n","//Permit definitions\nimport { Interface } from 'ethers/lib/utils'\n\nexport const PERMIT_TYPE_2612 = [\n  { name: \"owner\", type: \"address\" },\n  { name: \"spender\", type: \"address\" },\n  { name: \"value\", type: \"uint256\" },\n  { name: \"nonce\", type: \"uint256\" },\n  { name: \"deadline\", type: \"uint256\" },\n]\n\nexport const PERMIT_TYPE_DAI = [\n  { name: \"holder\", type: \"address\" },\n  { name: \"spender\", type: \"address\" },\n  { name: \"nonce\", type: \"uint256\" },\n  { name: \"expiry\", type: \"uint256\" },\n  { name: \"allowed\", type: \"bool\" },\n]\n\nexport const EIP712DomainWithVersion = [\n  { name: \"name\", type: \"string\" },\n  { name: \"version\", type: \"string\" },\n  { name: \"chainId\", type: \"uint256\" },\n  { name: \"verifyingContract\", type: \"address\" },\n];\n\nexport const EIP712DomainWithoutNameNorVersion = [\n  { name: \"chainId\", type: \"uint256\" },\n  { name: \"verifyingContract\", type: \"address\" },\n];\n\nexport const EIP712Domain = [\n  { name: \"name\", type: \"string\" },\n  { name: \"chainId\", type: \"uint256\" },\n  { name: \"verifyingContract\", type: \"address\" },\n];\n\nexport const EIP712DomainWithSalt = [\n  { name: \"name\", type: \"string\" },\n  { name: \"version\", type: \"string\" },\n  { name: \"verifyingContract\", type: \"address\" },\n  { name: \"salt\", type: \"bytes32\" },\n]\n\nexport const PERMITTABLE_COINS = {\n  1: [\n    // Without version 2\n    { address: '0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48', name: 'USD Coin', version: '2', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612 },\n\n    // Without version\n    { address: '0x1f9840a85d5af5bf1d1762f925bdaddc4201f984', name: 'Uniswap', domainType: EIP712Domain, permitType: PERMIT_TYPE_2612 },\n    { address: '0xde30da39c46104798bb5aa3fe8b9e0e1f348163f', name: 'Gitcoin', domainType: EIP712Domain, permitType: PERMIT_TYPE_2612 },\n\n    // Dai\n    { address: '0x6b175474e89094c44da98b954eedeac495271d0f', name: 'Dai Stablecoin', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_DAI },\n\n    // Spell Token\n    { address: '0x090185f2135308bad17527004364ebcc2d37e5f6', domainType: EIP712DomainWithoutNameNorVersion, permitType: PERMIT_TYPE_2612 },\n    // Magic Internet Money\n    { address: '0x99d8a9c45b2eca8864373a26d1459e3dff1e17f3', domainType: EIP712DomainWithoutNameNorVersion, permitType: PERMIT_TYPE_2612 },\n\n    // With version 1\n    { address: '0x7fc66500c84a76ad7e9c93437bfc5ac33e2ddae9', name: 'Aave Token', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612 , nonceFunction: \"_nonces\"},\n    { name: 'AdEx Loyalty', address: '0xd9a4cb9dc9296e111c66dfacab8be034ee2e1c2c', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'Aave Token', address: '0x7fc66500c84a76ad7e9c93437bfc5ac33e2ddae9', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'Ambire Wallet Staking Token', address: '0x47cd7e91c3cbaaf266369fe8518345fc4fc12935', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'ConstitutionDAO', address: '0x7a58c0be72be218b41c608b7fe7c5bb630736c71', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'Aragon Network Token', address: '0xa117000000f279d81a1d3cc75430faa017fa5a2e', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'AdEx Staking Token', address: '0xb6456b57f03352be48bf101b46c1752a0813491a', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'dYdX', address: '0x92d6c1e31e14520e676a687f0a93788b716beff5', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'Ethereum Name Service', address: '0xc18360217d8f7ab5e7c516566761ea12ce7f9d72', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'Olympus', address: '0x383518188c0c6d7730d91b2c03a03c837814a899', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: '1INCH Token', address: '0x111111111117dc0aa78b770fa6a738034120c302', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'IceToken', address: '0xf16e81dce15b08f326220742020379b855b87df9', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'Fei USD', address: '0x956f47f50a910163d8bf957cf5846d573e7f87ca', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'LUSD Stablecoin', address: '0x5f98805a4e8be255a32880fdec7f6728c6568ba0', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'Balancer', address: '0xba100000625a3754423978a60c9317c58a424e3d', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n\n    { name: 'Aave interest bearing AAVE', address: '0xffc97d72e13e01096502cb8eb52dee56f74dad7b', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave AMM Market UniBATWETH', address: '0xa1b0edf4460cc4d8bfaa18ed871bff15e5b57eb4', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave AMM Market UniWBTCWETH', address: '0xc58f53a8adff2fb4eb16ed56635772075e2ee123', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave AMM Market UniUSDCWETH', address: '0x391e86e2c002c70dee155eaceb88f7a3c38f5976', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave interest bearing WETH', address: '0x030ba81f1c18d280636f32af80b9aad02cf0854e', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave interest bearing DAI', address: '0x028171bca77440897b824ca71d1c56cac55b68a3', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave AMM Market UniWBTCUSDC', address: '0x2365a4890ed8965e564b7e2d27c38ba67fec4c6f', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave AMM Market UniCRVWETH', address: '0x0ea20e7ffb006d4cfe84df2f72d8c7bd89247db0', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave AMM Market UniUNIWETH', address: '0x3d26dcd840fcc8e4b2193ace8a092e4a65832f9f', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave interest bearing GUSD', address: '0xd37ee7e4f452c6638c96536e68090de8cbcdb583', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave AMM Market UniMKRWETH', address: '0x370adc71f67f581158dc56f539df5f399128ddf9', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave interest bearing CRV', address: '0x8dae6cb04688c62d939ed9b68d32bc62e49970b1', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave AMM Market USDT', address: '0x17a79792fe6fe5c95dfe95fe3fcee3caf4fe4cb7', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave AMM Market UniSNXWETH', address: '0x38e491a71291cd43e8de63b7253e482622184894', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave interest bearing YFI', address: '0x5165d24277cd063f5ac44efd447b27025e888f37', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave interest bearing SNX', address: '0x35f6b052c598d933d69a4eec4d04c73a191fe6c2', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave AMM Market USDC', address: '0xd24946147829deaa935be2ad85a3291dbf109c80', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave AMM Market DAI', address: '0x79be75ffc64dd58e66787e4eae470c8a1fd08ba4', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave interest bearing USDT', address: '0x3ed3b47dd13ec9a98b44e6204a523e766b225811', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave interest bearing RAI', address: '0xc9bc48c72154ef3e5425641a3c747242112a46af', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave interest bearing BAL', address: '0x272f97b7a56a387ae942350bbc7df5700f8a4576', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave interest bearing BAT', address: '0x05ec93c0365baaeabf7aeffb0972ea7ecdd39cf1', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave interest bearing USDC', address: '0xbcca60bb61934080951369a648fb03df4f96263c', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave AMM Market BptBALWETH', address: '0xd109b2a304587569c84308c55465cd9ff0317bfb', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave interest bearing KNC', address: '0x39c6b3e42d6a679d7d776778fe880bc9487c2eda', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave interest bearing MANA', address: '0xa685a61171bb30d4072b338c80cb7b2c865c873e', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave interest bearing XSUSHI', address: '0xf256cc7847e919fac9b808cc216cac87ccf2f47a', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave interest bearing TUSD', address: '0x101cc05f4a51c0319f570d5e146a8c625198e636', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n    { name: 'Aave interest bearing ENJ', address: '0xac6df26a590f08dcc95d5a4705ae8abbc88509ef', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612, nonceFunction: \"_nonces\"},\n\n  ],\n  137: [\n    //Not working, only to test UX behavior on polygon\n    { name: 'Governance OHM', address: '0xd8ca34fd379d9ca3c6ee3b3905678320f5b45195', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'Frax', address: '0x45c32fa6df82ead1e2ef74d17b76547eddfaff89', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'Aave Matic Market WBTC', address: '0x5c2ed810328349100a66b82b78a1791b101c9d61', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n\n    { name: 'Aave Matic Market WETH', address: '0x28424507fefb6f7f8e9d3860f56504e4e5f5f390', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'Aave Matic Market USDC', address: '0x1a13f4ca1d028320a707d99520abfefca3998b7f', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'Aave Matic Market AAVE', address: '0x1d2a0e5ec8e5bbdca5cb219e649b565d8e5c3360', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'Synapse', address: '0xf8f9efc0db77d8881500bb06ff5d6abc3070e695', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n\n    { name: 'Aave Matic Market WMATIC', address: '0x8df3aad3a84da6b69a4da8aec3ea40d9091b2ac4', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'Aave Matic Market USDT', address: '0x60d55f02a771d515e077c9c2403a1ef324885cec', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'Klima DAO', address: '0x4e78011ce80ee02d2c3e649fb657e45898257815', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n\n    { name: 'Quickswap', address: '0xb5c064f955d8e7f38fe0460c556a72987494ee17', domainType: EIP712Domain, permitType: PERMIT_TYPE_2612},\n    { name: 'Route', address: '0x16eccfdbb4ee1a85a33f3a9b21175cd7ae753db4', domainType: EIP712Domain, permitType: PERMIT_TYPE_2612},\n\n    { address: '0x8f3cf7ad23cd3cadbd9735aff958023239c6a063', name: '(PoS) Dai Stablecoin', version: '1', salt: '0x0000000000000000000000000000000000000000000000000000000000000089', domainType: EIP712DomainWithSalt, permitType: PERMIT_TYPE_DAI, nonceFunction: 'getNonce'},\n    { address: '0x2791bca1f2de4661ed88a30c99a7a9449aa84174', name: 'USD Coin (PoS)', version: '1', salt: '0x0000000000000000000000000000000000000000000000000000000000000089', domainType: EIP712DomainWithSalt, permitType: PERMIT_TYPE_2612 },\n  ],\n  56: [\n    { name: '1INCH Token', address: '0x111111111117dc0aa78b770fa6a738034120c302', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'Frax', address: '0x90c97f71e18723b0cf0dfa30ee176ab653e89f40', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'JADE', address: '0x7ad7242a99f21aa543f9650a56d141c57e4f6081', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n    { name: 'Templar Token', address: '0x19e6bfc1a6e4b042fb20531244d47e252445df01', version: '1', domainType: EIP712DomainWithVersion, permitType: PERMIT_TYPE_2612},\n\n  ]\n}\n\nexport const ERC20PermittableInterface = new Interface([\n  \"function nonces(address owner) external view returns (uint256)\",\n  \"function _nonces(address owner) external view returns (uint256)\",\n  \"function getNonce(address owner) external view returns (uint256)\",\n\n  \"function name() external view returns (string)\",\n  \"function symbol() external view returns (string)\",\n  \"function decimals() external view returns (uint)\",\n  \"function balanceOf(address) external view returns (uint)\",\n\n  //2612 permit\n  \"function permit(address owner, address spender, uint256 value, uint256 deadline, uint8 v, bytes32 r, bytes32 s)\",\n  //Dai permit\n  \"function permit(address holder, address spender, uint256 nonce, uint256 expiry, bool allowed, uint8 v, bytes32 r, bytes32 s)\",\n  \"function transferFrom(address from, address to, uint256 amount) view returns (bool)\",\n  \"function transfer(address to, uint256 amount) view returns (bool)\",\n  \"function approve(address spender, uint256 amount) returns (bool)\",\n  \"function allowance(address owner, address spender) view returns (uint)\"\n])\n","import './AssetsMigration.scss'\n\nimport BigNumber from 'bignumber.js'\nimport { useCallback, useEffect, useRef, useState } from 'react'\nimport assetMigrationDetector from 'lib/assetMigrationDetector'\nimport { ZERO_ADDRESS } from 'consts/specialAddresses'\nimport AmbireLoading from 'components/common/Loading/AmbireLoading'\nimport { Checkbox, TextInput, Button, Loading } from 'components/common'\nimport { GiToken } from 'react-icons/gi'\nimport { fetchGet } from 'lib/fetch'\nimport { MdClose, MdOutlineNavigateNext, MdOutlineAddCircleOutline, MdCancel } from 'react-icons/md'\nimport { Contract, ethers } from 'ethers'\nimport { ERC20PermittableInterface } from 'consts/permittableCoins'\nimport { getProvider } from 'lib/provider'\nimport { GAS_SPEEDS } from 'ambire-common/src/constants/gasSpeeds'\n\nconst TRANSFER_CONSUMPTION = 52000 // higher avg, 21000 included\n\nconst AssetsMigrationSelector = ({ signerAccount, identityAccount, network, setIsSelectionConfirmed, setStep, portfolio, relayerURL, setModalButtons, hideModal, setSelectedTokensWithAllowance, setGasSpeed, setStepperSteps, hidden }) => {\n\n  const [selectableTokens, setSelectableTokens] = useState([])\n  const [selectableTokensUserInputs, setSelectableTokensUserInputs] = useState([])\n\n  const [nativeToken, setNativeToken] = useState(null)\n\n  const [isLoading, setIsLoading] = useState(true)\n  const [failedImg, setFailedImg] = useState([])\n  const [gasData, setGasData] = useState(null)\n  const [estimatedGasFees, setEstimatedGasFees] = useState(null)\n  const [selectedGasSpeed, setSelectedGasSpeed] = useState('fast')\n  const [tokensAllowances, setTokenAllowances] = useState([])\n\n  const [isAddCustomTokenFormShown, setIsAddCustomTokenFormShown] = useState(false)\n  const [isCustomTokenPending, setIsCustomTokenPending] = useState(false)\n  const [customTokenAddress, setCustomTokenAddress] = useState('')\n  const [customTokenError, setCustomTokenError] = useState('')\n\n  const customTokenInput = useRef()\n  const inputRefs = useRef({})\n\n  // update signerTokens state helper\n  const updateSelectableTokenUserInputs = useCallback((address, callback) => {\n    const index = selectableTokensUserInputs.findIndex(a => a.address === address)\n\n    if (index !== -1) {\n      const updated = callback(selectableTokensUserInputs[index])\n\n      setSelectableTokensUserInputs([\n        ...selectableTokensUserInputs.slice(0, index),\n        updated,\n        ...selectableTokensUserInputs.slice(index + 1),\n      ])\n    }\n  }, [selectableTokensUserInputs])\n\n  // Include/Exclude token in migration\n  const toggleTokenSelection = useCallback((address, minHumanAmount = null) => {\n\n    // focusing input fields on selection\n    const index = selectableTokens\n      .sort((a, b) => a.name < b.name ? -1 : 1)\n      .findIndex(t => t.address === address)\n    inputRefs.current[index]?.focus()\n\n    updateSelectableTokenUserInputs(address, old => {\n      let updated = {\n        ...old,\n        selected: !old.selected\n      }\n      if (minHumanAmount) {\n\n        // let newHumanAmount = humanAmount.replace(/\\.?0+$/g, '')\n        const currentHumanAmount = selectableTokensUserInputs.find(t => t.address === address)?.humanAmount\n        if (minHumanAmount > currentHumanAmount) {\n          const decimals = selectableTokens.find(t => t.address === address)?.decimals\n\n          updated.amount = new BigNumber(minHumanAmount).multipliedBy(10 ** decimals).toFixed(0)\n          updated.humanAmount = minHumanAmount\n        }\n      }\n      return updated\n    })\n  }, [selectableTokens, updateSelectableTokenUserInputs, selectableTokensUserInputs])\n\n  const addCustomToken = useCallback(() => {\n\n    const provider = getProvider(network.id)\n\n    if (!ethers.utils.isAddress(customTokenAddress)) {\n      setCustomTokenError('invalid custom token address')\n      return\n    }\n\n    if (selectableTokens.find(t => t.address.toLowerCase() === customTokenAddress.toLowerCase())) {\n      setCustomTokenAddress('')\n      setIsAddCustomTokenFormShown(false)\n      return\n    }\n\n    const tokenContract = new Contract(customTokenAddress, ERC20PermittableInterface, provider)\n\n    const symbolPromise = tokenContract.symbol().catch(() => setCustomTokenError('Could not get symbol of token ' + customTokenAddress))\n    const decimalsPromise = tokenContract.decimals().catch(() => setCustomTokenError('Could not get decimals of token ' + customTokenAddress))\n    const allowancePromise = tokenContract.allowance(signerAccount, identityAccount).catch(() => setCustomTokenError('Could not get allowance for token ' + customTokenAddress))\n    const availableSignerBalancePromise = tokenContract.balanceOf(signerAccount).catch(() => setCustomTokenError('Could not get balance for token ' + customTokenAddress))\n\n    setIsCustomTokenPending(true)\n    setCustomTokenError(null)\n\n    Promise.all([\n      symbolPromise,\n      decimalsPromise,\n      allowancePromise,\n      availableSignerBalancePromise]\n    ).then((promises) => {\n\n      const [symbol, decimals, allowance, signerBalance] = promises\n\n      setIsCustomTokenPending(false)\n\n      if (symbol && decimals && allowance !== null && signerBalance !== null) {\n        setCustomTokenAddress('')\n        setIsAddCustomTokenFormShown(false)\n\n        setSelectableTokens(old => {\n          return [\n            ...old,\n            {\n              address: customTokenAddress,\n              name: symbol,\n              decimals: decimals.toNumber(),\n              icon: null,\n              rate: 0,\n              native: false,\n              availableBalance: signerBalance.toString(),\n              balanceUSD: 0,\n            }\n          ]\n        })\n\n        setSelectableTokensUserInputs(old => {\n          return [\n            ...old,\n            {\n              address: customTokenAddress,\n              selectedAmount: 0,\n              amount: signerBalance.toString(),\n              humanAmount: new BigNumber(signerBalance.toString()).div(10 ** decimals.toString()).toFixed(),\n              selected: signerBalance.gt(0)\n            }\n          ]\n        })\n\n        setTokenAllowances(old => {\n          return [\n            ...old,\n            {\n              address: customTokenAddress,\n              allowance: 0\n            }\n          ]\n        })\n      }\n    }).catch(err => {\n      console.log('err getting custom token data', err)\n      setIsCustomTokenPending(false)\n    })\n  }, [network, customTokenAddress, signerAccount, identityAccount, setCustomTokenError, selectableTokens])\n\n  const canCoverGasFees = useCallback((speed) => {\n    if (!estimatedGasFees) return false\n    const nativeToSpend = selectableTokensUserInputs.find(t => t.address === ZERO_ADDRESS && t.selected)?.amount || 0\n\n    return new BigNumber(estimatedGasFees.gasFees[speed].signerTransactionsCost)\n      .plus(nativeToSpend)\n      .lte(nativeToken.availableBalance || 0)\n\n  }, [selectableTokensUserInputs, estimatedGasFees, nativeToken])\n\n  const getMaxTransferableNative = useCallback((speed) => {\n    return new BigNumber(nativeToken.availableBalance).minus(estimatedGasFees.gasFees[speed].signerTransactionsCost)\n  }, [estimatedGasFees, nativeToken])\n\n  const consolidatedSelectableTokens = (selectableTokens, selectableTokensUserInputs = [], tokensAllowances = []) => {\n    return selectableTokens.map(st => {\n      return {\n        ...st,\n        ...selectableTokensUserInputs.find(t => t.address === st.address),\n        ...tokensAllowances.find(t => t.address === st.address)\n      }\n    })\n  }\n\n  // select tokens to migrate\n  const confirmTokenSelection = useCallback(async () => {\n\n    const tokensToMigrate = consolidatedSelectableTokens(selectableTokens, selectableTokensUserInputs, tokensAllowances).filter(a => a.selected)\n    if (!tokensToMigrate.length) return\n\n    setSelectedTokensWithAllowance(tokensToMigrate.map(a => {\n      return {\n        ...a,\n      }\n    }))\n\n    setIsSelectionConfirmed(true)\n    if (tokensToMigrate.find(a => a.address === ZERO_ADDRESS)) {\n      setStep(1)\n    } else {\n      setStep(2)\n    }\n\n    setGasSpeed(selectedGasSpeed)\n  }, [selectableTokens, selectableTokensUserInputs, tokensAllowances, setSelectedTokensWithAllowance, setIsSelectionConfirmed, setStep, setGasSpeed, selectedGasSpeed])\n\n  useEffect(() => {\n    if (isAddCustomTokenFormShown) {\n      customTokenInput.current.focus()\n    }\n  }, [isAddCustomTokenFormShown])\n\n  useEffect(() => {\n    setNativeToken(selectableTokens.find(t => t.native))\n  }, [selectableTokens])\n\n  // fetch selectable tokens\n  useEffect(() => {\n\n    setIsLoading(true)\n    setSelectableTokens([])\n\n    assetMigrationDetector({ networkId: network.id, account: signerAccount }).then(assets => {\n      setSelectableTokens(\n        assets.map(t => {\n          return {\n            ...t,\n          }\n        })\n      )\n\n      setSelectableTokensUserInputs(assets.map(t => {\n        return {\n          address: t.address,\n          selectedAmount: 0,\n          amount: t.availableBalance,\n          humanAmount: new BigNumber(t.availableBalance).div(10 ** t.decimals).toFixed(),\n          selected: false\n        }\n      }))\n\n      setIsLoading(false)\n    }).catch(err => {\n      console.error(err)\n    })\n  }, [signerAccount, setIsLoading, setSelectableTokens, network])\n\n  // check Identity gas fees\n  useEffect(() => {\n\n    if (!gasData) return\n\n    const consolidatedTokens = consolidatedSelectableTokens(selectableTokens, selectableTokensUserInputs, tokensAllowances)\n\n    const regularTransfersCount = consolidatedTokens.filter(t => t.selected && !t.native).length\n    const nativeTransfersCount = consolidatedTokens.filter(t => t.selected && t.native).length\n\n    const adjustedApprovalCost = network.id === 'arbitrum' ? 200000 : 0\n\n    const signerTransactionsConsumption = (regularTransfersCount * (25000 + TRANSFER_CONSUMPTION + adjustedApprovalCost)) + (nativeTransfersCount * 25000)\n\n    const nativeRate = gasData.gasFeeAssets.native / 10 ** 18 // should decimals be returned in the API?\n\n    const gasFees = {}\n    GAS_SPEEDS.forEach(speed => {\n      let gasPrice = (gasData.gasPrice[speed] + (gasData.gasPrice.maxPriorityFeePerGas ? gasData.gasPrice.maxPriorityFeePerGas[speed] * 1 : 0))\n\n      const signerTransactionsCost = signerTransactionsConsumption * gasPrice\n      const signerTransactionsCostUSD = signerTransactionsCost * nativeRate\n\n      gasFees[speed] = {\n        speed,\n        signerTransactionsCost,\n        signerTransactionsCostUSD,\n        signerTransactionsConsumption\n      }\n    })\n\n    setEstimatedGasFees({\n      regularTransfersCount,\n      nativeTransfersCount,\n      gasFees,\n    })\n\n  }, [selectableTokens, selectableTokensUserInputs, portfolio, gasData, selectedGasSpeed, tokensAllowances, network])\n\n\n  // getting gasPrice data from relayer\n  useEffect(() => {\n    fetchGet(`${relayerURL}/gasPrice/${network.id}`).then(gasData => {\n      setGasData(gasData.data)\n    }).catch(err => {\n      console.log('fetch error', err)\n    })\n  }, [relayerURL, network])\n\n\n  // getting erc20 token allowances\n  useEffect(() => {\n    const promises = selectableTokens.map(t => {\n      const provider = getProvider(network.id)\n      const tokenContract = new Contract(t.address, ERC20PermittableInterface, provider)\n\n      if (!t.native) {\n        return tokenContract.allowance(signerAccount, identityAccount)\n          .then((allowance) => {\n\n            return {\n              address: t.address,\n              allowance: allowance.toString(),\n            }\n          }).catch(err => {\n            console.log('err getting allowance', err)\n          })\n      }\n      return {\n        address: t.address,\n        allowance: 0,\n      }\n    })\n\n    Promise.all(promises).then(allowanceResults => {\n      setTokenAllowances(allowanceResults)\n    })\n\n  }, [identityAccount, network, selectableTokens, signerAccount])\n\n\n  useEffect(() => {\n    if (hidden) return\n    setModalButtons(\n      <>\n        <Button clear small icon={<MdClose/>} onClick={hideModal}>Close</Button>\n        {\n          (selectableTokensUserInputs.filter(a => a.selected).length > 0 && canCoverGasFees(selectedGasSpeed))\n            ? <Button small icon={<MdOutlineNavigateNext/>} className={'primary'}\n                      onClick={() => confirmTokenSelection()}>Move {selectableTokensUserInputs.filter(a => a.selected).length} assets</Button>\n            : <Button small icon={<MdOutlineNavigateNext/>} className={'primary disabled'}>Move assets</Button>\n        }\n      </>\n    )\n  }, [selectableTokensUserInputs, selectedGasSpeed, setModalButtons, hideModal, confirmTokenSelection, hidden, canCoverGasFees])\n\n  const onAssetAmountChange = useCallback((val, item) => updateSelectableTokenUserInputs(item.address, (old) => {\n    if (val === '') {\n      return {\n        ...old,\n        humanAmount: 0,\n        amount: 0\n      }\n    }\n    if (\n      (val.endsWith('.') && val.split('.').length === 2)\n      || (val.split('.').length === 2 && (val.endsWith('0') && new BigNumber(val).isEqualTo(old.humanAmount)))\n    ) {\n      return {\n        ...old,\n        humanAmount: val,\n      }\n    }\n\n    if (!isNaN(val)) {\n      let newHumanAmount = new BigNumber(val).toFixed(item.decimals)\n      if (new BigNumber(newHumanAmount).multipliedBy(10 ** item.decimals).comparedTo(item.availableBalance) === 1) {\n        newHumanAmount = new BigNumber(item.availableBalance).dividedBy(10 ** item.decimals).toFixed(item.decimals)\n      }\n      // trim trailing . or 0\n      newHumanAmount = newHumanAmount.replace(/\\.?0+$/g, '')\n\n      return {\n        ...old,\n        humanAmount: newHumanAmount,\n        amount: new BigNumber(newHumanAmount).multipliedBy(10 ** item.decimals).toFixed(0)\n      }\n    }\n    return old\n  }), [updateSelectableTokenUserInputs])\n\n  useEffect(() => {\n    setTimeout(() => {\n      inputRefs.current[0]?.focus()\n    }, 250)\n  }, [selectableTokens])\n\n  // Stepper\n  useEffect(() => {\n\n    const steps = ['Selection']\n\n    const native = selectableTokensUserInputs.find(a => a.address.toLowerCase() === ZERO_ADDRESS && a.selected)\n    if (native) {\n      steps.push(`Send ${selectableTokens.find(t => t.address === native.address).name}`)\n    }\n\n    if (selectableTokensUserInputs.find(a => a.address.toLowerCase() !== ZERO_ADDRESS && a.selected)) {\n\n      let tokensTitleActions = []\n      if (selectableTokensUserInputs.find(a => a.selected && a.address.toLowerCase() !== ZERO_ADDRESS)) tokensTitleActions.push('Send')\n\n      steps.push(tokensTitleActions.join(' and ') + ' tokens')\n\n    }\n\n    if (steps.length === 1) {\n      steps.push('Send tokens')\n    }\n\n    setStepperSteps(steps)\n  }, [selectableTokens, selectableTokensUserInputs, setStepperSteps, network])\n\n  if (hidden) return <></>\n\n  return (\n    <div>\n      {\n        isLoading\n          ?\n          <div className={'content-center'}>\n            <h3 className={'mb-6'}>Loading assets...</h3>\n            <AmbireLoading/>\n          </div>\n          :\n          <div>\n            {\n              selectableTokens.length === 0\n                ? <div>No assets to migrate have been found</div>\n                :\n                <div>\n                  <div className={'mb-4'}>Please select the assets you would like to migrate from your signer wallet to\n                    your Ambire wallet\n                  </div>\n                  {\n                    consolidatedSelectableTokens(selectableTokens, selectableTokensUserInputs)\n                      .sort((a, b) => a.name < b.name ? -1 : 1)\n                      .map((item, index) => (\n                        <div className='migration-asset-row' key={index}>\n                          <div className={`migration-asset-select${item.selected ? ' checked' : ''}`}\n                               onClick={() => false}>\n                            <Checkbox\n                              labelClassName='checkbox-label'\n                              id={`check-${item.address}`}\n                              label={<span className={'migration-asset-select-label'}>\n                                  <span className='migration-asset-select-icon'>\n                                    {\n                                      (failedImg.includes(item.icon) || !item.icon) ?\n                                        <GiToken size={18}/>\n                                        :\n                                        <img src={item.icon} draggable='false' alt='Token Icon' onError={(err) => {\n                                          setFailedImg(failed => [...failed, item.icon])\n                                        }}/>\n                                    }\n                                </span>\n                                <span className='migration-asset-select-name'>{item.name}</span>\n                              </span>}\n                              checked={item.selected}\n                              onChange={() => toggleTokenSelection(item.address)}\n                            />\n                          </div>\n                          <div className='migration-asset-usd'>\n                            ${((item.amount) * item.rate).toFixed(2)}\n                          </div>\n                          <div className='migration-asset-amount'>\n                            <TextInput\n                              ref={(element) => inputRefs.current[index] = element}\n                              className={'migrate-amount-input'}\n                              value={item.humanAmount}\n                              onChange={(val) => onAssetAmountChange(val, item)}\n                            />\n                          </div>\n                        </div>\n                      ))\n                  }\n                  <div className={'custom-token-row mt-2'}>\n                    {\n                      isAddCustomTokenFormShown\n                        ? <div>\n                          {\n                            isCustomTokenPending\n                              ? <div className={'custom-token-message-fetching'}>\n                                <Loading/>\n                                Fetching custom token data...\n                              </div>\n                              : <>\n                                {\n                                  customTokenError && <div className={'error'}>{customTokenError}</div>\n                                }\n                                <div>\n                                  <TextInput\n                                    className={'custom-token-input'}\n                                    placeholder={'Enter custom token address'}\n                                    value={customTokenAddress}\n                                    onChange={(val) => {\n                                      setCustomTokenAddress(val)\n                                    }}\n                                    ref={customTokenInput}\n                                  />\n                                </div>\n                                <div className={'flex-row mt-2'}>\n                                  <Button small icon={<MdCancel/>} className={'buttonHollow danger align-right'}\n                                          onClick={() => {\n                                            setIsAddCustomTokenFormShown(false)\n                                            setCustomTokenAddress('')\n                                            setCustomTokenError(null)\n                                          }}>Cancel</Button>\n                                  <Button small icon={<MdOutlineAddCircleOutline/>} className={'primary ms-4'}\n                                          onClick={() => addCustomToken()}>Add</Button>\n                                </div>\n                              </>\n                          }\n                        </div>\n                        : <Button small icon={<MdOutlineAddCircleOutline/>} className={'clear align-right'}\n                                  onClick={() => setIsAddCustomTokenFormShown(true)}\n                        >Add custom token</Button>\n                    }\n                  </div>\n                  {\n                    !canCoverGasFees(selectedGasSpeed) && selectableTokensUserInputs.filter(a => a.selected).length > 0 &&\n                    <div className={'notification-hollow warning mt-3 mb-3'}>\n                      Your Signer Wallet will not have enough fees to pay for the migration.\n                      Please transfer a maximum of <span className={'max-native-suggestion'}\n                                                         onClick={() => onAssetAmountChange(new BigNumber(getMaxTransferableNative(selectedGasSpeed)).dividedBy(10 ** nativeToken.decimals).toFixed(6, BigNumber.ROUND_DOWN), nativeToken)}>\n                        {new BigNumber(getMaxTransferableNative(selectedGasSpeed)).dividedBy(10 ** nativeToken.decimals).toFixed(6, BigNumber.ROUND_DOWN)} {network.nativeAssetSymbol}\n                      </span>\n                    </div>\n                  }\n                  {\n                    estimatedGasFees &&\n                    <div className={'gas-estimation-block mt-4'}>\n                      <div className={'gas-estimation-block-title'}>Estimated gas fee</div>\n                      <ul className={'gas-estimation-selector'}>\n                        {\n                          Object.values(estimatedGasFees.gasFees).map((f, index) => {\n                              return (<li key={index} className={f.speed === selectedGasSpeed ? 'selected' : ''}\n                                          onClick={() => setSelectedGasSpeed(f.speed)}>{f.speed}</li>)\n                            }\n                          )\n                        }\n                      </ul>\n                      <table className={'gas-estimation-details'}>\n                        <tbody>\n                        <tr>\n                          <td>\n                            Signer fee\n                            {\n                              (!!estimatedGasFees.nativeTransfersCount || !!estimatedGasFees.regularTransfersCount) &&\n                              <span className={'migration-actions'}>\n                                  <span>{estimatedGasFees.nativeTransfersCount + estimatedGasFees.regularTransfersCount} transfers</span>\n                              </span>\n                            }\n                          </td>\n                          <td\n                            className={'gas-estimation-details-amount'}>${estimatedGasFees.gasFees[selectedGasSpeed].signerTransactionsCostUSD.toFixed(2)}</td>\n                        </tr>\n                        </tbody>\n                      </table>\n                    </div>\n                  }\n                </div>\n            }\n          </div>\n      }\n    </div>\n  )\n}\n\nexport default AssetsMigrationSelector\n","import './AssetsMigration.scss'\nimport { ethers } from 'ethers'\nimport { useCallback, useEffect, useState } from 'react'\nimport { getWallet } from 'lib/getWallet'\nimport { FaCheck, FaHourglass } from 'react-icons/fa'\nimport Button from 'components/common/Button/Button'\n\nimport { GiToken } from 'react-icons/gi'\nimport { MdOutlineNavigateBefore, MdOutlineNavigateNext } from 'react-icons/md'\nimport { ZERO_ADDRESS } from 'consts/specialAddresses'\nimport { fetchGet } from 'lib/fetch'\nimport BigNumber from 'bignumber.js'\nimport { ERC20PermittableInterface } from 'consts/permittableCoins'\n\nconst AssetsMigrationPermitter = ({\n                                    addRequest,\n                                    identityAccount,\n                                    signer,\n                                    signerExtra,\n                                    network,\n                                    selectedTokensWithAllowance,\n                                    setError,\n                                    hideModal,\n                                    setStep,\n                                    setModalButtons,\n                                    relayerURL,\n                                    gasSpeed,\n                                    hidden,\n                                  }) => {\n\n  //storing user sign/send or rejection\n  const [tokensPermissions, setTokensPermissions] = useState([])\n\n  //storing transfer status for non permittable tokens\n  const [tokensTransfers, setTokensTransfers] = useState({})\n\n  //to be able to have UI feedback without trigerring useEffects\n  const [tokensPendingStatus, setTokensPendingStatus] = useState({})\n  //error display logic if a user has rejected one or more MM popup\n  const [hasRefusedOnce, setHasRefusedOnce] = useState(false)\n  const [lastRefusalError, setLastRefusalError] = useState(null)\n  const [failedImg, setFailedImg] = useState([])\n\n  const [hasCorrectAccountAndChainId, setHasCorrectAccountAndChainId] = useState(null)\n\n  const [currentGasPrice, setCurrentGasPrice] = useState(null)\n\n  const [wallet, setWallet] = useState(null)\n\n  //using a callback would return not up to date data + would trigger useEffect prompt loop while we do not want that\n  const getConsolidatedTokensPure = (selected, tokensPermissions = [], tokensTransfers = [], tokensPendingStatus = []) => {\n    return selected.filter(t => t.address !== ZERO_ADDRESS).map(t => {\n      let remapped = {\n        ...t,\n        signing: null,\n        signature: null,\n        sent: false,\n        pending: false,\n        allowance: 0,\n      }\n      if (tokensPermissions[t.address]) {\n        remapped.signing = tokensPermissions[t.address].signing\n        remapped.signature = tokensPermissions[t.address].signature\n      }\n\n      if (tokensTransfers[t.address]) {\n        remapped.sent = true\n      }\n\n      if (tokensPendingStatus[t.address]) {\n        remapped.pending = true\n      }\n\n      return remapped\n    })\n  }\n\n  const checkWalletConnection = useCallback(async () => {\n    return wallet?.isConnected(signer.address, network.chainId)\n      .then(connected => {\n        setHasCorrectAccountAndChainId(connected)\n        if (!connected) {\n          setError(<>Please make sure your signer wallet is unlocked, and connected with <b>{signer.address}</b> to the\n            correct chain: <b>{network.id}</b></>)\n          return false\n        }\n        return true\n      })\n      .catch(e => {\n        setError('Could not check signer connection status: ' + e.error)\n        return false\n      })\n  }, [network, setError, signer, wallet])\n\n  //number of tokens that are ready to migrate (sent / permitted)\n  const readyTokensCount = useCallback(() => {\n    let count = 0\n    getConsolidatedTokensPure(selectedTokensWithAllowance, tokensPermissions, tokensTransfers, []).forEach(t => {\n      if (t.sent) {\n        count++\n      }\n    })\n    return count\n  }, [selectedTokensWithAllowance, tokensPermissions, tokensTransfers])\n\n  //Send MM prompt\n  const sendToken = useCallback(async (address, waitForRcpt = false) => {\n\n    if (!(await checkWalletConnection())) return\n\n    const tokenToMigrate = selectedTokensWithAllowance.find(t => t.address === address)\n    if (!tokenToMigrate) return\n\n    const sendData = ERC20PermittableInterface.encodeFunctionData('transfer', [identityAccount, new BigNumber(tokenToMigrate.amount).toFixed(0)])\n\n    //UI pending status\n    setTokensPendingStatus(old => {\n      old[address] = true\n      return { ...old }\n    })\n\n    setLastRefusalError(null)\n    const transferResult = wallet.sendTransaction({\n      from: signer.address,\n      to: address,\n      data: sendData,\n      gasLimit: 80000,\n      gasPrice: currentGasPrice,\n      chainId: network.chainId,\n    }).then(async rcpt => {\n\n      setTokensPermissions(old => {\n        old[address] = {\n          ...old[address],\n          signing: true,\n        }\n        return { ...old }\n      })\n\n      if (waitForRcpt) {\n        await rcpt.wait()\n        setTokensTransfers(old => {\n          old[address] = true\n          return { ...old }\n        })\n\n        setTokensPendingStatus(old => {\n          old[address] = false\n          return { ...old }\n        })\n\n        setTokensPermissions(old => {\n          old[address] = {\n            ...old[address],\n            signing: false,\n          }\n          return { ...old }\n        })\n      }\n\n      return true\n    }).catch(err => {\n      setTokensPendingStatus(old => {\n        old[address] = false\n        return { ...old }\n      })\n\n      if (err.message.includes('underpriced')) { // not copying the whole JSON error returned by the rpc\n        setLastRefusalError('Transaction fee underpriced')\n      } else {\n        setLastRefusalError(err.message)\n      }\n\n      setHasRefusedOnce(true)\n\n      if (!tokensPermissions[address] || (tokensPermissions[address] && tokensPermissions[address].signing !== false)) {\n        setTokensPermissions(old => {\n          old[address] = {\n            ...old[address],\n            signing: false,\n          }\n          return { ...old }\n        })\n      }\n      return false\n    })\n\n    return !!transferResult\n\n  }, [wallet, identityAccount, tokensPermissions, selectedTokensWithAllowance, currentGasPrice, network, signer, checkWalletConnection])\n\n  //going to assets selection\n  const cancelMigration = useCallback(() => {\n    setError(null)\n    setTokensTransfers([])\n    setTokensPermissions([])\n    setHasRefusedOnce(false)\n    setStep(0)\n  }, [setError, setTokensPermissions, setTokensTransfers, setStep])\n\n  //batch transactions\n  const completeMigration = useCallback(() => {\n    //reset assets migration status\n    cancelMigration()\n    hideModal()\n  }, [cancelMigration, hideModal])\n\n  useEffect(() => {\n    setWallet(getWallet({\n      signer: signer,\n      signerExtra: signerExtra,\n      chainId: network.chainId\n    }))\n  }, [network, signer, signerExtra])\n\n  // check correctness of signer wallet before starting the chained popups\n  useEffect(() => {\n    checkWalletConnection()\n  }, [checkWalletConnection])\n\n  useEffect(() => {\n    const url = `${relayerURL}/gasPrice/${network.id}`\n\n    fetchGet(url).then(gasData => {\n      let gasPrice = gasData.data.gasPrice[gasSpeed]\n      if (gasData.data.gasPrice.maxPriorityFeePerGas) {\n        gasPrice += gasData.data.gasPrice.maxPriorityFeePerGas[gasSpeed]\n      }\n      setCurrentGasPrice(gasPrice)\n    }).catch(err => {\n      setError(err.message + ' ' + url)\n    })\n\n  }, [network, relayerURL, setError, gasSpeed])\n\n  //Automatic permit ask chain\n  useEffect(() => {\n\n    //Skip initial useEffect\n    if (!hasCorrectAccountAndChainId) return\n    if (!Object.values(tokensTransfers).length) return\n    if (!currentGasPrice) return\n\n    const tokensWithPermission = getConsolidatedTokensPure(selectedTokensWithAllowance, tokensPermissions, tokensTransfers, []).map(t => {\n      return {\n        address: t.address,\n        signed: t.signing,\n      }\n    })\n\n    const nextTokenToAsk = tokensWithPermission.find(a => a.signed === null)\n\n    if (nextTokenToAsk) {\n      //avoid MM popup losing focus when immediately running the next action\n      setTimeout(() => {\n        sendToken(nextTokenToAsk.address, true)\n      }, 150)\n    }\n  }, [selectedTokensWithAllowance, sendToken, tokensPermissions, tokensTransfers, hasCorrectAccountAndChainId, currentGasPrice])\n\n  useEffect(() => {\n    if (!selectedTokensWithAllowance.length) return\n    const initialTokensTransfers = {}\n    selectedTokensWithAllowance.forEach(t => {\n      initialTokensTransfers[t.address] = false\n    })\n    setTokensTransfers(initialTokensTransfers)\n  }, [selectedTokensWithAllowance, setTokensTransfers])\n\n  useEffect(() => {\n    if (hasRefusedOnce) {\n      setError('Every asset below needs to be sent to complete the migration' + (lastRefusalError ? ' (' + lastRefusalError + ')' : ''))\n    }\n  }, [hasRefusedOnce, setError, lastRefusalError])\n\n\n  //Clearing UI error if all the tokens are validated\n  useEffect(() => {\n    if (readyTokensCount() === selectedTokensWithAllowance.length) {\n      setError(null)\n    }\n  }, [readyTokensCount, selectedTokensWithAllowance, setError])\n\n  useEffect(() => {\n    if (hidden) return\n    setModalButtons(\n      <>\n        <Button\n          className={'clear'}\n          icon={<MdOutlineNavigateBefore/>}\n          onClick={() => cancelMigration()}\n        >Back</Button>\n        {\n          readyTokensCount() === getConsolidatedTokensPure(selectedTokensWithAllowance).length\n            ?\n            <Button\n              className={'primary'}\n              icon={<MdOutlineNavigateNext/>}\n              onClick={() => hideModal()}\n            >Close</Button>\n            :\n            <Button\n              className={'primary disabled'}\n              icon={<MdOutlineNavigateNext/>}\n            >Complete</Button>\n        }\n      </>\n    )\n  }, [cancelMigration, completeMigration, readyTokensCount, selectedTokensWithAllowance, setModalButtons, hidden, hideModal])\n\n  if (hidden) return <></>\n\n  return (\n    <div>\n      {\n        readyTokensCount() < getConsolidatedTokensPure(selectedTokensWithAllowance).length\n          ? <div\n            className='notification-hollow mb-3 warning'>{`${getConsolidatedTokensPure(selectedTokensWithAllowance).length - readyTokensCount()} actions left to complete the migration`}</div>\n          : <div className='notification-hollow mb-3 success'>\n            Your tokens were migrated. You can close this window\n          </div>\n      }\n      {getConsolidatedTokensPure(selectedTokensWithAllowance, tokensPermissions, tokensTransfers, tokensPendingStatus).map((item, index) => (\n        <div className='migration-asset-row' key={index}>\n          <span className='migration-asset-select-icon migration-asset-select-icon-permit'>\n            {\n              (!item.icon || failedImg.includes(item.icon)) ?\n                <GiToken size={18}/>\n                :\n                <img src={item.icon} draggable='false' alt='Token Icon' onError={(err) => {\n                  setFailedImg(failed => [...failed, item.icon])\n                }}/>\n            }\n          </span>\n          <div className='migration-asset-name'>\n            {item.name}\n          </div>\n          <div className='migration-asset-amount'>\n            {new BigNumber(item.amount).div(10 ** item.decimals).toFixed()} <span\n            className={'migration-asset-amount-usd'}>(${((item.amount) * item.rate).toFixed(2)})</span>\n          </div>\n          <div className='separator'>\n\n          </div>\n          <div>\n            {!((item.allowance && ethers.BigNumber.from(item.allowance).gte(item.amount)) || item.sent)\n              ?\n              <>\n                {(item.pending || item.signing)\n                  ? <div className={'migration-permitted warning'}><FaHourglass/> Sending...</div>\n                  :\n                  <Button className={'button-small secondary'}\n                          onClick={() => sendToken(item.address)}>\n                    Send\n                  </Button>\n                }\n              </>\n              :\n              <div className={'migration-permitted'} onClick={() => sendToken(item.address)}><FaCheck/> Sent\n              </div>\n            }\n          </div>\n        </div>\n      ))}\n    </div>\n  )\n}\n\nexport default AssetsMigrationPermitter\n","import './AssetsMigration.scss'\nimport { useCallback, useEffect, useState } from 'react'\nimport { getWallet } from 'lib/getWallet'\nimport { TextInput, Button, Loading } from 'components/common'\n\nimport { GiToken } from 'react-icons/gi'\nimport BigNumber from 'bignumber.js'\nimport { fetchGet } from 'lib/fetch'\nimport { MdOutlineNavigateNext, MdClose, MdOutlineNavigateBefore } from 'react-icons/md'\n\nconst AssetsMigrationNative = ({\n  identityAccount,\n  signer,\n  signerExtra,\n  network,\n  nativeTokenData,\n  setSelectedTokensWithAllowance,\n  selectedTokensWithAllowance,\n  setError,\n  setStep,\n  hasERC20Tokens,\n  hideModal,\n  relayerURL,\n  setModalButtons,\n  setBeforeCloseModalHandler,\n  gasSpeed,\n  hidden,\n}) => {\n\n  const [failedImg, setFailedImg] = useState([])\n  const [hasMigratedNative, setHasMigratedNative] = useState(false)\n  const [isMigrationPending, setIsMigrationPending] = useState(false)\n  const [nativeAmount, setNativeAmount] = useState('0')\n  const [maxRecommendedAmount, setMaxRecommendedAmount] = useState(null)\n  const [transactionEstimationCost, setTransactionEstimationCost] = useState('0')\n  const [nativeHumanAmount, setNativeHumanAmount] = useState('0')\n\n  const [hasModifiedAmount, setHasModifiedAmount] = useState(false)\n\n  const [currentGasPrice, setCurrentGasPrice] = useState(null)\n\n  let wallet\n  try {\n    wallet = getWallet({\n      signer: signer,\n      signerExtra: signerExtra,\n      chainId: network.chainId\n    })\n  } catch (err) {\n    // in case of no window.ethereum was injected from extension\n    setError('No Web3 wallet connected. Please connect a Web3 wallet and reload the page')\n  }\n\n  //going back to assets selection\n  const cancelMigration = useCallback(() => {\n    setStep(0)\n    setSelectedTokensWithAllowance([])\n  }, [setSelectedTokensWithAllowance, setStep])\n\n  const continueMigration = useCallback(() => {\n    setStep(2)\n  }, [setStep])\n\n  const erc20TransfersCount = (selectedTokensWithAllowance) => {\n    return selectedTokensWithAllowance.filter(t => t.selected && !t.permittable && !t.native).length\n  }\n\n  //Pops MM modal to send native to Identity\n  const migrateNative = useCallback(async () => {\n    if (!wallet) return\n    setError(null)\n    setIsMigrationPending(true)\n\n    if (!hasERC20Tokens) {\n      setBeforeCloseModalHandler(null)\n    }\n\n    let hasCorrectChainAndAccount = await wallet.isConnected(signer.address, network.chainId).catch(e => {\n      setError('Could not check signer connection status: ' + e.error)\n    })\n\n    if (hasCorrectChainAndAccount) {\n      wallet.sendTransaction({\n        from: signer.address,\n        to: identityAccount,\n        gasLimit: 25000 + (network.id === 'arbitrum' ? 200000 : 0),\n        gasPrice: currentGasPrice,\n        value: '0x' + new BigNumber(nativeAmount).toString(16),\n        chainId: network.chainId\n      }).then(async rcpt => {\n        await rcpt.wait()\n        setHasMigratedNative(true)\n        setIsMigrationPending(false)\n        return true\n      }).catch(err => {\n        setHasMigratedNative(false)\n        setIsMigrationPending(false)\n\n        if (err && err.message.includes('must provide an Ethereum address')) {\n          setError(`Make sure your wallet is unlocked and connected with ${signer.address}.`)\n        } else {\n          setError('Native asset migration failed: ' + err.message)\n        }\n\n        return false\n      })\n    } else {\n      setError(<>Please make sure your signer wallet is unlocked, and connected with <b>{signer.address}</b> to the correct chain: <b>{network.id}</b></>)\n      setIsMigrationPending(false)\n    }\n  }, [wallet, setError, hasERC20Tokens, network, setBeforeCloseModalHandler, signer, identityAccount, nativeAmount, currentGasPrice])\n\n  const updateAmount = useCallback((amount) => {\n    let newHumanAmount = new BigNumber(amount).dividedBy(10 ** nativeTokenData.decimals).toFixed(nativeTokenData.decimals).replace(/\\.?0+$/g, '')\n\n    setNativeHumanAmount(newHumanAmount)\n    setNativeAmount(amount)\n    setHasModifiedAmount(true)\n  }, [nativeTokenData])\n\n  useEffect(() => {\n    const url = `${relayerURL}/gasPrice/${network.id}`\n\n    fetchGet(url).then(gasData => {\n      let gasPrice = gasData.data.gasPrice[gasSpeed]\n      if (gasData.data.gasPrice.maxPriorityFeePerGas) {\n        gasPrice += gasData.data.gasPrice.maxPriorityFeePerGas[gasSpeed]\n      }\n      const nativeTransactionCost = gasPrice * 25000\n\n      const regularTransfersCount = erc20TransfersCount(selectedTokensWithAllowance)\n      const transfersTransactionCost = regularTransfersCount * gasPrice * (25000 + 52000)\n\n      setTransactionEstimationCost(new BigNumber((nativeTransactionCost + transfersTransactionCost).toFixed(0)).toFixed(0))\n      const recommendedBN = new BigNumber(nativeTokenData.availableBalance).minus((nativeTransactionCost + transfersTransactionCost))\n      setMaxRecommendedAmount(recommendedBN.gte(0) ? recommendedBN.toFixed(0) : 0)\n      setCurrentGasPrice(gasPrice)\n    }).catch(err => {\n      setError(err.message + ' ' + url)\n    })\n\n  }, [setTransactionEstimationCost, setMaxRecommendedAmount, nativeTokenData, network, relayerURL, setError, gasSpeed, selectedTokensWithAllowance])\n\n  const onAmountChange = useCallback((val) => {\n    setHasModifiedAmount(true)\n    if (val === '') {\n      setNativeHumanAmount(0)\n      setNativeAmount(0)\n      return\n    }\n    if (\n      (val.endsWith('.') && val.split('.').length === 2)\n      || (val.split('.').length === 2 && val.endsWith('0'))\n    ) {\n      setNativeHumanAmount(val)\n      return\n    }\n\n    if (!isNaN(val)) {\n      let newHumanAmount = new BigNumber(val).toFixed(nativeTokenData.decimals)\n      if (new BigNumber(newHumanAmount).multipliedBy(10 ** nativeTokenData.decimals).comparedTo(nativeTokenData.availableBalance) === 1) {\n        newHumanAmount = new BigNumber(nativeTokenData.availableBalance).dividedBy(10 ** nativeTokenData.decimals).toFixed(nativeTokenData.decimals)\n      }\n      //trim trailing . or 0\n      newHumanAmount = newHumanAmount.replace(/\\.?0+$/g, '')\n\n      setNativeHumanAmount(newHumanAmount)\n      setNativeAmount(new BigNumber(newHumanAmount).multipliedBy(10 ** nativeTokenData.decimals).toFixed(0))\n    }\n  }, [nativeTokenData])\n\n  useEffect(() => {\n    const initialHumanAmount = new BigNumber(nativeTokenData.amount).dividedBy(10 ** nativeTokenData.decimals).toFixed(nativeTokenData.decimals).replace(/\\.?0+$/g, '')\n    setNativeHumanAmount(initialHumanAmount)\n    setNativeAmount(nativeTokenData.amount)\n  }, [nativeTokenData])\n\n  useEffect(() => {\n    if (hidden) return\n    const getDisplayedButtons = () => {\n      let buttons = []\n      if (hasMigratedNative) {\n        if (hasERC20Tokens) {\n          buttons.push(<Button\n            icon={<MdOutlineNavigateNext/>}\n            className={'primary full'}\n            onClick={() => continueMigration()}\n          >Next</Button>)\n        } else {\n          buttons.push(<Button\n            icon={<MdClose/>}\n            className={'primary full'}\n            onClick={() => hideModal()}\n          >Close</Button>)\n        }\n      } else if (!wallet) { // will have to restart the process anyway as web3.ethereum is not injected (not to confuse with not unlocked)\n        buttons.push(<Button\n          icon={<MdClose/>}\n          className={'clear full'}\n          onClick={() => hideModal()}\n        >Close</Button>)\n      } else {\n        buttons.push(<Button\n          icon={<MdOutlineNavigateBefore/>}\n          className={'clear'}\n          onClick={() => cancelMigration()}\n          key='0'\n        >Back</Button>)\n\n        if (isMigrationPending) {\n          buttons.push(<Button\n            icon={<Loading/>}\n            className={'primary disabled'}\n            key='1'\n          >Moving {nativeTokenData.name}...</Button>)\n        } else {\n          buttons.push(<Button\n            icon={<MdOutlineNavigateNext/>}\n            className={'primary'}\n            onClick={() => migrateNative()}\n            key='1'\n          >Move {nativeTokenData.name}</Button>)\n        }\n      }\n      return buttons\n    }\n\n    setModalButtons(getDisplayedButtons())\n  }, [hasMigratedNative, hasERC20Tokens, setModalButtons, hideModal, isMigrationPending, cancelMigration, migrateNative, continueMigration, wallet, nativeTokenData, hidden])\n\n  if (hidden) return <></>\n\n  return (\n    <div>\n\n      {\n        wallet &&\n        <>\n          <div className={'migration-native-title mb-4'}>\n            <div className='migration-native-asset-icon'>\n              {\n                failedImg.includes(nativeTokenData.icon) ?\n                  <GiToken size={64}/>\n                  :\n                  <img src={nativeTokenData.icon} draggable='false' alt='Token Icon' onError={(err) => {\n                    setFailedImg(failed => [...failed, nativeTokenData.icon])\n                  }}/>\n              }\n            </div>\n            <div className='migration-native-title-asset-name'>Migrate native asset <b>{nativeTokenData.name}</b></div>\n          </div>\n\n          {\n            hasMigratedNative\n              ?\n              <>\n                <div className={'small-asset-notification success'}>Migration of your {nativeTokenData.name} was\n                  successful\n                </div>\n              </>\n              :\n              <>\n                <div className={'migration-native-row'}>\n                  <span className={'migration-native-row-key'}>\n                    Current balance\n                  </span>\n                  <span className={'migration-native-selection'}\n                        onClick={() => updateAmount(nativeTokenData.availableBalance)}>\n                    {new BigNumber(nativeTokenData.availableBalance).dividedBy(10 ** nativeTokenData.decimals).toFixed(6)} {nativeTokenData.name}\n                  </span>\n                </div>\n\n                <div className={'migration-native-row'}>\n                  <span className={'migration-native-row-key'}>Amount to migrate</span>\n                  {\n                    (hasModifiedAmount || (maxRecommendedAmount !== null && nativeAmount > maxRecommendedAmount))\n                      ?\n                      <TextInput\n                        className={'migrate-amount-input'}\n                        value={nativeHumanAmount}\n                        onChange={onAmountChange}\n                      />\n                      :\n                      <div>{nativeHumanAmount}</div>\n                  }\n                </div>\n\n                {\n                  maxRecommendedAmount !== null && new BigNumber(nativeAmount).gt(maxRecommendedAmount) &&\n                  <div className={'notification-hollow warning mt-4'}>\n                    <div>\n                      {\n                        !!erc20TransfersCount(selectedTokensWithAllowance)\n                          ? 'Signer transactions cost'\n                          : 'Current Transaction cost'\n                      }\n                      :\n                      ~{new BigNumber(transactionEstimationCost).dividedBy(10 ** nativeTokenData.decimals).toFixed(6)} {nativeTokenData.name}\n                      <span\n                        className={'migration-native-usd'}> (${new BigNumber(transactionEstimationCost).multipliedBy(nativeTokenData.rate).toFixed(2)})</span>\n                    </div>\n\n                    <div className={'mt-3 mb-3'}>\n                      {\n                        maxRecommendedAmount > 0\n                          ?\n                          <>\n                            <span>You should migrate up to </span>\n                            <span className={'migration-native-selection'} onClick={() => updateAmount(maxRecommendedAmount)}>\n                              {new BigNumber(maxRecommendedAmount).dividedBy(10 ** nativeTokenData.decimals).toFixed(6)} {nativeTokenData.name}\n                            </span>\n                            <span> because will you need funds to pay the transaction costs.</span>\n                          </>\n                          :\n                          <span>You do not have enough funds to pay the transaction fee.</span>\n                      }\n                    </div>\n                  </div>\n                }\n\n                {\n                  (isMigrationPending && hasERC20Tokens) &&\n                  <div className={'notification-hollow info mt-4'}>\n                    Waiting for the transaction to be mined before continuing migration...\n                  </div>\n                }\n                {\n                  (isMigrationPending && !hasERC20Tokens) &&\n                  <div className={'notification-hollow info mt-4'}>\n                    The amount of {nativeTokenData.name} will be updated in your wallet, once the transaction has been\n                    confirmed and mined.\n                    If you confirmed your transaction, you can already close this window\n                  </div>\n                }\n              </>\n          }\n        </>\n      }\n    </div>\n  )\n}\n\nexport default AssetsMigrationNative\n","import './AssetsMigration.scss'\nimport { useEffect, useState } from 'react'\nimport AssetsMigrationSelector from './AssetsMigrationSelector'\nimport AssetsMigrationPermitter from './AssetsMigrationPermitter'\nimport AssetsMigrationNative from './AssetsMigrationNative'\nimport { PERMITTABLE_COINS } from 'consts/permittableCoins'\nimport { MdClose, MdOutlineNavigateBefore } from 'react-icons/md'\nimport { Button } from 'components/common'\n\nconst AssetsMigration = ({ addRequest, selectedAccount, accounts, network, hideModal, relayerURL, portfolio, setModalButtons, setModalSteps, setBeforeCloseModalHandler }) => {\n\n  const [selectedTokensWithAllowance, setSelectedTokensWithAllowance] = useState([])\n  const [nativeTokenData, setNativeTokenData] = useState(null)\n  const [hasERC20Tokens, setHasERC20Tokens] = useState(false)\n\n  const [isSelectionConfirmed, setIsSelectionConfirmed] = useState(false)\n  const [step, setStep] = useState(0)\n  const [stepperSteps, setStepperSteps] = useState([])\n  const [error, setError] = useState(null)\n\n  const [showCloseConfirmation, setShowCloseConfirmation] = useState(false)\n\n  const [gasSpeed, setGasSpeed] = useState(null)\n\n\n  //to get signer\n  const currentAccount = accounts.find(a => a.id === selectedAccount)\n\n  //clear error and reset tokens\n  useEffect(() => {\n    if (step === 0) {\n      setError(null)\n      setSelectedTokensWithAllowance([])\n      setNativeTokenData(null)\n      setHasERC20Tokens(false)\n      setGasSpeed(null)\n      setBeforeCloseModalHandler(null)\n    }\n  }, [network, selectedAccount, step, setBeforeCloseModalHandler])\n\n  useEffect(() => {\n    if (isSelectionConfirmed) {\n      setIsSelectionConfirmed(false)\n\n      //the non permittable, promise wait all\n      setNativeTokenData(selectedTokensWithAllowance.find(t => t.native))\n      setHasERC20Tokens(!!selectedTokensWithAllowance.find(t => !t.native))\n    }\n  }, [isSelectionConfirmed, currentAccount, selectedTokensWithAllowance, network, selectedAccount])\n\n  useEffect(() => {\n    let stepIndex = step\n\n    if (step > 0 && !nativeTokenData) {\n      stepIndex -= 1\n    }\n\n    setModalSteps({\n      steps: stepperSteps.map(s => ({ name: s })),\n      stepIndex\n    })\n  }, [nativeTokenData, setModalSteps, step, stepperSteps])\n\n  useEffect(() => {\n    const beforeCloseHandle = () => {\n      setShowCloseConfirmation(true)\n      setModalButtons([\n        (<Button\n          icon={<MdOutlineNavigateBefore/>}\n          className={'clear buttonComponent'}\n          onClick={() => setShowCloseConfirmation(false)}\n          key='0'\n        >Back</Button>),\n        (<Button\n          icon={<MdClose/>}\n          className={'danger buttonComponent'}\n          onClick={() => hideModal()}\n          key='1'\n        >Close</Button>)\n      ])\n    }\n\n    if (step > 0) {\n      setBeforeCloseModalHandler(() => beforeCloseHandle)\n    }\n  }, [step, setBeforeCloseModalHandler, setModalButtons, hideModal, showCloseConfirmation])\n\n  return (\n    <div>\n      {\n        error && <div className={'mt-3 error'}>{error}</div>\n      }\n      <div id='assets-migration'>\n        {\n          showCloseConfirmation &&\n          <div className='notification-hollow warning mt-4'>\n            By closing this window, your progress will be lost. Are you sure you want to close this window?\n          </div>\n        }\n        {\n          step === 0 && <AssetsMigrationSelector\n            hidden={showCloseConfirmation}\n            signerAccount={currentAccount.signer.address}\n            identityAccount={selectedAccount}\n            network={network}\n            PERMITTABLE_COINS={PERMITTABLE_COINS}\n            setIsSelectionConfirmed={setIsSelectionConfirmed}\n            setStep={setStep}\n            portfolio={portfolio}\n            relayerURL={relayerURL}\n            setModalButtons={setModalButtons}\n            hideModal={hideModal}\n            setError={setError}\n            setSelectedTokensWithAllowance={setSelectedTokensWithAllowance}\n            setStepperSteps={setStepperSteps}\n            setGasSpeed={setGasSpeed}\n          />\n        }\n        {step === 1 && nativeTokenData &&\n          <AssetsMigrationNative\n            hidden={showCloseConfirmation}\n            signer={currentAccount.signer}\n            identityAccount={selectedAccount}\n            network={network}\n            addRequest={addRequest}\n            signerExtra={currentAccount.signerExtra}\n            setError={setError}\n            nativeTokenData={nativeTokenData}\n            hideModal={hideModal}\n            setStep={setStep}\n            relayerURL={relayerURL}\n            hasERC20Tokens={hasERC20Tokens}\n            setModalButtons={setModalButtons}\n            setSelectedTokensWithAllowance={setSelectedTokensWithAllowance}\n            selectedTokensWithAllowance={selectedTokensWithAllowance}\n            setBeforeCloseModalHandler={setBeforeCloseModalHandler}\n            gasSpeed={gasSpeed}\n          />\n        }\n        {step === 2 &&\n          <AssetsMigrationPermitter\n            hidden={showCloseConfirmation}\n            signer={currentAccount.signer}\n            identityAccount={selectedAccount}\n            network={network}\n            addRequest={addRequest}\n            PERMITTABLE_COINS={PERMITTABLE_COINS}\n            signerExtra={currentAccount.signerExtra}\n            setError={setError}\n            selectedTokensWithAllowance={selectedTokensWithAllowance}\n            hideModal={hideModal}\n            setStep={setStep}\n            setModalButtons={setModalButtons}\n            gasSpeed={gasSpeed}\n            relayerURL={relayerURL}\n          />\n        }\n      </div>\n    </div>\n  )\n}\n\nexport default AssetsMigration\n","import './AssetsMigrationModal.scss'\n\nimport { useModals } from 'hooks'\nimport { Modal, Stepper } from 'components/common'\n\nimport AssetsMigration from 'components/Wallet/AssetsMigration/AssetsMigration'\nimport { useState } from 'react'\n\nconst AssetsMigrationModal = ({ addRequest, selectedAccount, selectedNetwork, accounts, relayerURL, portfolio }) => {\n  const { hideModal, setBeforeCloseModalHandler } = useModals()\n\n  const [modalButtons, setModalButtons] = useState(null)\n  const [modalSteps, setModalSteps] = useState({ steps: [], stepIndex: 0})\n\n  const getModalTitle = () => {\n    return (<div>\n      <span>Migrate Assets</span>\n      <Stepper steps={modalSteps.steps} currentStep={modalSteps.stepIndex} noLabels={false}/>\n    </div>)\n  }\n\n  return (\n    <Modal id='asset-migration-modal' title={getModalTitle()} buttons={modalButtons} >\n      <AssetsMigration\n        addRequest={addRequest}\n        selectedAccount={selectedAccount}\n        network={selectedNetwork}\n        accounts={accounts}\n        hideModal={hideModal}\n        relayerURL={relayerURL}\n        portfolio={portfolio}\n        setModalButtons={setModalButtons}\n        setModalSteps={setModalSteps}\n        setBeforeCloseModalHandler={setBeforeCloseModalHandler}\n      />\n    </Modal>\n  )\n}\n\nexport default AssetsMigrationModal\n","import './AssetsMigration.scss'\nimport assetMigrationDetector from 'lib/assetMigrationDetector'\nimport AssetsMigrationModal from 'components/Modals/AssetsMigrationModal/AssetsMigrationModal'\nimport { useCallback, useEffect, useState } from 'react'\nimport { useModals } from 'hooks'\nimport { FaTimes } from 'react-icons/fa'\nimport { getWallet } from 'lib/getWallet'\n\nconst AssetsMigrationBanner = ({ addRequest, selectedAccount, accounts, selectedNetwork, relayerURL, portfolio, closeable = false, linkMargin = false, useStorage }) => {\n\n  const [hasSignerAssets, setHasSignerAssets] = useState(false)\n  const [migrationMessageSeen, setMigrationMessageSeen] = useState(false)\n  const { showModal } = useModals()\n  const [migrationMessageSeenStorage, setMigrationMessageSeenStorage] = useStorage({key: 'migrationSeen', defaultValue:{}})\n\n  // in the meantime that we integrate HW wallets...\n  const currentAccount = accounts.find(a => a.id === selectedAccount)\n  let wallet\n  try {\n    wallet = getWallet({\n      signer: currentAccount.signer,\n      signerExtra: currentAccount.signerExtra,\n      chainId: selectedNetwork.chainId\n    })\n  } catch (err) {\n    // in case of no window.ethereum was injected from extension\n  }\n\n  const closeMigrationMessage = useCallback(() => {\n    setMigrationMessageSeen(true)\n    setMigrationMessageSeenStorage((old) => {\n      old[selectedAccount + selectedNetwork.id] = true\n      return old\n    })\n  }, [selectedAccount, selectedNetwork, setMigrationMessageSeenStorage])\n\n  //fetching relevant assets\n  useEffect(() => {\n    let unmounted = false\n\n    setHasSignerAssets(false)\n    const checkSignerAssets = ({ networkId, identityAccount, accounts }) => {\n      const currentAccount = accounts.find(a => a.id === identityAccount)\n      if (!currentAccount.signer) return\n\n      assetMigrationDetector({ networkId: networkId, account: currentAccount.signer.address }).then(assets => {\n        if (unmounted) return\n        const relevantAssets = assets.filter(a => a.balanceUSD > 0.001)\n        setHasSignerAssets(!!relevantAssets.length)\n      }).catch(err => {\n        console.error(err)\n      })\n    }\n\n    checkSignerAssets({ identityAccount: selectedAccount, networkId: selectedNetwork.id, accounts })\n\n    return () => unmounted = true\n  }, [selectedAccount, selectedNetwork, accounts])\n\n  //checking if closable message has been seen(closed) or not\n  useEffect(() => {\n    setMigrationMessageSeen(closeable && !!migrationMessageSeenStorage[selectedAccount + selectedNetwork.id])\n  }, [closeable, selectedAccount, selectedNetwork, migrationMessageSeenStorage])\n  \n  // We either have a provider (web3) or we use a supported HW wallet\n  const supportedHWWalletTypes = ['ledger', 'trezor', 'Lattice']\n  const shouldShow = wallet?.provider|| (currentAccount.signerExtra && supportedHWWalletTypes.includes(currentAccount.signerExtra.type))\n  if (!shouldShow) return (<></>)\n\n  return (\n    (hasSignerAssets && !migrationMessageSeen) &&\n    <div className={'migration-banner'}>\n      <div className='migration-banner-message'>\n        <div>We detected that your signer account has tokens that can be transferred to your Ambire account. We recommend doing this in order to maximize your $WALLET rewards.</div>\n        <span className={'link' + (linkMargin ? ' link-margin' : '')} onClick={() => {\n          showModal(<AssetsMigrationModal\n            addRequest={addRequest}\n            selectedNetwork={selectedNetwork}\n            selectedAccount={selectedAccount}\n            accounts={accounts}\n            relayerURL={relayerURL}\n            portfolio={portfolio}\n          />)\n        }}>Click here to migrate those tokens</span>\n      </div>\n      {\n        closeable &&\n        <div className={'migration-banner-close'}><FaTimes onClick={() => closeMigrationMessage()}/></div>\n      }\n    </div>\n  )\n}\n\nexport default AssetsMigrationBanner\n"],"sourceRoot":""}