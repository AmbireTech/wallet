{"version":3,"sources":["components/SendTransaction/FeeSelector.js","components/SendTransaction/Actions.js","components/SendTransaction/noRelayer.js","components/SendTransaction/SendTransaction.js","../node_modules/adex-protocol-eth/js/ensureTypes.js","../../src/bytes.ts","lib/icons.js","lib/formatters.js","../node_modules/adex-protocol-eth/node_modules/ethereumjs-abi/index.js","../../src/secp256k1v3-adapter.ts","../../src/hash.ts","lib/lattice.js","lib/getWallet.js","lib/ledgerWebHID.js","../node_modules/adex-protocol-eth/js/Bundle.js","../node_modules/adex-protocol-eth/js/index.js","../node_modules/adex-protocol-eth/js/Channel.js","../node_modules/adex-protocol-eth/js/Withdraw.js","../node_modules/adex-protocol-eth/js/MerkleTree.js","../node_modules/adex-protocol-eth/js/splitSig.js","../node_modules/adex-protocol-eth/js/UnbondCommitment.js","../node_modules/adex-protocol-eth/js/Permit.js","../node_modules/adex-protocol-eth/node_modules/ethereumjs-abi/lib/index.js","../../src/index.ts","../../../src/secp256k1v3-lib/index.ts","../../../src/secp256k1v3-lib/der.ts","../../src/constants.ts","../../src/account.ts","../../src/signature.ts","../../src/object.ts","components/SendTransaction/helpers.js","components/common/TxnPreview/TxnPreview.js","../node_modules/ambire-common/src/services/requestToBundleTxn/requestToBundleTxn.ts"],"names":["SPEEDS","walletDiscountBlogpost","DISCOUNT_TOKENS_SYMBOLS","getBalance","token","balance","decimals","priceInUSD","WalletDiscountBanner","currenciesItems","tokens","estimation","onFeeCurrencyChange","onDismiss","feeSpeed","isGasTankEnabled","network","selectedFeeToken","symbol","includes","discount","walletDiscountTokens","filter","x","isTokenEligible","sort","a","b","parseInt","indexOf","length","discountToken","eligibleWalletToken","find","value","address","action","actionTxt","showSwap","className","href","target","rel","onClick","mini","to","FeeSelector","disabled","signer","setEstimation","setFeeSpeed","useState","editCustomFee","setEditCustomFee","insufficientFee","feeInUSD","success","checkIfDAppIncompatible","message","title","FailingTxn","mapTxnErrMsg","tooltip","getErrHint","feeInNative","gasLimit","nativeAssetSymbol","remainingFeeTokenBalances","nativePrice","gasTankTokens","gasTank","map","nativeAssetPriceInUSD","item","nativeRate","price","toUpperCase","ethers","utils","parseUnits","toFixed","toString","label","localeCompare","tokenNetwork","icon","rest","getTokenIcon","id","extra","feeCurrencySelect","defaultValue","items","onChange","setCustomFee","prevEstimation","customFee","sufficientSpeeds","speed","i","highestSufficientSpeed","checkIsSelectorDisabled","feeAmountSelectors","isETH","getFeesData","feeInFeeToken","discountInFeeToken","getDiscountApplied","discountInFeeInUSD","baseFeeInFeeToken","baseFeeInFeeUSD","showInUSD","selectFeeSpeed","formatFloatTokenAmount","savedGas","minFee","minFeeUSD","maxFee","maxFeeUSD","discountMin","discountMax","discountInUSD","discountBaseMinInUSD","discountBaseMaxInUSD","baseFeeInUSD","baseMinFee","baseMaxFee","baseMinFeeUSD","baseMaxFeeUSD","isUnderpriced","isNaN","parseFloat","isOverpriced","join","isGasTankAvailable","small","placeholder","textOnly","balanceInUSD","Actions","approveTxn","rejectTxn","cancelSigning","signingStatus","code","passphrase","quickAccCredentials","setQuickAccCredentials","useEffect","prev","form","useRef","rejectButton","danger","type","signButtonLabel","inProgress","isRecoveryMode","finalBundle","recoveryMode","quickAcc","confCodeRequired","ref","onSubmit","e","preventDefault","password","required","minLength","style","visibility","pattern","autoComplete","maxLength","clear","current","checkValidity","IdentityInterface","Interface","require","FactoryInterface","sendNoRelayer","account","wallet","provider","quickAccManager","Error","getCode","identity","then","data","encodeFunctionData","txns","getNonce","sign","identityFactoryAddr","bytecode","salt","signature","estimateGas","from","toNumber","hexlify","Math","floor","getTransactionCount","txn","gas","gasPrice","nonce","sendTransaction","signTransaction","signed","txId","hash","getNetwork","chainId","name","ERC20","REJECT_MSG","WALLET_TOKEN_SYMBOLS","isInt","getDefaultFeeToken","currentAccGasTankState","getErrorMessage","SendTransaction","relayerURL","accounts","selectedAcc","requests","resolveMany","replacementBundle","replaceByDefault","mustReplaceNonce","onBroadcastedTxn","gasTankState","eligibleRequests","useMemo","toLowerCase","bundle","networkId","Bundle","toBundleTxn","Array","isArray","extraGas","reduce","requestIds","some","meta","addressLabel","xWalletReq","xWallet","makeBundle","SendTransactionWithBundle","isEnabled","replaceTx","setReplaceTx","setSigningStatus","addToast","useToasts","console","error","isMounted","currentBundle","unmounted","reestimate","estimate","fetch","replacing","minFeeInUSDPerGas","getNextNonce","estimateNoRelayer","getProvider","relayerless","catch","log","intvl","setInterval","clearInterval","getFinalBundle","useCallback","feeToken","addedGas","feeTxn","accountPresets","feeCollector","toHexAmount","nextFreeNonce","nextNonce","nextNonMinedNonce","fToken","gasTankFee","assetId","approveTxnImpl","getWallet","signerExtra","submit","approveTxnImplQuickAcc","canSkip2FA","fetchPost","primaryKeyBackup","undefined","Promise","resolve","setTimeout","pwd","alert","Wallet","fromEncryptedJson","JSON","parse","signatureTwo","accountAvatar","blockies","seed","toDataURL","canProceed","size","isFirstFailing","firstFailing","min","Date","now","TxnPreview","minute","disableDismiss","disableDismissLabel","backgroundImage","networkIconsById","pendingBundle","checked","isDeployed","timeout","bundleResult","match","result","BN","Address","startsWith","Bytes32","Buffer","slice","isBuffer","module","exports","Uint256","bn","isNeg","Bytes","Bytes32Array","bytes32Array","Channel","channel","leader","follower","guardian","tokenAddr","bytes","v","customIcons","zapperStorageTokenIcons","addr","net","amount","useGrouping","maximumFractionDigits","minimumFractionDigits","toLocaleString","max","err","Uint8Array","publicKey","createHash","crypto","HARDENED_OFFSET","getAddressesReqOpts","startPath","n","latticeInit","commKey","clientConfig","privKey","Client","latticeConnect","client","deviceId","reject","connect","isPaired","errConnect","latticePair","secret","pair","hasActiveWallet","errPair","latticeGetAddresses","getAddresses","res","errGetAddresses","latticeSignMessage","dataMsg","protocol","payload","signerPath","signOptsMsg","currency","signedTx","signedMsg","sig","r","s","errSignMessage","latticeSignMessage712","reqData","latticeSignTransaction","unsignedTxObj","txData","useEIP155","signOpts","serializedSigned","serialize","errSignTxn","wallets","opts","one","getWalletNew","providerTrezor","TrezorSubprovider","trezorConnectClientApi","TrezorConnect","_initialDerivedKeyInfo","hdKey","HDNode","fromExtendedKey","info","xpub","derivationPath","baseDerivationPath","getInitialDerivedKeyInfo","signMessage","signPersonalMessageAsync","params","signTransactionAsync","transaction","networks","broadcastProvider","isConnected","matchAddress","getAccountsAsync","addresses","_signTypedData","domain","types","domainSeparator","_TypedDataEncoder","hashDomain","hashStructMessage","hashStruct","getPrimaryType","getPayload","_initialDerivedKeyInfoAsync","initialDerivedKeyInfo","derivedKeyInfo","_findDerivedKeyInfoForAddress","path","_trezorConnectClientApi","ethereumSignTypedData","metamask_v4_compat","domain_separator_hash","message_hash","response","transportProtocol","ledgerSignMessage","ledgerSignTransaction","ledgerGetAddresses","ledgerSignMessage712","LedgerSubprovider","ledgerEthereumClientFactoryAsync","ledgerEthereumBrowserClientFactoryAsync","wrapLatticeError","window","ethereum","providers","Web3Provider","signerObject","getSigner","matchChain","listAccounts","fn","arg","apply","this","ethUtil","connectedDevices","PARENT_HD_PATH","getTransport","TransportWebHID","list","opened","open","request","transport","getAccounts","close","parentKeyDerivationPath","getAddressInternal","o","statusCode","ledgerResponse","chainCode","mainAddress","addressOfHDKey","calculateDerivedHDKeyInfos","appEth","AppEth","ledgerTimeout","timeoutHandle","race","getAddress","clearTimeout","fromAddr","serializedUnsigned","accountsData","substr","rsvResponse","intV","signerAddress","signPersonalMessage","rsvReply","signEIP712HashedMessage","count","derivedKeys","fullDerivationPath","derive","derivedKey","push","derivedPublicKey","ethereumAddressUnprefixed","publicToAddress","addHexPrefix","AbiCoder","arrayify","keccak256","Contract","BigNumber","ensure","IdentityABI","QuickAccManagerABI","args","prototype","queryParams","Object","fromEntries","entries","URLSearchParams","isSingleSigMode","encoded","getSignable","signMsg","cancel","UNPREDICTABLE_GAS_REGEX","signatureOne","abiCoder","sigInner","encode","timelock","signMsg712","userTxnBundle","getChainID","accHash","two","mapSignatureV","sigRaw","useFinalDigestSigMode","typedDataSign","nonces","url","body","headers","method","stringify","json","txParams","blockTag","estimateGasWithCatch","getErrMsg","getFeeData","feeData","baseFee","slow","medium","fast","ape","ERROR_SIG","call","returnData","decode","tx","send","signMessage712","channelLib","withdrawalLib","MerkleTree","splitSig","unbondCommitmentlLib","Permit","bundleLib","abi","freeze","arrayBuffer","rawEncode","hashHex","toSolidityTuple","hashToSign","contractAddr","balanceRoot","getSignableStateRoot","hashToSignHex","stateRoot","getResumeSignableMessage","challengeExpires","solidityPack","getResumeSignableMessageHex","channelId","getBalanceLeaf","acc","amnt","getSpenderBalanceLeaf","ChannelState","Challenged","Active","Withdraw","balanceTreeAmount","sigLeader","sigFollower","proof","combinedHash","first","second","sorted","concat","compare","getLayers","elements","layers","getNextLayer","layer","element","index","arr","_elements","every","buffers","buffer","findIndex","equals","assign","l","root","getRoot","pairIndex","getPair","inputSig","substring","UnbondCommitment","owner","shares","unlocksAt","buf","defaultAbiCoder","toUtf8Bytes","PERMIT_TYPEHASH","getDomainSeparator","tokenAddress","getApprovalDigest","approve","deadline","DOMAIN_SEPARATOR","spender","ABI","elementaryName","parseTypeN","exec","parseTypeNxM","tmp","parseTypeArray","parseNumber","isHexPrefixed","stripHexPrefix","toArray","parseSignature","split","retargs","encodeSingle","num","ret","lastIndexOf","unshift","zeros","setLengthRight","bitLength","toArrayLike","toTwos","mul","pow","decodeSingle","parsedType","offset","parseType","rawType","decoded","subArray","memoryUsage","fromTwos","mod","isZero","div","isDynamic","eventID","methodID","values","output","headLength","forEach","cur","rawDecode","parsed","simpleEncode","arguments","simpleDecode","test","solidityHexValue","bitsize","subType","replace","arraySize","arrayValues","padding","bytesize","setLengthLeft","soliditySHA3","soliditySHA256","sha256","solidityRIPEMD160","ripemd160","fromSerpent","c","j","toSerpent","__exportStar","lenbyte","zeroAddress","self","assert","getAddedGas","contractErrors","msg","contractMsg","round","multiplier","getFeePaymentConsequences","discountMultiplier","totalMultiplier","isCrossChainNativeSelected","getNetworkSymbol","mined","disableExpand","useConstants","constants","tokenList","humanizerInfo","isExpanded","setExpanded","contractName","getName","networkDetails","summary","getTransactionSummary","extended","entry","explorerUrl","stopPropagation","canShowLink","parseExtendedSummaryItem","setKnownAddressNames","isKnown","formatUnits","IdentityFactory","IdentityFactoryABI","deploySalt"],"mappings":"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A,EACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,EACA,EACA,IACA,IACA,IACA,GACA,IACA,GACA,IACA,GACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,EACA,GACA,EACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,GACA,GACA,GACA,EACA,EACA,EACA,IACA,GACA,EACA,GACA,EAEA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,IAGI,EAAqC,EAAO,KAAK,CAErD,GACA,IACA,EACA,GACA,EACA,EACA,EACA,EACA,GAEA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EAEA,IACA,IACA,IACA,GACA,IACA,IACA,EACA,EACA,EACA,GACA,GACA,EACA,EACA,GACA,IACA,GACA,IACA,GACA,EACA,EACA,EACA,GACA,EACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,GACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,EACA,EACA,IACA,IACA,IACA,GACA,IACA,GACA,IACA,GACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,GACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,GACA,GACA,EACA,IACA,IACA,GACA,IACA,GACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,EACA,GACA,EACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,GACA,GACA,GACA,EACA,EACA,EACA,IACA,GACA,EACA,GACA,EAEA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,IAGF,EAAQ,iBAAmB,SACzB,EACA,EACA,sBAEE,IAAI,EAAS,EAAO,KACpB,EAAa,EAAmC,GAIhD,OAFA,EAAS,KAAK,EAAQ,EAAa,EAAI,GACvC,EAAQ,KAAK,EAAQ,EAAa,IAAM,KACnC,GAGT,EAAQ,iBAAmB,SAAS,GAChC,IAAI,EAAS,EAAW,OAGtB,EAAQ,EACV,GAAE,EAAS,EAAQ,GAA2B,KAAtB,EAAW,GAAiB,OAAO,KAI3D,GAAE,GAHF,GAAO,GAGY,KAA2B,IAApB,EAAW,IAAgB,OAAO,KAE5D,IAAI,EAA2B,IAApB,EAAW,GAEtB,GAAE,EAAO,GAAK,EAAO,EAAG,OAAO,KAC/B,GAAE,GAFF,GAAO,GAEY,EAAM,OAAO,KAGhC,IAAI,EAAM,EAAW,EAAQ,EAAO,IAAM,EAAO,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","file":"static/js/12.a78d22a7.chunk.js","sourcesContent":["import './FeeSelector.scss'\n\nimport { AiOutlineWarning } from 'react-icons/ai'\nimport { Loading, Select, ToolTip, Button, TextInput, DAppIncompatibilityWarningMsg } from 'components/common'\nimport {\n  isTokenEligible,\n  mapTxnErrMsg,\n  getErrHint,\n  getFeesData,\n  getDiscountApplied,\n  checkIfDAppIncompatible\n} from './helpers'\nimport { FaPercentage } from 'react-icons/fa'\nimport { MdInfoOutline } from 'react-icons/md'\nimport { NavLink } from 'react-router-dom'\nimport { MdEdit } from 'react-icons/md'\nimport { useState } from 'react'\nimport { getTokenIcon } from 'lib/icons'\nimport { formatFloatTokenAmount } from 'lib/formatters'\nimport { ethers } from 'ethers'\n\nconst SPEEDS = ['slow', 'medium', 'fast', 'ape']\nconst walletDiscountBlogpost = 'https://blog.ambire.com/move-crypto-with-ambire-pay-gas-with-wallet-and-save-30-on-fees-35dca1002697'\nconst OVERPRICED_MULTIPLIER = 1.2\n// NOTE: Order matters for for secondary fort after the one by discount\nconst DISCOUNT_TOKENS_SYMBOLS = ['xWALLET', 'WALLET-STAKING', 'WALLET']\n\nfunction getBalance(token) {\n  const { balance, decimals, priceInUSD } = token\n  return balance / decimals * priceInUSD\n}\n\nconst WalletDiscountBanner = ({ currenciesItems, tokens, estimation, onFeeCurrencyChange, onDismiss, feeSpeed, isGasTankEnabled, network }) => {\n  if (estimation.selectedFeeToken?.symbol\n    && (DISCOUNT_TOKENS_SYMBOLS.includes(estimation.selectedFeeToken?.symbol)\n      || estimation.selectedFeeToken.discount)\n  ) {\n    return null\n  }\n  const walletDiscountTokens = [...tokens]\n    .filter(x => DISCOUNT_TOKENS_SYMBOLS.includes(x.symbol) && x.discount && isTokenEligible(x, feeSpeed, estimation, isGasTankEnabled, network))\n    .sort((a, b) =>\n      b.discount - a.discount\n      || ((!parseInt(a.balance) || !parseInt(b.balance)) ? getBalance(b) - getBalance(a) : 0)\n      || DISCOUNT_TOKENS_SYMBOLS.indexOf(a.symbol) - DISCOUNT_TOKENS_SYMBOLS.indexOf(b.symbol)\n    )\n\n  if (!walletDiscountTokens.length) return null\n\n  const discountToken = walletDiscountTokens[0]\n\n  const { discount } = discountToken\n  const eligibleWalletToken = currenciesItems.find(x => x.value && (x.value === 'WALLET' || x.value === discountToken.address))\n  const action = !!eligibleWalletToken\n    ? () => onFeeCurrencyChange(eligibleWalletToken)\n    : null\n  //TODO: go to swap \n  const actionTxt = !!eligibleWalletToken ? `USE ${discountToken.symbol}` : `BUY ${discountToken.symbol}`\n  const showSwap = !action\n\n  return (\n    <div className='wallet-discount-banner row'>\n      <div className='row'>\n        Get {discount * 100} <FaPercentage /> fees discount with &nbsp;<strong>$WALLET</strong> &nbsp;\n        <a\n          className=\"address row\"\n          href={walletDiscountBlogpost}\n          target=\"_blank\"\n          rel=\"noreferrer noopener\">\n          <MdInfoOutline />\n        </a>\n      </div>\n      {!!action && <Button onClick={action} mini className='buttonComponent'>\n        {actionTxt}\n      </Button>}\n      {showSwap && <div className='swap-info'>\n        You can get $WALLET, just use the &nbsp;\n        <NavLink className='link' to={'/wallet/swap'} onClick={onDismiss}>\n          Swap\n        </NavLink> menu on the left!\n      </div>}\n    </div>\n  )\n}\n\nconst mapGasTankTokens = nativePrice => item => {\n  const nativeRate = item.address === '0x0000000000000000000000000000000000000000' ? null : nativePrice / item.price\n  return {\n    ...item,\n    symbol: item.symbol.toUpperCase(),\n    balance: ethers.utils.parseUnits(\n      item.balance.toFixed(item.decimals).toString(),\n      item.decimals\n    ).toString(),\n    nativeRate\n  }\n}\n\nexport function FeeSelector({ disabled, signer, estimation, network, setEstimation, feeSpeed, setFeeSpeed, onDismiss, isGasTankEnabled }) {\n  const [editCustomFee, setEditCustomFee] = useState(false)\n  if (!estimation) return (<Loading />)\n  // Only check for insufficient fee in relayer mode (.feeInUSD is available)\n  // Otherwise we don't care whether the user has enough for fees, their signer wallet will take care of it\n  const insufficientFee = estimation && estimation.feeInUSD\n    && !isTokenEligible(estimation.selectedFeeToken, feeSpeed, estimation, isGasTankEnabled, network)\n  if (estimation && !estimation.success) return (!checkIfDAppIncompatible(estimation.message) ?\n    <FailingTxn\n      message={<>The current transaction batch cannot be sent because it will fail: {mapTxnErrMsg(estimation.message)}</>}\n      tooltip={getErrHint(estimation.message)}\n    /> : <DAppIncompatibilityWarningMsg title={'Unable to send transaction'} />)\n\n  if (!estimation.feeInNative) return (<></>)\n  if (estimation && !estimation.feeInUSD && estimation.gasLimit < 40000) {\n    return (<div>\n      <b>WARNING:</b> Fee estimation unavailable when you're doing your first account transaction and you are not connected to a relayer. You will pay the fee from <b>{signer.address}</b>, make sure you have {network.nativeAssetSymbol} there.\n    </div>)\n  }\n  if (estimation && estimation.feeInUSD && !estimation.remainingFeeTokenBalances) {\n    return (<div className='balance-error'>Internal error: fee balances not available. This should never happen, please report this on help.ambire.com</div>)\n  }\n\n  const { nativeAssetSymbol } = network\n  const gasTankTokens = estimation.gasTank?.map(mapGasTankTokens(estimation.nativeAssetPriceInUSD))\n  const tokens = (isGasTankEnabled && gasTankTokens?.length)\n    ? gasTankTokens\n    // fallback to the native asset if fee tokens cannot be retrieved for wh  atever reason\n    : estimation.remainingFeeTokenBalances || [{ symbol: nativeAssetSymbol, decimals: 18, address: '0x0000000000000000000000000000000000000000' }]\n\n  const onFeeCurrencyChange = ({ value, label}) => {\n    const token = tokens.find(({ address, symbol }) => (address === value) && (symbol === label))\n    setEstimation({ ...estimation, selectedFeeToken: token })\n  }\n\n  const currenciesItems = tokens\n    // NOTE: filter by slowest and then will disable the higher fees speeds otherwise \n    // it will just hide the token from the select\n    .sort((a, b) =>\n    (isTokenEligible(b, SPEEDS[0], estimation, isGasTankEnabled, network) - isTokenEligible(a, SPEEDS[0], estimation, isGasTankEnabled, network))\n    || (DISCOUNT_TOKENS_SYMBOLS.indexOf(b.symbol) - DISCOUNT_TOKENS_SYMBOLS.indexOf(a.symbol))\n    || ((b.discount || 0) - (a.discount || 0))\n    || a?.symbol.toUpperCase().localeCompare(b?.symbol.toUpperCase())\n  )\n    .map(({ address, symbol, discount, network: tokenNetwork, icon, ...rest }) => ({\n      disabled: !isTokenEligible({address, symbol, discount, ...rest }, SPEEDS[0], estimation, isGasTankEnabled, network),\n      icon: icon || (address ? getTokenIcon(isGasTankEnabled ? tokenNetwork : network.id, address) : null),\n      label: symbol,\n      value: address || symbol,\n      ...(discount ? {\n        extra: <div className='discount'> - {discount * 100} <FaPercentage /> </div>\n      } : {})\n    }))\n\n  const feeCurrencySelect = estimation.feeInUSD ? (<>\n    <div className='section'>\n      <div className='section-title'>Fee Currency</div>\n      <Select\n        className=\"fee-select\"\n        disabled={disabled}\n        defaultValue={estimation.selectedFeeToken?.address || estimation.selectedFeeToken?.symbol}\n        items={currenciesItems}\n        onChange={onFeeCurrencyChange}\n      />\n    </div>\n  </>) : (<></>)\n\n  const { discount = 0, symbol, nativeRate = null, decimals } = estimation.selectedFeeToken || {}\n\n  const setCustomFee = value => setEstimation(prevEstimation => ({\n    ...prevEstimation,\n    customFee: value\n  }))\n\n  const selectFeeSpeed = speed => {\n    setFeeSpeed(speed)\n    setCustomFee(null)\n    setEditCustomFee(false)\n  }\n\n  if (insufficientFee) {\n    const sufficientSpeeds = SPEEDS.filter((speed, i) => isTokenEligible(estimation.selectedFeeToken, speed, estimation, isGasTankEnabled, network))\n    const highestSufficientSpeed = sufficientSpeeds[sufficientSpeeds.length - 1]\n    setFeeSpeed(highestSufficientSpeed)\n  }\n\n  const checkIsSelectorDisabled = speed => {\n    const insufficientFee = !isTokenEligible(estimation.selectedFeeToken, speed, estimation, isGasTankEnabled, network)\n    return disabled || insufficientFee\n  }\n\n  const feeAmountSelectors = SPEEDS.map(speed => {\n    const isETH = symbol === 'ETH' && nativeAssetSymbol === 'ETH'\n    const {\n      feeInFeeToken,\n      feeInUSD,\n      // NOTE: get the estimation res data w/o custom fee for the speeds\n    } = getFeesData({ ...estimation.selectedFeeToken }, { ...estimation, customFee: null }, speed, isGasTankEnabled, network)\n    const discountInFeeToken = getDiscountApplied(feeInFeeToken, discount)\n    const discountInFeeInUSD = getDiscountApplied(feeInUSD, discount)\n\n    const baseFeeInFeeToken = feeInFeeToken + discountInFeeToken\n    const baseFeeInFeeUSD = feeInUSD ? feeInUSD + discountInFeeInUSD : null\n\n    const showInUSD = (nativeRate !== null) && baseFeeInFeeUSD\n\n    return (\n      <div\n        key={speed}\n        className={`feeSquare${!estimation.customFee && feeSpeed === speed ? ' selected' : ''}${checkIsSelectorDisabled(speed) ? ' disabled' : ''}`}\n        onClick={() => !checkIsSelectorDisabled(speed) && selectFeeSpeed(speed)}\n      >\n        {!!discount && <FaPercentage className='discount-badge' />}\n        <div className='speed'>{speed}</div>\n        <div className='feeEstimation'>\n          {(isETH ? 'Ξ ' : '')\n            + (showInUSD ? `$${formatFloatTokenAmount(baseFeeInFeeUSD, true, 4)}` : formatFloatTokenAmount(baseFeeInFeeToken, true, decimals))\n            + (!isETH && !showInUSD ? ` ${estimation.selectedFeeToken.symbol}` : '')\n          }\n        </div>\n        {!isETH && !showInUSD && <div className='feeEstimation symbol'>\n          {estimation.selectedFeeToken.symbol}\n        </div>}\n      </div>\n    )\n  })\n\n  const {\n    feeInFeeToken,\n    feeInUSD,\n    savedGas,\n  } = getFeesData(estimation.selectedFeeToken, estimation, feeSpeed, isGasTankEnabled, network)\n\n  const {\n    feeInFeeToken: minFee,\n    feeInUSD: minFeeUSD,\n  } = getFeesData({ ...estimation.selectedFeeToken }, { ...estimation, customFee: null }, 'slow', isGasTankEnabled, network)\n\n  const {\n    feeInFeeToken: maxFee,\n    feeInUSD: maxFeeUSD,\n  } = getFeesData({ ...estimation.selectedFeeToken }, { ...estimation, customFee: null }, 'ape', isGasTankEnabled, network)\n\n  const discountMin = getDiscountApplied(minFee, discount)\n  const discountMax = getDiscountApplied(maxFee, discount)\n\n  const discountInFeeToken = getDiscountApplied(feeInFeeToken, discount)\n  const discountInUSD = getDiscountApplied(feeInUSD, discount)\n  const discountBaseMinInUSD = getDiscountApplied(minFeeUSD, discount)\n  const discountBaseMaxInUSD = getDiscountApplied(maxFeeUSD, discount)\n\n  // Fees with no discounts applied\n  const baseFeeInFeeToken = feeInFeeToken + discountInFeeToken\n  const baseFeeInUSD = feeInUSD + discountInUSD\n  const baseMinFee = minFee + discountMin\n  const baseMaxFee = (maxFee + discountMax) * OVERPRICED_MULTIPLIER\n  const baseMinFeeUSD = minFeeUSD + discountBaseMinInUSD\n  const baseMaxFeeUSD = (maxFeeUSD + discountBaseMaxInUSD) * OVERPRICED_MULTIPLIER\n\n  const isUnderpriced = !!estimation.customFee\n    && !isNaN(parseFloat(estimation.customFee))\n    && (baseFeeInFeeToken < baseMinFee)\n\n  const isOverpriced = !!estimation.customFee\n    && !isNaN(parseFloat(estimation.customFee))\n    && (baseFeeInFeeToken > baseMaxFee)\n\n  return (<>\n    {insufficientFee ?\n      (<div className='balance-error'>\n        Insufficient balance for the fee.<br />Accepted tokens: {(estimation.remainingFeeTokenBalances || []).map(x => x.symbol).join(', ')}\n        { isGasTankEnabled && <div>Disable your Gas Tank to use the default fee tokens.</div> }\n      </div>)\n      : feeCurrencySelect\n    }\n\n    {WalletDiscountBanner({\n      selectedFeeToken: estimation.selectedFeeToken,\n      currenciesItems,\n      tokens,\n      estimation,\n      onFeeCurrencyChange,\n      onDismiss,\n      feeSpeed,\n      isGasTankEnabled,\n      network\n    })}\n\n    <div className='section-title'>\n      <span>Transaction Speed</span>\n      { network.isGasTankAvailable && \n        <span>Gas Tank: { isGasTankEnabled ? \n          (<span className='gas-tank-enabled'>Enabled</span>) : \n          (<span className='gas-tank-disabled'>Disabled</span>)}\n        </span> \n      }\n    </div>\n    <div className='fee-selector'>\n      <div className='section'>\n        <div id='fee-selector'>{feeAmountSelectors}</div>\n        {\n          !editCustomFee ?\n            <div id='edit-custom-fee' onClick={() => setEditCustomFee(true)}>\n              <MdEdit />Edit fee\n            </div>\n            :\n            <div id='custom-fee-selector'>\n              <div className='title'>Custom Fee ({symbol})</div>\n              <TextInput\n                small\n                placeholder='Enter amount'\n                className={`${estimation.customFee ? 'selected' : ''}`}\n                onChange={value => setCustomFee(value)}\n                value={estimation.customFee}\n              />\n              {isUnderpriced &&\n                <div className='price-warning'>\n                  <div>Custom Fee too low. You can try to \"sign and send\" the transaction but most probably it will fail.</div>\n                  <div>Min estimated fee: &nbsp;\n                    {<Button textOnly\n                      onClick={() => setCustomFee(baseMinFee)}\n                    >\n                      {baseMinFee} {symbol}\n                    </Button>}\n                    {!isNaN(baseMinFeeUSD) &&\n                      <span>&nbsp; (~${formatFloatTokenAmount(baseMinFeeUSD, true, 4)}) </span>\n                    }\n                  </div>\n                </div>\n              }\n              {isOverpriced &&\n                <div className='price-warning'>\n                  <div>Custom Fee is higher than the APE speed. You will pay more than probably needed. Make sure you know what are you doing!</div>\n                  <div>Recommended max fee: &nbsp;\n                    {<Button textOnly\n                      onClick={() => setCustomFee(baseMaxFee)}\n                    >\n                      {baseMaxFee} {symbol}\n                    </Button>}\n                    {!isNaN(baseMaxFeeUSD) &&\n                      <span>&nbsp; (~${formatFloatTokenAmount(baseMaxFeeUSD, true, 4)}) </span>\n                    }\n                  </div>\n                </div>\n              }\n            </div>\n        }\n      </div>\n\n      <div className='fees-breakdown'>\n        {(<div className='fee-row native-fee-estimation'>\n          <div>\n            Fee {!!discount && <span className='discount-label'>*</span>}\n            {!!(discount && DISCOUNT_TOKENS_SYMBOLS.includes(estimation.selectedFeeToken?.symbol)) &&\n              <a\n                className=\"address row discount-label\"\n                href={walletDiscountBlogpost}\n                target=\"_blank\"\n                rel=\"noreferrer\">\n                &nbsp;<MdInfoOutline />\n              </a>}:\n          </div>\n          <div className='fee-amounts'>\n            {!isNaN(baseFeeInUSD) &&\n              <div>\n                ~${formatFloatTokenAmount(baseFeeInUSD, true, 4)}\n              </div>\n            }\n            {!isNaN(baseFeeInFeeToken) && <div>\n              {formatFloatTokenAmount(baseFeeInFeeToken, true, decimals) + ' ' + estimation?.selectedFeeToken?.symbol}\n            </div>\n            }\n          </div>\n        </div>)}\n\n        {!!discount && (<div className='fee-row native-fee-estimation discount-label'>\n          <div>\n            You save ({discount * 100}%):\n          </div>\n          <div className='fee-amounts'>\n            <div>\n              ~${formatFloatTokenAmount(discountInUSD, true, 4)}\n            </div>\n            {/* <div>\n              {discountInFeeToken + ' ' + estimation.selectedFeeToken.symbol}\n            </div> */}\n          </div>\n        </div>)}\n\n        {!!discount && (<div className='fee-row native-fee-estimation discount-label'>\n          <div>\n            You pay:\n          </div>\n          <div className='fee-amounts'>\n            <div>\n              ~${formatFloatTokenAmount(feeInUSD, true, 4)}\n            </div>\n          </div>\n        </div>)}\n        {!isGasTankEnabled && !isNaN((feeInUSD / estimation.gasLimit) * savedGas) && \n            <div className='fee-row native-fee-estimation discount-label'>\n              <div>\n                Gas Tank Saves You:\n              </div>\n              <div className='fee-amounts'>\n                <div>\n                  ${formatFloatTokenAmount(((feeInUSD / estimation.gasLimit) * savedGas), true, 4)}\n                </div>\n              </div>\n            </div>}\n        {!!isGasTankEnabled && (<>\n          <div className='fee-row native-fee-estimation discount-label'>\n            <div>\n              Gas Tank fee token balance:\n            </div>\n            <div className='fee-amounts'>\n              <div>\n                ${formatFloatTokenAmount(estimation.selectedFeeToken.balanceInUSD, true, 4)}\n              </div>\n            </div>\n          </div>\n         {!isNaN((feeInUSD / estimation.gasLimit) * savedGas) && \n            <div className='fee-row native-fee-estimation discount-label'>\n              <div>\n                Gas Tank saves you:\n              </div>\n              <div className='fee-amounts'>\n                <div>\n                  ${formatFloatTokenAmount(((feeInUSD / estimation.gasLimit) * savedGas), true, 4)}\n                </div>\n              </div>\n            </div>}\n        </>)}\n      </div>\n    </div>\n\n    {!estimation.feeInUSD ?\n      (<span className='no-relayer-msg'><b>WARNING:</b> Paying fees in tokens other than {nativeAssetSymbol} is unavailable because you are not connected to a relayer. You will pay the fee from <b>{signer.address}</b>.</span>)\n      : (<></>)}\n  </>)\n}\n\nexport function FailingTxn({ message, tooltip = '' }) {\n  return (<div className='failingTxn'>\n    <ToolTip label={tooltip}>\n      <div className='error-title'><AiOutlineWarning></AiOutlineWarning> Warning</div>\n      <div className='error-message'>{message}</div>\n    </ToolTip>\n  </div>)\n}","import { useState, useRef, useEffect } from 'react'\nimport { Button, Loading, TextInput } from 'components/common'\nimport { isTokenEligible } from './helpers'\nimport { MdCheck, MdCheckCircle, MdOutlineCheck, MdOutlineClose } from 'react-icons/md'\n\nexport default function Actions({ \n    estimation, \n    feeSpeed, \n    approveTxn, \n    rejectTxn, \n    cancelSigning, \n    signingStatus, \n    isGasTankEnabled, \n    network\n  }) {\n  const [quickAccCredentials, setQuickAccCredentials] = useState({ code: '', passphrase: '' })\n  // reset this every time the signing status changes\n  useEffect(() => !signingStatus && setQuickAccCredentials(prev => ({ ...prev, code: '' })), [signingStatus])\n\n  const form = useRef(null)\n\n  const rejectButton = rejectTxn && (\n    // WARNING: DO NOT remove type='button' here, it indicates that this button is not a submit button in the <form>\n    // if it is, pressing Enter will reject the transaction rather than submit it\n    <Button danger type='button' className='rejectTxn' onClick={rejectTxn}>Reject</Button>\n  )\n  const insufficientFee = estimation && estimation.feeInUSD\n    && !isTokenEligible(estimation.selectedFeeToken, feeSpeed, estimation, isGasTankEnabled, network)\n  const willFail = (estimation && !estimation.success) || insufficientFee\n  if (willFail) {\n    return (<div className='buttons'>\n      {rejectButton}\n    </div>)\n  }\n\n  const signButtonLabel = signingStatus && signingStatus.inProgress ?\n    <><Loading/>Signing...</>\n    : <><MdOutlineCheck/>Sign and send</>\n\n  const isRecoveryMode = signingStatus && signingStatus.finalBundle && signingStatus.finalBundle.recoveryMode\n  if (signingStatus && signingStatus.quickAcc) {\n    return (<>\n      {\n        signingStatus.confCodeRequired ?\n          <div className='confirmation-code-info'>\n            <div className='confirmation-code-info-title'><MdCheckCircle/>Confirmation</div>\n            <div className='confirmation-code-info-message'>\n              {signingStatus.confCodeRequired === 'otp' ? <>Please enter your OTP code and your password.</> : null}\n              {signingStatus.confCodeRequired === 'email' ?\n                (isRecoveryMode\n                  ? <>A confirmation code was sent to your email, please enter it to initiate the recovery.</>\n                  : <>A confirmation code was sent to your email, please enter it along with your password.</>)\n                      : null\n\t      }\n            </div>\n          </div>\n          :\n          null\n      }\n  \n      <form ref={form} className='quickAccSigningForm' onSubmit={e => { e.preventDefault() }}>\n        {signingStatus.confCodeRequired === 'notRequired' &&\n          <p className='code-2fa-not-required-msg'>You already sent 3 or more transactions to this address, confirmation code is not needed.</p>\n        }\n        <div className='inputs-container'>\n          <TextInput\n            small\n            password\n            required\n            minLength={3}\n            placeholder='Password'\n            value={quickAccCredentials.passphrase}\n            style={isRecoveryMode ? { visibility: 'hidden' } : {} }\n            disabled={isRecoveryMode}\n            onChange={value => setQuickAccCredentials({ ...quickAccCredentials, passphrase: value })}\n          ></TextInput>\n          {/* Changing the autoComplete prop to a random string seems to disable it in more cases */}\n          {signingStatus.confCodeRequired !== 'notRequired' &&\n            <TextInput\n              small\n              pattern='[0-9]+'\n              title='Confirmation code should be 6 digits'\n              autoComplete='nope'\n              required minLength={6} maxLength={6}\n              placeholder={signingStatus.confCodeRequired === 'otp' ? 'Authenticator OTP code' : 'Confirmation code'}\n              value={quickAccCredentials.code}\n              onChange={value => setQuickAccCredentials({ ...quickAccCredentials, code: value })}\n            ></TextInput>\n          }\n        </div>\n        <div className='buttons'>\n          <Button\n            clear\n            disabled={signingStatus && signingStatus.inProgress}\n            icon={<MdOutlineClose/>}\n            type='button'\n            className='cancelSigning buttonComponent'\n            onClick={cancelSigning}\n          >\n            Cancel\n          </Button>\n          <Button \n            className='confirmSigning buttonComponent'\n            onClick={() => {\n              if (!form.current.checkValidity()) return\n              approveTxn({ quickAccCredentials })\n            }}\n          >\n            { signingStatus && signingStatus.inProgress ? <Loading/> : <><MdCheck/> Confirm</>}\n          </Button>\n        </div>\n      </form>\n    </>)\n  }\n\n  return (<div className='buttons'>\n      {rejectButton}\n      <Button className='approveTxn' disabled={!estimation || signingStatus} onClick={approveTxn}>\n        {signButtonLabel}\n      </Button>\n  </div>)\n}\n","import { Interface, hexlify } from 'ethers/lib/utils'\nconst IdentityInterface = new Interface(require('adex-protocol-eth/abi/Identity5.2'))\nconst FactoryInterface = new Interface(require('adex-protocol-eth/abi/IdentityFactory5.2'))\n\nexport async function sendNoRelayer ({ finalBundle, account, network, wallet, estimation, feeSpeed, provider }) {\n    const { signer } = finalBundle\n    // @TODO: in case we need deploying, run using deployAndCall pipeline with signed msgs\n    // @TODO: quickAccManager\n    if (signer.quickAccManager) throw new Error('quickAccManager not supported in relayerless mode yet')\n    // currently disabled quickAccManager cause 1) we don't have a means of getting the second sig 2) we still have to sign txes so it's inconvenient\n    // if (signer.quickAccManager) await finalBundle.sign(wallet)\n    //const [to, data] = signer.quickAccManager ? [signer.quickAccManager, QuickAccManagerInterface.encodeFunctionData('send', [finalBundle.identity, [signer.timelock, signer.one, signer.two], [false, finalBundle.signature, '0x']])] :\n\n    // NOTE: just adding values to gasLimit is bad because 1) they're hardcoded estimates\n    // and 2) the fee displayed in the UI does not reflect that\n    const isDeployed = await provider.getCode(finalBundle.identity).then(code => code !== '0x')\n    let gasLimit\n    let to, data\n    if (isDeployed) {\n      gasLimit = estimation.gasLimit + 20000\n      to = finalBundle.identity\n      data = IdentityInterface.encodeFunctionData('executeBySender', [finalBundle.txns])\n    } else {\n      await finalBundle.getNonce(provider)\n      // just some hardcoded value to make the signing pass\n      finalBundle.gasLimit = 400000\n      await finalBundle.sign(wallet)\n      to = account.identityFactoryAddr\n      data = FactoryInterface.encodeFunctionData('deployAndExecute', [account.bytecode, account.salt, finalBundle.txns, finalBundle.signature])\n      gasLimit = (await provider.estimateGas({ to, data, from: signer.address })).toNumber() + 20000\n    }\n\n    const txn = {\n      from: signer.address,\n      to, data,\n      gas: hexlify(gasLimit),\n      gasPrice: hexlify(Math.floor(estimation.feeInNative[feeSpeed] / estimation.gasLimit * 1e18)),\n      nonce: hexlify(await provider.getTransactionCount(signer.address))\n    }\n    try {\n      let txId\n      if (!wallet.sendTransaction) {\n        // HW wallets which only sign\n        const signed = await wallet.signTransaction(txn)\n        txId = (await provider.sendTransaction(signed)).hash\n      } else {\n        // web3 injectors which can't sign, but can sign+send\n        // they also don't like the gas arg they fully control the chain ID\n        if (wallet.provider) {\n          const { chainId } = await wallet.provider.getNetwork()\n          if (network.chainId !== chainId) throw new Error(`Connected to the wrong network: please switch to ${network.name}`)\n          txId = (await wallet.sendTransaction({ from: txn.from, to: txn.to, data: txn.data, gasPrice: txn.gasPrice, nonce: txn.nonce })).hash\n        } else { // implementation of sendTransaction in getWallet\n          txId = (await wallet.sendTransaction({ from: txn.from, to: txn.to, data: txn.data, gasPrice: txn.gasPrice, gas: txn.gas, nonce: txn.nonce, chainId: network.chainId })).hash\n        }\n\n      }\n      return { success: true, txId }\n    } catch(e) {\n      if (e.code === 'INSUFFICIENT_FUNDS') throw new Error(`Insufficient gas fees: you need to have ${network.nativeAssetSymbol} on ${signer.address}`)\n      throw e\n    }\n  }\n","//import { GrInspect } from 'react-icons/gr'\n// GiObservatory is also interesting\nimport { GiGorilla } from 'react-icons/gi'\nimport { FaChevronLeft } from 'react-icons/fa'\nimport { MdOutlineClose, MdOutlineInfo, MdWarning } from 'react-icons/md'\nimport './SendTransaction.scss'\nimport { useEffect, useState, useMemo, useRef } from 'react'\nimport { Bundle } from 'adex-protocol-eth/js'\nimport { Wallet } from 'ethers'\nimport { Interface } from 'ethers/lib/utils'\nimport * as blockies from 'blockies-ts'\nimport { useToasts } from 'hooks/toasts'\nimport { getWallet } from 'lib/getWallet'\nimport accountPresets from 'ambire-common/src/constants/accountPresets'\nimport { networkIconsById } from 'consts/networks'\nimport { FeeSelector, FailingTxn } from './FeeSelector'\nimport Actions from './Actions'\nimport TxnPreview from 'components/common/TxnPreview/TxnPreview'\nimport { sendNoRelayer } from './noRelayer'\nimport {\n  isTokenEligible,\n  // getFeePaymentConsequences,\n  getFeesData,\n  toHexAmount\n } from './helpers'\nimport { fetchPost } from 'lib/fetch'\nimport { toBundleTxn } from 'ambire-common/src/services/requestToBundleTxn'\nimport { getProvider } from 'lib/provider'\nimport { MdInfo } from 'react-icons/md'\nimport { useCallback } from 'react'\nimport { ToolTip, Button, Loading } from 'components/common'\nimport { ethers } from 'ethers'\nimport { Checkbox } from 'components/common'\n\nconst ERC20 = new Interface(require('adex-protocol-eth/abi/ERC20'))\n\nconst DEFAULT_SPEED = 'fast'\nconst REESTIMATE_INTERVAL = 15000\n\nconst REJECT_MSG = 'Ambire user rejected the request'\n\nconst WALLET_TOKEN_SYMBOLS = ['xWALLET', 'WALLET']\n\nconst isInt = x => !isNaN(x) && x !== null\n\nconst getDefaultFeeToken = (remainingFeeTokenBalances, network, feeSpeed, estimation, currentAccGasTankState) => {\n  if(!remainingFeeTokenBalances?.length) {\n    return { symbol: network.nativeAssetSymbol, decimals: 18, address: '0x0000000000000000000000000000000000000000' }\n  }\n\n  return remainingFeeTokenBalances\n  .sort((a, b) =>\n    (WALLET_TOKEN_SYMBOLS.indexOf(b?.symbol) - WALLET_TOKEN_SYMBOLS.indexOf(a?.symbol))\n    || ((b?.discount || 0) - (a?.discount || 0))\n    || a?.symbol.toUpperCase().localeCompare(b?.symbol.toUpperCase())\n  )\n  .find(token => isTokenEligible(token, feeSpeed, estimation, currentAccGasTankState, network))\n  || remainingFeeTokenBalances[0]\n}\n\nfunction makeBundle(account, networkId, requests) {\n  const bundle = new Bundle({\n    network: networkId,\n    identity: account.id,\n    // checking txn isArray because sometimes we receive txn in array from walletconnect. Also we use Array.isArray because txn object can have prop 0\n    txns: requests.map(({ txn }) => toBundleTxn(Array.isArray(txn) ? txn[0] : txn, account.id)),\n    signer: account.signer\n  })\n  bundle.extraGas = requests.map(x => x.extraGas || 0).reduce((a, b) => a + b, 0)\n  bundle.requestIds = requests.map(x => x.id)\n\n  // Attach bundle's meta\n  if (requests.some(item => item.meta)) {\n    bundle.meta = {}\n\n    if (requests.some(item => item.meta?.addressLabel)) {\n      bundle.meta.addressLabel = requests.map(x => !!x.meta?.addressLabel ? x.meta.addressLabel : { addressLabel: '', address: ''})\n    }\n\n    const xWalletReq = requests.find(x => x.meta?.xWallet)\n    if (xWalletReq) {\n      bundle.meta.xWallet = xWalletReq.meta.xWallet\n    }\n  }\n\n  return bundle\n}\n\nfunction getErrorMessage(e) {\n  if (e && e.message === 'NOT_TIME') {\n    return 'Your 72 hour recovery waiting period still hasn\\'t ended. You will be able to use your account after this lock period.'\n  } else if (e && e.message === 'WRONG_ACC_OR_NO_PRIV') {\n    return 'Unable to sign with this email/password account. Please contact support.'\n  // NOTE: is INVALID_SIGNATURE even a real error?\n  } else if (e && e.message === 'INVALID_SIGNATURE') {\n    return 'Invalid signature. This may happen if you used password/derivation path on your hardware wallet.'\n  } else if (e && e.message === 'INSUFFICIENT_PRIVILEGE') {\n    return 'Wrong signature. This may happen if you used password/derivation path on your hardware wallet.'\n  } else {\n    return e.message || e\n  }\n}\n\nexport default function SendTransaction({ relayerURL, accounts, network, selectedAcc, requests, resolveMany, replacementBundle, replaceByDefault, mustReplaceNonce, onBroadcastedTxn, onDismiss, gasTankState }) {\n  // NOTE: this can be refactored at a top level to only pass the selected account (full object)\n  // keeping it that way right now (selectedAcc, accounts) cause maybe we'll need the others at some point?\n  const account = accounts.find(x => x.id === selectedAcc)\n\n  // Also filtered in App.js, but better safe than sorry here\n  const eligibleRequests = useMemo(() => requests\n    .filter(({ type, chainId, account, txn }) =>\n      type === 'eth_sendTransaction'\n      && chainId === network.chainId\n      && account === selectedAcc\n      && txn && (!txn.from || txn.from.toLowerCase() === selectedAcc.toLowerCase())\n    // we only need to update on change of IDs\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    ), [requests.map(x => x.id).join(','), network.chainId, selectedAcc])\n  const bundle = useMemo(\n    () => replacementBundle || makeBundle(account, network.id, eligibleRequests),\n    [replacementBundle, network.id, account, eligibleRequests]\n  )\n\n  if (!account || !bundle.txns.length) return (<div id='sendTransaction'>\n    <h3 className='error'>SendTransactions: No account or no requests: should never happen.</h3>\n  </div>)\n  return (<SendTransactionWithBundle\n    relayerURL={relayerURL}\n    bundle={bundle}\n    replaceByDefault={replaceByDefault}\n    mustReplaceNonce={mustReplaceNonce}\n    network={network}\n    account={account}\n    resolveMany={resolveMany}\n    onBroadcastedTxn={onBroadcastedTxn}\n    onDismiss={onDismiss}\n    gasTankState={gasTankState}\n  />)\n}\n\nfunction SendTransactionWithBundle({ bundle, replaceByDefault, mustReplaceNonce, network, account, resolveMany, relayerURL, onBroadcastedTxn, onDismiss, gasTankState }) {\n  const currentAccGasTankState = network.isGasTankAvailable ? \n    gasTankState.find(i => i.account === account.id) : \n    { account: account.id, isEnabled: false }\n  const [estimation, setEstimation] = useState(null)\n  const [replaceTx, setReplaceTx] = useState(!!replaceByDefault)\n  const [signingStatus, setSigningStatus] = useState(false)\n  const [feeSpeed, setFeeSpeed] = useState(DEFAULT_SPEED)\n  const { addToast } = useToasts()\n\n  // Safety check: make sure our input parameters make sense\n  if (isInt(mustReplaceNonce) && !(replaceByDefault || isInt(bundle.nonce))) {\n    console.error('ERROR: SendTransactionWithBundle: mustReplaceNonce is set but we are not using replacementBundle or replaceByDefault')\n    console.error('ERROR: SendTransactionWithBundle: This is a huge logical error as mustReplaceNonce is intended to be used only when we want to replace a txn')\n  }\n\n  // Keep track of unmounted: we need this to not try to modify state after async actions if the component is unmounted\n  const isMounted = useRef(false)\n  useEffect(() => {\n    isMounted.current = true\n    return () => { isMounted.current = false }\n  })\n\n  // Reset the estimation when there are no txns in the bundle\n  useEffect(() => {\n    if (!bundle.txns.length) return\n    setEstimation(null)\n  }, [bundle, setEstimation])\n\n  // Estimate the bundle & reestimate periodically\n  const currentBundle = useRef(null)\n  currentBundle.current = bundle\n  useEffect(() => {    // eslint-disable-next-line react-hooks/exhaustive-deps\n    // We don't need to reestimate the fee when a signing process is in progress\n    if (signingStatus) return\n    // nor when there are no txns in the bundle, if this is even possible\n    if (!bundle.txns.length) return\n\n    // track whether the effect has been unmounted\n    let unmounted = false\n\n    // Note: currently, there's no point of getting the nonce if the bundle already has a nonce\n    // We may want to change this if we make a check if the currently replaced txn was already mined\n    const reestimate = () => (relayerURL\n        ? bundle.estimate({ relayerURL, fetch, replacing: !!bundle.minFeeInUSDPerGas, getNextNonce: true, gasTank: currentAccGasTankState.isEnabled })\n        : bundle.estimateNoRelayer({ provider: getProvider(network.id) })\n    )\n      .then((estimation) => {\n        if (unmounted || bundle !== currentBundle.current) return\n        estimation.relayerless = !relayerURL\n        const gasTankTokens = estimation.gasTank?.map(item => { \n          return { \n            ...item,\n            symbol: item.symbol.toUpperCase(), \n            balance: ethers.utils.parseUnits(item.balance.toFixed(item.decimals).toString(), item.decimals).toString(),\n            nativeRate: item.address === '0x0000000000000000000000000000000000000000' ? null : estimation.nativeAssetPriceInUSD / item.price\n          }\n        })\n        if (currentAccGasTankState.isEnabled) estimation.remainingFeeTokenBalances = gasTankTokens\n        estimation.selectedFeeToken = getDefaultFeeToken(estimation.remainingFeeTokenBalances, network, feeSpeed, estimation, currentAccGasTankState.isEnabled, network)\n        setEstimation(prevEstimation => {\n          if (prevEstimation && prevEstimation.customFee) return prevEstimation\n          if (estimation.remainingFeeTokenBalances) {\n            // If there's no eligible token, set it to the first one cause it looks more user friendly (it's the preferred one, usually a stablecoin)\n            estimation.selectedFeeToken = (\n                prevEstimation\n                && isTokenEligible(prevEstimation.selectedFeeToken, feeSpeed, estimation, currentAccGasTankState.isEnabled, network)\n                && prevEstimation.selectedFeeToken\n              )\n              || getDefaultFeeToken(estimation.remainingFeeTokenBalances, network, feeSpeed, estimation, currentAccGasTankState.isEnabled, network)\n          }\n          return estimation\n        })\n      })\n      .catch(e => {\n        if (unmounted) return\n        console.log('estimation error', e)\n        addToast(`Estimation error: ${e.message || e}`, { error: true })\n      })\n\n    reestimate()\n    const intvl = setInterval(reestimate, REESTIMATE_INTERVAL)\n\n    return () => {\n      unmounted = true\n      clearInterval(intvl)\n    }\n  }, [bundle, setEstimation, feeSpeed, addToast, network, relayerURL, signingStatus, currentAccGasTankState.isEnabled ])\n\n  // The final bundle is used when signing + sending it\n  // the bundle before that is used for estimating\n  const getFinalBundle = useCallback(() => {\n    if (!relayerURL) {\n      return new Bundle({\n        ...bundle,\n        gasLimit: estimation.gasLimit,\n      })\n    }\n\n    const feeToken = estimation.selectedFeeToken\n\n    const {\n      feeInNative,\n      // feeInUSD, // don't need fee in USD for stables as it will work with feeInFeeToken\n      // Also it can be stable but not in USD\n      feeInFeeToken,\n      addedGas\n    } = getFeesData(feeToken, estimation, feeSpeed, currentAccGasTankState.isEnabled, network)\n    const feeTxn = feeToken.symbol === network.nativeAssetSymbol\n      // TODO: check native decimals\n      ? [accountPresets.feeCollector, toHexAmount(feeInNative, 18), '0x']\n      : [feeToken.address, '0x0', ERC20.encodeFunctionData('transfer', [\n        accountPresets.feeCollector,\n        toHexAmount(feeInFeeToken, feeToken.decimals)\n    ])]\n\n    const nextFreeNonce = estimation.nextNonce?.nonce\n    const nextNonMinedNonce = estimation.nextNonce?.nextNonMinedNonce\n    // If we've passed in a bundle, use it's nonce (when using a replacementBundle); else, depending on whether we want to replace the current pending bundle,\n    // either use the next non-mined nonce or the next free nonce\n    const nonce = isInt(bundle.nonce) ? bundle.nonce : (replaceTx ? nextNonMinedNonce : nextFreeNonce)\n\n    if (!!currentAccGasTankState.isEnabled) {\n      let gasLimit\n      if (bundle.txns.length > 1) gasLimit = estimation.gasLimit + (bundle.extraGas || 0)\n      else gasLimit = estimation.gasLimit\n\n      let value\n      if (feeToken.address === \"0x0000000000000000000000000000000000000000\") value = feeInNative\n      else {\n        const fToken = estimation.remainingFeeTokenBalances.find(i => i.id === feeToken.id)\n        value = fToken && estimation.feeInNative[feeSpeed] * fToken.nativeRate\n      }\n      \n      return new Bundle({\n        ...bundle,\n        gasTankFee: {\n          assetId: feeToken.id,\n          value: ethers.utils.parseUnits(value.toFixed(feeToken.decimals), feeToken.decimals).toString()\n        },\n        txns: [...bundle.txns],\n        gasLimit,\n        nonce\n      })\n    }\n\n    return new Bundle({\n      ...bundle,\n      txns: [...bundle.txns, feeTxn],\n      gasTankFee: null,\n      gasLimit: estimation.gasLimit + addedGas + (bundle.extraGas || 0),\n      nonce\n    })\n  }, [relayerURL, estimation, feeSpeed, currentAccGasTankState.isEnabled, network, bundle, replaceTx])\n\n  const approveTxnImpl = async () => {\n    if (!estimation) throw new Error('no estimation: should never happen')\n\n    const finalBundle = getFinalBundle()\n    const provider = getProvider(network.id)\n    const signer = finalBundle.signer\n\n    // a bit redundant cause we already called it at the beginning of approveTxn, but\n    // we need to freeze finalBundle in the UI in case signing takes a long time (currently only to freeze the fee selector)\n    setSigningStatus({ inProgress: true, finalBundle })\n\n    const wallet = getWallet({\n      signer,\n      signerExtra: account.signerExtra,\n      chainId: network.chainId\n    })\n\n    if (relayerURL) {\n      // Temporary way of debugging the fee cost\n      // const initialLimit = finalBundle.gasLimit - getFeePaymentConsequences(estimation.selectedFeeToken, estimation).addedGas\n      // finalBundle.estimate({ relayerURL, fetch }).then(estimation => console.log('fee costs: ', estimation.gasLimit - initialLimit), estimation.selectedFeeToken).catch(console.error)\n      await finalBundle.sign(wallet)\n      return await finalBundle.submit({ relayerURL, fetch })\n    } else {\n      return await sendNoRelayer({\n        finalBundle, account, network, wallet, estimation, feeSpeed, provider\n      })\n    }\n  }\n\n  const approveTxnImplQuickAcc = async ({ quickAccCredentials }) => {\n    if (!estimation) throw new Error('no estimation: should never happen')\n    if (!relayerURL) throw new Error('Email/Password account signing without the relayer is not supported yet')\n\n    const finalBundle = (signingStatus && signingStatus.finalBundle) || getFinalBundle()\n    const signer = finalBundle.signer\n\n    const canSkip2FA = signingStatus && signingStatus.confCodeRequired === 'notRequired'\n    const { signature, success, message, confCodeRequired } = await fetchPost(\n      `${relayerURL}/second-key/${bundle.identity}/${network.id}/sign`, {\n        signer, txns: finalBundle.txns, nonce: finalBundle.nonce, gasLimit: finalBundle.gasLimit,\n        ...(!canSkip2FA) && {code: quickAccCredentials && quickAccCredentials.code},\n        // This can be a boolean but it can also contain the new signer/primaryKeyBackup, which instructs /second-key to update acc upon successful signature\n        recoveryMode: finalBundle.recoveryMode,\n        canSkip2FA: canSkip2FA\n      }\n    )\n    if (!success) {\n      if (!message) throw new Error(`Secondary key: no success but no error message`)\n      if (message.includes('invalid confirmation code')) {\n        addToast('Unable to sign: wrong confirmation code', { error: true })\n        return\n      }\n      throw new Error(`Secondary key error: ${message}`)\n    }\n    if (confCodeRequired) {\n      setSigningStatus({ quickAcc: true, finalBundle, confCodeRequired })\n    } else {\n      if (!signature) throw new Error(`QuickAcc internal error: there should be a signature`)\n      if (!account.primaryKeyBackup) throw new Error(`No key backup found: you need to import the account from JSON or login again.`)\n      setSigningStatus({ quickAcc: true, inProgress: true, confCodeRequired: canSkip2FA ? 'notRequired' : undefined })\n      if (!finalBundle.recoveryMode) {\n        // Make sure we let React re-render without blocking (decrypting and signing will block)\n        await new Promise(resolve => setTimeout(resolve, 0))\n        const pwd = quickAccCredentials.passphrase || alert('Enter password')\n        const wallet = await Wallet.fromEncryptedJson(JSON.parse(account.primaryKeyBackup), pwd)\n        await finalBundle.sign(wallet)\n      } else {\n        // set both .signature and .signatureTwo to the same value: the secondary signature\n        // this will trigger a timelocked txn\n        finalBundle.signature = signature\n      }\n      finalBundle.signatureTwo = signature\n      return await finalBundle.submit({ relayerURL, fetch })\n    }\n  }\n\n  const approveTxn = ({ quickAccCredentials }) => {\n    if (signingStatus && signingStatus.inProgress) return\n    setSigningStatus(signingStatus || { inProgress: true })\n\n    if (account.signerExtra && account.signerExtra.type === 'ledger') {\n      addToast('Please confirm this transaction on your Ledger device.', { timeout: 10000 })\n    }\n\n    if (account.signerExtra && account.signerExtra.type === 'Lattice') {\n      addToast('Please confirm this transaction on your Lattice device.', { timeout: 10000 })\n    }\n\n    const requestIds = bundle.requestIds\n    const approveTxnPromise = bundle.signer.quickAccManager ?\n      approveTxnImplQuickAcc({ quickAccCredentials })\n      : approveTxnImpl()\n    approveTxnPromise.then(bundleResult => {\n      // special case for approveTxnImplQuickAcc: when a user interaction prevents the operation from completing\n      if (!bundleResult) return\n\n      // do not to call this after onDimiss, cause it might cause state to be changed post-unmount\n      if (isMounted.current) setSigningStatus(null)\n\n      // Inform everything that's waiting for the results (eg WalletConnect)\n      const skipResolve = !bundleResult.success && bundleResult.message && bundleResult.message.match(/underpriced/i)\n      if (!skipResolve && requestIds) resolveMany(requestIds, { success: bundleResult.success, result: bundleResult.txId, message: bundleResult.message })\n\n      if (bundleResult.success) {\n        onBroadcastedTxn(bundleResult.txId)\n        onDismiss()\n      } else {\n        // to force replacementBundle to be null, so it's not filled from previous state change in App.js in useEffect\n        // basically close the modal if the txn was already mined\n        if (bundleResult.message.includes('was already mined')) {\n          onDismiss()\n        }\n        addToast(`Transaction error: ${getErrorMessage(bundleResult)}`, { error: true })  //'unspecified error'\n      }\n    })\n    .catch(e => {\n      if (isMounted.current) setSigningStatus(null)\n      console.error(e)\n      if (e && e.message.includes('must provide an Ethereum address')) {\n        addToast(`Signing error: not connected with the correct address. Make sure you're connected with ${bundle.signer.address}.`, { error: true })\n      } else if (e && e.message.includes('0x6b0c')) {\n        // not sure if that's actually the case with this hellish error, but after unlocking the device it no longer appeared\n        // however, it stopped appearing after that even if the device is locked, so I'm not sure it's related...\n        addToast(`Ledger: unknown error (0x6b0c): is your Ledger unlocked and in the Ethereum application?`, { error: true })\n      } else {\n        addToast(`Signing error: ${getErrorMessage(e)}`, { error: true })\n      }\n    })\n  }\n\n  const rejectTxn = () => {\n    onDismiss()\n    bundle.requestIds && resolveMany(bundle.requestIds, { message: REJECT_MSG })\n  }\n\n  const accountAvatar = blockies.create({ seed: account.id }).toDataURL()\n\n  // `mustReplaceNonce` is set on speedup/cancel, to prevent the user from broadcasting the txn if the same nonce has been mined\n  const canProceed = isInt(mustReplaceNonce)\n    ? (\n      isInt(estimation?.nextNonce?.nextNonMinedNonce)\n        ? mustReplaceNonce >= estimation?.nextNonce?.nextNonMinedNonce\n        : null // null = waiting to get nonce data from relayer\n    )\n    : true\n\n  return (\n    <div id='sendTransaction'>\n      <div id=\"titleBar\">\n        <div className='dismiss' onClick={onDismiss}>\n          <FaChevronLeft size={35}/>\n          back\n          <ToolTip label=\"You can go back to the main dashboard and add more transactions to this bundle in order to sign & send them all at once.\">\n            <MdOutlineInfo size={25}/>\n          </ToolTip>\n        </div>\n      </div>\n\n      <div className='container'>\n        <div id='transactionPanel' className='panel'>\n          <div className='heading'>\n            <div className='title'>{ bundle.txns.length } Transaction{ bundle.txns.length > 1 ? 's' : '' } Waiting</div>\n          </div>\n          <div className='content'>\n            <div className={`listOfTransactions${bundle.requestIds ? '' : ' frozen'}`}>\n              {bundle.txns.map((txn, i) => {\n                const isFirstFailing = estimation && !estimation.success && estimation.firstFailing === i\n                // we need to re-render twice per minute cause of DEX deadlines\n                const min = Math.floor(Date.now() / 30000)\n                return (<TxnPreview\n                  key={[...txn, i].join(':')}\n                  // pasing an unused property to make it update\n                  minute={min}\n                  onDismiss={bundle.requestIds && (() => resolveMany([bundle.requestIds[i]], { message: REJECT_MSG }))}\n                  txn={txn} network={bundle.network} account={bundle.identity}\n                  isFirstFailing={isFirstFailing}\n                  disableDismiss={!!signingStatus}\n                  disableDismissLabel={\"Cannot modify transaction bundle while a signing procedure is pending\"}\n                  addressLabel={!!bundle.meta && bundle.meta.addressLabel}\n                  />\n                )\n              })}\n            </div>\n\n            <div className='separator'></div>\n\n            <div className='transactionsNote'>\n              {\n                // only render this if we're using the queue\n                bundle.requestIds &&\n                  <>\n                    <b><GiGorilla size={16}/> DEGEN TIP</b>\n                    <span>You can sign multiple transactions at once. Add more transactions to this batch by interacting with a connected dApp right now. Alternatively, you may click \"Back\" to add more transactions.</span>\n                  </>\n              }\n            </div>\n          </div>\n        </div>\n\n        <div id='detailsPanel' className='panel'>\n          <div id=\"options-container\">\n            <div className='section' id=\"signing-details\">\n              <div className='section-title'>Signing With</div>\n              <div className='section-content'>\n                <div className='account'>\n                  <div className='icon' style={{ backgroundImage: `url(${accountAvatar})` }}/>\n                  <div className='address'>{ account.id }</div>\n                </div>\n                <div className='network'>\n                  on\n                  <div className='icon' style={{ backgroundImage: `url(${networkIconsById[network.id]})` }}/>\n                  <div className='address'>{ network.name }</div>\n                </div>\n              </div>\n            </div>\n\n            { /* Only lock the fee selector when the bundle is locked too - to make sure that the fee really is set in stone (won't change on the next getFinalBundle()) */ }\n            {\n              canProceed &&\n              <FeeSelector\n                disabled={signingStatus && signingStatus.finalBundle && !(estimation && !estimation.success)}\n                signer={bundle.signer}\n                estimation={estimation}\n                setEstimation={setEstimation}\n                network={network}\n                feeSpeed={feeSpeed}\n                setFeeSpeed={setFeeSpeed}\n                onDismiss={onDismiss}\n                isGasTankEnabled={currentAccGasTankState.isEnabled && !!relayerURL}\n              ></FeeSelector>\n            }\n\n          </div>\n\n         {\n            // If there's `bundle.nonce` set, it means we're cancelling or speeding up, so this shouldn't even be visible\n            // We also don't show this in any case in which we're forced to replace a particular transaction (mustReplaceNonce)\n            !isInt(bundle.nonce) && !isInt(mustReplaceNonce) && !!estimation?.nextNonce?.pendingBundle &&\n            (\n              <div>\n               <Checkbox\n                    label='Replace currently pending transaction'\n                    checked={replaceTx}\n                    onChange={({ target }) => setReplaceTx(target.checked)}\n                />\n              </div>\n            )\n          }\n\n          {\n            // NOTE there's a case in which both \"This transaction will replace the current pending transaction\" and the checkbox will render - when we're doing a modify\n            // If we are replacing a txn, look at whether canProceed is true\n            isInt(mustReplaceNonce) &&\n            <>\n              {\n                // We always warn the user if they're trying to replace a particular transaction\n                // This doesn't need to show when replacing is optional\n                (canProceed || canProceed === null) && <div className='replaceInfo warning' ><MdWarning /><span>This transaction bundle will replace the one that's currently pending.</span></div>\n              }\n\n              {\n                // canProceed equals null means we don't have data yet\n                canProceed === null &&\n                <div>\n                  <Loading />\n                </div>\n              }\n\n              {\n                canProceed === false &&\n                <div id='actions-container-replace'>\n                  <div className='replaceInfo info' ><MdInfo /><span>The transaction you're trying to replace has already been confirmed</span></div>\n                  <div className='buttons'>\n                    <Button clear icon={<MdOutlineClose/>} type='button' className='rejectTxn buttonComponent' onClick={rejectTxn}>Close</Button>\n                  </div>\n                </div>\n              }\n            </>\n          }\n\n          {\n            canProceed &&\n            <>\n              {\n                estimation && estimation.success && estimation.isDeployed === false && bundle.gasLimit ?\n                  <div className='first-tx-note'>\n                    <div className='first-tx-note-title'><MdInfo/>Note</div>\n                    <div className='first-tx-note-message'>\n                      Because this is your first Ambire transaction, this fee is {(60000 / bundle.gasLimit * 100).toFixed()}% higher than usual because we have to deploy your smart wallet.\n                      Subsequent transactions will be cheaper\n                    </div>\n                  </div>\n                  :\n                  null\n              }\n\n              <div id=\"actions-container\">\n                {\n                  bundle.signer.quickAccManager && !relayerURL ?\n                    <FailingTxn message='Signing transactions with an email/password account without being connected to the relayer is unsupported.'></FailingTxn>\n                    :\n                    <div className='section' id=\"actions\">\n                      <Actions\n                        estimation={estimation}\n                        approveTxn={approveTxn}\n                        rejectTxn={rejectTxn}\n                        cancelSigning={() => setSigningStatus(null)}\n                        signingStatus={signingStatus}\n                        feeSpeed={feeSpeed}\n                        isGasTankEnabled={currentAccGasTankState.isEnabled && !!relayerURL}\n                        network={network}\n                      />\n                    </div>\n                }\n              </div>\n            </>\n          }\n\n        </div>\n      </div>\n    </div>\n  )\n}\n","const { BN } = require('bn.js')\n\nfunction Uint256(x) {\n\tconst bn = new BN(x, 10)\n\tif (bn.isNeg()) throw new Error('uint256 expected, negative number given')\n\treturn bn\n}\n\nfunction Address(x) {\n\tif (!(typeof x === 'string' && x.length === 42 && x.startsWith('0x')))\n\t\tthrow new Error('invalid address: must start with a 0x and be 42 characters long')\n\treturn x\n}\n\nfunction Bytes32(b) {\n\tif (typeof b === 'string' && b.startsWith('0x') && b.length === 66) {\n\t\treturn Buffer.from(b.slice(2), 'hex')\n\t}\n\tif (!(b.length === 32 && Buffer.isBuffer(b))) throw new Error('32 byte Buffer expected')\n\treturn b\n}\n\nfunction Bytes(b) {\n\tif (typeof b === 'string' && b.startsWith('0x')) {\n\t\treturn Buffer.from(b.slice(2), 'hex')\n\t}\n\tif (!Buffer.isBuffer(b)) throw new Error('Buffer expected')\n\treturn b\n}\n\nfunction Bytes32Array(bytes32Array, size) {\n\t// no size specified\n\tif (size === -1 || size === undefined) {\n\t\treturn bytes32Array.map(x => Bytes32(x))\n\t}\n\treturn bytes32Array.length === size && bytes32Array.map(x => Bytes32(x))\n}\n\nfunction Channel(channel) {\n\tAddress(channel.leader)\n\tAddress(channel.follower)\n\tAddress(channel.guardian)\n\tAddress(channel.tokenAddr)\n\tBytes32(channel.nonce)\n\treturn channel\n}\n\nmodule.exports = { Uint256, Bytes32, Address, Bytes, Bytes32Array, Channel }\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.baToJSON = exports.addHexPrefix = exports.toUnsigned = exports.fromSigned = exports.bufferToHex = exports.bufferToInt = exports.toBuffer = exports.stripZeros = exports.unpad = exports.setLengthRight = exports.setLength = exports.setLengthLeft = exports.zeros = void 0;\nvar ethjsUtil = require('ethjs-util');\nvar BN = require(\"bn.js\");\n/**\n * Returns a buffer filled with 0s.\n * @param bytes the number of bytes the buffer should be\n */\nexports.zeros = function (bytes) {\n    return Buffer.allocUnsafe(bytes).fill(0);\n};\n/**\n * Left Pads an `Array` or `Buffer` with leading zeros till it has `length` bytes.\n * Or it truncates the beginning if it exceeds.\n * @param msg the value to pad (Buffer|Array)\n * @param length the number of bytes the output should be\n * @param right whether to start padding form the left or right\n * @return (Buffer|Array)\n */\nexports.setLengthLeft = function (msg, length, right) {\n    if (right === void 0) { right = false; }\n    var buf = exports.zeros(length);\n    msg = exports.toBuffer(msg);\n    if (right) {\n        if (msg.length < length) {\n            msg.copy(buf);\n            return buf;\n        }\n        return msg.slice(0, length);\n    }\n    else {\n        if (msg.length < length) {\n            msg.copy(buf, length - msg.length);\n            return buf;\n        }\n        return msg.slice(-length);\n    }\n};\nexports.setLength = exports.setLengthLeft;\n/**\n * Right Pads an `Array` or `Buffer` with leading zeros till it has `length` bytes.\n * Or it truncates the beginning if it exceeds.\n * @param msg the value to pad (Buffer|Array)\n * @param length the number of bytes the output should be\n * @return (Buffer|Array)\n */\nexports.setLengthRight = function (msg, length) {\n    return exports.setLength(msg, length, true);\n};\n/**\n * Trims leading zeros from a `Buffer` or an `Array`.\n * @param a (Buffer|Array|String)\n * @return (Buffer|Array|String)\n */\nexports.unpad = function (a) {\n    a = ethjsUtil.stripHexPrefix(a);\n    var first = a[0];\n    while (a.length > 0 && first.toString() === '0') {\n        a = a.slice(1);\n        first = a[0];\n    }\n    return a;\n};\nexports.stripZeros = exports.unpad;\n/**\n * Attempts to turn a value into a `Buffer`. As input it supports `Buffer`, `String`, `Number`, null/undefined, `BN` and other objects with a `toArray()` method.\n * @param v the value\n */\nexports.toBuffer = function (v) {\n    if (!Buffer.isBuffer(v)) {\n        if (Array.isArray(v)) {\n            v = Buffer.from(v);\n        }\n        else if (typeof v === 'string') {\n            if (ethjsUtil.isHexString(v)) {\n                v = Buffer.from(ethjsUtil.padToEven(ethjsUtil.stripHexPrefix(v)), 'hex');\n            }\n            else {\n                throw new Error(\"Cannot convert string to buffer. toBuffer only supports 0x-prefixed hex strings and this string was given: \" + v);\n            }\n        }\n        else if (typeof v === 'number') {\n            v = ethjsUtil.intToBuffer(v);\n        }\n        else if (v === null || v === undefined) {\n            v = Buffer.allocUnsafe(0);\n        }\n        else if (BN.isBN(v)) {\n            v = v.toArrayLike(Buffer);\n        }\n        else if (v.toArray) {\n            // converts a BN to a Buffer\n            v = Buffer.from(v.toArray());\n        }\n        else {\n            throw new Error('invalid type');\n        }\n    }\n    return v;\n};\n/**\n * Converts a `Buffer` to a `Number`.\n * @param buf `Buffer` object to convert\n * @throws If the input number exceeds 53 bits.\n */\nexports.bufferToInt = function (buf) {\n    return new BN(exports.toBuffer(buf)).toNumber();\n};\n/**\n * Converts a `Buffer` into a `0x`-prefixed hex `String`.\n * @param buf `Buffer` object to convert\n */\nexports.bufferToHex = function (buf) {\n    buf = exports.toBuffer(buf);\n    return '0x' + buf.toString('hex');\n};\n/**\n * Interprets a `Buffer` as a signed integer and returns a `BN`. Assumes 256-bit numbers.\n * @param num Signed integer value\n */\nexports.fromSigned = function (num) {\n    return new BN(num).fromTwos(256);\n};\n/**\n * Converts a `BN` to an unsigned integer and returns it as a `Buffer`. Assumes 256-bit numbers.\n * @param num\n */\nexports.toUnsigned = function (num) {\n    return Buffer.from(num.toTwos(256).toArray());\n};\n/**\n * Adds \"0x\" to a given `String` if it does not already start with \"0x\".\n */\nexports.addHexPrefix = function (str) {\n    if (typeof str !== 'string') {\n        return str;\n    }\n    return ethjsUtil.isHexPrefixed(str) ? str : '0x' + str;\n};\n/**\n * Converts a `Buffer` or `Array` to JSON.\n * @param ba (Buffer|Array)\n * @return (Array|String|null)\n */\nexports.baToJSON = function (ba) {\n    if (Buffer.isBuffer(ba)) {\n        return \"0x\" + ba.toString('hex');\n    }\n    else if (ba instanceof Array) {\n        var array = [];\n        for (var i = 0; i < ba.length; i++) {\n            array.push(exports.baToJSON(ba[i]));\n        }\n        return array;\n    }\n};\n//# sourceMappingURL=bytes.js.map","const customIcons = {\n    '0xb468a1e5596cfbcdf561f21a10490d99b4bb7b68': 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5a/Jeff_Sessions_with_Elmo_and_Rosita_%28cropped%29.jpg/220px-Jeff_Sessions_with_Elmo_and_Rosita_%28cropped%29.jpg', // TEST Polygon ELMO token,\n    '0x88800092ff476844f74dc2fc427974bbee2794ae': 'https://raw.githubusercontent.com/AmbireTech/ambire-brand/main/logos/ambire_logo_white_bg_250x250.png', // Ambire Wallet Token\n    '0x47cd7e91c3cbaaf266369fe8518345fc4fc12935': 'https://raw.githubusercontent.com/AmbireTech/ambire-brand/main/logos/xwallet_250x250.png', //xWallet\n    '0xb6456b57f03352be48bf101b46c1752a0813491a': 'https://raw.githubusercontent.com/AmbireTech/adex-brand/master/logos/vaporwave-adex-2.png', // ADX-STAKING\n    '0xd9a4cb9dc9296e111c66dfacab8be034ee2e1c2c': 'https://raw.githubusercontent.com/AmbireTech/adex-brand/master/logos/ADX-loyalty%40256x256.png', // ADX-LOYALTY\n    '0xec3b10ce9cabab5dbf49f946a623e294963fbb4e': 'https://raw.githubusercontent.com/AmbireTech/ambire-brand/main/logos/xwallet_250x250.png', // Polygons test xWallet\n    '0xe9415e904143e42007865e6864f7f632bd054a08': 'https://raw.githubusercontent.com/AmbireTech/ambire-brand/main/logos/Ambire_logo_250x250.png', // Polygons test Wallet\n    '0xade00c28244d5ce17d72e40330b1c318cd12b7c3': 'https://raw.githubusercontent.com/AmbireTech/ambire-brand/main/official-logos/Ambire-AdEx/Ambire_AdEx_Symbol_color_white_bg.png' //ADX-TOKEN\n}\n\nconst zapperStorageTokenIcons = 'https://storage.googleapis.com/zapper-fi-assets/tokens'\n\nexport function getTokenIcon(networkId = '', address = '') {\n    const addr = address.toLowerCase()\n    const net = networkId.toLowerCase()\n    return customIcons[addr] || `${zapperStorageTokenIcons}/${net}/${addr}.png`\n}\n","export function formatFloatTokenAmount(amount, useGrouping = true, maximumFractionDigits = 18) {\n    if (isNaN(amount) || isNaN(parseFloat(amount)) || !(typeof amount === 'number' || typeof amount === 'string')) return amount\n\n    try {\n        const minimumFractionDigits = Math.min(2, maximumFractionDigits || 0)\n        return ((typeof amount === 'number') ? amount : parseFloat(amount))\n            .toLocaleString(undefined,\n                {\n                    useGrouping,\n                    maximumFractionDigits: Math.max(minimumFractionDigits, maximumFractionDigits),\n                    minimumFractionDigits\n                })\n    } catch (err) {\n        console.error(err)\n        return amount\n    }\n}\n\n// Round a floating point number to a specific decimal places, i.e. 1.156 => 1.16\nexport function roundFloatingNumber(number, places = 2) {\n  const decimals = Math.pow(10, places)\n\n  return Math.round((number + Number.EPSILON) * decimals) / decimals\n}\n","module.exports = require('./lib/index.js')\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ecdhUnsafe = exports.ecdh = exports.recover = exports.verify = exports.sign = exports.signatureImportLax = exports.signatureImport = exports.signatureExport = exports.signatureNormalize = exports.publicKeyCombine = exports.publicKeyTweakMul = exports.publicKeyTweakAdd = exports.publicKeyVerify = exports.publicKeyConvert = exports.publicKeyCreate = exports.privateKeyTweakMul = exports.privateKeyTweakAdd = exports.privateKeyModInverse = exports.privateKeyNegate = exports.privateKeyImport = exports.privateKeyExport = exports.privateKeyVerify = void 0;\nvar secp256k1 = require('ethereum-cryptography/secp256k1');\nvar secp256k1v3 = require('./secp256k1v3-lib/index');\nvar der = require('./secp256k1v3-lib/der');\n/**\n * Verify an ECDSA privateKey\n * @method privateKeyVerify\n * @param {Buffer} privateKey\n * @return {boolean}\n */\nexports.privateKeyVerify = function (privateKey) {\n    // secp256k1 v4 version throws when privateKey length is not 32\n    if (privateKey.length !== 32) {\n        return false;\n    }\n    return secp256k1.privateKeyVerify(Uint8Array.from(privateKey));\n};\n/**\n * Export a privateKey in DER format\n * @method privateKeyExport\n * @param {Buffer} privateKey\n * @param {boolean} compressed\n * @return {boolean}\n */\nexports.privateKeyExport = function (privateKey, compressed) {\n    // secp256k1 v4 version throws when privateKey length is not 32\n    if (privateKey.length !== 32) {\n        throw new RangeError('private key length is invalid');\n    }\n    var publicKey = secp256k1v3.privateKeyExport(privateKey, compressed);\n    return der.privateKeyExport(privateKey, publicKey, compressed);\n};\n/**\n * Import a privateKey in DER format\n * @method privateKeyImport\n * @param {Buffer} privateKey\n * @return {Buffer}\n */\nexports.privateKeyImport = function (privateKey) {\n    // privateKeyImport method is not part of secp256k1 v4 package\n    // this implementation is based on v3\n    privateKey = der.privateKeyImport(privateKey);\n    if (privateKey !== null && privateKey.length === 32 && exports.privateKeyVerify(privateKey)) {\n        return privateKey;\n    }\n    throw new Error(\"couldn't import from DER format\");\n};\n/**\n * Negate a privateKey by subtracting it from the order of the curve's base point\n * @method privateKeyNegate\n * @param {Buffer} privateKey\n * @return {Buffer}\n */\nexports.privateKeyNegate = function (privateKey) {\n    return Buffer.from(secp256k1.privateKeyNegate(Uint8Array.from(privateKey)));\n};\n/**\n * Compute the inverse of a privateKey (modulo the order of the curve's base point).\n * @method privateKeyModInverse\n * @param {Buffer} privateKey\n * @return {Buffer}\n */\nexports.privateKeyModInverse = function (privateKey) {\n    if (privateKey.length !== 32) {\n        throw new Error('private key length is invalid');\n    }\n    return Buffer.from(secp256k1v3.privateKeyModInverse(Uint8Array.from(privateKey)));\n};\n/**\n * Tweak a privateKey by adding tweak to it.\n * @method privateKeyTweakAdd\n * @param {Buffer} privateKey\n * @param {Buffer} tweak\n * @return {Buffer}\n */\nexports.privateKeyTweakAdd = function (privateKey, tweak) {\n    return Buffer.from(secp256k1.privateKeyTweakAdd(Uint8Array.from(privateKey), tweak));\n};\n/**\n * Tweak a privateKey by multiplying it by a tweak.\n * @method privateKeyTweakMul\n * @param {Buffer} privateKey\n * @param {Buffer} tweak\n * @return {Buffer}\n */\nexports.privateKeyTweakMul = function (privateKey, tweak) {\n    return Buffer.from(secp256k1.privateKeyTweakMul(Uint8Array.from(privateKey), Uint8Array.from(tweak)));\n};\n/**\n * Compute the public key for a privateKey.\n * @method publicKeyCreate\n * @param {Buffer} privateKey\n * @param {boolean} compressed\n * @return {Buffer}\n */\nexports.publicKeyCreate = function (privateKey, compressed) {\n    return Buffer.from(secp256k1.publicKeyCreate(Uint8Array.from(privateKey), compressed));\n};\n/**\n * Convert a publicKey to compressed or uncompressed form.\n * @method publicKeyConvert\n * @param {Buffer} publicKey\n * @param {boolean} compressed\n * @return {Buffer}\n */\nexports.publicKeyConvert = function (publicKey, compressed) {\n    return Buffer.from(secp256k1.publicKeyConvert(Uint8Array.from(publicKey), compressed));\n};\n/**\n * Verify an ECDSA publicKey.\n * @method publicKeyVerify\n * @param {Buffer} publicKey\n * @return {boolean}\n */\nexports.publicKeyVerify = function (publicKey) {\n    // secp256k1 v4 version throws when publicKey length is not 33 or 65\n    if (publicKey.length !== 33 && publicKey.length !== 65) {\n        return false;\n    }\n    return secp256k1.publicKeyVerify(Uint8Array.from(publicKey));\n};\n/**\n * Tweak a publicKey by adding tweak times the generator to it.\n * @method publicKeyTweakAdd\n * @param {Buffer} publicKey\n * @param {Buffer} tweak\n * @param {boolean} compressed\n * @return {Buffer}\n */\nexports.publicKeyTweakAdd = function (publicKey, tweak, compressed) {\n    return Buffer.from(secp256k1.publicKeyTweakAdd(Uint8Array.from(publicKey), Uint8Array.from(tweak), compressed));\n};\n/**\n * Tweak a publicKey by multiplying it by a tweak value\n * @method publicKeyTweakMul\n * @param {Buffer} publicKey\n * @param {Buffer} tweak\n * @param {boolean} compressed\n * @return {Buffer}\n */\nexports.publicKeyTweakMul = function (publicKey, tweak, compressed) {\n    return Buffer.from(secp256k1.publicKeyTweakMul(Uint8Array.from(publicKey), Uint8Array.from(tweak), compressed));\n};\n/**\n * Add a given publicKeys together.\n * @method publicKeyCombine\n * @param {Array<Buffer>} publicKeys\n * @param {boolean} compressed\n * @return {Buffer}\n */\nexports.publicKeyCombine = function (publicKeys, compressed) {\n    var keys = [];\n    publicKeys.forEach(function (publicKey) {\n        keys.push(Uint8Array.from(publicKey));\n    });\n    return Buffer.from(secp256k1.publicKeyCombine(keys, compressed));\n};\n/**\n * Convert a signature to a normalized lower-S form.\n * @method signatureNormalize\n * @param {Buffer} signature\n * @return {Buffer}\n */\nexports.signatureNormalize = function (signature) {\n    return Buffer.from(secp256k1.signatureNormalize(Uint8Array.from(signature)));\n};\n/**\n * Serialize an ECDSA signature in DER format.\n * @method signatureExport\n * @param {Buffer} signature\n * @return {Buffer}\n */\nexports.signatureExport = function (signature) {\n    return Buffer.from(secp256k1.signatureExport(Uint8Array.from(signature)));\n};\n/**\n * Parse a DER ECDSA signature (follow by [BIP66](https://github.com/bitcoin/bips/blob/master/bip-0066.mediawiki)).\n * @method signatureImport\n * @param {Buffer} signature\n * @return {Buffer}\n */\nexports.signatureImport = function (signature) {\n    return Buffer.from(secp256k1.signatureImport(Uint8Array.from(signature)));\n};\n/**\n * Parse a DER ECDSA signature (not follow by [BIP66](https://github.com/bitcoin/bips/blob/master/bip-0066.mediawiki)).\n * @method signatureImportLax\n * @param {Buffer} signature\n * @return {Buffer}\n */\nexports.signatureImportLax = function (signature) {\n    // signatureImportLax method is not part of secp256k1 v4 package\n    // this implementation is based on v3\n    // ensure that signature is greater than 0\n    if (signature.length === 0) {\n        throw new RangeError('signature length is invalid');\n    }\n    var sigObj = der.signatureImportLax(signature);\n    if (sigObj === null) {\n        throw new Error(\"couldn't parse DER signature\");\n    }\n    return secp256k1v3.signatureImport(sigObj);\n};\n/**\n * Create an ECDSA signature. Always return low-S signature.\n * @method sign\n * @param {Buffer} message\n * @param {Buffer} privateKey\n * @param {Object} options\n * @return {Buffer}\n */\nexports.sign = function (message, privateKey, options) {\n    if (options === null) {\n        throw new TypeError('options should be an Object');\n    }\n    var signOptions = undefined;\n    if (options) {\n        signOptions = {};\n        if (options.data === null) {\n            // validate option.data length\n            throw new TypeError('options.data should be a Buffer');\n        }\n        if (options.data) {\n            if (options.data.length != 32) {\n                throw new RangeError('options.data length is invalid');\n            }\n            signOptions.data = new Uint8Array(options.data);\n        }\n        if (options.noncefn === null) {\n            throw new TypeError('options.noncefn should be a Function');\n        }\n        if (options.noncefn) {\n            // convert option.noncefn function signature\n            signOptions.noncefn = function (message, privateKey, algo, data, attempt) {\n                var bufferAlgo = algo != null ? Buffer.from(algo) : null;\n                var bufferData = data != null ? Buffer.from(data) : null;\n                var buffer = Buffer.from('');\n                if (options.noncefn) {\n                    buffer = options.noncefn(Buffer.from(message), Buffer.from(privateKey), bufferAlgo, bufferData, attempt);\n                }\n                return new Uint8Array(buffer);\n            };\n        }\n    }\n    var sig = secp256k1.ecdsaSign(Uint8Array.from(message), Uint8Array.from(privateKey), signOptions);\n    return {\n        signature: Buffer.from(sig.signature),\n        recovery: sig.recid,\n    };\n};\n/**\n * Verify an ECDSA signature.\n * @method verify\n * @param {Buffer} message\n * @param {Buffer} signature\n * @param {Buffer} publicKey\n * @return {boolean}\n */\nexports.verify = function (message, signature, publicKey) {\n    return secp256k1.ecdsaVerify(Uint8Array.from(signature), Uint8Array.from(message), publicKey);\n};\n/**\n * Recover an ECDSA public key from a signature.\n * @method recover\n * @param {Buffer} message\n * @param {Buffer} signature\n * @param {Number} recid\n * @param {boolean} compressed\n * @return {Buffer}\n */\nexports.recover = function (message, signature, recid, compressed) {\n    return Buffer.from(secp256k1.ecdsaRecover(Uint8Array.from(signature), recid, Uint8Array.from(message), compressed));\n};\n/**\n * Compute an EC Diffie-Hellman secret and applied sha256 to compressed public key.\n * @method ecdh\n * @param {Buffer} publicKey\n * @param {Buffer} privateKey\n * @return {Buffer}\n */\nexports.ecdh = function (publicKey, privateKey) {\n    // note: secp256k1 v3 doesn't allow optional parameter\n    return Buffer.from(secp256k1.ecdh(Uint8Array.from(publicKey), Uint8Array.from(privateKey), {}));\n};\nexports.ecdhUnsafe = function (publicKey, privateKey, compressed) {\n    // ecdhUnsafe method is not part of secp256k1 v4 package\n    // this implementation is based on v3\n    // ensure valid publicKey length\n    if (publicKey.length !== 33 && publicKey.length !== 65) {\n        throw new RangeError('public key length is invalid');\n    }\n    // ensure valid privateKey length\n    if (privateKey.length !== 32) {\n        throw new RangeError('private key length is invalid');\n    }\n    return Buffer.from(secp256k1v3.ecdhUnsafe(Uint8Array.from(publicKey), Uint8Array.from(privateKey), compressed));\n};\n//# sourceMappingURL=secp256k1v3-adapter.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.rlphash = exports.ripemd160 = exports.sha256 = exports.keccak256 = exports.keccak = void 0;\nvar _a = require('ethereum-cryptography/keccak'), keccak224 = _a.keccak224, keccak384 = _a.keccak384, k256 = _a.keccak256, keccak512 = _a.keccak512;\nvar createHash = require('create-hash');\nvar ethjsUtil = require('ethjs-util');\nvar rlp = require(\"rlp\");\nvar bytes_1 = require(\"./bytes\");\n/**\n * Creates Keccak hash of the input\n * @param a The input data (Buffer|Array|String|Number) If the string is a 0x-prefixed hex value\n * it's interpreted as hexadecimal, otherwise as utf8.\n * @param bits The Keccak width\n */\nexports.keccak = function (a, bits) {\n    if (bits === void 0) { bits = 256; }\n    if (typeof a === 'string' && !ethjsUtil.isHexString(a)) {\n        a = Buffer.from(a, 'utf8');\n    }\n    else {\n        a = bytes_1.toBuffer(a);\n    }\n    if (!bits)\n        bits = 256;\n    switch (bits) {\n        case 224: {\n            return keccak224(a);\n        }\n        case 256: {\n            return k256(a);\n        }\n        case 384: {\n            return keccak384(a);\n        }\n        case 512: {\n            return keccak512(a);\n        }\n        default: {\n            throw new Error(\"Invald algorithm: keccak\" + bits);\n        }\n    }\n};\n/**\n * Creates Keccak-256 hash of the input, alias for keccak(a, 256).\n * @param a The input data (Buffer|Array|String|Number)\n */\nexports.keccak256 = function (a) {\n    return exports.keccak(a);\n};\n/**\n * Creates SHA256 hash of the input.\n * @param a The input data (Buffer|Array|String|Number)\n */\nexports.sha256 = function (a) {\n    a = bytes_1.toBuffer(a);\n    return createHash('sha256')\n        .update(a)\n        .digest();\n};\n/**\n * Creates RIPEMD160 hash of the input.\n * @param a The input data (Buffer|Array|String|Number)\n * @param padded Whether it should be padded to 256 bits or not\n */\nexports.ripemd160 = function (a, padded) {\n    a = bytes_1.toBuffer(a);\n    var hash = createHash('rmd160')\n        .update(a)\n        .digest();\n    if (padded === true) {\n        return bytes_1.setLength(hash, 32);\n    }\n    else {\n        return hash;\n    }\n};\n/**\n * Creates SHA-3 hash of the RLP encoded version of the input.\n * @param a The input data\n */\nexports.rlphash = function (a) {\n    return exports.keccak(rlp.encode(a));\n};\n//# sourceMappingURL=hash.js.map","import { Client } from 'gridplus-sdk'\nimport { ethers } from 'ethers'\nimport { serialize } from '@ethersproject/transactions'\n\nconst crypto = require('crypto')\nconst HARDENED_OFFSET = 0x80000000\n\nconst getAddressesReqOpts = {\n    startPath: [\n        HARDENED_OFFSET + 44,\n        HARDENED_OFFSET + 60,\n        HARDENED_OFFSET,\n        0,\n        0,\n    ],\n    n: 10,\n}\n\nconst latticeInit = commKey => {\n    const clientConfig = {\n        name: 'Ambire Wallet',\n        crypto: crypto,\n        privKey: commKey,\n    }\n\n    return new Client(clientConfig)\n}\n\nconst latticeConnect = async(client, deviceId) => {\n    return await new Promise((resolve, reject) => {\n        client.connect(deviceId, (err, isPaired) => {\n            if (err) {\n                reject(`Lattice connect: ${err} Or check if the DeviceID is correct.`)\n                return\n            }\n            \n            resolve({ isPaired: !!isPaired, errConnect: false })\n        })\n    }).catch(err => {\n        console.error(err)\n        return { isPaired: false, errConnect: err }\n    })\n}\n\nconst latticePair = async(client, secret) => {\n    return await new Promise((resolve, reject) => {\n        client.pair(secret, (err, hasActiveWallet) => {\n            if (err) {\n                reject(`Lattice connect: ${err}`)\n                return\n            }\n            \n            resolve({ hasActiveWallet, errPair: false })\n        })\n    }).catch(err => {\n        console.error(err)\n        return { hasActiveWallet: false, errPair: err }\n    })\n}\n\nconst latticeGetAddresses = async client => {\n    return await new Promise((resolve, reject) => {\n        client.getAddresses(getAddressesReqOpts, (err, res) => {\n            if (err) {\n                reject(`Lattice get addresses: ${err}`)\n                return\n            }\n\n            if (!res) throw new Error('Lattice could not get the addresses.')\n\n            resolve({res, errGetAddresses: false })\n        })\n    }).catch(err => {\n        console.error(err)\n        return { res: null, errGetAddresses: err }\n    })\n}\n\nconst latticeSignMessage = async(client, hash) => {\n    const dataMsg = {\n        protocol: 'signPersonal',\n        payload: ethers.utils.hexlify(hash),\n        signerPath: [HARDENED_OFFSET+44, HARDENED_OFFSET+60, HARDENED_OFFSET, 0, 0],\n    }\n\n    const signOptsMsg = {\n        currency: 'ETH_MSG',\n        data: dataMsg,\n    }\n\n    \n    return await new Promise((resolve, reject) => {\n        client.sign(signOptsMsg, (err, signedTx) => {\n            if (err) {\n                reject(err)\n                return\n            }\n\n            if (!signedTx) throw new Error('Lattice could not sign the message.')\n            \n            resolve({ signedMsg: '0x' + signedTx.sig.r + signedTx.sig.s + signedTx.sig.v[0].toString(16), errSignMessage: false })  \n        })\n    }).catch(err => {\n        console.error(err)\n        return { signedMsg: null, errSignMessage: err }\n    })\n}\n\nconst latticeSignMessage712 = async(client, message) => {\n    const reqData = {\n        currency: 'ETH_MSG',\n        data: {\n          signerPath: [HARDENED_OFFSET+44, HARDENED_OFFSET+60, HARDENED_OFFSET, 0, 0],\n          protocol: 'eip712', // You must use this string to specify this protocol\n          payload: message\n        }\n      }\n\n    return await new Promise((resolve, reject) => {\n        client.sign(reqData, (err, signedTx) => {\n            if (err) {\n                reject(err)\n                return\n            }\n\n            if (!signedTx) throw new Error('Lattice could not sign the message.')\n            \n            resolve({ signedMsg: '0x' + signedTx.sig.r + signedTx.sig.s + signedTx.sig.v[0].toString(16), errSignMessage: false })  \n        })\n    }).catch(err => {\n        console.error(err)\n        return { signedMsg: null, errSignMessage: err }\n    })\n}\n\nconst latticeSignTransaction = async(client, txn, chainId) => {\n    const { to, data, gas, gasPrice, nonce, value = 0 } = txn\n    const unsignedTxObj = {\n        ...txn,\n        gasLimit: txn.gasLimit || txn.gas,\n        chainId\n    }\n    delete unsignedTxObj.from\n    delete unsignedTxObj.gas\n\n    const txData = {\n        nonce,\n        gasLimit: gas || txn.gasLimit,\n        gasPrice,\n        to,\n        value,\n        data: data || '',\n        // -- m/44'/60'/0'/0/0\n        signerPath: [HARDENED_OFFSET+44, HARDENED_OFFSET+60, HARDENED_OFFSET, 0, 0],\n        chainId,\n        useEIP155: true,\n    }\n\n    const signOpts = {\n        currency: 'ETH',\n        data: txData,\n    }\n\n    \n    return await new Promise((resolve, reject) => {\n        client.sign(signOpts, (err, signedTx) => {\n            if (err) {\n                reject(err)\n                return\n            }\n\n            if (!signedTx) throw new Error('Lattice could not sign the message.')\n            \n            delete unsignedTxObj.v\n            const serializedSigned = serialize(unsignedTxObj, {\n                r: '0x' + signedTx.sig.r,\n                s: '0x' + signedTx.sig.s,\n                v: signedTx.sig.v[0].toString(16)\n            })\n            \n            resolve({ serializedSigned, errSignTxn: false })\n        })\n    }).catch(err => {\n        console.error(err)\n        return { serializedSigned: null, errSignTxn: err }\n    })\n}\n\nexport { \n    latticeInit,\n    latticeConnect,\n    latticePair,\n    latticeGetAddresses,\n    latticeSignMessage,\n    latticeSignMessage712,\n    latticeSignTransaction\n }\n","import { TrezorSubprovider } from '@0x/subproviders/lib/src/subproviders/trezor' // https://github.com/0xProject/0x-monorepo/issues/1400\nimport TrezorConnect from '@trezor/connect-web'\nimport { ethers } from 'ethers'\nimport HDNode from 'hdkey'\nimport { LedgerSubprovider } from '@0x/subproviders/lib/src/subproviders/ledger' // https://github.com/0xProject/0x-monorepo/issues/1400\nimport { ledgerEthereumBrowserClientFactoryAsync } from '@0x/subproviders/lib/src' // https://github.com/0xProject/0x-monorepo/issues/1400\nimport { ledgerSignMessage, ledgerSignTransaction, ledgerSignMessage712, ledgerGetAddresses } from './ledgerWebHID'\nimport { \n  latticeInit, \n  latticeConnect, \n  latticeSignMessage, \n  latticeSignTransaction, \n  latticeGetAddresses, \n  latticeSignMessage712\n } from 'lib/lattice'\nimport { _TypedDataEncoder } from 'ethers/lib/utils'\nimport { getProvider } from 'lib/provider'\nimport networks from 'consts/networks'\n\nlet wallets = {}\n\n// opts\n// passphrase: string\n// noCache: boolean\nexport function getWallet({ signer, signerExtra, chainId }, opts = {}) {\n  const id = `${signer.address || signer.one}${chainId}`\n  if (wallets[id]) return wallets[id]\n  return wallets[id] = getWalletNew({ signer, signerExtra, chainId }, opts)\n}\n\nfunction getWalletNew({ chainId, signer, signerExtra }, opts) {\n  if (signerExtra && signerExtra.type === 'trezor') {\n    const providerTrezor = new TrezorSubprovider({\n      trezorConnectClientApi: TrezorConnect,\n      networkId: chainId\n    })\n    providerTrezor._initialDerivedKeyInfo = getInitialDerivedKeyInfo(signerExtra)\n    // for Trezor/ledger, alternatively we can shim using https://www.npmjs.com/package/web3-provider-engine and then wrap in Web3Provider\n    return {\n      signMessage: hash => providerTrezor.signPersonalMessageAsync(ethers.utils.hexlify(hash), signer.address),\n      signTransaction: params => providerTrezor.signTransactionAsync({ ...params, from: signer.address }),\n      sendTransaction: async (transaction) => {\n        const network = networks.find(n => n.chainId === transaction.chainId)\n        if (!network) throw Error('no network found for chainId : ' + transaction.chainId)\n        const broadcastProvider = await getProvider(network.id)\n        if (!broadcastProvider) throw Error('no provider found for network : ' + network.id)\n\n        transaction.nonce = ethers.utils.hexlify(await broadcastProvider.getTransactionCount(transaction.from))\n        const gas = ethers.utils.hexlify(transaction.gas || transaction.gasLimit)\n        transaction.gasPrice = ethers.utils.hexlify(transaction.gasPrice)\n        \n        transaction = {\n          ...transaction,\n          gas // trezor params requires gas prop\n          // no chainId prop but chainId already known by providerTrezor\n        }\n        \n        const signedTx = await providerTrezor.signTransactionAsync(transaction)\n        \n        return broadcastProvider.sendTransaction(signedTx)\n      },\n      isConnected: async (matchAddress) => { // chain is provided to trezor. Not necessary to check network\n        const addresses = await providerTrezor.getAccountsAsync(100)\n        return addresses.map(i => i.toLowerCase()).includes(matchAddress.toLowerCase())\n      },\n      _signTypedData: async (domain, types, value) => {\n        \n        const domainSeparator = _TypedDataEncoder.hashDomain(domain)\n        const hashStructMessage = _TypedDataEncoder.hashStruct(_TypedDataEncoder.getPrimaryType(types), types, value)\n        const data = _TypedDataEncoder.getPayload(domain, types, value)\n        const initialDerivedKeyInfo = await providerTrezor._initialDerivedKeyInfoAsync()\n        const derivedKeyInfo = providerTrezor._findDerivedKeyInfoForAddress(initialDerivedKeyInfo, signer.address)\n        const path = derivedKeyInfo.derivationPath\n\n        const response = await providerTrezor._trezorConnectClientApi.ethereumSignTypedData({\n          path,\n          data,\n          metamask_v4_compat: true,\n          domain_separator_hash: domainSeparator,\n          message_hash: hashStructMessage\n        })\n\n        if (response.success) {\n          return `${response.payload.signature}`;\n        } else {\n            throw new Error(response.payload.error);\n        }\n      }\n    }\n  } else if (signerExtra && signerExtra.type === 'ledger') {\n    if (signerExtra.transportProtocol === 'webHID') {\n      return {\n        signMessage: hash => ledgerSignMessage(ethers.utils.hexlify(hash), signer.address),\n        signTransaction: params => ledgerSignTransaction(params, chainId),\n        sendTransaction: async (transaction) => {\n          const network = networks.find(n => n.chainId === transaction.chainId)\n          if (!network) throw Error('no network found for chainId : ' + transaction.chainId)\n          const provider = await getProvider(network.id)\n          if (!provider) throw Error('no provider found for network : ' + network.id)\n\n          transaction.nonce = ethers.utils.hexlify(await provider.getTransactionCount(transaction.from))\n\n          const signedTx = await ledgerSignTransaction(transaction, transaction.chainId)\n\n          return provider.sendTransaction(signedTx)\n        },\n        isConnected: async (matchAddress) => { // chain is provided to ledger. Not necessary to check network\n          const addresses = await ledgerGetAddresses()\n          if (addresses && addresses[0]) {\n            if (matchAddress) {\n              return !!addresses.find(a => a.toLowerCase() === matchAddress.toLowerCase())\n            }\n            return true\n          }\n          return false\n        },\n        _signTypedData: (domain, types, value) => {\n          const domainSeparator = _TypedDataEncoder.hashDomain(domain)\n          const hashStructMessage = _TypedDataEncoder.hashStruct(_TypedDataEncoder.getPrimaryType(types), types, value)\n          return ledgerSignMessage712(domainSeparator, hashStructMessage, signer.address)\n        }\n      }\n    } else {\n      const provider = new LedgerSubprovider({\n        networkId: chainId,\n        ledgerEthereumClientFactoryAsync: ledgerEthereumBrowserClientFactoryAsync,\n        baseDerivationPath: signerExtra.info.baseDerivationPath\n      })\n      return {\n        signMessage: hash => provider.signPersonalMessageAsync(ethers.utils.hexlify(hash), signer.address),\n        signTransaction: params => provider.signTransactionAsync({ ...params, from: signer.address }),\n        sendTransaction: async () => {\n          throw Error('Please use a chrome based browser to use Ledger')\n        },\n        isConnected: async (matchAddress) => { // chain is provided to ledger. Not necessary to check network\n          const addresses = await provider.getAccountsAsync(1)\n          return addresses.map(i => i.toLowerCase()).includes(matchAddress.toLowerCase())\n        },\n        _signTypedData: (domain, types, value) => {\n          throw Error('Please, use a chrome based browser to use 721 Typed signatures')\n        }\n      }\n    }\n  } else if (signerExtra && signerExtra.type === 'Lattice') {\n    return {\n      signMessage: async hash => {\n        return await wrapLatticeError(async hash => {\n          const { commKey, deviceId } = signerExtra\n          const client = latticeInit(commKey)\n          const {isPaired, errConnect } = await latticeConnect(client, deviceId)\n\n          if (errConnect) throw new Error(errConnect.message || errConnect)\n\n          if (!isPaired) {\n            // Canceling the visualization of the secret code on the device's screen.\n            client.pair('')\n            throw new Error('The Lattice device is not paired! Please re-add your account!')\n          }\n\n          const { signedMsg, errSignMessage } = await latticeSignMessage(client, hash)\n          if (errSignMessage) throw new Error(errSignMessage)\n\n          return signedMsg\n        }, [hash])\n      },\n      signTransaction: async params => {\n        return await wrapLatticeError( async params => {\n          const { commKey, deviceId } = signerExtra\n          const client = latticeInit(commKey)\n          const {isPaired, errConnect } = await latticeConnect(client, deviceId)\n\n          if (errConnect) throw new Error(errConnect.message || errConnect)\n\n          if (!isPaired) {\n            // Canceling the visualization of the secret code on the device's screen.\n            client.pair('')\n            throw new Error('The Lattice device is not paired! Please re-add your account!')\n          }\n\n          const { serializedSigned, errSignTxn } = await latticeSignTransaction(client, params, chainId)\n          if (errSignTxn) throw new Error(errSignTxn)\n\n          return serializedSigned\n        }, [params])\n      },\n      sendTransaction: async transaction => { \n        return await wrapLatticeError(async (transaction) => {\n          const network = networks.find(n => n.chainId === transaction.chainId)\n          if (!network) throw Error('no network found for chainId : ' + transaction.chainId)\n          const broadcastProvider = await getProvider(network.id)\n          if (!broadcastProvider) throw Error('no provider found for network : ' + network.id)\n          transaction.nonce = ethers.utils.hexlify(await broadcastProvider.getTransactionCount(transaction.from))\n          const { commKey, deviceId } = signerExtra\n          const client = latticeInit(commKey)\n          const { isPaired, errConnect } = await latticeConnect(client, deviceId)\n\n          if (errConnect) throw new Error(errConnect.message || errConnect)\n\n          if (!isPaired) {\n            // Canceling the visualization of the secret code on the device's screen.\n            client.pair('')\n            throw new Error('The Lattice device is not paired! Please re-add your account!')\n          }\n\n          const { serializedSigned, errSignTxn } = await latticeSignTransaction(client, transaction, chainId)\n          if (errSignTxn) throw new Error(errSignTxn)\n\n          return broadcastProvider.sendTransaction(serializedSigned)\n        }, [transaction])\n      },\n      isConnected: async matchAddress => { \n        return await wrapLatticeError(async (matchAddress) => {\n          let addresses = null\n\n          const { commKey, deviceId } = signerExtra\n          const client = latticeInit(commKey)\n          const { isPaired, errConnect } = await latticeConnect(client, deviceId)\n\n          if (errConnect) throw new Error(errConnect.message || errConnect)\n\n          if (!isPaired) {\n            // Canceling the visualization of the secret code on the device's screen.\n            client.pair('')\n            throw new Error('The Lattice device is not paired! Please re-add your account!')\n          }\n\n          const { res, errGetAddresses } = await latticeGetAddresses(client)\n          if (errGetAddresses) { \n            throw new Error(`Lattice: ${errGetAddresses}`, { error: true })\n          }\n\n          addresses = res\n          return addresses.map(i => i.toLowerCase()).includes(matchAddress.toLowerCase())\n        }, [matchAddress])\n    },\n    _signTypedData: async (domain, types, value) => {\n      return await wrapLatticeError(async (domain, types, value) => {\n        const payload = _TypedDataEncoder.getPayload(domain, types, value)\n        const { commKey, deviceId } = signerExtra\n        const client = latticeInit(commKey)\n        const {isPaired, errConnect } = await latticeConnect(client, deviceId)\n\n        if (errConnect) throw new Error(errConnect.message || errConnect)\n\n        if (!isPaired) {\n          // Canceling the visualization of the secret code on the device's screen.\n          client.pair('')\n          throw new Error('The Lattice device is not paired! Please re-add your account!')\n        }\n\n        const { signedMsg, errSignMessage } = await latticeSignMessage712(client, payload)\n        if (errSignMessage) throw new Error(errSignMessage)\n\n        return signedMsg\n      }, [domain, types, value])\n    }\n  }\n  } else if (signer.address) {\n    if (!window.ethereum) throw new Error('No web3 support detected in your browser: if you created this account through MetaMask, please install it.')\n    // NOTE: for metamask, use `const provider = new ethers.providers.Web3Provider(window.ethereum)`\n    // 'any' is explained here: https://github.com/ethers-io/ethers.js/issues/1107\n    const provider = new ethers.providers.Web3Provider(window.ethereum, 'any')\n\n    const signerObject = provider.getSigner(signer.address)\n\n    signerObject.isConnected = async (matchAddress, matchChain) => {\n      const accounts = await provider.listAccounts()\n\n      let match = true\n      if (!!(accounts.length)) {\n        if (matchAddress) {\n          match = !!accounts.find(a => a.toLowerCase() === matchAddress.toLowerCase())\n        }\n        if (matchChain) {\n          const { chainId } = await provider.getNetwork()\n          match = match && chainId === matchChain\n        }\n      } else {\n        match = false\n      }\n      return match\n    }\n\n    return signerObject\n  } else if (signer.one) {\n    throw new Error('getWallet not applicable for QuickAccounts: use primaryKeyBackup with the passphrase and /second-sig')\n  } else {\n    throw new Error('unknown signer type')\n  }\n}\n\nfunction getInitialDerivedKeyInfo(signerExtra) {\n  return {\n    hdKey: HDNode.fromExtendedKey(signerExtra.info.hdKey.xpub),\n    derivationPath: signerExtra.info.derivationPath,\n    baseDerivationPath: signerExtra.info.baseDerivationPath\n  }\n}\n\nasync function wrapLatticeError(fn, arg) {\n  return await fn.apply(this, arg)\n   .catch(e => {\n     throw new Error(`Lattice: ${e.message}`)\n    })\n}\n","import TransportWebHID from '@ledgerhq/hw-transport-webhid'\nimport AppEth from '@ledgerhq/hw-app-eth'\nimport { serialize } from '@ethersproject/transactions'\n\nconst EIP_155_CONSTANT = 35\n\nconst ethUtil = require('ethereumjs-util')\nconst HDNode = require('hdkey')\n\nlet connectedDevices = null\n\nexport const PARENT_HD_PATH = \"44'/60'/0'/0\"\n\nasync function getTransport() {\n  connectedDevices = await TransportWebHID.list()\n  if (connectedDevices.length) {\n    if (connectedDevices[0].opened) {\n      return new TransportWebHID(connectedDevices[0])\n    } else { // when transport is still not closed and time between 2 requests is short\n      return TransportWebHID.open(connectedDevices[0])\n    }\n  } else {\n    try {\n      return await TransportWebHID.request()\n    } catch (e) {\n      if (e.message.includes('reading \\'open\\'')) {\n        throw new Error('ledger WebHID request denied')\n      }\n      throw new Error('Could not request WebHID ledger: ' + e.message)\n    }\n  }\n}\n\nexport async function ledgerGetAddresses() {\n  const transport = await getTransport()\n  const accounts = await getAccounts(transport)\n  transport.close()\n\n  return accounts.map(a => a.address)\n}\n\nasync function getAccounts(transport) {\n  const parentKeyDerivationPath = `m/${PARENT_HD_PATH}`\n  let ledgerResponse\n  ledgerResponse = await getAddressInternal(transport, parentKeyDerivationPath).then(o => o).catch(err => {\n    if (err.statusCode === 25871 || err.statusCode === 27404) {\n      throw Error('Please make sure your ledger is unlocked and running the Ethereum app. ' + err.message)\n    } else {\n      throw Error('Could not get address from ledger : ' + err)\n    }\n  })\n\n  const hdKey = new HDNode()\n  hdKey.publicKey = Buffer.from(ledgerResponse.publicKey, 'hex')\n  hdKey.chainCode = Buffer.from(ledgerResponse.chainCode, 'hex')\n  const mainAddress = addressOfHDKey(hdKey)\n\n  const initialDerivedKeyInfo = {\n    hdKey,\n    address: mainAddress,\n    derivationPath: parentKeyDerivationPath,\n    baseDerivationPath: PARENT_HD_PATH,\n  }\n\n  // currently we can't get addrs to match with what appears in MM/Ledger live so only one is derived\n  return calculateDerivedHDKeyInfos(initialDerivedKeyInfo, 1)\n}\n\n\nasync function getAddressInternal(transport, parentKeyDerivationPath) {\n  let timeoutHandle\n  const appEth = new AppEth(transport)\n\n  const ledgerTimeout = new Promise((resolve, reject) => {\n    timeoutHandle = setTimeout(() => {\n      return reject(new Error('Device took too long to respond...'))\n    }, 10000)\n  })\n\n  return Promise.race([\n    appEth.getAddress(parentKeyDerivationPath, false, true),\n    ledgerTimeout\n  ]).then((res) => {\n    clearTimeout(timeoutHandle)\n    return res\n  })\n}\n\nexport async function ledgerSignTransaction(txn, chainId) {\n  const transport = await getTransport()\n\n  const fromAddr = txn.from\n\n  const unsignedTxObj = {\n    ...txn,\n    gasLimit: txn.gasLimit || txn.gas,\n    chainId: chainId\n  }\n  delete unsignedTxObj.from\n  delete unsignedTxObj.gas\n\n  let serializedUnsigned = serialize(unsignedTxObj)\n  const accountsData = await getAccounts(transport)\n\n  //Managing only 1 addr for now\n  const address = accountsData[0].address\n\n  let serializedSigned\n  if (address.toLowerCase() === fromAddr.toLowerCase()) {\n    let rsvResponse\n    try {\n      rsvResponse = await new AppEth(transport).signTransaction(accountsData[0].derivationPath, serializedUnsigned.substr(2))\n    } catch (e) {\n      throw new Error('Could not sign transaction ' + e)\n    }\n\n    const intV = parseInt(rsvResponse.v, 16)\n    const signedChainId = Math.floor((intV - EIP_155_CONSTANT) / 2)\n\n    if (signedChainId !== chainId) {\n      throw new Error('Invalid returned V 0x' + rsvResponse.v)\n    }\n\n    delete unsignedTxObj.v\n    serializedSigned = serialize(unsignedTxObj, {\n      r: '0x' + rsvResponse.r,\n      s: '0x' + rsvResponse.s,\n      v: intV\n    })\n  } else {\n    throw new Error('Incorrect address. Are you using the correct account/ledger?')\n  }\n\n  transport.close()\n\n  return serializedSigned\n}\n\nexport async function ledgerSignMessage(hash, signerAddress) {\n  const transport = await getTransport()\n\n  const accountsData = await getAccounts(transport)\n\n  //TODO for multiple accs?\n  const account = accountsData[0]\n\n  let signedMsg\n  if (account.address.toLowerCase() === signerAddress.toLowerCase()) {\n    try {\n      const rsvReply = await new AppEth(transport).signPersonalMessage(account.derivationPath, hash.substr(2))\n      signedMsg = '0x' + rsvReply.r + rsvReply.s + rsvReply.v.toString(16)\n    } catch (e) {\n      throw new Error('Signature denied ' + e.message)\n    }\n  } else {\n    throw new Error('Incorrect address. Are you using the correct account/ledger?')\n  }\n  transport.close()\n  return signedMsg\n}\n\nexport async function ledgerSignMessage712(domainSeparator, hashStructMessage, signerAddress) {\n  const transport = await getTransport()\n\n  const accountsData = await getAccounts(transport)\n\n  //TODO for multiple accs?\n  const account = accountsData[0]\n\n  let signedMsg\n  if (account.address.toLowerCase() === signerAddress.toLowerCase()) {\n    try {\n      const rsvReply = await new AppEth(transport).signEIP712HashedMessage(account.derivationPath, domainSeparator, hashStructMessage)\n      signedMsg = '0x' + rsvReply.r + rsvReply.s + rsvReply.v.toString(16)\n    } catch (e) {\n      throw new Error('Signature denied ' + e.message)\n    }\n  } else {\n    throw new Error('Incorrect address. Are you using the correct account/ledger?')\n  }\n  transport.close()\n  return signedMsg\n}\n\nfunction calculateDerivedHDKeyInfos(initialDerivedKeyInfo, count) {\n  const derivedKeys = []\n  for (let i = 0; i < count; i++) {\n\n    const fullDerivationPath = `m/${initialDerivedKeyInfo.baseDerivationPath}/${i}`\n    const path = `m/${i}`\n    const hdKey = initialDerivedKeyInfo.hdKey.derive(path)\n    const address = addressOfHDKey(hdKey)\n    const derivedKey = {\n      address,\n      hdKey,\n      baseDerivationPath: initialDerivedKeyInfo.baseDerivationPath,\n      derivationPath: fullDerivationPath,\n    }\n\n    derivedKeys.push(derivedKey)\n  }\n  return derivedKeys\n}\n\nexport function addressOfHDKey(hdKey) {\n  const shouldSanitizePublicKey = true\n  const derivedPublicKey = hdKey.publicKey\n  const ethereumAddressUnprefixed = ethUtil\n    .publicToAddress(derivedPublicKey, shouldSanitizePublicKey)\n    .toString('hex')\n  return ethUtil.addHexPrefix(ethereumAddressUnprefixed).toLowerCase()\n}\n","const { AbiCoder, hexlify, arrayify, keccak256, Interface } = require('ethers').utils\nconst { Contract, BigNumber } = require('ethers')\n\nconst ensure = require('./ensureTypes')\n\nconst IdentityABI = require('../abi/Identity5.2')\nconst QuickAccManagerABI = require('../abi/QuickAccManager')\n\nconst IdentityInterface = new Interface(IdentityABI)\n\nfunction Bundle(args) {\n\tthis.identity = ensure.Address(args.identity)\n\tthis.network = args.network\n\t// @TODO validate this\n\tthis.signer = args.signer\n\tthis.txns = args.txns\n\tthis.gasLimit = args.gasLimit\n\tthis.nonce = args.nonce\n\tthis.signature = args.signature\n\tthis.minFeeInUSDPerGas = args.minFeeInUSDPerGas\n\tthis.recoveryMode = args.recoveryMode\n\tthis.meta = args.meta\n\tthis.gasTankFee = args.gasTankFee\n\treturn this\n}\n\nBundle.prototype.getNonce = async function(provider) {\n\tthis.nonce = await getNonce(provider, this)\n\treturn this.nonce\n}\n\nBundle.prototype.estimate = async function({ fetch, relayerURL, replacing, getNextNonce, gasTank }) {\n\tconst queryParams = Object.fromEntries(Object.entries({getNextNonce, gasTank}).filter(([_, v]) => v))\n\tconst res = await fetchPost(\n\t\tfetch,\n\t\t`${relayerURL}/identity/${this.identity}/${this.network}/estimate?${\n\t\t\t(new URLSearchParams(queryParams)).toString()\n\t\t}`,\n\t\t{ txns: this.txns, signer: this.signer, replacing, minFeeInUSDPerGas: this.minFeeInUSDPerGas }\n\t)\n\tthis.gasLimit = res.gasLimit\n\treturn res\n}\n\nBundle.prototype.sign = async function(wallet, isSingleSigMode) {\n\tif (isNaN(this.nonce)) throw new Error('nonce is not set')\n\tif (isNaN(this.gasLimit)) throw new Error('gasLimit is not set')\n\tconst encoded = getSignable(this, isSingleSigMode)\n\tconst hash = arrayify(keccak256(encoded))\n\tconst signature = await signMsg(wallet, hash)\n\tthis.signature = signature\n\treturn signature\n}\n\nBundle.prototype.submit = async function({ fetch, relayerURL }) {\n\tconst res = await fetchPost(\n\t\tfetch,\n\t\t`${relayerURL}/identity/${this.identity}/${this.network}/submit`,\n\t\t{\n\t\t\tnonce: this.nonce,\n\t\t\tsigner: this.signer,\n\t\t\ttxns: this.txns,\n\t\t\tgasLimit: this.gasLimit,\n\t\t\tsignature: this.signature,\n\t\t\tsignatureTwo: this.signatureTwo,\n\t\t\tmeta: this.meta,\n\t\t\tgasTankFee: this.gasTankFee\n\t\t}\n\t)\n\treturn res\n}\n\nBundle.prototype.cancel = async function({ fetch, relayerURL }) {\n\tconst res = await fetchPost(\n\t\tfetch,\n\t\t`${relayerURL}/identity/${this.identity}/${this.network}/cancel`,\n\t\t{ nonce: this.nonce, signer: this.signer }\n\t)\n\treturn res\n}\n\nconst UNPREDICTABLE_GAS_REGEX = /gas required exceeds allowance|always failing transaction|execution reverted/\nBundle.prototype.estimateNoRelayer = async function({ provider, replacing }) {\n\tconst txParams = {\n\t\tfrom: this.signer.quickAccManager || this.signer.address,\n\t\tto: this.identity,\n\t\tdata: IdentityInterface.encodeFunctionData('executeBySender', [this.txns])\n\t}\n\tconst blockTag = replacing ? 'latest' : 'pending'\n\tconst { error, gasLimit } = await estimateGasWithCatch(provider, blockTag, txParams)\n\tif (error && error.message.startsWith('execution reverted: ')) {\n\t\tconst message = error.message.slice(20)\n\t\treturn { success: false, message }\n\t}\n\tif (error) {\n\t\t// Match both the code and the regex to handle both errs from ethers and raw ones from nodes in case we use .send\n\t\tif (!(error.code === 'UNPREDICTABLE_GAS_LIMIT' || error.message.match(UNPREDICTABLE_GAS_REGEX)))\n\t\t\tthrow error\n\t\treturn { success: false, message: await getErrMsg(provider, txParams, blockTag) }\n\t}\n\tthis.gasLimit = gasLimit.toNumber()\n\t// @TODO EIP1559-optimized estimations (good first issue for external contributors)\n\tconst feeData = await provider.getFeeData()\n\tconst gasPrice = feeData.gasPrice.toNumber()\n\tconst baseFee = (gasPrice * gasLimit) / 1e18\n\treturn {\n\t\tsuccess: true,\n\t\tgasLimit: this.gasLimit,\n\t\tgasPrice,\n\t\tfeeInNative: {\n\t\t\tslow: baseFee * 0.9,\n\t\t\tmedium: baseFee * 1.0,\n\t\t\tfast: baseFee * 1.15,\n\t\t\tape: baseFee * 1.4\n\t\t}\n\t}\n}\n\nasync function signMessage(wallet, identity, signer, message, signatureTwo) {\n\tif (signer.address) return signMsg(wallet, message, true)\n\tif (signer.quickAccManager) {\n\t\tconst signatureOne = await signMsg(wallet, message, true)\n\t\t// the inner sig is the one that the QuickAccManager interprets by doing an abi.decode and sending each individual signature to isValidSignature\n\t\tconst abiCoder = new AbiCoder()\n\t\tconst sigInner = abiCoder.encode(\n\t\t\t['uint', 'bytes', 'bytes'],\n\t\t\t[signer.timelock, signatureOne, signatureTwo]\n\t\t)\n\t\t// 02 is the SmartWallet type sig; we're essentially formatting this as a smart wallet type sig, verified by the quickAccManager\n\t\tconst sig = `${sigInner + abiCoder.encode(['address'], [signer.quickAccManager]).slice(2)}02`\n\t\treturn sig\n\t}\n\tthrow new Error(`invalid signer object`)\n}\n\n\nasync function signMessage712(wallet, identity, signer, domain, types, value, signatureTwo) {\n\tif (signer.address) return signMsg712(wallet, domain, types, value)\n\tif (signer.quickAccManager) {\n\t\tconst signatureOne = await signMsg712(wallet, domain, types, value)\n\t\t// the inner sig is the one that the QuickAccManager interprets by doing an abi.decode and sending each individual signature to isValidSignature\n\t\tconst abiCoder = new AbiCoder()\n\t\tconst sigInner = abiCoder.encode(\n\t\t\t['uint', 'bytes', 'bytes'],\n\t\t\t[signer.timelock, signatureOne, signatureTwo]\n\t\t)\n\t\t// 02 is the SmartWallet type sig; we're essentially formatting this as a smart wallet type sig, verified by the quickAccManager\n\t\tconst sig = `${sigInner + abiCoder.encode(['address'], [signer.quickAccManager]).slice(2)}02`\n\t\treturn sig\n\t}\n\tthrow new Error(`invalid signer object`)\n}\n\nfunction getSignable(userTxnBundle, isSingleSigMode) {\n\tconst abiCoder = new AbiCoder()\n\tconst signer = userTxnBundle.signer\n\tif (signer.address)\n\t\treturn abiCoder.encode(\n\t\t\t['address', 'uint', 'uint', 'tuple(address, uint, bytes)[]'],\n\t\t\t[\n\t\t\t\tuserTxnBundle.identity,\n\t\t\t\tgetChainID(userTxnBundle.network),\n\t\t\t\tuserTxnBundle.nonce,\n\t\t\t\tuserTxnBundle.txns\n\t\t\t]\n\t\t)\n\tif (signer.quickAccManager) {\n\t\tconst accHash = keccak256(\n\t\t\tabiCoder.encode(\n\t\t\t\t['tuple(uint, address, address)'],\n\t\t\t\t[[userTxnBundle.signer.timelock, userTxnBundle.signer.one, userTxnBundle.signer.two]]\n\t\t\t)\n\t\t)\n\t\t// @TODO typed data\n\t\t// if (signer.isTypedData)\n\t\treturn abiCoder.encode(\n\t\t\t['address', 'uint', 'address', 'bytes32', 'uint', 'tuple(address, uint, bytes)[]', 'bool'],\n\t\t\t[\n\t\t\t\tsigner.quickAccManager,\n\t\t\t\tgetChainID(userTxnBundle.network),\n\t\t\t\tuserTxnBundle.identity,\n\t\t\t\taccHash,\n\t\t\t\tuserTxnBundle.nonce,\n\t\t\t\tuserTxnBundle.txns,\n\t\t\t\t!isSingleSigMode\n\t\t\t]\n\t\t)\n\t}\n\tthrow new Error(`invalid signer object`)\n}\n\nfunction getChainID(network) {\n\tif (network === 'ethereum') return 1\n\tif (network === 'polygon') return 137\n\tif (network === 'binance-smart-chain') return 56\n\tif (network === 'bsc') return 56\n\tif (network === 'fantom') return 250\n\tif (network === 'avalanche') return 43114\n\tif (network === 'arbitrum') return 42161\n\tif (network === 'moonbeam') return 1284\n\tif (network === 'moonriver') return 1285\n\tif (network === 'gnosis') return 100\n\tif (network === 'kucoin') return 321\n\tif (network === 'andromeda') return 1088\n\tif (network === 'cronos') return 25\n\tif (network === 'aurora') return 1313161554\n\tif (network === 'rinkeby') return 4\n\tif (network === 'optimism') return 10\n\tthrow new Error(`unsupported network ${network}`)\n}\n\nfunction mapSignatureV(sigRaw) {\n\tconst sig = arrayify(sigRaw)\n\tif (sig[64] < 27) sig[64] += 27\n\treturn hexlify(sig)\n}\n\nasync function signMsg(wallet, message, useFinalDigestSigMode = false) {\n\t// assert.equal(hash.length, 32, 'hash must be 32byte array buffer')\n\t// was 01 originally but to avoid prefixing in solidity, we changed it to 00\n\treturn `${mapSignatureV(await wallet.signMessage(message))}${useFinalDigestSigMode ? '00' : '01'}`\n}\n\nasync function signMsg712(wallet, domain, types, value) {\n\t// 00 is the enum number of SignatureMode.EIP712\n\tconst typedDataSign = await wallet._signTypedData(domain, types, value)\n\treturn `${mapSignatureV(typedDataSign)}00`\n}\n\nasync function getNonce(provider, userTxnBundle) {\n\ttry {\n\t\treturn (userTxnBundle.signer.quickAccManager\n\t\t\t? await new Contract(\n\t\t\t\t\tuserTxnBundle.signer.quickAccManager,\n\t\t\t\t\tQuickAccManagerABI,\n\t\t\t\t\tprovider\n\t\t\t  ).nonces(userTxnBundle.identity)\n\t\t\t: await new Contract(userTxnBundle.identity, IdentityABI, provider).nonce()\n\t\t).toNumber()\n\t} catch (e) {\n\t\t// means the identity isn't deployed, which certainly implies nonce 0\n\t\tif (e.code === 'CALL_EXCEPTION' && (await provider.getCode(userTxnBundle.identity)) === '0x')\n\t\t\treturn 0\n\t\tthrow e\n\t}\n}\n\nasync function fetchPost(fetch, url, body) {\n\tconst r = await fetch(url, {\n\t\theaders: { 'content-type': 'application/json' },\n\t\tmethod: 'POST',\n\t\tbody: JSON.stringify(body)\n\t})\n\treturn r.json()\n}\n\n// helpers for estimateNoRelayer\n\n// Signature of Error(string)\nconst ERROR_SIG = '0x08c379a0'\n\nasync function getErrMsg(provider, txParams, blockTag) {\n\t// .call always returns a hex string with ethers\n\ttry {\n\t\tconst returnData = await provider.call(txParams, blockTag)\n\t\treturn returnData.startsWith(ERROR_SIG)\n\t\t\t? new AbiCoder().decode(['string'], `0x${returnData.slice(10)}`)[0]\n\t\t\t: returnData\n\t} catch (e) {\n\t\t// weird infura case\n\t\tif (e.code === 'UNPREDICTABLE_GAS_LIMIT' && e.error) return e.error.message.slice(20)\n\t\tif (e.code === 'CALL_EXCEPTION') return 'no error string, possibly insufficient amount'\n\t\tif (e.code === 'INVALID_ARGUMENT') return `unable to deserialize: ${hexlify(e.value)}`\n\t\tthrow e\n\t}\n}\n\nasync function estimateGasWithCatch(provider, blockTag, tx) {\n\treturn (\n\t\tprovider\n\t\t\t.send('eth_estimateGas', [tx, blockTag])\n\t\t\t.then(gasLimit => ({ gasLimit: BigNumber.from(gasLimit) }))\n\t\t\t// with .send, the error is wrapped in another error\n\t\t\t.catch(e => (e.code === 'SERVER_ERROR' ? { error: e.error } : { error: e }))\n\t)\n}\n\n// getNonce(require('ethers').getDefaultProvider('homestead'), { identity: '0x23c2c34f38ce66ccc10e71e9bb2a06532d52c5e8', signer: {address: '0x942f9CE5D9a33a82F88D233AEb3292E680230348'}, txns: [] }).then(console.log)\n\nmodule.exports = { Bundle, signMessage, signMessage712, getSignable, signMsg, signMsg712 }\n","// Needed for OUTPACE\nconst channelLib = require('./Channel')\nconst withdrawalLib = require('./Withdraw')\nconst MerkleTree = require('./MerkleTree')\nconst splitSig = require('./splitSig')\n\n// Other utilities\nconst unbondCommitmentlLib = require('./UnbondCommitment')\nconst Permit = require('./Permit')\n\n// Identity and QuickAccManager\nconst bundleLib = require('./Bundle')\n\nmodule.exports = {\n\t...channelLib,\n\t...withdrawalLib,\n\t...unbondCommitmentlLib,\n\t...Permit,\n\t...bundleLib,\n\tMerkleTree,\n\tsplitSig\n}\n","const abi = require('ethereumjs-abi')\nconst keccak256 = require('js-sha3').keccak256\nconst ensure = require('./ensureTypes')\n\nconst ChannelState = {\n\t// hex representation of solidity type(uint256).max\n\tChallenged: '115792089237316195423570985008687907853269984665640564039457584007913129639935',\n\tActive: '0'\n}\n\nfunction Channel(args) {\n\tthis.leader = ensure.Address(args.leader)\n\tthis.follower = ensure.Address(args.follower)\n\tthis.guardian = ensure.Address(args.guardian)\n\tthis.tokenAddr = ensure.Address(args.tokenAddr)\n\tthis.nonce = ensure.Bytes32(args.nonce)\n\n\tObject.freeze(this)\n\n\treturn this\n}\n\nChannel.prototype.hash = function() {\n\treturn Buffer.from(\n\t\tkeccak256.arrayBuffer(\n\t\t\tabi.rawEncode(\n\t\t\t\t['address', 'address', 'address', 'address', 'bytes32'],\n\t\t\t\t[this.leader, this.follower, this.guardian, this.tokenAddr, this.nonce]\n\t\t\t)\n\t\t)\n\t)\n}\n\nChannel.prototype.hashHex = function() {\n\treturn `0x${this.hash().toString('hex')}`\n}\n\nChannel.prototype.toSolidityTuple = function() {\n\treturn [this.leader, this.follower, this.guardian, this.tokenAddr, this.nonce]\n}\n\nChannel.prototype.hashToSign = function(contractAddr, balanceRoot) {\n\t// contains the channel hash (channelId), so that it's not replayable\n\treturn Channel.getSignableStateRoot(contractAddr, this.hashHex(), balanceRoot)\n}\n\nChannel.prototype.hashToSignHex = function(contractAddr, stateRoot) {\n\treturn `0x${this.hashToSign(contractAddr, stateRoot).toString('hex')}`\n}\n\nChannel.prototype.getResumeSignableMessage = function(challengeExpires) {\n\treturn Buffer.from(\n\t\tkeccak256.arrayBuffer(\n\t\t\tabi.solidityPack(\n\t\t\t\t['string', 'bytes32', 'uint256'],\n\t\t\t\t['resume', this.hashHex(), challengeExpires]\n\t\t\t)\n\t\t)\n\t)\n}\n\nChannel.prototype.getResumeSignableMessageHex = function(challengeExpires) {\n\treturn `0x${this.getResumeSignableMessage(challengeExpires).toString('hex')}`\n}\n\n// This returns the same as .hashToSign, .hashToSignHex, but it takes the channelId rather than (the whole channel + contract addr)\nChannel.getSignableStateRoot = function(contractAddr, channelId, balanceRoot) {\n\treturn Buffer.from(\n\t\tkeccak256.arrayBuffer(\n\t\t\tabi.rawEncode(['address', 'bytes32', 'bytes32'], [contractAddr, channelId, balanceRoot])\n\t\t)\n\t)\n}\n\nChannel.getBalanceLeaf = function(acc, amnt) {\n\treturn Buffer.from(keccak256.arrayBuffer(abi.rawEncode(['address', 'uint256'], [acc, amnt])))\n}\n\nChannel.getSpenderBalanceLeaf = function(acc, amnt) {\n\treturn Buffer.from(\n\t\tkeccak256.arrayBuffer(abi.rawEncode(['address', 'string', 'uint256'], [acc, 'spender', amnt]))\n\t)\n}\n\nmodule.exports = { Channel, ChannelState }\n","const ensure = require('./ensureTypes')\n\nfunction Withdraw(args) {\n\tthis.channel = args.channel\n\tthis.balanceTreeAmount = ensure.Uint256(args.balanceTreeAmount)\n\tthis.stateRoot = ensure.Bytes32(args.stateRoot)\n\tthis.sigLeader = ensure.Bytes32Array(args.sigLeader, 3)\n\tthis.sigFollower = ensure.Bytes32Array(args.sigFollower, 3)\n\tthis.proof = ensure.Bytes32Array(args.proof, -1)\n\n\tObject.freeze(this)\n\n\treturn this\n}\n\nWithdraw.prototype.toSolidityTuple = function() {\n\t// etherjs doesn't seem to want BN.js instances; hex is the lowest common denominator for web3/ethers\n\treturn [\n\t\tthis.channel.toSolidityTuple(),\n\t\t`0x${this.balanceTreeAmount.toString(16)}`,\n\t\tthis.stateRoot,\n\t\tthis.sigLeader,\n\t\tthis.sigFollower,\n\t\tthis.proof\n\t]\n}\n\nmodule.exports = { Withdraw }\n","// from https://github.com/ConnextProject/connext-client/blob/master/src/helpers/MerkleTree.js\nconst Buffer = require('buffer').Buffer\nconst keccak256 = require('js-sha3').keccak256\n\nfunction combinedHash(first, second) {\n\tif (!second) {\n\t\treturn first\n\t}\n\tif (!first) {\n\t\treturn second\n\t}\n\tconst sorted = Buffer.concat([first, second].sort(Buffer.compare))\n\n\treturn Buffer.from(keccak256.arrayBuffer(sorted))\n}\n\nfunction deduplicate(buffers) {\n\t// NOTE: performance?\n\treturn buffers.filter((buffer, i) => {\n\t\treturn buffers.findIndex(e => e.equals(buffer)) === i\n\t})\n}\n\nfunction getPair(index, layer) {\n\tconst pairIndex = index % 2 ? index - 1 : index + 1\n\tif (pairIndex < layer.length) {\n\t\treturn layer[pairIndex]\n\t}\n\treturn null\n}\n\nfunction getLayers(elements) {\n\tif (elements.length === 0) {\n\t\treturn [[Buffer.from('')]]\n\t}\n\tconst layers = []\n\tlayers.push(elements)\n\twhile (layers[layers.length - 1].length > 1) {\n\t\tlayers.push(getNextLayer(layers[layers.length - 1]))\n\t}\n\treturn layers\n}\n\nfunction getNextLayer(elements) {\n\treturn elements.reduce((layer, element, index, arr) => {\n\t\tif (index % 2 === 0) {\n\t\t\tlayer.push(combinedHash(element, arr[index + 1]))\n\t\t}\n\t\treturn layer\n\t}, [])\n}\n\nclass MerkleTree {\n\tconstructor(_elements) {\n\t\tif (!_elements.every(b => b.length === 32 && Buffer.isBuffer(b))) {\n\t\t\tthrow new Error('elements must be 32 byte buffers')\n\t\t}\n\t\tconst e = { elements: deduplicate(_elements) }\n\t\tObject.assign(this, e)\n\t\tthis.elements.sort(Buffer.compare)\n\n\t\tconst l = { layers: getLayers(this.elements) }\n\t\tObject.assign(this, l)\n\t}\n\n\tgetRoot() {\n\t\tif (!this.root) {\n\t\t\tconst r = { root: this.layers[this.layers.length - 1][0] }\n\t\t\tObject.assign(this, r)\n\t\t}\n\t\treturn this.root\n\t}\n\n\tverify(proof, element) {\n\t\treturn this.getRoot().equals(proof.reduce((hash, pair) => combinedHash(hash, pair), element))\n\t}\n\n\tproof(element) {\n\t\tlet index = this.elements.findIndex(e => e.equals(element))\n\n\t\tif (index === -1) {\n\t\t\tthrow new Error('element not found in merkle tree')\n\t\t}\n\n\t\treturn this.layers.reduce((proof, layer) => {\n\t\t\tconst pair = getPair(index, layer)\n\t\t\tif (pair) {\n\t\t\t\tproof.push(pair)\n\t\t\t}\n\t\t\tindex = Math.floor(index / 2)\n\t\t\treturn proof\n\t\t}, [])\n\t}\n}\nmodule.exports = MerkleTree\n","function splitSig(inputSig) {\n\tconst sig = inputSig.startsWith('0x') ? inputSig.slice(2) : inputSig\n\tconst r = `0x${sig.substring(0, 64)}`\n\tconst s = `0x${sig.substring(64, 128)}`\n\tlet v = parseInt(sig.substring(128, 130), 16)\n\tif (v < 27) v += 27\n\t// 02 mode is GETH\n\tconst pack = `${'0x02'}${v.toString(\n\t\t16\n\t)}000000000000000000000000000000000000000000000000000000000000`\n\treturn [pack, r, s]\n}\n\nmodule.exports = splitSig\n","const abi = require('ethereumjs-abi')\nconst keccak256 = require('js-sha3').keccak256\nconst ensure = require('./ensureTypes')\n\nfunction UnbondCommitment(args) {\n\tthis.owner = ensure.Address(args.owner)\n\tthis.shares = ensure.Uint256(args.shares)\n\tthis.unlocksAt = ensure.Uint256(args.unlocksAt)\n\n\tObject.freeze(this)\n\treturn this\n}\n\nUnbondCommitment.prototype.hash = function() {\n\tconst buf = abi.rawEncode(\n\t\t['address', 'uint256', 'uint256'],\n\t\t[this.owner, this.shares, this.unlocksAt]\n\t)\n\treturn Buffer.from(keccak256.arrayBuffer(buf))\n}\n\nUnbondCommitment.prototype.hashHex = function() {\n\treturn `0x${this.hash().toString('hex')}`\n}\n\nmodule.exports = { UnbondCommitment }\n","const { keccak256, defaultAbiCoder, toUtf8Bytes, solidityPack } = require('ethers').utils\n\nconst PERMIT_TYPEHASH = keccak256(\n\ttoUtf8Bytes('Permit(address owner,address spender,uint256 value,uint256 nonce,uint256 deadline)')\n)\n\nfunction getDomainSeparator(name, tokenAddress, chainId) {\n\treturn keccak256(\n\t\tdefaultAbiCoder.encode(\n\t\t\t['bytes32', 'bytes32', 'bytes32', 'uint256', 'address'],\n\t\t\t[\n\t\t\t\tkeccak256(\n\t\t\t\t\ttoUtf8Bytes(\n\t\t\t\t\t\t'EIP712Domain(string name,string version,uint256 chainId,address verifyingContract)'\n\t\t\t\t\t)\n\t\t\t\t),\n\t\t\t\tkeccak256(toUtf8Bytes(name)),\n\t\t\t\tkeccak256(toUtf8Bytes('1')),\n\t\t\t\tchainId,\n\t\t\t\ttokenAddress\n\t\t\t]\n\t\t)\n\t)\n}\n\nfunction getApprovalDigest(token, approve, nonce, deadline) {\n\tconst DOMAIN_SEPARATOR = getDomainSeparator(token.name, token.address, token.chainId)\n\n\treturn keccak256(\n\t\tsolidityPack(\n\t\t\t['bytes1', 'bytes1', 'bytes32', 'bytes32'],\n\t\t\t[\n\t\t\t\t'0x19',\n\t\t\t\t'0x01',\n\t\t\t\tDOMAIN_SEPARATOR,\n\t\t\t\tkeccak256(\n\t\t\t\t\tdefaultAbiCoder.encode(\n\t\t\t\t\t\t['bytes32', 'address', 'address', 'uint256', 'uint256', 'uint256'],\n\t\t\t\t\t\t[PERMIT_TYPEHASH, approve.owner, approve.spender, approve.value, nonce, deadline]\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t]\n\t\t)\n\t)\n}\n\nmodule.exports = { getDomainSeparator, getApprovalDigest }\n","/* eslint-disable no-useless-escape */\nconst utils = require('ethereumjs-util')\nconst BN = require('bn.js')\n\nvar ABI = function () {\n}\n\n// Convert from short to canonical names\n// FIXME: optimise or make this nicer?\nfunction elementaryName (name) {\n  if (name.startsWith('int[')) {\n    return 'int256' + name.slice(3)\n  } else if (name === 'int') {\n    return 'int256'\n  } else if (name.startsWith('uint[')) {\n    return 'uint256' + name.slice(4)\n  } else if (name === 'uint') {\n    return 'uint256'\n  } else if (name.startsWith('fixed[')) {\n    return 'fixed128x128' + name.slice(5)\n  } else if (name === 'fixed') {\n    return 'fixed128x128'\n  } else if (name.startsWith('ufixed[')) {\n    return 'ufixed128x128' + name.slice(6)\n  } else if (name === 'ufixed') {\n    return 'ufixed128x128'\n  }\n  return name\n}\n\nABI.eventID = function (name, types) {\n  // FIXME: use node.js util.format?\n  var sig = name + '(' + types.map(elementaryName).join(',') + ')'\n  return utils.keccak256(Buffer.from(sig))\n}\n\nABI.methodID = function (name, types) {\n  return ABI.eventID(name, types).slice(0, 4)\n}\n\n// Parse N from type<N>\nfunction parseTypeN (type) {\n  return parseInt(/^\\D+(\\d+)$/.exec(type)[1], 10)\n}\n\n// Parse N,M from type<N>x<M>\nfunction parseTypeNxM (type) {\n  var tmp = /^\\D+(\\d+)x(\\d+)$/.exec(type)\n  return [ parseInt(tmp[1], 10), parseInt(tmp[2], 10) ]\n}\n\n// Parse N in type[<N>] where \"type\" can itself be an array type.\nfunction parseTypeArray (type) {\n  var tmp = type.match(/(.*)\\[(.*?)\\]$/)\n  if (tmp) {\n    return tmp[2] === '' ? 'dynamic' : parseInt(tmp[2], 10)\n  }\n  return null\n}\n\nfunction parseNumber (arg) {\n  var type = typeof arg\n  if (type === 'string') {\n    if (utils.isHexPrefixed(arg)) {\n      return new BN(utils.stripHexPrefix(arg), 16)\n    } else {\n      return new BN(arg, 10)\n    }\n  } else if (type === 'number') {\n    return new BN(arg)\n  } else if (arg.toArray) {\n    // assume this is a BN for the moment, replace with BN.isBN soon\n    return arg\n  } else {\n    throw new Error('Argument is not a number')\n  }\n}\n\n// someMethod(bytes,uint)\n// someMethod(bytes,uint):(boolean)\nfunction parseSignature (sig) {\n  var tmp = /^(\\w+)\\((.*)\\)$/.exec(sig)\n\n  if (tmp.length !== 3) {\n    throw new Error('Invalid method signature')\n  }\n\n  var args = /^(.+)\\):\\((.+)$/.exec(tmp[2])\n\n  if (args !== null && args.length === 3) {\n    return {\n      method: tmp[1],\n      args: args[1].split(','),\n      retargs: args[2].split(',')\n    }\n  } else {\n    var params = tmp[2].split(',')\n    if (params.length === 1 && params[0] === '') {\n      // Special-case (possibly naive) fixup for functions that take no arguments.\n      // TODO: special cases are always bad, but this makes the function return\n      // match what the calling functions expect\n      params = []\n    }\n    return {\n      method: tmp[1],\n      args: params\n    }\n  }\n}\n\n// Encodes a single item (can be dynamic array)\n// @returns: Buffer\nfunction encodeSingle (type, arg) {\n  var size, num, ret, i\n\n  if (type === 'address') {\n    return encodeSingle('uint160', parseNumber(arg))\n  } else if (type === 'bool') {\n    return encodeSingle('uint8', arg ? 1 : 0)\n  } else if (type === 'string') {\n    return encodeSingle('bytes', Buffer.from(arg, 'utf8'))\n  } else if (isArray(type)) {\n    // this part handles fixed-length ([2]) and variable length ([]) arrays\n    // NOTE: we catch here all calls to arrays, that simplifies the rest\n    if (typeof arg.length === 'undefined') {\n      throw new Error('Not an array?')\n    }\n    size = parseTypeArray(type)\n    if (size !== 'dynamic' && size !== 0 && arg.length > size) {\n      throw new Error('Elements exceed array size: ' + size)\n    }\n    ret = []\n    type = type.slice(0, type.lastIndexOf('['))\n    if (typeof arg === 'string') {\n      arg = JSON.parse(arg)\n    }\n    for (i in arg) {\n      ret.push(encodeSingle(type, arg[i]))\n    }\n    if (size === 'dynamic') {\n      var length = encodeSingle('uint256', arg.length)\n      ret.unshift(length)\n    }\n    return Buffer.concat(ret)\n  } else if (type === 'bytes') {\n    arg = Buffer.from(arg)\n\n    ret = Buffer.concat([ encodeSingle('uint256', arg.length), arg ])\n\n    if ((arg.length % 32) !== 0) {\n      ret = Buffer.concat([ ret, utils.zeros(32 - (arg.length % 32)) ])\n    }\n\n    return ret\n  } else if (type.startsWith('bytes')) {\n    size = parseTypeN(type)\n    if (size < 1 || size > 32) {\n      throw new Error('Invalid bytes<N> width: ' + size)\n    }\n\n    return utils.setLengthRight(arg, 32)\n  } else if (type.startsWith('uint')) {\n    size = parseTypeN(type)\n    if ((size % 8) || (size < 8) || (size > 256)) {\n      throw new Error('Invalid uint<N> width: ' + size)\n    }\n\n    num = parseNumber(arg)\n    if (num.bitLength() > size) {\n      throw new Error('Supplied uint exceeds width: ' + size + ' vs ' + num.bitLength())\n    }\n\n    if (num < 0) {\n      throw new Error('Supplied uint is negative')\n    }\n\n    return num.toArrayLike(Buffer, 'be', 32)\n  } else if (type.startsWith('int')) {\n    size = parseTypeN(type)\n    if ((size % 8) || (size < 8) || (size > 256)) {\n      throw new Error('Invalid int<N> width: ' + size)\n    }\n\n    num = parseNumber(arg)\n    if (num.bitLength() > size) {\n      throw new Error('Supplied int exceeds width: ' + size + ' vs ' + num.bitLength())\n    }\n\n    return num.toTwos(256).toArrayLike(Buffer, 'be', 32)\n  } else if (type.startsWith('ufixed')) {\n    size = parseTypeNxM(type)\n\n    num = parseNumber(arg)\n\n    if (num < 0) {\n      throw new Error('Supplied ufixed is negative')\n    }\n\n    return encodeSingle('uint256', num.mul(new BN(2).pow(new BN(size[1]))))\n  } else if (type.startsWith('fixed')) {\n    size = parseTypeNxM(type)\n\n    return encodeSingle('int256', parseNumber(arg).mul(new BN(2).pow(new BN(size[1]))))\n  }\n\n  throw new Error('Unsupported or invalid type: ' + type)\n}\n\n// Decodes a single item (can be dynamic array)\n// @returns: array\n// FIXME: this method will need a lot of attention at checking limits and validation\nfunction decodeSingle (parsedType, data, offset) {\n  if (typeof parsedType === 'string') {\n    parsedType = parseType(parsedType)\n  }\n  var size, num, ret, i\n\n  if (parsedType.name === 'address') {\n    return decodeSingle(parsedType.rawType, data, offset).toArrayLike(Buffer, 'be', 20).toString('hex')\n  } else if (parsedType.name === 'bool') {\n    return decodeSingle(parsedType.rawType, data, offset).toString() === new BN(1).toString()\n  } else if (parsedType.name === 'string') {\n    var bytes = decodeSingle(parsedType.rawType, data, offset)\n    return Buffer.from(bytes, 'utf8').toString()\n  } else if (parsedType.isArray) {\n    // this part handles fixed-length arrays ([2]) and variable length ([]) arrays\n    // NOTE: we catch here all calls to arrays, that simplifies the rest\n    ret = []\n    size = parsedType.size\n\n    if (parsedType.size === 'dynamic') {\n      offset = decodeSingle('uint256', data, offset).toNumber()\n      size = decodeSingle('uint256', data, offset).toNumber()\n      offset = offset + 32\n    }\n    for (i = 0; i < size; i++) {\n      var decoded = decodeSingle(parsedType.subArray, data, offset)\n      ret.push(decoded)\n      offset += parsedType.subArray.memoryUsage\n    }\n    return ret\n  } else if (parsedType.name === 'bytes') {\n    offset = decodeSingle('uint256', data, offset).toNumber()\n    size = decodeSingle('uint256', data, offset).toNumber()\n    return data.slice(offset + 32, offset + 32 + size)\n  } else if (parsedType.name.startsWith('bytes')) {\n    return data.slice(offset, offset + parsedType.size)\n  } else if (parsedType.name.startsWith('uint')) {\n    num = new BN(data.slice(offset, offset + 32), 16, 'be')\n    if (num.bitLength() > parsedType.size) {\n      throw new Error('Decoded int exceeds width: ' + parsedType.size + ' vs ' + num.bitLength())\n    }\n    return num\n  } else if (parsedType.name.startsWith('int')) {\n    num = new BN(data.slice(offset, offset + 32), 16, 'be').fromTwos(256)\n    if (num.bitLength() > parsedType.size) {\n      throw new Error('Decoded uint exceeds width: ' + parsedType.size + ' vs ' + num.bitLength())\n    }\n\n    return num\n  } else if (parsedType.name.startsWith('ufixed')) {\n    size = new BN(2).pow(new BN(parsedType.size[1]))\n    num = decodeSingle('uint256', data, offset)\n    if (!num.mod(size).isZero()) {\n      throw new Error('Decimals not supported yet')\n    }\n    return num.div(size)\n  } else if (parsedType.name.startsWith('fixed')) {\n    size = new BN(2).pow(new BN(parsedType.size[1]))\n    num = decodeSingle('int256', data, offset)\n    if (!num.mod(size).isZero()) {\n      throw new Error('Decimals not supported yet')\n    }\n    return num.div(size)\n  }\n  throw new Error('Unsupported or invalid type: ' + parsedType.name)\n}\n\n// Parse the given type\n// @returns: {} containing the type itself, memory usage and (including size and subArray if applicable)\nfunction parseType (type) {\n  var size\n  var ret\n  if (isArray(type)) {\n    size = parseTypeArray(type)\n    var subArray = type.slice(0, type.lastIndexOf('['))\n    subArray = parseType(subArray)\n    ret = {\n      isArray: true,\n      name: type,\n      size: size,\n      memoryUsage: size === 'dynamic' ? 32 : subArray.memoryUsage * size,\n      subArray: subArray\n    }\n    return ret\n  } else {\n    var rawType\n    switch (type) {\n      case 'address':\n        rawType = 'uint160'\n        break\n      case 'bool':\n        rawType = 'uint8'\n        break\n      case 'string':\n        rawType = 'bytes'\n        break\n    }\n    ret = {\n      rawType: rawType,\n      name: type,\n      memoryUsage: 32\n    }\n\n    if ((type.startsWith('bytes') && type !== 'bytes') || type.startsWith('uint') || type.startsWith('int')) {\n      ret.size = parseTypeN(type)\n    } else if (type.startsWith('ufixed') || type.startsWith('fixed')) {\n      ret.size = parseTypeNxM(type)\n    }\n\n    if (type.startsWith('bytes') && type !== 'bytes' && (ret.size < 1 || ret.size > 32)) {\n      throw new Error('Invalid bytes<N> width: ' + ret.size)\n    }\n    if ((type.startsWith('uint') || type.startsWith('int')) && (ret.size % 8 || ret.size < 8 || ret.size > 256)) {\n      throw new Error('Invalid int/uint<N> width: ' + ret.size)\n    }\n    return ret\n  }\n}\n\n// Is a type dynamic?\nfunction isDynamic (type) {\n  // FIXME: handle all types? I don't think anything is missing now\n  return (type === 'string') || (type === 'bytes') || (parseTypeArray(type) === 'dynamic')\n}\n\n// Is a type an array?\nfunction isArray (type) {\n  return type.lastIndexOf(']') === type.length - 1\n}\n\n// Encode a method/event with arguments\n// @types an array of string type names\n// @args  an array of the appropriate values\nABI.rawEncode = function (types, values) {\n  var output = []\n  var data = []\n\n  var headLength = 0\n\n  types.forEach(function (type) {\n    if (isArray(type)) {\n      var size = parseTypeArray(type)\n\n      if (size !== 'dynamic') {\n        headLength += 32 * size\n      } else {\n        headLength += 32\n      }\n    } else {\n      headLength += 32\n    }\n  })\n\n  for (var i = 0; i < types.length; i++) {\n    var type = elementaryName(types[i])\n    var value = values[i]\n    var cur = encodeSingle(type, value)\n\n    // Use the head/tail method for storing dynamic data\n    if (isDynamic(type)) {\n      output.push(encodeSingle('uint256', headLength))\n      data.push(cur)\n      headLength += cur.length\n    } else {\n      output.push(cur)\n    }\n  }\n\n  return Buffer.concat(output.concat(data))\n}\n\nABI.rawDecode = function (types, data) {\n  var ret = []\n  data = Buffer.from(data)\n  var offset = 0\n  for (var i = 0; i < types.length; i++) {\n    var type = elementaryName(types[i])\n    var parsed = parseType(type, data, offset)\n    var decoded = decodeSingle(parsed, data, offset)\n    offset += parsed.memoryUsage\n    ret.push(decoded)\n  }\n  return ret\n}\n\nABI.simpleEncode = function (method) {\n  var args = Array.prototype.slice.call(arguments).slice(1)\n  var sig = parseSignature(method)\n\n  // FIXME: validate/convert arguments\n  if (args.length !== sig.args.length) {\n    throw new Error('Argument count mismatch')\n  }\n\n  return Buffer.concat([ ABI.methodID(sig.method, sig.args), ABI.rawEncode(sig.args, args) ])\n}\n\nABI.simpleDecode = function (method, data) {\n  var sig = parseSignature(method)\n\n  // FIXME: validate/convert arguments\n  if (!sig.retargs) {\n    throw new Error('No return values in method')\n  }\n\n  return ABI.rawDecode(sig.retargs, data)\n}\n\nfunction stringify (type, value) {\n  if (type.startsWith('address') || type.startsWith('bytes')) {\n    return '0x' + value.toString('hex')\n  } else {\n    return value.toString()\n  }\n}\n\nABI.stringify = function (types, values) {\n  var ret = []\n\n  for (var i in types) {\n    var type = types[i]\n    var value = values[i]\n\n    // if it is an array type, concat the items\n    if (/^[^\\[]+\\[.*\\]$/.test(type)) {\n      value = value.map(function (item) {\n        return stringify(type, item)\n      }).join(', ')\n    } else {\n      value = stringify(type, value)\n    }\n\n    ret.push(value)\n  }\n\n  return ret\n}\n\nABI.solidityHexValue = function (type, value, bitsize) {\n  // pass in bitsize = null if use default bitsize\n  var size, num\n  if (isArray(type)) {\n    var subType = type.replace(/\\[.*?\\]/, '')\n    if (!isArray(subType)) {\n      var arraySize = parseTypeArray(type)\n      if (arraySize !== 'dynamic' && arraySize !== 0 && value.length > arraySize) {\n        throw new Error('Elements exceed array size: ' + arraySize)\n      }\n    }\n    var arrayValues = value.map(function (v) {\n      return ABI.solidityHexValue(subType, v, 256)\n    })\n    return Buffer.concat(arrayValues)\n  } else if (type === 'bytes') {\n    return value\n  } else if (type === 'string') {\n    return Buffer.from(value, 'utf8')\n  } else if (type === 'bool') {\n    bitsize = bitsize || 8\n    var padding = Array((bitsize) / 4).join('0')\n    return Buffer.from(value ? padding + '1' : padding + '0', 'hex')\n  } else if (type === 'address') {\n    var bytesize = 20\n    if (bitsize) {\n      bytesize = bitsize / 8\n    }\n    return utils.setLengthLeft(value, bytesize)\n  } else if (type.startsWith('bytes')) {\n    size = parseTypeN(type)\n    if (size < 1 || size > 32) {\n      throw new Error('Invalid bytes<N> width: ' + size)\n    }\n\n    return utils.setLengthRight(value, size)\n  } else if (type.startsWith('uint')) {\n    size = parseTypeN(type)\n    if ((size % 8) || (size < 8) || (size > 256)) {\n      throw new Error('Invalid uint<N> width: ' + size)\n    }\n\n    num = parseNumber(value)\n    if (num.bitLength() > size) {\n      throw new Error('Supplied uint exceeds width: ' + size + ' vs ' + num.bitLength())\n    }\n\n    bitsize = bitsize || size\n    return num.toArrayLike(Buffer, 'be', bitsize / 8)\n  } else if (type.startsWith('int')) {\n    size = parseTypeN(type)\n    if ((size % 8) || (size < 8) || (size > 256)) {\n      throw new Error('Invalid int<N> width: ' + size)\n    }\n\n    num = parseNumber(value)\n    if (num.bitLength() > size) {\n      throw new Error('Supplied int exceeds width: ' + size + ' vs ' + num.bitLength())\n    }\n\n    bitsize = bitsize || size\n    return num.toTwos(size).toArrayLike(Buffer, 'be', bitsize / 8)\n  } else {\n    // FIXME: support all other types\n    throw new Error('Unsupported or invalid type: ' + type)\n  }\n}\n\nABI.solidityPack = function (types, values) {\n  if (types.length !== values.length) {\n    throw new Error('Number of types are not matching the values')\n  }\n\n  var ret = []\n\n  for (var i = 0; i < types.length; i++) {\n    var type = elementaryName(types[i])\n    var value = values[i]\n    ret.push(ABI.solidityHexValue(type, value, null))\n  }\n\n  return Buffer.concat(ret)\n}\n\nABI.soliditySHA3 = function (types, values) {\n  return utils.keccak256(ABI.solidityPack(types, values))\n}\n\nABI.soliditySHA256 = function (types, values) {\n  return utils.sha256(ABI.solidityPack(types, values))\n}\n\nABI.solidityRIPEMD160 = function (types, values) {\n  return utils.ripemd160(ABI.solidityPack(types, values), true)\n}\n\n// Serpent's users are familiar with this encoding\n// - s: string\n// - b: bytes\n// - b<N>: bytes<N>\n// - i: int256\n// - a: int256[]\n\nfunction isNumeric (c) {\n  // FIXME: is this correct? Seems to work\n  return (c >= '0') && (c <= '9')\n}\n\n// For a \"documentation\" refer to https://github.com/ethereum/serpent/blob/develop/preprocess.cpp\nABI.fromSerpent = function (sig) {\n  var ret = []\n  for (var i = 0; i < sig.length; i++) {\n    var type = sig[i]\n    if (type === 's') {\n      ret.push('bytes')\n    } else if (type === 'b') {\n      var tmp = 'bytes'\n      var j = i + 1\n      while ((j < sig.length) && isNumeric(sig[j])) {\n        tmp += sig[j] - '0'\n        j++\n      }\n      i = j - 1\n      ret.push(tmp)\n    } else if (type === 'i') {\n      ret.push('int256')\n    } else if (type === 'a') {\n      ret.push('int256[]')\n    } else {\n      throw new Error('Unsupported or invalid type: ' + type)\n    }\n  }\n  return ret\n}\n\nABI.toSerpent = function (types) {\n  var ret = []\n  for (var i = 0; i < types.length; i++) {\n    var type = types[i]\n    if (type === 'bytes') {\n      ret.push('s')\n    } else if (type.startsWith('bytes')) {\n      ret.push('b' + parseTypeN(type))\n    } else if (type === 'int256') {\n      ret.push('i')\n    } else if (type === 'int256[]') {\n      ret.push('a')\n    } else {\n      throw new Error('Unsupported or invalid type: ' + type)\n    }\n  }\n  return ret.join('')\n}\n\nmodule.exports = ABI\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.secp256k1 = exports.rlp = exports.BN = void 0;\nvar secp256k1 = require('./secp256k1v3-adapter');\nexports.secp256k1 = secp256k1;\nvar ethjsUtil = require('ethjs-util');\nvar BN = require(\"bn.js\");\nexports.BN = BN;\nvar rlp = require(\"rlp\");\nexports.rlp = rlp;\nObject.assign(exports, ethjsUtil);\n/**\n * Constants\n */\n__exportStar(require(\"./constants\"), exports);\n/**\n * Public-key cryptography (secp256k1) and addresses\n */\n__exportStar(require(\"./account\"), exports);\n/**\n * Hash functions\n */\n__exportStar(require(\"./hash\"), exports);\n/**\n * ECDSA signature\n */\n__exportStar(require(\"./signature\"), exports);\n/**\n * Utilities for manipulating Buffers, byte arrays, etc.\n */\n__exportStar(require(\"./bytes\"), exports);\n/**\n * Function for definining properties on an object\n */\n__exportStar(require(\"./object\"), exports);\n//# sourceMappingURL=index.js.map","\"use strict\";\n// This file is imported from secp256k1 v3\n// https://github.com/cryptocoinjs/secp256k1-node/blob/master/LICENSE\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar BN = require(\"bn.js\");\nvar EC = require('elliptic').ec;\nvar ec = new EC('secp256k1');\nvar ecparams = ec.curve;\nexports.privateKeyExport = function (privateKey, compressed) {\n    if (compressed === void 0) { compressed = true; }\n    var d = new BN(privateKey);\n    if (d.ucmp(ecparams.n) >= 0) {\n        throw new Error(\"couldn't export to DER format\");\n    }\n    var point = ec.g.mul(d);\n    return toPublicKey(point.getX(), point.getY(), compressed);\n};\nexports.privateKeyModInverse = function (privateKey) {\n    var bn = new BN(privateKey);\n    if (bn.ucmp(ecparams.n) >= 0 || bn.isZero()) {\n        throw new Error('private key range is invalid');\n    }\n    return bn.invm(ecparams.n).toArrayLike(Buffer, 'be', 32);\n};\nexports.signatureImport = function (sigObj) {\n    var r = new BN(sigObj.r);\n    if (r.ucmp(ecparams.n) >= 0) {\n        r = new BN(0);\n    }\n    var s = new BN(sigObj.s);\n    if (s.ucmp(ecparams.n) >= 0) {\n        s = new BN(0);\n    }\n    return Buffer.concat([r.toArrayLike(Buffer, 'be', 32), s.toArrayLike(Buffer, 'be', 32)]);\n};\nexports.ecdhUnsafe = function (publicKey, privateKey, compressed) {\n    if (compressed === void 0) { compressed = true; }\n    var point = ec.keyFromPublic(publicKey);\n    var scalar = new BN(privateKey);\n    if (scalar.ucmp(ecparams.n) >= 0 || scalar.isZero()) {\n        throw new Error('scalar was invalid (zero or overflow)');\n    }\n    var shared = point.pub.mul(scalar);\n    return toPublicKey(shared.getX(), shared.getY(), compressed);\n};\nvar toPublicKey = function (x, y, compressed) {\n    var publicKey;\n    if (compressed) {\n        publicKey = Buffer.alloc(33);\n        publicKey[0] = y.isOdd() ? 0x03 : 0x02;\n        x.toArrayLike(Buffer, 'be', 32).copy(publicKey, 1);\n    }\n    else {\n        publicKey = Buffer.alloc(65);\n        publicKey[0] = 0x04;\n        x.toArrayLike(Buffer, 'be', 32).copy(publicKey, 1);\n        y.toArrayLike(Buffer, 'be', 32).copy(publicKey, 33);\n    }\n    return publicKey;\n};\n//# sourceMappingURL=index.js.map","\"use strict\";\n// This file is imported from secp256k1 v3\n// https://github.com/cryptocoinjs/secp256k1-node/blob/master/LICENSE\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar EC_PRIVKEY_EXPORT_DER_COMPRESSED = Buffer.from([\n    // begin\n    0x30,\n    0x81,\n    0xd3,\n    0x02,\n    0x01,\n    0x01,\n    0x04,\n    0x20,\n    // private key\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    // middle\n    0xa0,\n    0x81,\n    0x85,\n    0x30,\n    0x81,\n    0x82,\n    0x02,\n    0x01,\n    0x01,\n    0x30,\n    0x2c,\n    0x06,\n    0x07,\n    0x2a,\n    0x86,\n    0x48,\n    0xce,\n    0x3d,\n    0x01,\n    0x01,\n    0x02,\n    0x21,\n    0x00,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xfe,\n    0xff,\n    0xff,\n    0xfc,\n    0x2f,\n    0x30,\n    0x06,\n    0x04,\n    0x01,\n    0x00,\n    0x04,\n    0x01,\n    0x07,\n    0x04,\n    0x21,\n    0x02,\n    0x79,\n    0xbe,\n    0x66,\n    0x7e,\n    0xf9,\n    0xdc,\n    0xbb,\n    0xac,\n    0x55,\n    0xa0,\n    0x62,\n    0x95,\n    0xce,\n    0x87,\n    0x0b,\n    0x07,\n    0x02,\n    0x9b,\n    0xfc,\n    0xdb,\n    0x2d,\n    0xce,\n    0x28,\n    0xd9,\n    0x59,\n    0xf2,\n    0x81,\n    0x5b,\n    0x16,\n    0xf8,\n    0x17,\n    0x98,\n    0x02,\n    0x21,\n    0x00,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xfe,\n    0xba,\n    0xae,\n    0xdc,\n    0xe6,\n    0xaf,\n    0x48,\n    0xa0,\n    0x3b,\n    0xbf,\n    0xd2,\n    0x5e,\n    0x8c,\n    0xd0,\n    0x36,\n    0x41,\n    0x41,\n    0x02,\n    0x01,\n    0x01,\n    0xa1,\n    0x24,\n    0x03,\n    0x22,\n    0x00,\n    // public key\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n]);\nvar EC_PRIVKEY_EXPORT_DER_UNCOMPRESSED = Buffer.from([\n    // begin\n    0x30,\n    0x82,\n    0x01,\n    0x13,\n    0x02,\n    0x01,\n    0x01,\n    0x04,\n    0x20,\n    // private key\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    // middle\n    0xa0,\n    0x81,\n    0xa5,\n    0x30,\n    0x81,\n    0xa2,\n    0x02,\n    0x01,\n    0x01,\n    0x30,\n    0x2c,\n    0x06,\n    0x07,\n    0x2a,\n    0x86,\n    0x48,\n    0xce,\n    0x3d,\n    0x01,\n    0x01,\n    0x02,\n    0x21,\n    0x00,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xfe,\n    0xff,\n    0xff,\n    0xfc,\n    0x2f,\n    0x30,\n    0x06,\n    0x04,\n    0x01,\n    0x00,\n    0x04,\n    0x01,\n    0x07,\n    0x04,\n    0x41,\n    0x04,\n    0x79,\n    0xbe,\n    0x66,\n    0x7e,\n    0xf9,\n    0xdc,\n    0xbb,\n    0xac,\n    0x55,\n    0xa0,\n    0x62,\n    0x95,\n    0xce,\n    0x87,\n    0x0b,\n    0x07,\n    0x02,\n    0x9b,\n    0xfc,\n    0xdb,\n    0x2d,\n    0xce,\n    0x28,\n    0xd9,\n    0x59,\n    0xf2,\n    0x81,\n    0x5b,\n    0x16,\n    0xf8,\n    0x17,\n    0x98,\n    0x48,\n    0x3a,\n    0xda,\n    0x77,\n    0x26,\n    0xa3,\n    0xc4,\n    0x65,\n    0x5d,\n    0xa4,\n    0xfb,\n    0xfc,\n    0x0e,\n    0x11,\n    0x08,\n    0xa8,\n    0xfd,\n    0x17,\n    0xb4,\n    0x48,\n    0xa6,\n    0x85,\n    0x54,\n    0x19,\n    0x9c,\n    0x47,\n    0xd0,\n    0x8f,\n    0xfb,\n    0x10,\n    0xd4,\n    0xb8,\n    0x02,\n    0x21,\n    0x00,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xff,\n    0xfe,\n    0xba,\n    0xae,\n    0xdc,\n    0xe6,\n    0xaf,\n    0x48,\n    0xa0,\n    0x3b,\n    0xbf,\n    0xd2,\n    0x5e,\n    0x8c,\n    0xd0,\n    0x36,\n    0x41,\n    0x41,\n    0x02,\n    0x01,\n    0x01,\n    0xa1,\n    0x44,\n    0x03,\n    0x42,\n    0x00,\n    // public key\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n    0x00,\n]);\nexports.privateKeyExport = function (privateKey, publicKey, compressed) {\n    if (compressed === void 0) { compressed = true; }\n    var result = Buffer.from(compressed ? EC_PRIVKEY_EXPORT_DER_COMPRESSED : EC_PRIVKEY_EXPORT_DER_UNCOMPRESSED);\n    privateKey.copy(result, compressed ? 8 : 9);\n    publicKey.copy(result, compressed ? 181 : 214);\n    return result;\n};\nexports.privateKeyImport = function (privateKey) {\n    var length = privateKey.length;\n    // sequence header\n    var index = 0;\n    if (length < index + 1 || privateKey[index] !== 0x30)\n        return null;\n    index += 1;\n    // sequence length constructor\n    if (length < index + 1 || !(privateKey[index] & 0x80))\n        return null;\n    var lenb = privateKey[index] & 0x7f;\n    index += 1;\n    if (lenb < 1 || lenb > 2)\n        return null;\n    if (length < index + lenb)\n        return null;\n    // sequence length\n    var len = privateKey[index + lenb - 1] | (lenb > 1 ? privateKey[index + lenb - 2] << 8 : 0);\n    index += lenb;\n    if (length < index + len)\n        return null;\n    // sequence element 0: version number (=1)\n    if (length < index + 3 ||\n        privateKey[index] !== 0x02 ||\n        privateKey[index + 1] !== 0x01 ||\n        privateKey[index + 2] !== 0x01) {\n        return null;\n    }\n    index += 3;\n    // sequence element 1: octet string, up to 32 bytes\n    if (length < index + 2 ||\n        privateKey[index] !== 0x04 ||\n        privateKey[index + 1] > 0x20 ||\n        length < index + 2 + privateKey[index + 1]) {\n        return null;\n    }\n    return privateKey.slice(index + 2, index + 2 + privateKey[index + 1]);\n};\nexports.signatureImportLax = function (signature) {\n    var r = Buffer.alloc(32, 0);\n    var s = Buffer.alloc(32, 0);\n    var length = signature.length;\n    var index = 0;\n    // sequence tag byte\n    if (signature[index++] !== 0x30) {\n        return null;\n    }\n    // sequence length byte\n    var lenbyte = signature[index++];\n    if (lenbyte & 0x80) {\n        index += lenbyte - 0x80;\n        if (index > length) {\n            return null;\n        }\n    }\n    // sequence tag byte for r\n    if (signature[index++] !== 0x02) {\n        return null;\n    }\n    // length for r\n    var rlen = signature[index++];\n    if (rlen & 0x80) {\n        lenbyte = rlen - 0x80;\n        if (index + lenbyte > length) {\n            return null;\n        }\n        for (; lenbyte > 0 && signature[index] === 0x00; index += 1, lenbyte -= 1)\n            ;\n        for (rlen = 0; lenbyte > 0; index += 1, lenbyte -= 1)\n            rlen = (rlen << 8) + signature[index];\n    }\n    if (rlen > length - index) {\n        return null;\n    }\n    var rindex = index;\n    index += rlen;\n    // sequence tag byte for s\n    if (signature[index++] !== 0x02) {\n        return null;\n    }\n    // length for s\n    var slen = signature[index++];\n    if (slen & 0x80) {\n        lenbyte = slen - 0x80;\n        if (index + lenbyte > length) {\n            return null;\n        }\n        for (; lenbyte > 0 && signature[index] === 0x00; index += 1, lenbyte -= 1)\n            ;\n        for (slen = 0; lenbyte > 0; index += 1, lenbyte -= 1)\n            slen = (slen << 8) + signature[index];\n    }\n    if (slen > length - index) {\n        return null;\n    }\n    var sindex = index;\n    index += slen;\n    // ignore leading zeros in r\n    for (; rlen > 0 && signature[rindex] === 0x00; rlen -= 1, rindex += 1)\n        ;\n    // copy r value\n    if (rlen > 32) {\n        return null;\n    }\n    var rvalue = signature.slice(rindex, rindex + rlen);\n    rvalue.copy(r, 32 - rvalue.length);\n    // ignore leading zeros in s\n    for (; slen > 0 && signature[sindex] === 0x00; slen -= 1, sindex += 1)\n        ;\n    // copy s value\n    if (slen > 32) {\n        return null;\n    }\n    var svalue = signature.slice(sindex, sindex + slen);\n    svalue.copy(s, 32 - svalue.length);\n    return { r: r, s: s };\n};\n//# sourceMappingURL=der.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.KECCAK256_RLP = exports.KECCAK256_RLP_S = exports.KECCAK256_RLP_ARRAY = exports.KECCAK256_RLP_ARRAY_S = exports.KECCAK256_NULL = exports.KECCAK256_NULL_S = exports.TWO_POW256 = exports.MAX_INTEGER = void 0;\nvar BN = require(\"bn.js\");\n/**\n * The max integer that this VM can handle\n */\nexports.MAX_INTEGER = new BN('ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff', 16);\n/**\n * 2^256\n */\nexports.TWO_POW256 = new BN('10000000000000000000000000000000000000000000000000000000000000000', 16);\n/**\n * Keccak-256 hash of null\n */\nexports.KECCAK256_NULL_S = 'c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470';\n/**\n * Keccak-256 hash of null\n */\nexports.KECCAK256_NULL = Buffer.from(exports.KECCAK256_NULL_S, 'hex');\n/**\n * Keccak-256 of an RLP of an empty array\n */\nexports.KECCAK256_RLP_ARRAY_S = '1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347';\n/**\n * Keccak-256 of an RLP of an empty array\n */\nexports.KECCAK256_RLP_ARRAY = Buffer.from(exports.KECCAK256_RLP_ARRAY_S, 'hex');\n/**\n * Keccak-256 hash of the RLP of null\n */\nexports.KECCAK256_RLP_S = '56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421';\n/**\n * Keccak-256 hash of the RLP of null\n */\nexports.KECCAK256_RLP = Buffer.from(exports.KECCAK256_RLP_S, 'hex');\n//# sourceMappingURL=constants.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.importPublic = exports.privateToPublic = exports.privateToAddress = exports.publicToAddress = exports.pubToAddress = exports.isValidPublic = exports.isValidPrivate = exports.isPrecompiled = exports.generateAddress2 = exports.generateAddress = exports.isValidChecksumAddress = exports.toChecksumAddress = exports.isZeroAddress = exports.isValidAddress = exports.zeroAddress = void 0;\nvar assert = require('assert');\nvar ethjsUtil = require('ethjs-util');\nvar secp256k1 = require('./secp256k1v3-adapter');\nvar BN = require(\"bn.js\");\nvar bytes_1 = require(\"./bytes\");\nvar hash_1 = require(\"./hash\");\n/**\n * Returns a zero address.\n */\nexports.zeroAddress = function () {\n    var addressLength = 20;\n    var addr = bytes_1.zeros(addressLength);\n    return bytes_1.bufferToHex(addr);\n};\n/**\n * Checks if the address is a valid. Accepts checksummed addresses too.\n */\nexports.isValidAddress = function (address) {\n    return /^0x[0-9a-fA-F]{40}$/.test(address);\n};\n/**\n * Checks if a given address is a zero address.\n */\nexports.isZeroAddress = function (address) {\n    var zeroAddr = exports.zeroAddress();\n    return zeroAddr === bytes_1.addHexPrefix(address);\n};\n/**\n * Returns a checksummed address.\n *\n * If a eip1191ChainId is provided, the chainId will be included in the checksum calculation. This\n * has the effect of checksummed addresses for one chain having invalid checksums for others.\n * For more details, consult EIP-1191.\n *\n * WARNING: Checksums with and without the chainId will differ. As of 2019-06-26, the most commonly\n * used variation in Ethereum was without the chainId. This may change in the future.\n */\nexports.toChecksumAddress = function (address, eip1191ChainId) {\n    address = ethjsUtil.stripHexPrefix(address).toLowerCase();\n    var prefix = eip1191ChainId !== undefined ? eip1191ChainId.toString() + '0x' : '';\n    var hash = hash_1.keccak(prefix + address).toString('hex');\n    var ret = '0x';\n    for (var i = 0; i < address.length; i++) {\n        if (parseInt(hash[i], 16) >= 8) {\n            ret += address[i].toUpperCase();\n        }\n        else {\n            ret += address[i];\n        }\n    }\n    return ret;\n};\n/**\n * Checks if the address is a valid checksummed address.\n *\n * See toChecksumAddress' documentation for details about the eip1191ChainId parameter.\n */\nexports.isValidChecksumAddress = function (address, eip1191ChainId) {\n    return exports.isValidAddress(address) && exports.toChecksumAddress(address, eip1191ChainId) === address;\n};\n/**\n * Generates an address of a newly created contract.\n * @param from The address which is creating this new address\n * @param nonce The nonce of the from account\n */\nexports.generateAddress = function (from, nonce) {\n    from = bytes_1.toBuffer(from);\n    var nonceBN = new BN(nonce);\n    if (nonceBN.isZero()) {\n        // in RLP we want to encode null in the case of zero nonce\n        // read the RLP documentation for an answer if you dare\n        return hash_1.rlphash([from, null]).slice(-20);\n    }\n    // Only take the lower 160bits of the hash\n    return hash_1.rlphash([from, Buffer.from(nonceBN.toArray())]).slice(-20);\n};\n/**\n * Generates an address for a contract created using CREATE2.\n * @param from The address which is creating this new address\n * @param salt A salt\n * @param initCode The init code of the contract being created\n */\nexports.generateAddress2 = function (from, salt, initCode) {\n    var fromBuf = bytes_1.toBuffer(from);\n    var saltBuf = bytes_1.toBuffer(salt);\n    var initCodeBuf = bytes_1.toBuffer(initCode);\n    assert(fromBuf.length === 20);\n    assert(saltBuf.length === 32);\n    var address = hash_1.keccak256(Buffer.concat([Buffer.from('ff', 'hex'), fromBuf, saltBuf, hash_1.keccak256(initCodeBuf)]));\n    return address.slice(-20);\n};\n/**\n * Returns true if the supplied address belongs to a precompiled account (Byzantium).\n */\nexports.isPrecompiled = function (address) {\n    var a = bytes_1.unpad(address);\n    return a.length === 1 && a[0] >= 1 && a[0] <= 8;\n};\n/**\n * Checks if the private key satisfies the rules of the curve secp256k1.\n */\nexports.isValidPrivate = function (privateKey) {\n    return secp256k1.privateKeyVerify(privateKey);\n};\n/**\n * Checks if the public key satisfies the rules of the curve secp256k1\n * and the requirements of Ethereum.\n * @param publicKey The two points of an uncompressed key, unless sanitize is enabled\n * @param sanitize Accept public keys in other formats\n */\nexports.isValidPublic = function (publicKey, sanitize) {\n    if (sanitize === void 0) { sanitize = false; }\n    if (publicKey.length === 64) {\n        // Convert to SEC1 for secp256k1\n        return secp256k1.publicKeyVerify(Buffer.concat([Buffer.from([4]), publicKey]));\n    }\n    if (!sanitize) {\n        return false;\n    }\n    return secp256k1.publicKeyVerify(publicKey);\n};\n/**\n * Returns the ethereum address of a given public key.\n * Accepts \"Ethereum public keys\" and SEC1 encoded keys.\n * @param pubKey The two points of an uncompressed key, unless sanitize is enabled\n * @param sanitize Accept public keys in other formats\n */\nexports.pubToAddress = function (pubKey, sanitize) {\n    if (sanitize === void 0) { sanitize = false; }\n    pubKey = bytes_1.toBuffer(pubKey);\n    if (sanitize && pubKey.length !== 64) {\n        pubKey = secp256k1.publicKeyConvert(pubKey, false).slice(1);\n    }\n    assert(pubKey.length === 64);\n    // Only take the lower 160bits of the hash\n    return hash_1.keccak(pubKey).slice(-20);\n};\nexports.publicToAddress = exports.pubToAddress;\n/**\n * Returns the ethereum address of a given private key.\n * @param privateKey A private key must be 256 bits wide\n */\nexports.privateToAddress = function (privateKey) {\n    return exports.publicToAddress(exports.privateToPublic(privateKey));\n};\n/**\n * Returns the ethereum public key of a given private key.\n * @param privateKey A private key must be 256 bits wide\n */\nexports.privateToPublic = function (privateKey) {\n    privateKey = bytes_1.toBuffer(privateKey);\n    // skip the type flag and use the X, Y points\n    return secp256k1.publicKeyCreate(privateKey, false).slice(1);\n};\n/**\n * Converts a public key to the Ethereum format.\n */\nexports.importPublic = function (publicKey) {\n    publicKey = bytes_1.toBuffer(publicKey);\n    if (publicKey.length !== 64) {\n        publicKey = secp256k1.publicKeyConvert(publicKey, false).slice(1);\n    }\n    return publicKey;\n};\n//# sourceMappingURL=account.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.hashPersonalMessage = exports.isValidSignature = exports.fromRpcSig = exports.toRpcSig = exports.ecrecover = exports.ecsign = void 0;\nvar secp256k1 = require('./secp256k1v3-adapter');\nvar BN = require(\"bn.js\");\nvar bytes_1 = require(\"./bytes\");\nvar hash_1 = require(\"./hash\");\n/**\n * Returns the ECDSA signature of a message hash.\n */\nexports.ecsign = function (msgHash, privateKey, chainId) {\n    var sig = secp256k1.sign(msgHash, privateKey);\n    var recovery = sig.recovery;\n    var ret = {\n        r: sig.signature.slice(0, 32),\n        s: sig.signature.slice(32, 64),\n        v: chainId ? recovery + (chainId * 2 + 35) : recovery + 27,\n    };\n    return ret;\n};\n/**\n * ECDSA public key recovery from signature.\n * @returns Recovered public key\n */\nexports.ecrecover = function (msgHash, v, r, s, chainId) {\n    var signature = Buffer.concat([bytes_1.setLength(r, 32), bytes_1.setLength(s, 32)], 64);\n    var recovery = calculateSigRecovery(v, chainId);\n    if (!isValidSigRecovery(recovery)) {\n        throw new Error('Invalid signature v value');\n    }\n    var senderPubKey = secp256k1.recover(msgHash, signature, recovery);\n    return secp256k1.publicKeyConvert(senderPubKey, false).slice(1);\n};\n/**\n * Convert signature parameters into the format of `eth_sign` RPC method.\n * @returns Signature\n */\nexports.toRpcSig = function (v, r, s, chainId) {\n    var recovery = calculateSigRecovery(v, chainId);\n    if (!isValidSigRecovery(recovery)) {\n        throw new Error('Invalid signature v value');\n    }\n    // geth (and the RPC eth_sign method) uses the 65 byte format used by Bitcoin\n    return bytes_1.bufferToHex(Buffer.concat([bytes_1.setLengthLeft(r, 32), bytes_1.setLengthLeft(s, 32), bytes_1.toBuffer(v)]));\n};\n/**\n * Convert signature format of the `eth_sign` RPC method to signature parameters\n * NOTE: all because of a bug in geth: https://github.com/ethereum/go-ethereum/issues/2053\n */\nexports.fromRpcSig = function (sig) {\n    var buf = bytes_1.toBuffer(sig);\n    // NOTE: with potential introduction of chainId this might need to be updated\n    if (buf.length !== 65) {\n        throw new Error('Invalid signature length');\n    }\n    var v = buf[64];\n    // support both versions of `eth_sign` responses\n    if (v < 27) {\n        v += 27;\n    }\n    return {\n        v: v,\n        r: buf.slice(0, 32),\n        s: buf.slice(32, 64),\n    };\n};\n/**\n * Validate a ECDSA signature.\n * @param homesteadOrLater Indicates whether this is being used on either the homestead hardfork or a later one\n */\nexports.isValidSignature = function (v, r, s, homesteadOrLater, chainId) {\n    if (homesteadOrLater === void 0) { homesteadOrLater = true; }\n    var SECP256K1_N_DIV_2 = new BN('7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a0', 16);\n    var SECP256K1_N = new BN('fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141', 16);\n    if (r.length !== 32 || s.length !== 32) {\n        return false;\n    }\n    if (!isValidSigRecovery(calculateSigRecovery(v, chainId))) {\n        return false;\n    }\n    var rBN = new BN(r);\n    var sBN = new BN(s);\n    if (rBN.isZero() || rBN.gt(SECP256K1_N) || sBN.isZero() || sBN.gt(SECP256K1_N)) {\n        return false;\n    }\n    if (homesteadOrLater && sBN.cmp(SECP256K1_N_DIV_2) === 1) {\n        return false;\n    }\n    return true;\n};\n/**\n * Returns the keccak-256 hash of `message`, prefixed with the header used by the `eth_sign` RPC call.\n * The output of this function can be fed into `ecsign` to produce the same signature as the `eth_sign`\n * call for a given `message`, or fed to `ecrecover` along with a signature to recover the public key\n * used to produce the signature.\n */\nexports.hashPersonalMessage = function (message) {\n    var prefix = Buffer.from(\"\\u0019Ethereum Signed Message:\\n\" + message.length.toString(), 'utf-8');\n    return hash_1.keccak(Buffer.concat([prefix, message]));\n};\nfunction calculateSigRecovery(v, chainId) {\n    return chainId ? v - (2 * chainId + 35) : v - 27;\n}\nfunction isValidSigRecovery(recovery) {\n    return recovery === 0 || recovery === 1;\n}\n//# sourceMappingURL=signature.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.defineProperties = void 0;\nvar assert = require('assert');\nvar ethjsUtil = require('ethjs-util');\nvar rlp = require(\"rlp\");\nvar bytes_1 = require(\"./bytes\");\n/**\n * Defines properties on a `Object`. It make the assumption that underlying data is binary.\n * @param self the `Object` to define properties on\n * @param fields an array fields to define. Fields can contain:\n * * `name` - the name of the properties\n * * `length` - the number of bytes the field can have\n * * `allowLess` - if the field can be less than the length\n * * `allowEmpty`\n * @param data data to be validated against the definitions\n * @deprecated\n */\nexports.defineProperties = function (self, fields, data) {\n    self.raw = [];\n    self._fields = [];\n    // attach the `toJSON`\n    self.toJSON = function (label) {\n        if (label === void 0) { label = false; }\n        if (label) {\n            var obj_1 = {};\n            self._fields.forEach(function (field) {\n                obj_1[field] = \"0x\" + self[field].toString('hex');\n            });\n            return obj_1;\n        }\n        return bytes_1.baToJSON(self.raw);\n    };\n    self.serialize = function serialize() {\n        return rlp.encode(self.raw);\n    };\n    fields.forEach(function (field, i) {\n        self._fields.push(field.name);\n        function getter() {\n            return self.raw[i];\n        }\n        function setter(v) {\n            v = bytes_1.toBuffer(v);\n            if (v.toString('hex') === '00' && !field.allowZero) {\n                v = Buffer.allocUnsafe(0);\n            }\n            if (field.allowLess && field.length) {\n                v = bytes_1.stripZeros(v);\n                assert(field.length >= v.length, \"The field \" + field.name + \" must not have more \" + field.length + \" bytes\");\n            }\n            else if (!(field.allowZero && v.length === 0) && field.length) {\n                assert(field.length === v.length, \"The field \" + field.name + \" must have byte length of \" + field.length);\n            }\n            self.raw[i] = v;\n        }\n        Object.defineProperty(self, field.name, {\n            enumerable: true,\n            configurable: true,\n            get: getter,\n            set: setter,\n        });\n        if (field.default) {\n            self[field.name] = field.default;\n        }\n        // attach alias\n        if (field.alias) {\n            Object.defineProperty(self, field.alias, {\n                enumerable: false,\n                configurable: true,\n                set: setter,\n                get: getter,\n            });\n        }\n    });\n    // if the constuctor is passed data\n    if (data) {\n        if (typeof data === 'string') {\n            data = Buffer.from(ethjsUtil.stripHexPrefix(data), 'hex');\n        }\n        if (Buffer.isBuffer(data)) {\n            data = rlp.decode(data);\n        }\n        if (Array.isArray(data)) {\n            if (data.length > self._fields.length) {\n                throw new Error('wrong number of fields in data');\n            }\n            // make sure all the items are buffers\n            data.forEach(function (d, i) {\n                self[self._fields[i]] = bytes_1.toBuffer(d);\n            });\n        }\n        else if (typeof data === 'object') {\n            var keys_1 = Object.keys(data);\n            fields.forEach(function (field) {\n                if (keys_1.indexOf(field.name) !== -1)\n                    self[field.name] = data[field.name];\n                if (keys_1.indexOf(field.alias) !== -1)\n                    self[field.alias] = data[field.alias];\n            });\n        }\n        else {\n            throw new Error('invalid data');\n        }\n    }\n};\n//# sourceMappingURL=object.js.map","// It costs around 19k to send a token, if that token was interacted with before in the same transaction,\n// because of SLOAD costs - they depend on whether a slot has been read\n// however, it costs 30k if the token has not been interacted with\n// we may decrease it a bit and lean on the relayer failsafe values (cfg.gasAddedOnEstimate) later on\nconst ADDED_GAS_TOKEN = 30000\nconst ADDED_GAS_NATIVE = 12000\n\nexport function isTokenEligible(token, speed, estimation, isGasTankEnabled, network) {\n  if (estimation?.relayerless && token?.address === '0x0000000000000000000000000000000000000000') return true\n  if (!token) return false\n  const { feeInFeeToken } = getFeesData(token, estimation, speed, isGasTankEnabled, network)\n  const balanceInFeeToken = (parseInt(token.balance) / Math.pow(10, token.decimals))\n  return balanceInFeeToken > feeInFeeToken\n}\n\nexport function getAddedGas(token) {\n  return !token?.address || token?.address === '0x0000000000000000000000000000000000000000'\n    ? ADDED_GAS_NATIVE\n    : ADDED_GAS_TOKEN\n}\n\n// can't think of a less funny name for that\nexport function getFeePaymentConsequences(token, estimation, isGasTankEnabled) {\n  // Relayerless mode\n  if (!estimation?.feeInUSD || !token) return { multiplier: 1, addedGas: 0 }\n  // Relayer mode\n  const addedGas = getAddedGas(token)\n  // If Gas Tank enabled\n  if (!!isGasTankEnabled) return { addedGas: 0, multiplier: 1 }\n\n  return {\n    // otherwise we get very long floating point numbers with trailing .999999\n    multiplier: parseFloat(((estimation.gasLimit + addedGas) / estimation.gasLimit).toFixed(4)),\n    addedGas\n  }\n}\n\nconst contractErrors = ['caller is a contract', 'caller is another contract', 'contract not allowed', 'contract not supported', 'No contractz allowed', 'o contracts', /*no */'contracts allowed', /* c or C*/'ontract is not allowed', 'aller must be user', 'aller must be a user', 'ontract call not allowed']\n\nexport function mapTxnErrMsg(msg) {\n  if (!msg) return\n  if (msg.includes('Router: EXPIRED')) return 'Swap expired'\n  if (msg.includes('Router: INSUFFICIENT_OUTPUT_AMOUNT')) return 'Swap will suffer slippage higher than your requirements'\n  if (msg.includes('INSUFFICIENT_PRIVILEGE')) return 'Your signer address is not authorized.'\n  if (contractErrors.find(contractMsg => msg.includes(contractMsg))) return 'This dApp does not support smart wallets.'\n  return msg\n}\n\nexport function getErrHint(msg) {\n  if (!msg) return\n  if (msg.includes('Router: EXPIRED')) return 'Try performing the swap again'\n  if (msg.includes('Router: INSUFFICIENT_OUTPUT_AMOUNT')) return 'Try performing the swap again or increase your slippage requirements'\n  if (msg.includes('INSUFFICIENT_PRIVILEGE')) return 'If you set a new signer for this account, try re-adding the account.'\n  if (contractErrors.find(contractMsg => msg.includes(contractMsg))) {\n    return 'WARNING! We detected that this dApp intentionally blocks smart contract calls. This is a highly disruptive practice, as it breaks support for all smart wallets (Ambire, Gnosis Safe and others). We recommend you report this to the dApp ASAP and ask them to fix it.'\n    // return 'This dApp does not support smart wallets or purposefully excludes them. Contact the dApp developers to tell them to implement smart wallets by not blocking contract interactions and/or implementing EIP1271.'\n  }\n  return 'Sending this transaction batch would have resulted in an error, so we prevented it.'\n}\n\nexport function checkIfDAppIncompatible(msg) {\n  return contractErrors.find(contractMsg => msg.includes(contractMsg))\n}\n\nexport function toHexAmount(amnt, decimals) {\n  return '0x' + Math.round(amnt * Math.pow(10, decimals)).toString(16)\n}\n\nexport function getDiscountApplied(amnt, discount = 0) {\n  if (!discount) return 0\n  if (!amnt) return 0\n  if (discount === 1) return amnt\n  return amnt / (1 - discount) * discount\n}\n\n// Returns feeToken data with all multipliers applied\nexport function getFeesData(feeToken, estimation, speed, isGasTankEnabled, network) {\n  const { addedGas, multiplier } = getFeePaymentConsequences(feeToken, estimation, isGasTankEnabled)\n  const savedGas = getAddedGas(feeToken)\n  const discountMultiplier = 1 - (feeToken?.discount || 0)\n  const totalMultiplier = multiplier * discountMultiplier\n  const nativeRate = feeToken?.nativeRate || 1\n  const isCrossChainNativeSelected = isGasTankEnabled && feeToken.address === '0x0000000000000000000000000000000000000000' && (network.id !== feeToken.network)\n  const feeInNative = estimation.customFee\n    ? ((estimation.customFee * discountMultiplier) / nativeRate)\n    : !isCrossChainNativeSelected ? \n        estimation.feeInNative[speed] * totalMultiplier : \n        (((estimation.feeInNative[speed] * totalMultiplier) / nativeRate) * estimation.nativeAssetPriceInUSD) / feeToken.price\n  const feeInUSD = !isNaN(estimation.nativeAssetPriceInUSD) ? \n    !isCrossChainNativeSelected ? \n      feeInNative * estimation.nativeAssetPriceInUSD : \n      feeInNative * feeToken.price : \n    undefined\n  const feeInFeeToken = feeInNative * nativeRate\n\n  return {\n    feeInNative,\n    feeInUSD,\n    feeInFeeToken,\n    addedGas, // use it bundle data\n    savedGas,\n  }\n}\n","import './TxnPreview.scss'\n\nimport { useState, Fragment, useEffect  } from 'react'\n\nimport { getName, getTransactionSummary, isKnown } from 'lib/humanReadableTransactions'\nimport networks from 'consts/networks'\nimport { formatUnits } from 'ethers/lib/utils'\nimport { ToolTip } from 'components/common'\nimport { HiOutlineExternalLink } from 'react-icons/hi'\nimport { MdOutlineClose } from 'react-icons/md'\nimport { BsChevronDown, BsChevronUp } from 'react-icons/bs'\nimport { getTokenIcon } from 'lib/icons'\nimport { formatFloatTokenAmount } from 'lib/formatters'\nimport { setKnownAddressNames } from 'lib/humanReadableTransactions'\nimport useConstants from 'hooks/useConstants'\n\nfunction getNetworkSymbol(networkId) {\n  const network = networks.find(x => x.id === networkId)\n  return network ? network.nativeAssetSymbol : 'UNKNW'\n}\n\nfunction parseExtendedSummaryItem(item, i, networkDetails) {\n  if (item.length === 1) return item\n\n  if (i === 0) return (<div className={`action ${item.toLowerCase()}`} key={`item-${i}`}>{ item }</div>)\n\n  if (!item.type) return (<div className='word' key={`item-${i}`}>{ item }</div>)\n  if (item.type === 'token') {\n    return (\n    <div className='token' key={`item-${i}`}>\n      { item.amount > 0 && <span>{ formatFloatTokenAmount(item.amount, true, item.decimals) }</span> }\n      { item.decimals !== null && item.symbol ? \n        <Fragment>\n          {item.address &&\n            <div className='icon' \n              style={{ backgroundImage: `url(${getTokenIcon(networkDetails.id, item.address)})` }}>\n            </div>}\n          {item.symbol}\n        </Fragment>\n        : (item.amount > 0) ? 'units of unknown token' : null \n      }\n    </div>\n  )}\n\n  if (item.type === 'address') return (\n    <a\n      className='address'\n      key={`item-${i}`}\n      href={item.address ? `${networkDetails.explorerUrl}/address/${item.address}` : null}\n      target=\"_blank\"\n      rel=\"noreferrer\"\n      onClick={e => e.stopPropagation()}\n    >\n      <ToolTip disabled={!item.address} label={item.address}>\n        { item.name ? item.name : item.address }\n        { item.address ? <HiOutlineExternalLink/> : null }\n      </ToolTip>\n    </a>\n  )\n\n  if (item.type === 'network') return (\n    <div className='network' key={`item-${i}`}>\n      { item.icon ? <div className='icon' style={{ backgroundImage: `url(${item.icon})` }}></div> : null }\n      { item.name }\n    </div>\n  )\n\n  if (item.type === 'erc721') {\n    const canShowLink = item.network && item.address && item.id\n    return (\n      <a\n        className='erc721'\n        key={`item-${i}`}\n        href={canShowLink ? `#/wallet/nft/${item.network}/${item.address}/${item.id}` : null}\n        target=\"_blank\"\n        rel=\"noreferrer\"\n        onClick={e => e.stopPropagation()}\n      >\n        { item.name }\n        { canShowLink ? <HiOutlineExternalLink/> : null }\n      </a>\n    )\n  }\n\n  return <></>\n}\n\nexport default function TxnPreview ({ txn, onDismiss, network, account, isFirstFailing, mined, disableExpand, disableDismiss, disableDismissLabel, addressLabel = null }) {\n  const { constants: { tokenList, humanizerInfo } } = useConstants()\n  const [isExpanded, setExpanded] = useState(false)\n  const contractName = getName(humanizerInfo, txn[0])\n\n  const networkDetails = networks.find(({ id }) => id === network)\n  const extendedSummary = getTransactionSummary(humanizerInfo, tokenList, txn, network, account, { mined, extended: true })\n\n  const summary = (extendedSummary.map(entry => Array.isArray(entry) ? entry.map((item, i) => parseExtendedSummaryItem(item, i, networkDetails)) : (entry))) // If entry is extended summary parse it\n  useEffect(() => !!addressLabel && setKnownAddressNames(addressLabel), [addressLabel])\n  \n  return (\n    <div className={isFirstFailing ? 'txnPreview firstFailing' : 'txnPreview'}>\n        <div className=\"heading\">\n          <div className=\"info\" onClick={() => !disableExpand && setExpanded(e => !e)}>\n            <div className=\"summary-container\">\n              {!disableExpand && (<div className='expandTxn'>\n                {isExpanded ? (<BsChevronUp/>) : (<BsChevronDown/>)}\n              </div>)}\n              <div className=\"summary\">{ summary }</div>\n            </div>\n            {isFirstFailing && (<div className='firstFailingLabel'>This is the first failing transaction.</div>)}\n              {!isFirstFailing && !mined && !isKnown(humanizerInfo, txn, account) && (<div className='unknownWarning'>Warning: interacting with an unknown contract or address.</div>)}\n          </div>\n          <div className='actionIcons'>\n            {onDismiss ? (\n              <ToolTip disabled={!disableDismiss || !disableDismissLabel} label={disableDismissLabel}>\n                <div className={`dismissTxn ${disableDismiss ? 'disabled' : ''}`} onClick={e => { e.stopPropagation(); !disableDismiss && onDismiss.apply(this, e) }}><MdOutlineClose/></div>\n              </ToolTip>\n            ) : (<></>)}\n          </div>\n        </div>\n        {\n          isExpanded ? (<div className='advanced'>\n            <div><b>Interacting with (<i>to</i>):</b> {txn[0]}{contractName ? ` (${contractName})` : ''}</div>\n            <div><b>Value to be sent (<i>value</i>):</b> {formatUnits(txn[1] || '0x0', 18)} {getNetworkSymbol(network)}</div>\n            <div><b>Data:</b> {txn[2]}</div>\n          </div>) : (<></>)\n        }\n    </div>\n  )\n}\n","// @ts-ignore adex-protocol-eth package doesn't have any types written\nimport IdentityFactoryABI from 'adex-protocol-eth/abi/IdentityFactory'\nimport { Interface } from 'ethers/lib/utils'\n\nimport accountPresets from '../../constants/accountPresets'\n\nconst IdentityFactory = new Interface(IdentityFactoryABI)\n\n// Pass deploySalt (eg `id('IsAmbireIdentity')`) to deploy contracts at the same address across chains\nexport function toBundleTxn(\n  { to, value, data, deploySalt }: { to: string; value: string; data: string; deploySalt: string },\n  from: string\n) {\n  // Transactions with no `to` are interpreted by the Ethereum network as CREATE (contract deployment) if they come from an EOA\n  // however, our accounts are not EOAs, so we will just call the factory with a user-specific nonce, that's also identifiable (0x6942)\n  if (to === '0x' || !to) {\n    const salt =\n      deploySalt || `0x69420000000000${Date.now().toString(16).slice(1, 9)}00${from.slice(2)}`\n    return [\n      accountPresets.identityFactoryAddr,\n      value,\n      IdentityFactory.encodeFunctionData('deploy', [data, salt])\n    ]\n  }\n  return [to, value || '0x0', data || '0x']\n}\n"],"sourceRoot":""}